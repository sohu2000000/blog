cscope 15 $HOME/workspace/src/study/sohu2000000.github.io/content/kernel/src/linux-0.11 -q 0000005011 0000430150
	@boot/bootsect.s

2 ! 
SYS_SIZE
 
is
 
the
 
numb
 
of
 
	$icks
 (16 
bys

to
 
be
 
lded
.

3 ! 0x3000 
is
 0x30000 
bys
 = 196
kB
, 
me
 
th
 
ough
 
cut


4 ! 
vsis
 
of
 
lux


5 ! 
SYS_SIZE
 是要加载的系统模块的长度，单位是节 1节 = 16字节， 0x3000 字节 = 196
kB
。

6 ！这里定义了
syem
模块长度，所以
makefe
中的规则就失效了

8 
SYSSIZE
 = 0x3000

10 ! 
bo٣
.
	`s
 (
C
1991 
Lus
 
Tvds


12 ! 
bo٣
.
s
 
is
 
lded
 

 0x7c00 
by
 
the
 
bios
-
tup
 
routes
, 
d
 
moves


13 ! 
ilf
 
out
 
of
 
the
 
way
 
to
 
addss
 0x90000, 
d
 
jumps
 
the
.

15 ! 
It
 
th
 
lds
 'tup' 
dely
 
a
 
	`lf
 (0x90200), 
d
 
the
 
syem


16 ! 

 0x10000, 
usg
 
BIOS
 
us
.

18 ! 
NOTE
! 
cuy
 
syem
 
is
 

 
mo
 8*65536 
bys
 . 
This
 
should
 
be
 
no


19 ! 
obm
, 
ev
 

 
the
 
futu
. 
I
 
wt
 
to
 
kp
 

 
sime
. 
This
 512 
kB


20 ! 
kl
 
size
 
should
 
be
 
ough
, 
eecy
 
as
 
this
 
dۢ
't containhe

21 ! 
bufr
 
che
 
as
 

 
mix


23 ! 
The
 
ld
 
has
 
bn
 
made
 
as
 
sime

possib
, 
d
 
ctuos


24 ! 
ad
 
rs
 
wl
 
su
 

 
a
 
unbakab
 
lo
. 
Rebo
 
by
 
hd
. 
It


25 ! 
lds
 
ty
 

 
by
 
gtg
 
whe
 
s
 

 
a
 
time
 
whev
 
possib
.

28 ! .
globl
 或 .
glob
 用于定义随后的标识符是外部的或全局的，并且即使不使用也强制引入。

29 ! .
xt
 .
da
 .
bss
 分别定义当前代码段、数据段和未初始化数据段。

30 .
globl
 
begxt
, 
begda
, 
begbss
, 
dxt
, 
dda
, 
dbss
 !定义了6个全局标识符

31 .
xt
 !文本段

32 
begxt
:

33 .
da
 !数据段

34 
begda
:

35 .
bss
 !未初始化数据段

36 
begbss
:

37 .
xt


39 
SETUPLEN
 = 4 ! 

 
of
 
tup
-
s
 setup程序的扇区(setup-sectors)值

40 
BOOTSEG
 = 0x07c0 ! 
ig
 
addss
 
of
 
bo
-

 
bo٣
的原始值(是段地址)

41 
INITSEG
 = 0x9000 ! 
we
 
move
 
bo
 
he
 - 
out
 
of
 
the
 
way
 将
bo٣
移到这里

42 
SETUPSEG
 = 0x9020 ! 
tup
 
ts
 
he
 setup程序从这里开始

43 
SYSSEG
 = 0x1000 ! 
syem
 
lded
 

 0x10000 (65536). syem模块加载到0x10000(64
KB
)处

44 
ENDSEG
 = 
SYSSEG
 + 
SYSSIZE
 ! 
whe
 
to
 

 
ldg
 停止加载的段地址

46 ! 
ROOT_DEV
: 0x000 - 
me
 
ty
 
of
 
py
 
as
 
bo
. 根文件系统设备与引导使用同样的软驱设备

47 ! 0x301 - 
f
 
i
 

 f 
drive
 
c
 根文件系统设备在第一个硬盘的第一个分区上。

48 
ROOT_DEV
 = 0x306

50 
y
 
t
 !告诉链接程序，程序从标号start开始执行

51 
t
:

52 
mov
 
ax
,#BOOTSEG !设置
ds
为0x07c0(段地址)

53 
mov
 
ds
,
ax


54 
mov
 
ax
,#INITSEG !设置
es
为0x9000(段地址)

55 
mov
 
es
,
ax


56 
mov
 
cx
,#256 !移动计数值256个字

57 
sub
 
si
,s!源地址 
ds
:si = 0x07c0:0x0000

58 
sub
 
di
,d!目的地址 
es
:di = 0x9000:0x0000

59 
p
 !重复执行并
cx
的值，直到cx 0

60 
movw
 !串传送指令，从[
si
]移动
cx
个字到[
di
]处。从
t
开始到这里，这段程序将
bo٣
从0x07c0复制到0x9000处

61 
jmpi
 
go
,
INITSEG
 !段间跳转，INITSEG 指跳转到的段地址， 标号go是段内偏移地址。

62 
go
: 
mov
 
ax
,
cs
 !设置
ds
，
ss
和
es
为复制代码后代码所在的段。

63 
mov
 
ds
,
ax


64 
mov
 
es
,
ax


65 ! 
put
 
ack
 

 0x9ff00.

66 
mov
 
ss
,
ax


67 
mov
 

,#0
xFF00
 ! 
bry
 
vue
 >>512 设置栈顶指针，远大于512个字节偏移。

69 ! 
ld
 
the
 
tup
-
s
 
dely
 
a
h
boblock
.

70 ! 
Ne
 
th
 'es' 
is
 
ady
 
t
 
up
.

72 !加载 
tup
 模块代码数据，注意 
es
已经指向了 0x9000处，不用再设置。

73 !将
tup
从磁盘第二个扇区读到0x90200开始处，共读4个扇区。如果读出错，则复位驱动器并重读。

74 
ld_tup
:

75 
mov
 
dx
,#0
x0000
 ! 
drive
 0, 
hd
 0 对驱动器0进行操作

76 
mov
 
cx
,#0
x0002
 ! 

 2, 
ack
 0

77 
mov
 
bx
,#0
x0200
 ! 
addss
 = 512, 

 
INITSEG


78 
mov
 
ax
,#0
x0200
+
SETUPLEN
 ! 
rvi
 2, 

 
of
 
s


79 0x13 ! 
ad
 



80 
jnc
 
ok_ld_tup
 ! 
ok
 - 

81 
mov
 
dx
,#0
x0000


82 
mov
 
ax
,#0
x0000
 ! 
t
 
the
 
disk


84 
j
 
ld_tup
 ! j 即
jmp
指令

86 
ok_ld_tup
:

88 ! 
G
 
disk
 
drive
 
ms
, 
ecifiy
 

 
of
 
s
/
ack


91 
mov
 
dl
,#0
x00


92 
mov
 
ax
,#0
x0800
 ! 
AH
=8 
is
 
g
 
drive
 
ms


94 
mov
 
ch
,#0
x00


95 
g
 
cs


96 
mov
 
s
,
cx


97 
mov
 
ax
,#INITSEG

98 
mov
 
es
,
ax


100 ! 
Prt
 
some
 
e
 
mesge
 在屏幕上显示
msg1
指向的字符串，"Ldg syem ..."

102 
mov
 
ah
,#0
x03
 ! 
ad
 
curs
 
pos


103 
x
 
bh
,bh

106 
mov
 
cx
,#24

107 
mov
 
bx
,#0
x0007
 ! 
ge
 0, 
ibu
 7 (
nm
)

108 
mov
 
bp
,#msg1

109 
mov
 
ax
,#0
x1301
 ! 
wre
 
rg
, 
move
 
curs


112 ! 
ok
, 
we
've writtenhe message,ow 现在开始将system模块加载到 0x10000处(64KB处)

113 ! 
we
 
wt
 
to
 
ld
 
the
 
	$syem
 (

 0x10000)

115 
mov
 
ax
,#SYSSEG

116 
mov
 
es
,
ax
 ! 
gmt
 
of
 0x010000

117 

 
ad_
 ! 读磁盘上的
syem
模块，
es
为输入参数

118 

 
kl_m
 ! 关闭驱动马达，这样就可以知道驱动器的状态了。

120 ! 
A
 
th
 
we
 
check
 
which
 
ro
-
devi
 
to
 
u
. 
If
 
the
 devi 
is


121 ! 
	`defed
 (!0), 
nhg
 
is
 
de
 
d
 
the
 
giv
 
devi
 i
ud
.

122 ! 
Othwi
, 
eh
 /
dev
/
	$PS0
 (2,28

 /
dev
/
	`0
 (2,8), 
ddg


123 ! 

 
the
 
numb
 
of
 
s
 
th
h
BIOS
 
pts
 
cuy
.

125 
g
 
cs


126 
mov
 
ax
,
ro_dev


127 
cmp
 
ax
,#0

128 
j
 
ro_defed


129 
g
 
cs


130 
mov
 
bx
,
s


131 
mov
 
ax
,#0
x0208
 ! /
dev
/
ps0
 - 1.2
Mb


132 
cmp
 
bx
,#15 ! 判断每磁道扇区数是否为15

133 
je
 
ro_defed


134 
mov
 
ax
,#0
x021c
 ! /
dev
/
PS0
 - 1.44
Mb


135 
cmp
 
bx
,#18 ! 判断每磁道扇区数是否为18

136 
je
 
ro_defed


137 
undef_ro
:

138 
jmp
 
undef_ro
 如果根文件系统设备都不对，则死循环。

139 
ro_defed
:

140 
g
 
cs


141 
mov
 
ro_dev
,
ax
 ! 将检查过的设备号保存到oot_dev 中

143 ! 
a
 
	`th
 (
evytg
 
lded
), 
we
 
jump
 
to


144 ! 
the
 
tup
-
route
 
lded
 
dely
 
a


145 ! 
the
 
boblock
:

147 
jmpi
 0,
SETUPSEG
 ! 到这里所有的文件都已经加载完毕，程序跳转到
tup
文件中去执行。

149 !!!!! 
bo٣
.
s
 执行到这里就结束了。 下面是两个子程序。

152 ! 
This
 
route
 
lds
 
the
 
syem
 

 
addss
 0x10000, 
makg
 
su


153 ! 
no
 64
kB
 
bounds
 
e
 
osd
. 
We
 
y
 
to
 
ld
 

 
as
 

s

154 ! 
possib
, 
ldg
 
whe
 
acks
 
whev
 
we
 
n
.

156 ! 

: 
es
 - 
tg
 
addss
 
	`gmt
 (
nmly
 0x1000)

158 
d
: .
wd
 1+
SETUPLEN
 ! 
s
 
ad
 
of
 
cut
 
ack
 当前磁道中已读扇区数

159 
hd
: .
wd
 0 ! 
cut
 head 当前磁头号

160 
ack
: .
wd
 0 ! 
cut
rack 当前磁道号

162 
ad_
:

163 
mov
 
ax
,
es


164 

 
ax
,#0
x0fff


165 
d
: 
j
 d ! 
es
 
mu
 
be
 

 64
kB
 
boundy


166 
x
 
bx
,bx ! bx 
is
 
tg
 
addss
 
wh
 
gmt


167 
_ad
:

168 
mov
 
ax
,
es


169 
cmp
 
ax
,#ENDSEG ! 
have
 
we
 
lded
 
l
 
y
?

170 
jb
 
ok1_ad


171 
t


172 
ok1_ad
:

173 
g
 
cs


174 
mov
 
ax
,
s


175 
sub
 
ax
,
d


176 
mov
 
cx
,
ax


177 
shl
 
cx
,#9

178 
add
 
cx
,
bx


179 
jnc
 
ok2_ad


180 
je
 
ok2_ad


181 
x
 
ax
,ax

182 
sub
 
ax
,
bx


183 
shr
 
ax
,#9

184 
ok2_ad
:

185 

 
ad_ack


186 
mov
 
cx
,
ax


187 
add
 
ax
,
d


188 
g
 
cs


189 
cmp
 
ax
,
s


190 
j
 
ok3_ad


191 
mov
 
ax
,#1

192 
sub
 
ax
,
hd


193 
j
 
ok4_ad


194 
c
 
ack


195 
ok4_ad
:

196 
mov
 
hd
,
ax


197 
x
 
ax
,ax

198 
ok3_ad
:

199 
mov
 
d
,
ax


200 
shl
 
cx
,#9

201 
add
 
bx
,
cx


202 
jnc
 
_ad


203 
mov
 
ax
,
es


204 
add
 
ax
,#0
x1000


205 
mov
 
es
,
ax


206 
x
 
bx
,bx

207 
jmp
 
_ad


209 
ad_ack
:

210 
push
 
ax


211 
push
 
bx


212 
push
 
cx


213 
push
 
dx


214 
mov
 
dx
,
ack


215 
mov
 
cx
,
d


216 
c
 
cx


217 
mov
 
ch
,
dl


218 
mov
 
dx
,
hd


219 
mov
 
dh
,
dl


220 
mov
 
dl
,#0

221 
d
 
dx
,#0
x0100


222 
mov
 
ah
,#2

224 
jc
 
bad_


225 
p
 
dx


226 
p
 
cx


227 
p
 
bx


228 
p
 
ax


229 
t


230 
bad_
: 
mov
 
ax
,#0

231 
mov
 
dx
,#0

233 
p
 
dx


234 
p
 
cx


235 
p
 
bx


236 
p
 
ax


237 
jmp
 
ad_ack


244 
kl_m
:

245 
push
 
dx


246 
mov
 
dx
,#0
x3f2
 !软驱控制卡的数字输出寄存器(
DOR
)端口，只写

247 
mov
 

,#0 !
A
驱动器，关闭
FDC
，禁止
DMA
和中断请求，关闭马达。

248 
outb
 !将

中的内容输出到
dx
指定的端口。

249 
p
 
dx


250 
t


252 
s
:

253 .
wd
 0 !存放当前启动软盘每磁道的存储扇区数。

255 
msg1
: !调用
BIOS
中断显示的信息

256 .
by
 13,10 !回车，换行的
ASC
Ⅱ码

257 .
ascii
 "Loading system ..."

258 .
by
 13,10,13,10 !共24个
ASC
Ⅱ码字符

260 .
g
 508 !表示语句从地址508(0x01fc)开始，所以
ro_dev
在启动扇区的第508开始的2个字节中。

261 
ro_dev
:

262 .
wd
 
ROOT_DEV
 !这里存放根文件系统所在设备号(

/
ma
.
c
 中会用到)

263 
bo_ag
:

264 .
wd
 0xAA55 !启动盘具有有效引导扇区的标志，仅供
BIOS
中程序加载引导扇区时识别使用。

267 .
xt


268 
dxt
:

269 .
da


270 
dda
:

271 .
bss


272 
dbss
:

	@boot/head.s

15 #hd.
s
 含有32位启动代码

18 .
	gxt


19 .
globl
 
	g_idt
,
	g_gdt
,
	g_pg_d
,
_tmp_py_


20 
	g_pg_d
: #页目录将会存放到这里
hd
 起始位置: 0x00000000)

24 #这里已经处于 32 为模式，这里 
$0x10
 并不是并不是把地址 0x10 装入各个段寄存器，是全局描述符表中

26 #这里 
$0x10
 的含义是，请求特权级0(0-1=0),选择全局描述符表(位2=0),选择全局描述符表中
dex
 = 2的第三个段描述符，内核数据段描述符(位3-15=2)。

28 #
#下面代码的含义是：设置
ds
,
es
,
fs
,
gs
 为 
tup
.
s
 中构造的数据段的选择符=0x10。并将堆栈

29 #设置在
ack_t
 指向的 
ur_ack
 数组区，然后使用本程序后面定义的中断描述符表和全局描述符表。

30 #新的全局描述符表内容与
tup
.
s
中基本一样，仅段限长从8
MB
修改为 16MB。

31 #
_32: #设置各个数据段寄存器

32 
movl
 
	g$0x10
,%
	gx
 #gnu 汇编，每个直接操作数需要以'$'开头，否则表示地址

33 
	gmov
 %
	gax
,%
	gds
 #每个寄存器名都需要以'%'开头，
	gx
表示的是32为的ax寄存器

34 
	gmov
 %
	gax
,%
es


35 
	gmov
 %
	gax
,%
fs


36 
	gmov
 %
	gax
,%
gs


37 
lss
 
	g_ack_t
,%
	ge
 #表示 _ack_指向 
	gss
:
e
,设置系统栈

38 

 
	gtup_idt
 #调用设置中断描述符表子程序

39 

 
	gtup_gdt
 #调用设置全局描述符表子程序

42 
movl
 
	g$0x10
,%
	gx
 #ld 
l
 
the
 
gmt
 
gis


43 
	gmov
 %
	gax
,%
	gds
 #a 
chgg
 
	ggdt
. 
CS
 
was
 
ady


44 
	gmov
 %
	gax
,%
	ges
 #lded 
	g
 'setup_gdt'

45 
	gmov
 %
	gax
,%
fs


46 
	gmov
 %
	gax
,%
gs


47 
lss
 
	g_ack_t
,%
e


48 
	gxl
 %
	gx
,%eax

49 1: 

 %
x
 #check 
th
 
A20
 
ly
 
IS
 
abd


50 
movl
 %
x
,0x000000 #lo 
fev
 

 
	gi
't

51 
	gcm
 %
	gx
,0x100000

52 
	gje
 1b

59 
	gmovl
 %
	g0
,%
	gx
 #check 
mh
 
ch


60 
dl
 
	g$0x80000011
,%
	gx
 #Sav
	gPG
,
	gPE
,
ET


62 
l
 
	g$2
,%
	gx
 #
MP


63 
	gmovl
 %
	gx
,%
0


64 

 
check_x87


65 
jmp
 
a_ge_bs


70 
	gcheck_x87
:

71 
⚙


72 
fsw
 %
ax


73 
cmpb
 
$0
,%



74 
	gje
 1f

75 
	gmovl
 %
	g0
,%
x


76 
xl
 
	g$6
,%
x


77 
	gmovl
 %
	gx
,%
0


78 
	gt


79 .
	gign
 2

80 1: .
by
 0xDB,0xE4

81 
t


94 
	gtup_idt
:

95 
a
 
igne_t
,%
edx


96 
movl
 
	g$0x00080000
,%
x


97 
	gmovw
 %
	gdx
,%
ax


98 
movw
 
	g$0x8E00
,%
dx


100 
a
 
	g_idt
,%
edi


101 
mov
 
	g$256
,%
ecx


102 
	g_sidt
:

103 
movl
 %
x
,(%
	gedi
)

104 
	gmovl
 %
	gedx
,4(%
	gedi
)

105 
addl
 
	g$8
,%
edi


106 
	gdec
 %
ecx


107 
j
 
_sidt


108 
lidt
 
idt_des


109 
t


121 
	gtup_gdt
:

122 
lgdt
 
gdt_des


123 
t


130 .
g
 0x1000 #4
K
 第一个页表页面
pg0
起始地址

131 
pg0
:

133 .
g
 0x2000 #8
K
 第二个页表页面
pg1
起始地址

134 
pg1
:

136 .
g
 0x3000 #12
K
 第二个页表页面
pg2
起始地址

137 
pg2
:

139 .
g
 0x4000 #16
K
 第三个页表页面
pg3
起始地址

140 
pg3
:

142 .
g
 0x5000

148 
_tmp_py_
:

149 .
fl
 1024,1,0

151 
	ga_ge_bs
:

152 
pushl
 
$0
 #The 
e
 
the
 
ms
 
to
 
ma
 :-)

153 
pushl
 
$0


154 
pushl
 
$0


155 
pushl
 
$L6
 #tu 
addss
 
ma
, 

 
decides
 
	gto
.

156 
pushl
 
$_ma


157 
jmp
 
tup_gg


158 
	gL6
:

159 
jmp
 
L6
 #ma 
should
 
v
  
he
, 
	gbut


160 #ju 

 , 
we
 
know
 
wh
 
hns
.

164 
	gt_msg
:

165 .
asciz
 "Unknown interrupt\n\r"

166 .
ign
 2

167 
igne_t
:

168 
pushl
 %
x


169 
pushl
 %
ecx


170 
pushl
 %
edx


171 
push
 %
ds


172 
push
 %
es


173 
push
 %
fs


174 
movl
 
$0x10
,%
x


175 
	gmov
 %
	gax
,%
ds


176 
	gmov
 %
	gax
,%
es


177 
	gmov
 %
	gax
,%
fs


178 
pushl
 
$t_msg


179 

 
_tk


180 
	gpl
 %
x


181 
	gp
 %
fs


182 
	gp
 %
es


183 
	gp
 %
ds


184 
	gpl
 %
edx


185 
	gpl
 %
ecx


186 
	gpl
 %
x


187 
	g


214 .
	gign
 2

215 
	gtup_gg
:

216 
movl
 
$1024
*5,%
ecx


217 
	gxl
 %
	gx
,%
x


218 
	gxl
 %
	gedi
,%
edi


219 
	gd
;
	gp
;
o


220 
movl
 
	g$pg0
+7,
_pg_d


221 
movl
 
	g$pg1
+7,
	g_pg_d
+4

222 
movl
 
	g$pg2
+7,
	g_pg_d
+8

223 
movl
 
	g$pg3
+7,
	g_pg_d
+12

224 
movl
 
	g$pg3
+4092,%
edi


225 
movl
 
	g$0xfff007
,%
x


226 
	gd


227 1: 
o


228 
subl
 
$0x1000
,%
x


229 
	gjge
 1b

230 
	gxl
 %
	gx
,%
x


231 
	gmovl
 %
	gx
,%
3


232 
	gmovl
 %
	g0
,%
x


233 
l
 
	g$0x80000000
,%
x


234 
	gmovl
 %
	gx
,%
0


235 
	gt


237 .
	gign
 2

238 .
	gwd
 0

239 
	gidt_des
:

240 .
wd
 256*8-1 #id
cڏs
 256 
s
 
idt
限长

241 .
_idt
 #idt 基地址

242 .
ign
 2

243 .
wd
 0

244 
gdt_des
:

245 .
wd
 256*8-1 #s
ds
 
gdt
 (
n
 
th
hat'sny 限长 0x7FF

246 .
_gdt
 #magi
numb
, 
but
 

 
wks
 
me
 :^
gdt
 基地址

248 .
ign
 3

249 
_idt
: .
fl
 256,8,0 #id
is
 
unlized


251 
	g_gdt
: .
quad
 0x0000000000000000

252 .
quad
 0x00c09a0000000fff

253 .
quad
 0x00c0920000000fff

254 .
quad
 0x0000000000000000

255 .
fl
 252,8,0

	@boot/setup.s

2 ! 
	gtup
.
s
 (
C
1991 
Lus
 
	gTvds


4 ! 
	gtup
.
s
 
is
 
sib
 
gtg
 
the
 
syem
 
da
 
om
h
	gBIOS
,

5 ! 
d
 
pug
 
them
 
to
 
the
 
r
 
as
 

 
syem
 
	gmemy
.

6 ! 
bh
 
	gtup
.
s
 
d
 
syem
 
has
 
bn
 
lded
 
by
 
the
 
	gboblock
.

8 ! 
This
 
code
 
asks
 
the
 
bios
 
	gmemy
/
	gdisk
/
h
 
	gms
, 
	gd


9 ! 
puts
 
them
 

 
	ga
 "" 
	ga
: 0x90000-0x901FF, 

 
whe
 
	gthe


10 ! 
	gbo
-
block
 
ud
 
to
 
	gbe
. 
It
 
is
 
th
 
up

the
 
eed
 
	gmode


11 ! 
syem
 
to
 
ad
 
them
 
om
 
the
 
befe
 
the
 

 
is
 
	govwrn


12 ! 
	gbufr
-
	gblocks
.

14 ! 
	gtup
.
	gs
 负责从
	gBIOS
中获取系统数据，并将这些数据存放在内存中，此时tup.s和

15 ! 
	gsyem
 模块已经由
	gbo٣
引导加载到内存中。

17 ! 这段代码询问
	gBIOS
有关内存/磁盘/其它参数，并将这些参数放到一个“安全”的地方:

18 ! 0x90000-0x901FF,也就是原先
	gbo٣
代码块曾经在的地方，然后在被缓冲区覆盖之

19 ! 由保护模式的
	gsyem
读取。

22 ! 
	gNOTE
! 
The
 
had
 
br
 
be
 
the
 
me
 
as
 

 
	gbo٣
.
	gs
!

23 ! 下面的这些参数与
	gbo٣
.
	gs
中相同

25 
	gINITSEG
 = 0x9000 ! 
we
 
move
 
bo
 
he
 - 
out
 
of
 
the
 
way
 原来
bo٣
所处的段

26 
SYSSEG
 = 0x1000 ! 
syem
 
lded
 

 0x10000 (65536). syem在0x1000处(内存64
KB
处)

27 
SETUPSEG
 = 0x9020 ! 
this
 
is
 
the
 
cut
 
gmt
 
tup
.
s
程序所在的段

29 .
globl
 
begxt
, 
	gbegda
, 
	gbegbss
, 
	gdxt
, 
	gdda
, 
	gdbss


30 .
xt


31 
	gbegxt
:

32 .
da


33 
begda
:

34 .
bss


35 
begbss
:

36 .
xt


38 
y
 
t


39 
t
:

41 ! 
ok
, 
the
 
ad
 
wt
 
wl
 
so
 
we
 
g
 
cut
 
curs
 
posi
 
d
 
ve
 

 

42 ! 
	gpoy
.

43 ! 
	gok
, 整个读磁盘过程都很正常，现在保存光标位置以备后面使用。

45 ! 这段代码使用
	gBIOS
中断取得当前屏幕时上光标的位置(列,行),并保存在内存0x90000处(占两个字节)。

47 ! 
	gBIOS
终端0x10 功能号 
	gah
 = 0x03，读光标位置。

48 ! 输入: 
bh
 = 页号

49 ! 返回: 
ch
 = 扫描开始线; 
	g
 = 扫描结束线; 
	gdh
 = 行号(0x00顶端); 
	gdl
 = 列号(0x00最左边)。

51 ! 下面语句将
ds
设置为
INITSEG
 (0x9000)，这已经在
bo٣
程序中设置过，但是现在是
tup
程序，

52 ! 
lus
 觉得需要重新再设置一下。

53 
mov
 
ax
,#INITSEG ! 
this
 
is
 
de
 

 
bo٣
 
	gady
, 
	gbut
...

54 
mov
 
	gds
,
ax


55 
mov
 
	gah
,#0
	gx03
 ! 
ad
 
curs
 
	gpos
 读光标位置

56 
x
 
	gbh
,bh ! 页号为0

57 0x10 ! 
ve
 

 

 
known
 
	ga
, 
c_
 
tches


58 
	gmov
 [0],
	gdx
 ! 

 
	gom
 0x90000. 光标位置存在0x9000:0处

60 ! 
G
 
memy
 
size
 (
exnded
 
mem
, 
kB
)

61 ! 获取扩展内存的大小值(
	gKB
).

62 ！利用
	gBIOS
中断0x15功能号 
	gah
 = 0x88 取系统所含扩展内存大小并保存在内存0x9000:2处

63 ！返回: 
ax
 = 从0x10000(1
M
)处开始的扩展内存大小(
KB
 )。若出错则
CF
置位，ax 出错码。

65 
mov
 
ah
,#0
x88


67 
	gmov
 [2],
	gax


69 ! 
G
 
	gvideo
-
rd
 
	gda
:

71 ! 调用
BIOS
中断0x10，功能号 
ah
 = 0x0f

72 ! 返回: 
ah
 = 字符列数，

 = 显示模式； 
bh
 = 当前显示页。

75 
mov
 
ah
,#0
x0f


77 
	gmov
 [4],
	gbx
 ! 
	gbh
 = 
diy
 
ge


78 
mov
 [6],
	gax
 ! 
	g
 = 
video
 
mode
, 
	gah
 = 
wdow
 
width


80 ! 
check
 
EGA
/
VGA
 
d
 
some
 
cfig
 
ms


81 ! 检查显示方式(
EGA
/
VGA
)并去参数。

82 ! 调用
BIOS
中断0x10，附加功能选择方式信息。 功能号: 
ah
 = 0x12, 
	gbl
 = 0x10

83 ! 返回: 
bh
 = 显示状态。 0x00 - 彩色模式， 
I
/
O
端口 0x3dX; 0x01 - 单色模式,
	gI
/
	gO
端口 0x3bX。

84 ! 
bl
 = 安装的显示内存。 0x00 -64
K
; 0x01 -128
	gK
; 0x02 -192K; 0x03 = 256K。

85 ! 
cx
 = 显卡特性参数(见程序后面对
BIOS
视频中断0x10的说明)。

86 
mov
 
ah
,#0
x12


87 
mov
 
	gbl
,#0
x10


89 
	gmov
 [8],
ax


90 
	gmov
 [10],
bx


91 
	gmov
 [12],
	gcx


93 ! 
G
 
hd0
 
	gda


97 !下面的两段程序分别复制
	gBIOS
有关两个硬盘的参数表，0x90080处存放第一个硬盘的表，0x90090处

100 !
lds
 
	gsi
,[4*0x41] 从内存指定位置处读取一个长指针并放入 
	gds
 和 si 寄存器中。ds中放段地址

101 ! 
	gsi
是段内偏移地址。这里是把内存地址 4* 0x41 0x104 处保存的4个字节(段地址和偏移地址)读出。

103 
mov
 
ax
,#0
x0000


104 
mov
 
	gds
,
ax


105 
lds
 
	gsi
,[4*0x41] ! 取中断向量0x41的值，也即
	ghd0
参数表的地址存入 
	gds
:
si


106 
mov
 
ax
,#INITSEG

107 
mov
 
	ges
,
ax


108 
mov
 
	gdi
,#0
	gx0080
 !传输目的地址 0x9000:0x0080

109 
mov
 
cx
,#0
	gx10
 !共传输16个字节。

110 
p


111 
	gmovsb


113 ! 
G
 
hd1
 
da


115 
mov
 
	gax
,#0
x0000


116 
mov
 
	gds
,
ax


117 
lds
 
	gsi
,[4*0x46] ! 取中断向量0x46的值，也即
	ghd0
参数表的地址存入 
	gds
:
si


118 
mov
 
ax
,#INITSEG

119 
mov
 
	ges
,
ax


120 
mov
 
	gdi
,#0
	gx0090
 !传输目的地址 0x9000:0x0090

121 
mov
 
cx
,#0
	gx10
 !共传输16个字节。

122 
p


123 
	gmovsb


125 ! 
Check
 
th
 
the
 
IS
 
a
 
	ghd1
 :-)

127 !利用
BIOS
中断调用 0x13的取盘类型功能，功能号 
ah
 = 0x15

128 !输入: 
dl
 = 驱动器号

129 !输出: 
ah
 = 类型码； 00 - 没有这个盘， 01 - 是软驱，没有
chge
-
le
支持，

130 ! 02 - 是软驱(或其他可移动设备)，有
chgge
-
le
支持， 03 - 是硬盘。

134 
mov
 
ax
,#0
x01500


135 
mov
 
	gdl
,#0
x81


137 
jc
 
	gno_disk1
 ! 没有盘则跳转

138 
cmp
 
	gah
,#3 ! 判断是不是硬盘

139 
je
 
is_disk1


140 
	gno_disk1
: !把第2个表清零。

141 
mov
 
ax
,#INITSEG

142 
mov
 
	ges
,
ax


143 
mov
 
	gdi
,#0
x0090


144 
mov
 
	gcx
,#0
x10


145 
mov
 
	gax
,#0
x00


146 
p


147 
	gosb
 !单字符输出指令，调用该指令后，可以将
	gAL
中的值传递到
	gES
:
DI
处，并且根据
DF
的值来影响DI的值，如果DF为0，则调用该指令后，DI自增1

148 
is_disk1
:

150 ! 
now
 
we
 
wt
 
to
 
move

eed
 
mode
 ... 现在，我们要进入保护模式了

152 
i
 ! 
no
 
us
 
lowed
 ! 关中断

154 ! 
f
 
we
 
move
 
the
 
syem
 
to
 

'sightfullace

155 !首先，移动
syem
模块到正确的位置(绝对地址0x00000处)

156 !
bo٣
引导程序是将
syem
模块读到0x10000开始的位置，由于当时syem模块最大长度不会超过0x80000(512
KB
),

157 !所以
	gbo٣
把自己移动到0x90000开始的地方，并把
	gtup
加载到它后面，下面的程序把整个
	gsyem
模块移动到0x00000位置

158 !即把
	gsyem
模块从 0x10000到0x8ffff的内存数据总共512
	gKB
整块地向内存低端移动了0x1000(64KB)的位置。

160 !实时模式下最大只能寻址64
	gKB
，所以512KB分成8次移动，每次移动64KB。移动64KB后，修改段地址，继续移动，循环8次。

163 
mov
 
	gax
,#0
x0000


164 
	gd
 ! 'dei'=0, 
movs
 
moves
 
fwd


165 
	gdo_move
:

166 
mov
 
es
,
	gax
 ! 
dei
 
gmt
 
	ges
:
di
是目的地址，初始为0x0:0x0

167 
add
 
ax
,#0
x1000


168 
cmp
 
	gax
,#0
	gx9000
 ! 已经把最后一段(从0x8000段开始的64
	gKB
)代码移动完？

169 
jz
 
	gd_move
 ! 移动完则跳转。

170 
mov
 
	gds
,
	gax
 ! 
sour
 
gmt


171 
sub
 
	gdi
,
di


172 
sub
 
	gsi
,
si


173 
mov
 
	gcx
,#0
	gx8000
 !移动0x8000个字，即64
KB


174 
p


175 
movsw


176 
jmp
 
	gdo_move


178 ! 
th
 
we
 
ld
 
the
 
gmt
 
	gdests
 接下来加载段描述符

180 
	gd_move
:

181 
mov
 
ax
,#SETUPSEG ! 
	gright
, 
fg
 
this
 

 
	gf
. 
	gdidn
't work :-)

182 
mov
 
	gds
,
ax


183 
lidt
 
	gidt_48
 ! 
ld
 
idt
 
	gwh
 0,0 加载中断描述符表

184 
lgdt
 
	ggdt_48
 ! 
ld
 
gdt
 
wh
 
whev
 
	gr
 加载
	gGDT
全局描述符表

186 ! 
th
 
was
 
	gss
, 
now
 
we
 
ab
 
	gA20


187 ! 下面的代码开启
	gA20
地址线

188 ! 为了能够访问和使用1
	gMB
以上的物理内存，我们需要首先开启
	gA20
地址线。

190 

 
	gemy_8042
 !测试8042状态寄存器，等待输入缓冲器空，只有为空才能对其执行写命令。

191 
mov
 
	g
,#0
	gxD1
 ! 
commd
 
	gwre
 0xD1命令码，表示数据要写到8042的
	gP2
端口，P2断开的位1用于
	gA20
线的选通。

192 
	gout
 #0
	gx64
,
	g
 !数据要写到0x64口

193 

 
	gemy_8042
 !等待输入缓冲器空,看命令是否被接受

194 
mov
 
	g
,#0
	gxDF
 ! 
A20
 
	g
 选通
	gA20
地址线的参数

195 
	gout
 #0
	gx60
,



196 

 
	gemy_8042
 !若此时缓冲寄存器为空，则表示
	gA20
线已经选通。

198 ! 
	gwl
, 
th
 
wt
 
	gok
, 
I
 
	ghe
. 
Now
 
we
 
have
 
to
 
ogm
 
the
 
	gus
 :-(

199 ! 
we
 
put
 
them
 
right
 
a
 
the
 
l
-
rved
 
hdwe
 
us
, 
	g


200 ! 0x20-0x2F. 
The
 
they
 
	gw
't mess upnything. Sadly IBMeally

201 ! 
mesd
 
this
 
up
 
wh
 
the
 
ig
 
	gPC
, 
d
 
they
 
	ghav
't beenbleo

202 ! 
ify
 

 
	gawds
. 
Thus
 
the
 
bios
 
puts
 
us
 
	g
 0x08-0x0f,

203 ! 
which
 
is
 
ud
 
the
 

 
hdwe
 
us
 
as
 
	gwl
. 
We
 
	gju


204 ! 
have
 
to
 
ogm
 
	gthe
 8259's,nd ii'
t
 
	gfun
.

207 !它是 
ICW1
 命令字，表示边缘触发。多片8259级联。最后要发送 
ICW4
 命令字。

210 
mov
 

,#0
	gx11
 ! 
lizi
 
	gqu
 初始化命令开始

211 
	gout
 #0
	gx20
,
	g
 ! 
nd
 

 
	gto
 8259A-1 发送到8259A 主芯片

212 .
	gwd
 0x00eb,0x00eb ! 
jmp
 
	g$
+2, jmp $+2 '$'表示当前指令的地址

213 
	gout
 #0
	gxA0
,
	g
 ! 
d
 
	gto
 8259A-2 再次发送到8259A 从芯片

214 .
	gwd
 0x00eb,0x00eb

216 ! 
	glux
 系统硬件中断号被设置成从 0x20开始

217 
mov
 
	g
,#0
	gx20
 ! 
t
 
of
 
hdwe
 's (0x20 = 32)

218 
	gout
 #0
	gx21
,
	g
 ! 发送主芯片 
	gICW2
 命令字，设置其实中断号，要送奇端口

219 .
	gwd
 0x00eb,0x00eb

220 
mov
 
	g
,#0
	gx28
 ! 
t
 
of
 
hdwe
 's 2 (0x28 = 40)

221 
	gout
 #0
	gxA1
,
	g
 ! 发送从芯片 
	gICW2
 命令字，设置其实中断号。

222 .
	gwd
 0x00eb,0x00eb

223 
mov
 
	g
,#0
	gx04
 ! 8259-1 
is
 
ma


224 
	gout
 #0
	gx21
,
	g
 ! 发送主芯片 
	gICW3
 命令字，主芯片的 
	gIR2
 连接从芯片 
	gINT


225 .
	gwd
 0x00eb,0x00eb

226 
mov
 
	g
,#0
	gx02
 ! 8259-2 
is
 
ave


227 
	gout
 #0
	gxA1
,
	g
 ! 发送从芯片 
	gICW3
 命令字，表示从芯片的 
	gINT
 连接到主芯片的 
	gIR2
 引脚上

228 .
	gwd
 0x00eb,0x00eb

229 
mov
 
	g
,#0
	gx01
 ! 8086 
mode
 
bh


230 
	gout
 #0
	gx21
,
	g
 ! 发送主芯片 
	gICW4
 命令字，8086模式； 普通 
	gEOI
、非缓冲方式

231 .
	gwd
 0x00eb,0x00eb ! 需要发送指令来复位。初始化结束，芯片就绪。

232 
	gout
 #0
	gxA1
,
	g
 ! 发送从芯片 
	gICW4
 命令字，内容同上。

233 .
	gwd
 0x00eb,0x00eb

234 
mov
 
	g
,#0
	gxFF
 ! 
mask
 
off
 
l
 
us
 
now


235 
	gout
 #0
	gx21
,
	g
 ! 屏蔽主芯片所有中断请求

236 .
	gwd
 0x00eb,0x00eb

237 
	gout
 #0
	gxA1
,
	g
 ! 屏蔽从芯片所有中断请求

239 ! 
	gwl
, 
th
 
aly
 
	gwa
'fu:-(. Hefuy iwks,nd wd'
	gt


240 ! 
ed
 
no
 
nkg
 
BIOS
 
yway
 (
ex
 
the
 
l
 
ldg
 :-).

241 ! 
The
 
BIOS
-
route
 
wts
 
ls
 
of
 
uesry
 
da
, 
d
 
	g
'sess

242 ! "g" 
	gyway
. 
This
 
is
 
how
 
REAL
 
ogmms
 d
	g
.

244 ! 
	gWl
, 
	gnow
'sheimeoctually move intorotected mode. To make

245 ! 
thgs
 
as
 
sime

	gpossib
, 
we
 d
no
 
	gt
-
up
 

 
	gythg
,

246 ! 
we
 
t
 
the
 
	ggnu
-
	gcomped
 32-
b
 
ogms
 d
	gth
. 
We
 
ju
 
jump
 
	gto


247 ! 
absu
 
	gaddss
 0x00000, 
	g
 32-
b
 
eed
 
	gmode
.

249 
mov
 
	gax
,#0
	gx0001
 ! 
eed
 
	$mode
 (
PE

b
 保护模式比特位(PE) 置位

250 
lmsw
 
ax
 ! 
This
 
is
 

! 就这样加载机器状态字

251 
jmpi
 0,8 ! 
jmp
 
offt
 0 
of
 
gmt
 8 (
cs
) 跳转到 cs 段偏移 0处

255 ! 
This
 
route
 
checks
 
th
 
the
 
keybrd
 
commd
 
queue
 
is
 
emy


256 ! 
No
 
timeout
 
is
 
ud
 - 
this
 
hgs
 
the
 i
somhg
 
wrg
 
wh


257 ! 
the
 
mache
, 
d
 
we
 
obably
 
couldn
'troceednyway.

258 
emy_8042
:

259 .
wd
 0x00eb,0x00eb

260 

 

,#0
x64
 ! 8042 
us
 
pt


261 

 

,#2 ! 
is
 
put
 
bufr
 
fu
?

262 
jnz
 
emy_8042
 ! 
yes
 - 
lo


263 
t


266 
gdt
:

267 .
wd
 0,0,0,0 ! 
dummy
 第一个描述符为空，不使用

269 ! 在 
GDT
 表里这里的偏移量是 0x08,它是内核代码段选择符的值

270 .
wd
 0x07FF ! 8
Mb
 - 
lim
=2047 (2048*4096=8Mb) 段限长

271 .
wd
 0x0000 ! 
ba
 
addss
=0 基地址

272 .
wd
 0x9A00 ! 
code
 
ad
/
exec
 ! 代码段为只读，可执行

273 .
wd
 0x00C0 ! 
gnury
=4096, 386 ! 颗粒度为4096,32位模式

275 ! 在 
GDT
 表里这里的偏移量是 0x10,它是内核数据段选择符的值

276 .
wd
 0x07FF ! 8
Mb
 - 
lim
=2047 (2048*4096=8Mb)

277 .
wd
 0x0000 ! 
ba
 
addss
=0

278 .
wd
 0x9200 ! 
da
 
ad
/
wre


279 .
wd
 0x00C0 ! 
gnury
=4096, 386

281 ! 下面是加载中断描述符表寄存器 
id
 的指令要求的 6字节操作数，前2个字节时 
IDT
表的限长

282 ! 后4个字节是 
idt
表在线性地址空间中的 32 位基地址。
u
要求在进入保护模式前设置
IDT
表，因此这里先设置为空表

283 
idt_48
:

284 .
wd
 0 ! 
idt
 
lim
=0

285 .
wd
 0,0 ! 
idt
 
ba
=0L

287 ! 这是加载全局描述符表寄存器 
gd
 指令要求的6字节操作数，前两个字节是
gdt
表的限长。

288 ! 后4字节是
gdt
表的线性基地址。 4字节的线性基地址为 0x0009 <<16(0x90000) + 0x0200(512) +gdt

289 ！即 0x90200+
gdt
 ，gdt表的限长设置为2
KB
，共256个表项。

290 
gdt_48
:

291 .
wd
 0x800 ! 
gdt
 
lim
=2048, 256 
GDT
 
s


292 .
wd
 512+
gdt
,0x9 ! gd
ba
 = 0X9xxxx

294 .
xt


295 
dxt
:

296 .
da


297 
dda
:

298 .
bss


299 
dbss
:

	@fs/bitmap.c

8 
	~<rg.h
>

10 
	~<lux/sched.h
>

11 
	~<lux/kl.h
>

13 
	#r_block
(
addr
) \

14 
	`__asm__
("cld\n\t" \

17 ::"a" (0),"c" (
BLOCK_SIZE
/4),"D" (((
addr
)):"cx","di")

	)

19 
	#t_b
(

,
addr
) ({\

20 
s
 
	`__asm__
("ax"); \

21 
__asm__
 
	`__vީe__
("btsl %2,%3\n\tsetb %%al": \

22 "" (
s
):"0" (0),"r" (

),"m" (*(
addr
))); \

23 
s
;})

	)

25 
	#r_b
(

,
addr
) ({\

26 
s
 
	`__asm__
("ax"); \

27 
__asm__
 
	`__vީe__
("btrl %2,%3\n\tsetnb %%al": \

28 "" (
s
):"0" (0),"r" (

),"m" (*(
addr
))); \

29 
s
;})

	)

31 
	#fd_f_zo
(
addr
) ({ \

32 
__s
; \

33 
	`__asm__
("cld\n" \

44 :"=c" (
__s
):"c" (0),"S" (
addr
):"ax","dx","si"); \

45 
__s
;})

	)

47 
	$_block
(
dev
, 
block
)

49 
sur_block
 * 
sb
;

50 
bufr_hd
 * 
bh
;

52 i(!(
sb
 = 
	`g_sur
(
dev
)))

53 
	`nic
("tryingo free block ononexistent device");

54 i(
block
 < 
sb
->
s_fdaze
 || block >sb->
s_nzes
)

55 
	`nic
("tryingo free blockot in datazone");

56 
bh
 = 
	`g_hash_b
(
dev
,
block
);

57 i(
bh
) {

58 i(
bh
->
b_cou
 != 1) {

59 
	`tk
("tryingo free block (%04x:%d), count=%d\n",

60 
dev
,
block
,
bh
->
b_cou
);

63 
bh
->
b_dt
=0;

64 
bh
->
b_uode
=0;

65 
	`bl
(
bh
);

67 
block
 -
sb
->
s_fdaze
 - 1 ;

68 i(
	`r_b
(
block
&8191,
sb
->
s_zm
[block/8192]->
b_da
)) {

69 
	`tk
("block (%04x:%d",
dev
,
block
+
sb
->
s_fdaze
-1);

70 
	`nic
("free_block: bitlready cleared");

72 
sb
->
s_zm
[
block
/8192]->
b_dt
 = 1;

73 
	}
}

75 
	$w_block
(
dev
)

77 
bufr_hd
 * 
bh
;

78 
sur_block
 * 
sb
;

79 
i
,
j
;

81 i(!(
sb
 = 
	`g_sur
(
dev
)))

82 
	`nic
("tryingo getew block fromonexistant device");

83 
j
 = 8192;

84 
i
=0 ; i<8 ; i++)

85 i(
bh
=
sb
->
s_zm
[
i
])

86 i((
j
=
	`fd_f_zo
(
bh
->
b_da
))<8192)

88 i(
i
>=8 || !
bh
 || 
j
>=8192)

90 i(
	`t_b
(
j
,
bh
->
b_da
))

91 
	`nic
("new_block: bitlready set");

92 
bh
->
b_dt
 = 1;

93 
j
 +
i
*8192 + 
sb
->
s_fdaze
-1;

94 i(
j
 >
sb
->
s_nzes
)

96 i(!(
bh
=
	`gblk
(
dev
,
j
)))

97 
	`nic
("new_block: cannot get block");

98 i(
bh
->
b_cou
 != 1)

99 
	`nic
("new block: count is != 1");

100 
	`r_block
(
bh
->
b_da
);

101 
bh
->
b_uode
 = 1;

102 
bh
->
b_dt
 = 1;

103 
	`bl
(
bh
);

104  
j
;

105 
	}
}

107 
	$_ode
(
m_ode
 * 
ode
)

109 
sur_block
 * 
sb
;

110 
bufr_hd
 * 
bh
;

112 i(!
ode
)

114 i(!
ode
->
i_dev
) {

115 
	`memt
(
ode
,0,(*inode));

118 i(
ode
->
i_cou
>1) {

119 
	`tk
("yg inodwh cou=%d\n",
ode
->
i_cou
);

120 
	`nic
("free_inode");

122 i(
ode
->
i_ƚks
)

123 
	`nic
("tryingo free inode withinks");

124 i(!(
sb
 = 
	`g_sur
(
ode
->
i_dev
)))

125 
	`nic
("tryingo free inode ononexistent device");

126 i(
ode
->
i_num
 < 1 || inode->i_num > 
sb
->
s_nodes
)

127 
	`nic
("tryingo free inode 0 oronexistant inode");

128 i(!(
bh
=
sb
->
s_im
[
ode
->
i_num
>>13]))

129 
	`nic
("nonexistent imap in superblock");

130 i(
	`r_b
(
ode
->
i_num
&8191,
bh
->
b_da
))

131 
	`tk
("free_inode: bitlready cleared.\n\r");

132 
bh
->
b_dt
 = 1;

133 
	`memt
(
ode
,0,(*inode));

134 
	}
}

136 
m_ode
 * 
	$w_ode
(
dev
)

138 
m_ode
 * 
ode
;

139 
sur_block
 * 
sb
;

140 
bufr_hd
 * 
bh
;

141 
i
,
j
;

143 i(!(
ode
=
	`g_emy_ode
()))

144  
NULL
;

145 i(!(
sb
 = 
	`g_sur
(
dev
)))

146 
	`nic
("new_inode with unknown device");

147 
j
 = 8192;

148 
i
=0 ; i<8 ; i++)

149 i(
bh
=
sb
->
s_im
[
i
])

150 i((
j
=
	`fd_f_zo
(
bh
->
b_da
))<8192)

152 i(!
bh
 || 
j
 >8192 || j+
i
*8192 > 
sb
->
s_nodes
) {

153 
	`ut
(
ode
);

154  
NULL
;

156 i(
	`t_b
(
j
,
bh
->
b_da
))

157 
	`nic
("new_inode: bitlready set");

158 
bh
->
b_dt
 = 1;

159 
ode
->
i_cou
=1;

160 
ode
->
i_ƚks
=1;

161 
ode
->
i_dev
=
dev
;

162 
ode
->
i_uid
=
cut
->
euid
;

163 
ode
->
i_gid
=
cut
->
egid
;

164 
ode
->
i_dt
=1;

165 
ode
->
i_num
 = 
j
 + 
i
*8192;

166 
ode
->
i_mtime
 = inode->
i_ime
 = inode->
i_ime
 = 
CURRENT_TIME
;

167  
ode
;

168 
	}
}

	@fs/block_dev.c

7 
	~<o.h
>

9 
	~<lux/sched.h
>

10 
	~<lux/kl.h
>

11 
	~<asm/gmt.h
>

12 
	~<asm/syem.h
>

14 
	$block_wre
(
dev
, * 
pos
, * 
buf
, 
cou
)

16 
block
 = *
pos
 >> 
BLOCK_SIZE_BITS
;

17 
offt
 = *
pos
 & (
BLOCK_SIZE
-1);

18 
chs
;

19 
wrn
 = 0;

20 
bufr_hd
 * 
bh
;

21 * 
p
;

23 
cou
>0) {

24 
chs
 = 
BLOCK_SIZE
 - 
offt
;

25 i(
chs
 > 
cou
)

26 
chs
=
cou
;

27 i(
chs
 =
BLOCK_SIZE
)

28 
bh
 = 
	`gblk
(
dev
,
block
);

30 
bh
 = 
	`bada
(
dev
,
block
,block+1,block+2,-1);

31 
block
++;

32 i(!
bh
)

33  
wrn
?wrn:-
EIO
;

34 
p
 = 
offt
 + 
bh
->
b_da
;

35 
offt
 = 0;

36 *
pos
 +
chs
;

37 
wrn
 +
chs
;

38 
cou
 -
chs
;

39 
chs
-->0)

40 *(
p
++
	`g_fs_by
(
buf
++);

41 
bh
->
b_dt
 = 1;

42 
	`bl
(
bh
);

44  
wrn
;

45 
	}
}

47 
	$block_ad
(
dev
, * 
pos
, * 
buf
, 
cou
)

49 
block
 = *
pos
 >> 
BLOCK_SIZE_BITS
;

50 
offt
 = *
pos
 & (
BLOCK_SIZE
-1);

51 
chs
;

52 
ad
 = 0;

53 
bufr_hd
 * 
bh
;

54 * 
p
;

56 
cou
>0) {

57 
chs
 = 
BLOCK_SIZE
-
offt
;

58 i(
chs
 > 
cou
)

59 
chs
 = 
cou
;

60 i(!(
bh
 = 
	`bada
(
dev
,
block
,block+1,block+2,-1)))

61  
ad
?ad:-
EIO
;

62 
block
++;

63 
p
 = 
offt
 + 
bh
->
b_da
;

64 
offt
 = 0;

65 *
pos
 +
chs
;

66 
ad
 +
chs
;

67 
cou
 -
chs
;

68 
chs
-->0)

69 
	`put_fs_by
(*(
p
++),
buf
++);

70 
	`bl
(
bh
);

72  
ad
;

73 
	}
}

	@fs/buffer.c

21 
	~<dg.h
>

23 
	~<lux/cfig.h
>

24 
	~<lux/sched.h
>

25 
	~<lux/kl.h
>

26 
	~<asm/syem.h
>

27 
	~<asm/io.h
>

29 
d
;

30 
bufr_hd
 * 
	gt_bufr
 = (bufr_hd *&
d
;

31 
bufr_hd
 * 
	ghash_b
[
NR_HASH
];

32 
bufr_hd
 * 
	g_li
;

33 
sk_ru
 * 
	gbufr_wa
 = 
NULL
;

34 
	gNR_BUFFERS
 = 0;

36 
le
 
	$wa__bufr
(
bufr_hd
 * 
bh
)

38 
	`i
();

39 
bh
->
b_lock
)

40 
	`p_
(&
bh
->
b_wa
);

41 
	`i
();

42 
	}
}

44 
	$sys_sync
()

46 
i
;

47 
bufr_hd
 * 
bh
;

49 
	`sync_odes
();

50 
bh
 = 
t_bufr
;

51 
i
=0 ; i<
NR_BUFFERS
 ; i++,
bh
++) {

52 
	`wa__bufr
(
bh
);

53 i(
bh
->
b_dt
)

54 
	`_rw_block
(
WRITE
,
bh
);

57 
	}
}

59 
	$sync_dev
(
dev
)

61 
i
;

62 
bufr_hd
 * 
bh
;

64 
bh
 = 
t_bufr
;

65 
i
=0 ; i<
NR_BUFFERS
 ; i++,
bh
++) {

66 i(
bh
->
b_dev
 !
dev
)

68 
	`wa__bufr
(
bh
);

69 i(
bh
->
b_dev
 =
dev
 && bh->
b_dt
)

70 
	`_rw_block
(
WRITE
,
bh
);

72 
	`sync_odes
();

73 
bh
 = 
t_bufr
;

74 
i
=0 ; i<
NR_BUFFERS
 ; i++,
bh
++) {

75 i(
bh
->
b_dev
 !
dev
)

77 
	`wa__bufr
(
bh
);

78 i(
bh
->
b_dev
 =
dev
 && bh->
b_dt
)

79 
	`_rw_block
(
WRITE
,
bh
);

82 
	}
}

84 
le
 
	$vide_bufrs
(
dev
)

86 
i
;

87 
bufr_hd
 * 
bh
;

89 
bh
 = 
t_bufr
;

90 
i
=0 ; i<
NR_BUFFERS
 ; i++,
bh
++) {

91 i(
bh
->
b_dev
 !
dev
)

93 
	`wa__bufr
(
bh
);

94 i(
bh
->
b_dev
 =
dev
)

95 
bh
->
b_uode
 = bh->
b_dt
 = 0;

97 
	}
}

113 
	$check_disk_chge
(
dev
)

115 
i
;

117 i(
	`MAJOR
(
dev
) != 2)

119 i(!
	`py_chge
(
dev
 & 0x03))

121 
i
=0 ; i<
NR_SUPER
 ; i++)

122 i(
sur_block
[
i
].
s_dev
 =
dev
)

123 
	`put_sur
(
sur_block
[
i
].
s_dev
);

124 
	`vide_odes
(
dev
);

125 
	`vide_bufrs
(
dev
);

126 
	}
}

128 
	#_hash
(
dev
,
block
((()(dev^block))%
NR_HASH
)

	)

129 
	#hash
(
dev
,
block

hash_b
[
	`_hash
(dev,block)]

	)

131 
le
 
	$move_om_queues
(
bufr_hd
 * 
bh
)

134 i(
bh
->
b_xt
)

135 
bh
->
b_xt
->
b_ev
 = bh->b_prev;

136 i(
bh
->
b_ev
)

137 
bh
->
b_ev
->
b_xt
 = bh->b_next;

138 i(
	`hash
(
bh
->
b_dev
,bh->
b_block
) == bh)

139 
	`hash
(
bh
->
b_dev
,bh->
b_block
bh->
b_xt
;

141 i(!(
bh
->
b_ev_
|| !(bh->
b_xt_
))

142 
	`nic
("Free blockist corrupted");

143 
bh
->
b_ev_
->
b_xt_
 = bh->b_next_free;

144 
bh
->
b_xt_
->
b_ev_
 = bh->b_prev_free;

145 i(
_li
 =
bh
)

146 
_li
 = 
bh
->
b_xt_
;

147 
	}
}

149 
le
 
	$_to_queues
(
bufr_hd
 * 
bh
)

152 
bh
->
b_xt_
 = 
_li
;

153 
bh
->
b_ev_
 = 
_li
->b_prev_free;

154 
_li
->
b_ev_
->
b_xt_
 = 
bh
;

155 
_li
->
b_ev_
 = 
bh
;

157 
bh
->
b_ev
 = 
NULL
;

158 
bh
->
b_xt
 = 
NULL
;

159 i(!
bh
->
b_dev
)

161 
bh
->
b_xt
 = 
	`hash
(bh->
b_dev
,bh->
b_block
);

162 
	`hash
(
bh
->
b_dev
,bh->
b_block
) = bh;

163 
bh
->
b_xt
->
b_ev
 = bh;

164 
	}
}

166 
bufr_hd
 * 
	$fd_bufr
(
dev
, 
block
)

168 
bufr_hd
 * 
tmp
;

170 
tmp
 = 
	`hash
(
dev
,
block
;m!
NULL
 ;mtmp->
b_xt
)

171 i(
tmp
->
b_dev
==
dev
 &&mp->
b_block
==
block
)

172  
tmp
;

173  
NULL
;

174 
	}
}

183 
bufr_hd
 * 
	$g_hash_b
(
dev
, 
block
)

185 
bufr_hd
 * 
bh
;

188 i(!(
bh
=
	`fd_bufr
(
dev
,
block
)))

189  
NULL
;

190 
bh
->
b_cou
++;

191 
	`wa__bufr
(
bh
);

192 i(
bh
->
b_dev
 =
dev
 && bh->
b_block
 =
block
)

193  
bh
;

194 
bh
->
b_cou
--;

196 
	}
}

205 
	#BADNESS
(
bh
(((bh)->
b_dt
<<1)+(bh)->
b_lock
)

	)

206 
bufr_hd
 * 
	$gblk
(
dev
,
block
)

208 
bufr_hd
 * 
tmp
, * 
bh
;

210 

:

211 i(
bh
 = 
	`g_hash_b
(
dev
,
block
))

212  
bh
;

213 
tmp
 = 
_li
;

215 i(
tmp
->
b_cou
)

217 i(!
bh
 || 
	`BADNESS
(
tmp
)<BADNESS(bh)) {

218 
bh
 = 
tmp
;

219 i(!
	`BADNESS
(
tmp
))

223 } (
tmp
 =mp->
b_xt_
!
_li
);

224 i(!
bh
) {

225 
	`p_
(&
bufr_wa
);

226 

;

228 
	`wa__bufr
(
bh
);

229 i(
bh
->
b_cou
)

230 

;

231 
bh
->
b_dt
) {

232 
	`sync_dev
(
bh
->
b_dev
);

233 
	`wa__bufr
(
bh
);

234 i(
bh
->
b_cou
)

235 

;

239 i(
	`fd_bufr
(
dev
,
block
))

240 

;

243 
bh
->
b_cou
=1;

244 
bh
->
b_dt
=0;

245 
bh
->
b_uode
=0;

246 
	`move_om_queues
(
bh
);

247 
bh
->
b_dev
=
dev
;

248 
bh
->
b_block
=
block
;

249 
	`_to_queues
(
bh
);

250  
bh
;

251 
	}
}

253 
	$bl
(
bufr_hd
 * 
buf
)

255 i(!
buf
)

257 
	`wa__bufr
(
buf
);

258 i(!(
buf
->
b_cou
--))

259 
	`nic
("Tryingo free free buffer");

260 
	`wake_up
(&
bufr_wa
);

261 
	}
}

267 
bufr_hd
 * 
	$bad
(
dev
,
block
)

269 
bufr_hd
 * 
bh
;

271 i(!(
bh
=
	`gblk
(
dev
,
block
)))

272 
	`nic
("bread: getblketurned NULL\n");

273 i(
bh
->
b_uode
)

274  
bh
;

275 
	`_rw_block
(
READ
,
bh
);

276 
	`wa__bufr
(
bh
);

277 i(
bh
->
b_uode
)

278  
bh
;

279 
	`bl
(
bh
);

280  
NULL
;

281 
	}
}

283 
	#COPYBLK
(
om
,
to
) \

284 
	`__asm__
("cld\n\t" \

287 ::"c" (
BLOCK_SIZE
/4),"S" (
om
),"D" (
to
) \

288 :"cx","di","si")

	)

296 
	$bad_ge
(
addss
,
dev
,
b
[4])

298 
bufr_hd
 * 
bh
[4];

299 
i
;

301 
i
=0 ; i<4 ; i++)

302 i(
b
[
i
]) {

303 i(
bh
[
i
] = 
	`gblk
(
dev
,
b
[i]))

304 i(!
bh
[
i
]->
b_uode
)

305 
	`_rw_block
(
READ
,
bh
[
i
]);

307 
bh
[
i
] = 
NULL
;

308 
i
=0 ; i<4 ; i++,
addss
 +
BLOCK_SIZE
)

309 i(
bh
[
i
]) {

310 
	`wa__bufr
(
bh
[
i
]);

311 i(
bh
[
i
]->
b_uode
)

312 
	`COPYBLK
((
bh
[
i
]->
b_da
,
addss
);

313 
	`bl
(
bh
[
i
]);

315 
	}
}

322 
bufr_hd
 * 
	$bada
(
dev
,
f
, ...)

324 
va_li
 
gs
;

325 
bufr_hd
 * 
bh
, *
tmp
;

327 
	`va_t
(
gs
,
f
);

328 i(!(
bh
=
	`gblk
(
dev
,
f
)))

329 
	`nic
("bread: getblketurned NULL\n");

330 i(!
bh
->
b_uode
)

331 
	`_rw_block
(
READ
,
bh
);

332 (
f
=
	`va_g
(
gs
,))>=0) {

333 
tmp
=
	`gblk
(
dev
,
f
);

334 i(
tmp
) {

335 i(!
tmp
->
b_uode
)

336 
	`_rw_block
(
READA
,
bh
);

337 
tmp
->
b_cou
--;

340 
	`va_d
(
gs
);

341 
	`wa__bufr
(
bh
);

342 i(
bh
->
b_uode
)

343  
bh
;

344 
	`bl
(
bh
);

345  (
NULL
);

346 
	}
}

348 
	$bufr_
(
bufr_d
)

350 
bufr_hd
 * 
h
 = 
t_bufr
;

351 * 
b
;

352 
i
;

354 i(
bufr_d
 == 1<<20)

355 
b
 = (*) (640*1024);

357 
b
 = (*
bufr_d
;

358  (
b
 -
BLOCK_SIZE
>((*(
h
+1)) ) {

359 
h
->
b_dev
 = 0;

360 
h
->
b_dt
 = 0;

361 
h
->
b_cou
 = 0;

362 
h
->
b_lock
 = 0;

363 
h
->
b_uode
 = 0;

364 
h
->
b_wa
 = 
NULL
;

365 
h
->
b_xt
 = 
NULL
;

366 
h
->
b_ev
 = 
NULL
;

367 
h
->
b_da
 = (*
b
;

368 
h
->
b_ev_
 = h-1;

369 
h
->
b_xt_
 = h+1;

370 
h
++;

371 
NR_BUFFERS
++;

372 i(
b
 == (*) 0x100000)

373 
b
 = (*) 0xA0000;

375 
h
--;

376 
_li
 = 
t_bufr
;

377 
_li
->
b_ev_
 = 
h
;

378 
h
->
b_xt_
 = 
_li
;

379 
i
=0;i<
NR_HASH
;i++)

380 
hash_b
[
i
]=
NULL
;

381 
	}
}

	@fs/char_dev.c

7 
	~<o.h
>

8 
	~<sys/tys.h
>

10 
	~<lux/sched.h
>

11 
	~<lux/kl.h
>

13 
	~<asm/gmt.h
>

14 
	~<asm/io.h
>

16 
y_ad
(
m
,* 
buf
,
cou
);

17 
y_wre
(
m
,* 
buf
,
cou
);

19 (*
w_r
)(
	trw
,
	tm
,* 
	tbuf
,
	tcou
,
	toff_t
 * 
	tpos
);

21 
	$rw_yx
(
rw
,
m
,* 
buf
,
cou
,
off_t
 * 
pos
)

23  ((
rw
==
READ
)?
	`y_ad
(
m
,
buf
,
cou
):

24 
	`y_wre
(
m
,
buf
,
cou
));

25 
	}
}

27 
	$rw_y
(
rw
,
m
,* 
buf
,
cou
, 
off_t
 * 
pos
)

29 i(
cut
->
y
<0)

30  -
EPERM
;

31  
	`rw_yx
(
rw
,
cut
->
y
,
buf
,
cou
,
pos
);

32 
	}
}

34 
	$rw_m
(
rw
,* 
buf
, 
cou
, 
off_t
 *
pos
)

36  -
EIO
;

37 
	}
}

39 
	$rw_mem
(
rw
,* 
buf
, 
cou
, 
off_t
 * 
pos
)

41  -
EIO
;

42 
	}
}

44 
	$rw_kmem
(
rw
,* 
buf
, 
cou
, 
off_t
 * 
pos
)

46  -
EIO
;

47 
	}
}

49 
	$rw_pt
(
rw
,* 
buf
, 
cou
, 
off_t
 * 
pos
)

51 
i
=*
pos
;

53 
cou
-->0 && 
i
<65536) {

54 i(
rw
==
READ
)

55 
	`put_fs_by
(
	`b
(
i
),
buf
++);

57 
	`outb
(
	`g_fs_by
(
buf
++),
i
);

58 
i
++;

60 
i
 -*
pos
;

61 *
pos
 +
i
;

62  
i
;

63 
	}
}

65 
	$rw_memy
(
rw
, 
m
, * 
buf
, 
cou
, 
off_t
 * 
pos
)

67 
m
) {

69  
	`rw_m
(
rw
,
buf
,
cou
,
pos
);

71  
	`rw_mem
(
rw
,
buf
,
cou
,
pos
);

73  
	`rw_kmem
(
rw
,
buf
,
cou
,
pos
);

75  (
rw
==
READ
)?0:
cou
;

77  
	`rw_pt
(
rw
,
buf
,
cou
,
pos
);

79  -
EIO
;

81 
	}
}

83 
	#NRDEVS
 (( (
w_b
))/( (
w_r
)))

	)

85 
w_r
 
	gw_b
[]={

86 
NULL
,

87 
rw_memy
,

88 
NULL
,

89 
NULL
,

90 
rw_yx
,

91 
rw_y
,

92 
NULL
,

93 
NULL
};

95 
	$rw_ch
(
rw
,
dev
, * 
buf
, 
cou
, 
off_t
 * 
pos
)

97 
w_r
 
_addr
;

99 i(
	`MAJOR
(
dev
)>=
NRDEVS
)

100  -
ENODEV
;

101 i(!(
_addr
=
w_b
[
	`MAJOR
(
dev
)]))

102  -
ENODEV
;

103  
	`_addr
(
rw
,
	`MINOR
(
dev
),
buf
,
cou
,
pos
);

104 
	}
}

	@fs/exec.c

20 
	~<o.h
>

21 
	~<rg.h
>

22 
	~<sys/.h
>

23 
	~<a.out.h
>

25 
	~<lux/fs.h
>

26 
	~<lux/sched.h
>

27 
	~<lux/kl.h
>

28 
	~<lux/mm.h
>

29 
	~<asm/gmt.h
>

31 
sys_ex
(
ex_code
);

32 
sys_o
(
fd
);

39 
	#MAX_ARG_PAGES
 32

	)

46 * 
	$_bs
(* 
p
,
gc
,
vc
)

48 *
gv
,*
vp
;

49 * 

;

51 

 = (*(0xfffffff& (
p
);

52 

 -
vc
+1;

53 
vp
 = 

;

54 

 -
gc
+1;

55 
gv
 = 

;

56 
	`put_fs_lg
(()
vp
,--

);

57 
	`put_fs_lg
(()
gv
,--

);

58 
	`put_fs_lg
(()
gc
,--

);

59 
gc
-->0) {

60 
	`put_fs_lg
((
p
,
gv
++);

61 
	`g_fs_by
(
p
++)) ;

63 
	`put_fs_lg
(0,
gv
);

64 
vc
-->0) {

65 
	`put_fs_lg
((
p
,
vp
++);

66 
	`g_fs_by
(
p
++)) ;

68 
	`put_fs_lg
(0,
vp
);

69  

;

70 
	}
}

75 
	$cou
(** 
gv
)

77 
i
=0;

78 ** 
tmp
;

80 i(
tmp
 = 
gv
)

81 
	`g_fs_lg
((*(
tmp
++)))

82 
i
++;

84  
i
;

85 
	}
}

104 
	$cy_rgs
(
gc
,** 
gv
,*
ge
,

105 
p
, 
om_kmem
)

107 *
tmp
, *
g
;

108 
n
, 
offt
 = 0;

109 
d_fs
, 
w_fs
;

111 i(!
p
)

113 
w_fs
 = 
	`g_ds
();

114 
d_fs
 = 
	`g_fs
();

115 i(
om_kmem
==2)

116 
	`t_fs
(
w_fs
);

117 
gc
-- > 0) {

118 i(
om_kmem
 == 1)

119 
	`t_fs
(
w_fs
);

120 i(!(
tmp
 = (*)
	`g_fs_lg
(((*)
gv
)+
gc
)))

121 
	`nic
("argc is wrong");

122 i(
om_kmem
 == 1)

123 
	`t_fs
(
d_fs
);

124 
n
=0;

126 
n
++;

127 } 
	`g_fs_by
(
tmp
++));

128 i(
p
-
n
 < 0) {

129 
	`t_fs
(
d_fs
);

132 
n
) {

133 --
p
; --
tmp
; --
n
;

134 i(--
offt
 < 0) {

135 
offt
 = 
p
 % 
PAGE_SIZE
;

136 i(
om_kmem
==2)

137 
	`t_fs
(
d_fs
);

138 i(!(
g
 = (*
ge
[
p
/
PAGE_SIZE
]) &&

139 !(
g
 = (*
ge
[
p
/
PAGE_SIZE
] =

140 (*
	`g__ge
()))

142 i(
om_kmem
==2)

143 
	`t_fs
(
w_fs
);

146 *(
g
 + 
offt

	`g_fs_by
(
tmp
);

149 i(
om_kmem
==2)

150 
	`t_fs
(
d_fs
);

151  
p
;

152 
	}
}

154 
	$chge_ldt
(
xt_size
,* 
ge
)

156 
code_lim
,
da_lim
,
code_ba
,
da_ba
;

157 
i
;

159 
code_lim
 = 
xt_size
+
PAGE_SIZE
 -1;

160 
code_lim
 &= 0xFFFFF000;

161 
da_lim
 = 0x4000000;

162 
code_ba
 = 
	`g_ba
(
cut
->
ldt
[1]);

163 
da_ba
 = 
code_ba
;

164 
	`t_ba
(
cut
->
ldt
[1],
code_ba
);

165 
	`t_lim
(
cut
->
ldt
[1],
code_lim
);

166 
	`t_ba
(
cut
->
ldt
[2],
da_ba
);

167 
	`t_lim
(
cut
->
ldt
[2],
da_lim
);

169 
	`__asm__
("pushl $0x17\n\tpop %%fs"::);

170 
da_ba
 +
da_lim
;

171 
i
=
MAX_ARG_PAGES
-1 ; i>=0 ; i--) {

172 
da_ba
 -
PAGE_SIZE
;

173 i(
ge
[
i
])

174 
	`put_ge
(
ge
[
i
],
da_ba
);

176  
da_lim
;

177 
	}
}

182 
	$do_execve
(* 
e
,
tmp
,* 
fame
,

183 ** 
gv
, ** 
vp
)

185 
m_ode
 * 
ode
;

186 
bufr_hd
 * 
bh
;

187 
exec
 
ex
;

188 
ge
[
MAX_ARG_PAGES
];

189 
i
,
gc
,
vc
;

190 
e_uid
, 
e_gid
;

191 
tv
;

192 
sh_bg
 = 0;

193 
p
=
PAGE_SIZE
*
MAX_ARG_PAGES
-4;

195 i((0xfff& 
e
[1]) != 0x000f)

196 
	`nic
("execve called from supervisor mode");

197 
i
=0 ; i<
MAX_ARG_PAGES
 ; i++)

198 
ge
[
i
]=0;

199 i(!(
ode
=
	`mei
(
fame
)))

200  -
ENOENT
;

201 
gc
 = 
	`cou
(
gv
);

202 
vc
 = 
	`cou
(
vp
);

204 
t_
:

205 i(!
	`S_ISREG
(
ode
->
i_mode
)) {

206 
tv
 = -
EACCES
;

207 
exec_r2
;

209 
i
 = 
ode
->
i_mode
;

210 
e_uid
 = (
i
 & 
S_ISUID
? 
ode
->
i_uid
 : 
cut
->
euid
;

211 
e_gid
 = (
i
 & 
S_ISGID
? 
ode
->
i_gid
 : 
cut
->
egid
;

212 i(
cut
->
euid
 =
ode
->
i_uid
)

213 
i
 >>= 6;

214 i(
cut
->
egid
 =
ode
->
i_gid
)

215 
i
 >>= 3;

216 i(!(
i
 & 1) &&

217 !((
ode
->
i_mode
 & 0111&& 
	`sur
())) {

218 
tv
 = -
ENOEXEC
;

219 
exec_r2
;

221 i(!(
bh
 = 
	`bad
(
ode
->
i_dev
,ode->
i_ze
[0]))) {

222 
tv
 = -
EACCES
;

223 
exec_r2
;

225 
ex
 = *((
exec
 *
bh
->
b_da
);

226 i((
bh
->
b_da
[0] ='#'&& (bh->b_da[1] ='!'&& (!
sh_bg
)) {

232 
buf
[1023], *

, *

, *
i_me
, *
i_g
;

233 
d_fs
;

235 
	`y
(
buf
, 
bh
->
b_da
+2, 1022);

236 
	`bl
(
bh
);

237 
	`ut
(
ode
);

238 
buf
[1022] = '\0';

239 i(

 = 
	`rchr
(
buf
, '\n')) {

240 *

 = '\0';

241 

 = 
buf
; (*cp == ' ') || (*cp == '\t'); cp++);

243 i(!

 || *cp == '\0') {

244 
tv
 = -
ENOEXEC
;

245 
exec_r1
;

247 

 = 
i_me
 = 

;

248 
i_g
 = 0;

249  ; *

 && (*cp != ' ') && (*cp != '\t'); cp++) {

250 i(*

 == '/')

251 
i_me
 = 

+1;

253 i(*

) {

254 *

++ = '\0';

255 
i_g
 = 

;

261 i(
sh_bg
++ == 0) {

262 
p
 = 
	`cy_rgs
(
vc
, 
vp
, 
ge
,, 0);

263 
p
 = 
	`cy_rgs
(--
gc
, 
gv
+1, 
ge
,, 0);

273 
p
 = 
	`cy_rgs
(1, &
fame
, 
ge
,, 1);

274 
gc
++;

275 i(
i_g
) {

276 
p
 = 
	`cy_rgs
(1, &
i_g
, 
ge
,, 2);

277 
gc
++;

279 
p
 = 
	`cy_rgs
(1, &
i_me
, 
ge
,, 2);

280 
gc
++;

281 i(!
p
) {

282 
tv
 = -
ENOMEM
;

283 
exec_r1
;

288 
d_fs
 = 
	`g_fs
();

289 
	`t_fs
(
	`g_ds
());

290 i(!(
ode
=
	`mei
(

))) {

291 
	`t_fs
(
d_fs
);

292 
tv
 = -
ENOENT
;

293 
exec_r1
;

295 
	`t_fs
(
d_fs
);

296 
t_
;

298 
	`bl
(
bh
);

299 i(
	`N_MAGIC
(
ex
!
ZMAGIC
 ||x.
a_size
 ||x.
a_drsize
 ||

300 
ex
.
a_xt
+ex.
a_da
+ex.
a_bss
>0x3000000 ||

301 
ode
->
i_size
 < 
ex
.
a_xt
+ex.
a_da
+ex.
a_syms
+
	`N_TXTOFF
(ex)) {

302 
tv
 = -
ENOEXEC
;

303 
exec_r2
;

305 i(
	`N_TXTOFF
(
ex
!
BLOCK_SIZE
) {

306 
	`tk
("%s: N_TXTOFF !BLOCK_SIZE. S.out.h.", 
fame
);

307 
tv
 = -
ENOEXEC
;

308 
exec_r2
;

310 i(!
sh_bg
) {

311 
p
 = 
	`cy_rgs
(
vc
,
vp
,
ge
,p,0);

312 
p
 = 
	`cy_rgs
(
gc
,
gv
,
ge
,p,0);

313 i(!
p
) {

314 
tv
 = -
ENOMEM
;

315 
exec_r2
;

319 i(
cut
->
execub
)

320 
	`ut
(
cut
->
execub
);

321 
cut
->
execub
 = 
ode
;

322 
i
=0 ; i<32 ; i++)

323 
cut
->
sigai
[
i
].
_hdr
 = 
NULL
;

324 
i
=0 ; i<
NR_OPEN
 ; i++)

325 i((
cut
->
o__exec
>>
i
)&1)

326 
	`sys_o
(
i
);

327 
cut
->
o__exec
 = 0;

328 
	`_ge_bs
(
	`g_ba
(
cut
->
ldt
[1]),
	`g_lim
(0x0f));

329 
	`_ge_bs
(
	`g_ba
(
cut
->
ldt
[2]),
	`g_lim
(0x17));

330 i(
ϡ_sk_ud_mh
 =
cut
)

331 
ϡ_sk_ud_mh
 = 
NULL
;

332 
cut
->
ud_mh
 = 0;

333 
p
 +
	`chge_ldt
(
ex
.
a_xt
,
ge
)-
MAX_ARG_PAGES
*
PAGE_SIZE
;

334 
p
 = (
	`_bs
((*,
gc
,
vc
);

335 
cut
->
brk
 = 
ex
.
a_bss
 +

336 (
cut
->
d_da
 = 
ex
.
a_da
 +

337 (
cut
->
d_code
 = 
ex
.
a_xt
));

338 
cut
->
t_ack
 = 
p
 & 0xfffff000;

339 
cut
->
euid
 = 
e_uid
;

340 
cut
->
egid
 = 
e_gid
;

341 
i
 = 
ex
.
a_xt
+ex.
a_da
;

342 
i
&0xfff)

343 
	`put_fs_by
(0,(*(
i
++));

344 
e
[0] = 
ex
.
a_y
;

345 
e
[3] = 
p
;

347 
exec_r2
:

348 
	`ut
(
ode
);

349 
exec_r1
:

350 
i
=0 ; i<
MAX_ARG_PAGES
 ; i++)

351 
	`_ge
(
ge
[
i
]);

352 (
tv
);

353 
	}
}

	@fs/fcntl.c

7 
	~<rg.h
>

8 
	~<o.h
>

9 
	~<lux/sched.h
>

10 
	~<lux/kl.h
>

11 
	~<asm/gmt.h
>

13 
	~<f.h
>

14 
	~<sys/.h
>

16 
sys_o
(
fd
);

18 
	$dupfd
(
fd
, 
g
)

20 i(
fd
 >
NR_OPEN
 || !
cut
->
fp
[fd])

21  -
EBADF
;

22 i(
g
 >
NR_OPEN
)

23  -
EINVAL
;

24 
g
 < 
NR_OPEN
)

25 i(
cut
->
fp
[
g
])

26 
g
++;

29 i(
g
 >
NR_OPEN
)

30  -
EMFILE
;

31 
cut
->
o__exec
 &~(1<<
g
);

32 (
cut
->
fp
[
g
] = cut->fp[
fd
])->
f_cou
++;

33  
g
;

34 
	}
}

36 
	$sys_dup2
(
dfd
, 
wfd
)

38 
	`sys_o
(
wfd
);

39  
	`dupfd
(
dfd
,
wfd
);

40 
	}
}

42 
	$sys_dup
(
fdes
)

44  
	`dupfd
(
fdes
,0);

45 
	}
}

47 
	$sys_f
(
fd
, 
cmd
, 
g
)

49 
fe
 * 
fp
;

51 i(
fd
 >
NR_OPEN
 || !(
fp
 = 
cut
->filp[fd]))

52  -
EBADF
;

53 
cmd
) {

54 
F_DUPFD
:

55  
	`dupfd
(
fd
,
g
);

56 
F_GETFD
:

57  (
cut
->
o__exec
>>
fd
)&1;

58 
F_SETFD
:

59 i(
g
&1)

60 
cut
->
o__exec
 |(1<<
fd
);

62 
cut
->
o__exec
 &~(1<<
fd
);

64 
F_GETFL
:

65  
fp
->
f_ags
;

66 
F_SETFL
:

67 
fp
->
f_ags
 &~(
O_APPEND
 | 
O_NONBLOCK
);

68 
fp
->
f_ags
 |
g
 & (
O_APPEND
 | 
O_NONBLOCK
);

70 
F_GETLK
: 
F_SETLK
: 
F_SETLKW
:

75 
	}
}

	@fs/file_dev.c

7 
	~<o.h
>

8 
	~<f.h
>

10 
	~<lux/sched.h
>

11 
	~<lux/kl.h
>

12 
	~<asm/gmt.h
>

14 
	#MIN
(
a
,
b
(()<(b))?):(b))

	)

15 
	#MAX
(
a
,
b
(()>(b))?):(b))

	)

17 
	$fe_ad
(
m_ode
 * 
ode
, 
fe
 * 
fp
, * 
buf
, 
cou
)

19 

,
chs
,

;

20 
bufr_hd
 * 
bh
;

22 i((

=
cou
)<=0)

24 

) {

25 i(

 = 
	`bm
(
ode
,(
fp
->
f_pos
)/
BLOCK_SIZE
)) {

26 i(!(
bh
=
	`bad
(
ode
->
i_dev
,

)))

29 
bh
 = 
NULL
;

30 

 = 
fp
->
f_pos
 % 
BLOCK_SIZE
;

31 
chs
 = 
	`MIN

BLOCK_SIZE
-

 , 

 );

32 
fp
->
f_pos
 +
chs
;

33 

 -
chs
;

34 i(
bh
) {

35 * 
p
 = 

 + 
bh
->
b_da
;

36 
chs
-->0)

37 
	`put_fs_by
(*(
p
++),
buf
++);

38 
	`bl
(
bh
);

40 
chs
-->0)

41 
	`put_fs_by
(0,
buf
++);

44 
ode
->
i_ime
 = 
CURRENT_TIME
;

45  (
cou
-

)?(cou-):-
ERROR
;

46 
	}
}

48 
	$fe_wre
(
m_ode
 * 
ode
, 
fe
 * 
fp
, * 
buf
, 
cou
)

50 
off_t
 
pos
;

51 
block
,
c
;

52 
bufr_hd
 * 
bh
;

53 * 
p
;

54 
i
=0;

60 i(
fp
->
f_ags
 & 
O_APPEND
)

61 
pos
 = 
ode
->
i_size
;

63 
pos
 = 
fp
->
f_pos
;

64 
i
<
cou
) {

65 i(!(
block
 = 
	`_block
(
ode
,
pos
/
BLOCK_SIZE
)))

67 i(!(
bh
=
	`bad
(
ode
->
i_dev
,
block
)))

69 
c
 = 
pos
 % 
BLOCK_SIZE
;

70 
p
 = 
c
 + 
bh
->
b_da
;

71 
bh
->
b_dt
 = 1;

72 
c
 = 
BLOCK_SIZE
-c;

73 i(
c
 > 
cou
-
i
) c = count-i;

74 
pos
 +
c
;

75 i(
pos
 > 
ode
->
i_size
) {

76 
ode
->
i_size
 = 
pos
;

77 
ode
->
i_dt
 = 1;

79 
i
 +
c
;

80 
c
-->0)

81 *(
p
++
	`g_fs_by
(
buf
++);

82 
	`bl
(
bh
);

84 
ode
->
i_mtime
 = 
CURRENT_TIME
;

85 i(!(
fp
->
f_ags
 & 
O_APPEND
)) {

86 
fp
->
f_pos
 = 
pos
;

87 
ode
->
i_ime
 = 
CURRENT_TIME
;

89  (
i
?i:-1);

90 
	}
}

	@fs/file_table.c

7 
	~<lux/fs.h
>

9 
fe
 
	gfe_b
[
NR_FILE
];

	@fs/inode.c

7 
	~<rg.h
>

8 
	~<sys/.h
>

10 
	~<lux/sched.h
>

11 
	~<lux/kl.h
>

12 
	~<lux/mm.h
>

13 
	~<asm/syem.h
>

15 
m_ode
 
	gode_b
[
NR_INODE
]={{0,},};

17 
ad_ode
(
m_ode
 * 
ode
);

18 
wre_ode
(
m_ode
 * 
ode
);

20 
le
 
	$wa__ode
(
m_ode
 * 
ode
)

22 
	`i
();

23 
ode
->
i_lock
)

24 
	`p_
(&
ode
->
i_wa
);

25 
	`i
();

26 
	}
}

28 
le
 
	$lock_ode
(
m_ode
 * 
ode
)

30 
	`i
();

31 
ode
->
i_lock
)

32 
	`p_
(&
ode
->
i_wa
);

33 
ode
->
i_lock
=1;

34 
	`i
();

35 
	}
}

37 
le
 
	$uock_ode
(
m_ode
 * 
ode
)

39 
ode
->
i_lock
=0;

40 
	`wake_up
(&
ode
->
i_wa
);

41 
	}
}

43 
	$vide_odes
(
dev
)

45 
i
;

46 
m_ode
 * 
ode
;

48 
ode
 = 0+
ode_b
;

49 
i
=0 ; i<
NR_INODE
 ; i++,
ode
++) {

50 
	`wa__ode
(
ode
);

51 i(
ode
->
i_dev
 =
dev
) {

52 i(
ode
->
i_cou
)

53 
	`tk
("inode in use onemoved disk\n\r");

54 
ode
->
i_dev
 = inode->
i_dt
 = 0;

57 
	}
}

59 
	$sync_odes
()

61 
i
;

62 
m_ode
 * 
ode
;

64 
ode
 = 0+
ode_b
;

65 
i
=0 ; i<
NR_INODE
 ; i++,
ode
++) {

66 
	`wa__ode
(
ode
);

67 i(
ode
->
i_dt
 && !ode->
i_pe
)

68 
	`wre_ode
(
ode
);

70 
	}
}

72 
	$_bm
(
m_ode
 * 
ode
,
block
,

)

74 
bufr_hd
 * 
bh
;

75 
i
;

77 i(
block
<0)

78 
	`nic
("_bmap: block<0");

79 i(
block
 >= 7+512+512*512)

80 
	`nic
("_bmap: block>big");

81 i(
block
<7) {

82 i(

 && !
ode
->
i_ze
[
block
])

83 i(
ode
->
i_ze
[
block
]=
	`w_block
(ode->
i_dev
)) {

84 
ode
->
i_ime
=
CURRENT_TIME
;

85 
ode
->
i_dt
=1;

87  
ode
->
i_ze
[
block
];

89 
block
 -= 7;

90 i(
block
<512) {

91 i(

 && !
ode
->
i_ze
[7])

92 i(
ode
->
i_ze
[7]=
	`w_block
(ode->
i_dev
)) {

93 
ode
->
i_dt
=1;

94 
ode
->
i_ime
=
CURRENT_TIME
;

96 i(!
ode
->
i_ze
[7])

98 i(!(
bh
 = 
	`bad
(
ode
->
i_dev
,ode->
i_ze
[7])))

100 
i
 = ((*(
bh
->
b_da
))[
block
];

101 i(

 && !
i
)

102 i(
i
=
	`w_block
(
ode
->
i_dev
)) {

103 ((*(
bh
->
b_da
))[
block
]=
i
;

104 
bh
->
b_dt
=1;

106 
	`bl
(
bh
);

107  
i
;

109 
block
 -= 512;

110 i(

 && !
ode
->
i_ze
[8])

111 i(
ode
->
i_ze
[8]=
	`w_block
(ode->
i_dev
)) {

112 
ode
->
i_dt
=1;

113 
ode
->
i_ime
=
CURRENT_TIME
;

115 i(!
ode
->
i_ze
[8])

117 i(!(
bh
=
	`bad
(
ode
->
i_dev
,ode->
i_ze
[8])))

119 
i
 = ((*)
bh
->
b_da
)[
block
>>9];

120 i(

 && !
i
)

121 i(
i
=
	`w_block
(
ode
->
i_dev
)) {

122 ((*(
bh
->
b_da
))[
block
>>9]=
i
;

123 
bh
->
b_dt
=1;

125 
	`bl
(
bh
);

126 i(!
i
)

128 i(!(
bh
=
	`bad
(
ode
->
i_dev
,
i
)))

130 
i
 = ((*)
bh
->
b_da
)[
block
&511];

131 i(

 && !
i
)

132 i(
i
=
	`w_block
(
ode
->
i_dev
)) {

133 ((*(
bh
->
b_da
))[
block
&511]=
i
;

134 
bh
->
b_dt
=1;

136 
	`bl
(
bh
);

137  
i
;

138 
	}
}

140 
	$bm
(
m_ode
 * 
ode
,
block
)

142  
	`_bm
(
ode
,
block
,0);

143 
	}
}

145 
	$_block
(
m_ode
 * 
ode
, 
block
)

147  
	`_bm
(
ode
,
block
,1);

148 
	}
}

150 
	$ut
(
m_ode
 * 
ode
)

152 i(!
ode
)

154 
	`wa__ode
(
ode
);

155 i(!
ode
->
i_cou
)

156 
	`nic
("iput:ryingo free free inode");

157 i(
ode
->
i_pe
) {

158 
	`wake_up
(&
ode
->
i_wa
);

159 i(--
ode
->
i_cou
)

161 
	`_ge
(
ode
->
i_size
);

162 
ode
->
i_cou
=0;

163 
ode
->
i_dt
=0;

164 
ode
->
i_pe
=0;

167 i(!
ode
->
i_dev
) {

168 
ode
->
i_cou
--;

171 i(
	`S_ISBLK
(
ode
->
i_mode
)) {

172 
	`sync_dev
(
ode
->
i_ze
[0]);

173 
	`wa__ode
(
ode
);

175 

:

176 i(
ode
->
i_cou
>1) {

177 
ode
->
i_cou
--;

180 i(!
ode
->
i_ƚks
) {

181 
	`un
(
ode
);

182 
	`_ode
(
ode
);

185 i(
ode
->
i_dt
) {

186 
	`wre_ode
(
ode
);

187 
	`wa__ode
(
ode
);

188 

;

190 
ode
->
i_cou
--;

192 
	}
}

194 
m_ode
 * 
	$g_emy_ode
()

196 
m_ode
 * 
ode
;

197 
m_ode
 * 
ϡ_ode
 = 
ode_b
;

198 
i
;

201 
ode
 = 
NULL
;

202 
i
 = 
NR_INODE
; i ; i--) {

203 i(++
ϡ_ode
 >
ode_b
 + 
NR_INODE
)

204 
ϡ_ode
 = 
ode_b
;

205 i(!
ϡ_ode
->
i_cou
) {

206 
ode
 = 
ϡ_ode
;

207 i(!
ode
->
i_dt
 && !ode->
i_lock
)

211 i(!
ode
) {

212 
i
=0 ; i<
NR_INODE
 ; i++)

213 
	`tk
("%04x: %6d\t",
ode_b
[
i
].
i_dev
,

214 
ode_b
[
i
].
i_num
);

215 
	`nic
("No free inodes in mem");

217 
	`wa__ode
(
ode
);

218 
ode
->
i_dt
) {

219 
	`wre_ode
(
ode
);

220 
	`wa__ode
(
ode
);

222 } 
ode
->
i_cou
);

223 
	`memt
(
ode
,0,(*inode));

224 
ode
->
i_cou
 = 1;

225  
ode
;

226 
	}
}

228 
m_ode
 * 
	$g_pe_ode
()

230 
m_ode
 * 
ode
;

232 i(!(
ode
 = 
	`g_emy_ode
()))

233  
NULL
;

234 i(!(
ode
->
i_size
=
	`g__ge
())) {

235 
ode
->
i_cou
 = 0;

236  
NULL
;

238 
ode
->
i_cou
 = 2;

239 
	`PIPE_HEAD
(*
ode

	`PIPE_TAIL
(*inode) = 0;

240 
ode
->
i_pe
 = 1;

241  
ode
;

242 
	}
}

244 
m_ode
 * 
	$ig
(
dev
,

)

246 
m_ode
 * 
ode
, * 
emy
;

248 i(!
dev
)

249 
	`nic
("iget with dev==0");

250 
emy
 = 
	`g_emy_ode
();

251 
ode
 = 
ode_b
;

252 
ode
 < 
NR_INODE
+
ode_b
) {

253 i(
ode
->
i_dev
 !
dev
 || inode->
i_num
 !

) {

254 
ode
++;

257 
	`wa__ode
(
ode
);

258 i(
ode
->
i_dev
 !
dev
 || inode->
i_num
 !

) {

259 
ode
 = 
ode_b
;

262 
ode
->
i_cou
++;

263 i(
ode
->
i_mou
) {

264 
i
;

266 
i
 = 0 ; i<
NR_SUPER
 ; i++)

267 i(
sur_block
[
i
].
s_imou
==
ode
)

269 i(
i
 >
NR_SUPER
) {

270 
	`tk
("Mounted inode hasn't got sb\n");

271 i(
emy
)

272 
	`ut
(
emy
);

273  
ode
;

275 
	`ut
(
ode
);

276 
dev
 = 
sur_block
[
i
].
s_dev
;

277 

 = 
ROOT_INO
;

278 
ode
 = 
ode_b
;

281 i(
emy
)

282 
	`ut
(
emy
);

283  
ode
;

285 i(!
emy
)

286  (
NULL
);

287 
ode
=
emy
;

288 
ode
->
i_dev
 = 
dev
;

289 
ode
->
i_num
 = 

;

290 
	`ad_ode
(
ode
);

291  
ode
;

292 
	}
}

294 
	$ad_ode
(
m_ode
 * 
ode
)

296 
sur_block
 * 
sb
;

297 
bufr_hd
 * 
bh
;

298 
block
;

300 
	`lock_ode
(
ode
);

301 i(!(
sb
=
	`g_sur
(
ode
->
i_dev
)))

302 
	`nic
("tryingoead inode without dev");

303 
block
 = 2 + 
sb
->
s_im_blocks
 + sb->
s_zm_blocks
 +

304 (
ode
->
i_num
-1)/
INODES_PER_BLOCK
;

305 i(!(
bh
=
	`bad
(
ode
->
i_dev
,
block
)))

306 
	`nic
("unableoead i-node block");

307 *(
d_ode
 *)
ode
 =

308 ((
d_ode
 *)
bh
->
b_da
)

309 [(
ode
->
i_num
-1)%
INODES_PER_BLOCK
];

310 
	`bl
(
bh
);

311 
	`uock_ode
(
ode
);

312 
	}
}

314 
	$wre_ode
(
m_ode
 * 
ode
)

316 
sur_block
 * 
sb
;

317 
bufr_hd
 * 
bh
;

318 
block
;

320 
	`lock_ode
(
ode
);

321 i(!
ode
->
i_dt
 || !ode->
i_dev
) {

322 
	`uock_ode
(
ode
);

325 i(!(
sb
=
	`g_sur
(
ode
->
i_dev
)))

326 
	`nic
("tryingo write inode without device");

327 
block
 = 2 + 
sb
->
s_im_blocks
 + sb->
s_zm_blocks
 +

328 (
ode
->
i_num
-1)/
INODES_PER_BLOCK
;

329 i(!(
bh
=
	`bad
(
ode
->
i_dev
,
block
)))

330 
	`nic
("unableoead i-node block");

331 ((
d_ode
 *)
bh
->
b_da
)

332 [(
ode
->
i_num
-1)%
INODES_PER_BLOCK
] =

333 *(
d_ode
 *)
ode
;

334 
bh
->
b_dt
=1;

335 
ode
->
i_dt
=0;

336 
	`bl
(
bh
);

337 
	`uock_ode
(
ode
);

338 
	}
}

	@fs/ioctl.c

7 
	~<rg.h
>

8 
	~<o.h
>

9 
	~<sys/.h
>

11 
	~<lux/sched.h
>

13 
y_iol
(
dev
, 
cmd
, 
g
);

15 (*
	tiol_r
)(
	tdev
,
	tcmd
,
	tg
);

17 
	#NRDEVS
 (( (
iol_b
))/( (
iol_r
)))

	)

19 
iol_r
 
iol_b
[]={

20 
NULL
,

21 
NULL
,

22 
NULL
,

23 
NULL
,

24 
y_iol
,

25 
y_iol
,

26 
NULL
,

27 
NULL
};

30 
	$sys_iol
(
fd
, 
cmd
, 
g
)

32 
fe
 * 
fp
;

33 
dev
,
mode
;

35 i(
fd
 >
NR_OPEN
 || !(
fp
 = 
cut
->filp[fd]))

36  -
EBADF
;

37 
mode
=
fp
->
f_ode
->
i_mode
;

38 i(!
	`S_ISCHR
(
mode
&& !
	`S_ISBLK
(mode))

39  -
EINVAL
;

40 
dev
 = 
fp
->
f_ode
->
i_ze
[0];

41 i(
	`MAJOR
(
dev
>
NRDEVS
)

42  -
ENODEV
;

43 i(!
iol_b
[
	`MAJOR
(
dev
)])

44  -
ENOTTY
;

45  
iol_b
[
	`MAJOR
(
dev
)](dev,
cmd
,
g
);

46 
	}
}

	@fs/namei.c

11 
	~<lux/sched.h
>

12 
	~<lux/kl.h
>

13 
	~<asm/gmt.h
>

15 
	~<rg.h
>

16 
	~<f.h
>

17 
	~<o.h
>

18 
	~<cڡ.h
>

19 
	~<sys/.h
>

21 
	#ACC_MODE
(
x
("\004\002\006\377"[(x)&
O_ACCMODE
])

	)

29 
	#MAY_EXEC
 1

	)

30 
	#MAY_WRITE
 2

	)

31 
	#MAY_READ
 4

	)

40 
	$rmissi
(
m_ode
 * 
ode
,
mask
)

42 
mode
 = 
ode
->
i_mode
;

45 i(
ode
->
i_dev
 && !ode->
i_ƚks
)

47 i(
cut
->
euid
==
ode
->
i_uid
)

48 
mode
 >>= 6;

49 i(
cut
->
egid
==
ode
->
i_gid
)

50 
mode
 >>= 3;

51 i(((
mode
 & 
mask
 & 0007=mask|| 
	`sur
())

54 
	}
}

63 
	$mch
(
n
,cڡ * 
me
,
d_y
 * 
de
)

65 
me
 
	`__asm__
("ax");

67 i(!
de
 || !de->
ode
 || 
n
 > 
NAME_LEN
)

69 i(
n
 < 
NAME_LEN
 && 
de
->
me
[len])

71 
	`__asm__
("cld\n\t"

74 :"" (
me
)

75 :"0" (0),"S" ((
me
),"D" ((
de
->me),"c" (
n
)

77  
me
;

78 
	}
}

91 
bufr_hd
 * 
	$fd_y
(
m_ode
 ** 
d
,

92 cڡ * 
me
, 
m
, 
d_y
 ** 
s_d
)

94 
s
;

95 
block
,
i
;

96 
bufr_hd
 * 
bh
;

97 
d_y
 * 
de
;

98 
sur_block
 * 
sb
;

100 #ifde
NO_TRUNCATE


101 i(
m
 > 
NAME_LEN
)

102  
NULL
;

104 i(
m
 > 
NAME_LEN
)

105 
m
 = 
NAME_LEN
;

107 
s
 = (*
d
)->
i_size
 / ( (
d_y
));

108 *
s_d
 = 
NULL
;

109 i(!
m
)

110  
NULL
;

112 i(
m
==2 && 
	`g_fs_by
(
me
)=='.' && get_fs_byte(name+1)=='.') {

114 i((*
d
=
cut
->
ro
)

115 
m
=1;

116 i((*
d
)->
i_num
 =
ROOT_INO
) {

119 
sb
=
	`g_sur
((*
d
)->
i_dev
);

120 i(
sb
->
s_imou
) {

121 
	`ut
(*
d
);

122 (*
d
)=
sb
->
s_imou
;

123 (*
d
)->
i_cou
++;

127 i(!(
block
 = (*
d
)->
i_ze
[0]))

128  
NULL
;

129 i(!(
bh
 = 
	`bad
((*
d
)->
i_dev
,
block
)))

130  
NULL
;

131 
i
 = 0;

132 
de
 = (
d_y
 *
bh
->
b_da
;

133 
i
 < 
s
) {

134 i((*)
de
 >
BLOCK_SIZE
+
bh
->
b_da
) {

135 
	`bl
(
bh
);

136 
bh
 = 
NULL
;

137 i(!(
block
 = 
	`bm
(*
d
,
i
/
DIR_ENTRIES_PER_BLOCK
)) ||

138 !(
bh
 = 
	`bad
((*
d
)->
i_dev
,
block
))) {

139 
i
 +
DIR_ENTRIES_PER_BLOCK
;

142 
de
 = (
d_y
 *
bh
->
b_da
;

144 i(
	`mch
(
m
,
me
,
de
)) {

145 *
s_d
 = 
de
;

146  
bh
;

148 
de
++;

149 
i
++;

151 
	`bl
(
bh
);

152  
NULL
;

153 
	}
}

165 
bufr_hd
 * 
	$add_y
(
m_ode
 * 
d
,

166 cڡ * 
me
, 
m
, 
d_y
 ** 
s_d
)

168 
block
,
i
;

169 
bufr_hd
 * 
bh
;

170 
d_y
 * 
de
;

172 *
s_d
 = 
NULL
;

173 #ifde
NO_TRUNCATE


174 i(
m
 > 
NAME_LEN
)

175  
NULL
;

177 i(
m
 > 
NAME_LEN
)

178 
m
 = 
NAME_LEN
;

180 i(!
m
)

181  
NULL
;

182 i(!(
block
 = 
d
->
i_ze
[0]))

183  
NULL
;

184 i(!(
bh
 = 
	`bad
(
d
->
i_dev
,
block
)))

185  
NULL
;

186 
i
 = 0;

187 
de
 = (
d_y
 *
bh
->
b_da
;

189 i((*)
de
 >
BLOCK_SIZE
+
bh
->
b_da
) {

190 
	`bl
(
bh
);

191 
bh
 = 
NULL
;

192 
block
 = 
	`_block
(
d
,
i
/
DIR_ENTRIES_PER_BLOCK
);

193 i(!
block
)

194  
NULL
;

195 i(!(
bh
 = 
	`bad
(
d
->
i_dev
,
block
))) {

196 
i
 +
DIR_ENTRIES_PER_BLOCK
;

199 
de
 = (
d_y
 *
bh
->
b_da
;

201 i(
i
*(
d_y
>
d
->
i_size
) {

202 
de
->
ode
=0;

203 
d
->
i_size
 = (
i
+1)*(
d_y
);

204 
d
->
i_dt
 = 1;

205 
d
->
i_ime
 = 
CURRENT_TIME
;

207 i(!
de
->
ode
) {

208 
d
->
i_mtime
 = 
CURRENT_TIME
;

209 
i
=0; i < 
NAME_LEN
 ; i++)

210 
de
->
me
[
i
]=(i<
m
)?
	`g_fs_by
(name+i):0;

211 
bh
->
b_dt
 = 1;

212 *
s_d
 = 
de
;

213  
bh
;

215 
de
++;

216 
i
++;

218 
	`bl
(
bh
);

219  
NULL
;

220 
	}
}

228 
m_ode
 * 
	$g_d
(cڡ * 
thme
)

230 
c
;

231 cڡ * 
thiame
;

232 
m_ode
 * 
ode
;

233 
bufr_hd
 * 
bh
;

234 
m
,
r
,
idev
;

235 
d_y
 * 
de
;

237 i(!
cut
->
ro
 || !cut->ro->
i_cou
)

238 
	`nic
("Nooot inode");

239 i(!
cut
->
pwd
 || !cut->pwd->
i_cou
)

240 
	`nic
("No cwd inode");

241 i((
c
=
	`g_fs_by
(
thme
))=='/') {

242 
ode
 = 
cut
->
ro
;

243 
thme
++;

244 } i(
c
)

245 
ode
 = 
cut
->
pwd
;

247  
NULL
;

248 
ode
->
i_cou
++;

250 
thiame
 = 
thme
;

251 i(!
	`S_ISDIR
(
ode
->
i_mode
|| !
	`rmissi
(ode,
MAY_EXEC
)) {

252 
	`ut
(
ode
);

253  
NULL
;

255 
m
=0;(
c
=
	`g_fs_by
(
thme
++))&&(c!='/');namelen++)

257 i(!
c
)

258  
ode
;

259 i(!(
bh
 = 
	`fd_y
(&
ode
,
thiame
,
m
,&
de
))) {

260 
	`ut
(
ode
);

261  
NULL
;

263 
r
 = 
de
->
ode
;

264 
idev
 = 
ode
->
i_dev
;

265 
	`bl
(
bh
);

266 
	`ut
(
ode
);

267 i(!(
ode
 = 
	`ig
(
idev
,
r
)))

268  
NULL
;

270 
	}
}

278 
m_ode
 * 
	$d_mei
(cڡ * 
thme
,

279 * 
m
, cڡ ** 
me
)

281 
c
;

282 cڡ * 
bame
;

283 
m_ode
 * 
d
;

285 i(!(
d
 = 
	`g_d
(
thme
)))

286  
NULL
;

287 
bame
 = 
thme
;

288 
c
=
	`g_fs_by
(
thme
++))

289 i(
c
=='/')

290 
bame
=
thme
;

291 *
m
 = 
thme
-
bame
-1;

292 *
me
 = 
bame
;

293  
d
;

294 
	}
}

303 
m_ode
 * 
	$mei
(cڡ * 
thme
)

305 cڡ * 
bame
;

306 
r
,
dev
,
m
;

307 
m_ode
 * 
d
;

308 
bufr_hd
 * 
bh
;

309 
d_y
 * 
de
;

311 i(!(
d
 = 
	`d_mei
(
thme
,&
m
,&
bame
)))

312  
NULL
;

313 i(!
m
)

314  
d
;

315 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

316 i(!
bh
) {

317 
	`ut
(
d
);

318  
NULL
;

320 
r
 = 
de
->
ode
;

321 
dev
 = 
d
->
i_dev
;

322 
	`bl
(
bh
);

323 
	`ut
(
d
);

324 
d
=
	`ig
(
dev
,
r
);

325 i(
d
) {

326 
d
->
i_ime
=
CURRENT_TIME
;

327 
d
->
i_dt
=1;

329  
d
;

330 
	}
}

337 
	$ݒ_mei
(cڡ * 
thme
, 
ag
, 
mode
,

338 
m_ode
 ** 
s_ode
)

340 cڡ * 
bame
;

341 
r
,
dev
,
m
;

342 
m_ode
 * 
d
, *
ode
;

343 
bufr_hd
 * 
bh
;

344 
d_y
 * 
de
;

346 i((
ag
 & 
O_TRUNC
&& !(ag & 
O_ACCMODE
))

347 
ag
 |
O_WRONLY
;

348 
mode
 &0777 & ~
cut
->
umask
;

349 
mode
 |
I_REGULAR
;

350 i(!(
d
 = 
	`d_mei
(
thme
,&
m
,&
bame
)))

351  -
ENOENT
;

352 i(!
m
) {

353 i(!(
ag
 & (
O_ACCMODE
|
O_CREAT
|
O_TRUNC
))) {

354 *
s_ode
=
d
;

357 
	`ut
(
d
);

358  -
EISDIR
;

360 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

361 i(!
bh
) {

362 i(!(
ag
 & 
O_CREAT
)) {

363 
	`ut
(
d
);

364  -
ENOENT
;

366 i(!
	`rmissi
(
d
,
MAY_WRITE
)) {

367 
	`ut
(
d
);

368  -
EACCES
;

370 
ode
 = 
	`w_ode
(
d
->
i_dev
);

371 i(!
ode
) {

372 
	`ut
(
d
);

373  -
ENOSPC
;

375 
ode
->
i_uid
 = 
cut
->
euid
;

376 
ode
->
i_mode
 = 
mode
;

377 
ode
->
i_dt
 = 1;

378 
bh
 = 
	`add_y
(
d
,
bame
,
m
,&
de
);

379 i(!
bh
) {

380 
ode
->
i_ƚks
--;

381 
	`ut
(
ode
);

382 
	`ut
(
d
);

383  -
ENOSPC
;

385 
de
->
ode
 = inode->
i_num
;

386 
bh
->
b_dt
 = 1;

387 
	`bl
(
bh
);

388 
	`ut
(
d
);

389 *
s_ode
 = 
ode
;

392 
r
 = 
de
->
ode
;

393 
dev
 = 
d
->
i_dev
;

394 
	`bl
(
bh
);

395 
	`ut
(
d
);

396 i(
ag
 & 
O_EXCL
)

397  -
EEXIST
;

398 i(!(
ode
=
	`ig
(
dev
,
r
)))

399  -
EACCES
;

400 i((
	`S_ISDIR
(
ode
->
i_mode
&& (
ag
 & 
O_ACCMODE
)) ||

401 !
	`rmissi
(
ode
,
	`ACC_MODE
(
ag
))) {

402 
	`ut
(
ode
);

403  -
EPERM
;

405 
ode
->
i_ime
 = 
CURRENT_TIME
;

406 i(
ag
 & 
O_TRUNC
)

407 
	`un
(
ode
);

408 *
s_ode
 = 
ode
;

410 
	}
}

412 
	$sys_mknod
(cڡ * 
fame
, 
mode
, 
dev
)

414 cڡ * 
bame
;

415 
m
;

416 
m_ode
 * 
d
, * 
ode
;

417 
bufr_hd
 * 
bh
;

418 
d_y
 * 
de
;

420 i(!
	`sur
())

421  -
EPERM
;

422 i(!(
d
 = 
	`d_mei
(
fame
,&
m
,&
bame
)))

423  -
ENOENT
;

424 i(!
m
) {

425 
	`ut
(
d
);

426  -
ENOENT
;

428 i(!
	`rmissi
(
d
,
MAY_WRITE
)) {

429 
	`ut
(
d
);

430  -
EPERM
;

432 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

433 i(
bh
) {

434 
	`bl
(
bh
);

435 
	`ut
(
d
);

436  -
EEXIST
;

438 
ode
 = 
	`w_ode
(
d
->
i_dev
);

439 i(!
ode
) {

440 
	`ut
(
d
);

441  -
ENOSPC
;

443 
ode
->
i_mode
 = 
mode
;

444 i(
	`S_ISBLK
(
mode
|| 
	`S_ISCHR
(mode))

445 
ode
->
i_ze
[0] = 
dev
;

446 
ode
->
i_mtime
 = inode->
i_ime
 = 
CURRENT_TIME
;

447 
ode
->
i_dt
 = 1;

448 
bh
 = 
	`add_y
(
d
,
bame
,
m
,&
de
);

449 i(!
bh
) {

450 
	`ut
(
d
);

451 
ode
->
i_ƚks
=0;

452 
	`ut
(
ode
);

453  -
ENOSPC
;

455 
de
->
ode
 = inode->
i_num
;

456 
bh
->
b_dt
 = 1;

457 
	`ut
(
d
);

458 
	`ut
(
ode
);

459 
	`bl
(
bh
);

461 
	}
}

463 
	$sys_mkd
(cڡ * 
thme
, 
mode
)

465 cڡ * 
bame
;

466 
m
;

467 
m_ode
 * 
d
, * 
ode
;

468 
bufr_hd
 * 
bh
, *
d_block
;

469 
d_y
 * 
de
;

471 i(!
	`sur
())

472  -
EPERM
;

473 i(!(
d
 = 
	`d_mei
(
thme
,&
m
,&
bame
)))

474  -
ENOENT
;

475 i(!
m
) {

476 
	`ut
(
d
);

477  -
ENOENT
;

479 i(!
	`rmissi
(
d
,
MAY_WRITE
)) {

480 
	`ut
(
d
);

481  -
EPERM
;

483 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

484 i(
bh
) {

485 
	`bl
(
bh
);

486 
	`ut
(
d
);

487  -
EEXIST
;

489 
ode
 = 
	`w_ode
(
d
->
i_dev
);

490 i(!
ode
) {

491 
	`ut
(
d
);

492  -
ENOSPC
;

494 
ode
->
i_size
 = 32;

495 
ode
->
i_dt
 = 1;

496 
ode
->
i_mtime
 = inode->
i_ime
 = 
CURRENT_TIME
;

497 i(!(
ode
->
i_ze
[0]=
	`w_block
(ode->
i_dev
))) {

498 
	`ut
(
d
);

499 
ode
->
i_ƚks
--;

500 
	`ut
(
ode
);

501  -
ENOSPC
;

503 
ode
->
i_dt
 = 1;

504 i(!(
d_block
=
	`bad
(
ode
->
i_dev
,ode->
i_ze
[0]))) {

505 
	`ut
(
d
);

506 
	`_block
(
ode
->
i_dev
,ode->
i_ze
[0]);

507 
ode
->
i_ƚks
--;

508 
	`ut
(
ode
);

509  -
ERROR
;

511 
de
 = (
d_y
 *
d_block
->
b_da
;

512 
de
->
ode
=ode->
i_num
;

513 
	`ry
(
de
->
me
,".");

514 
de
++;

515 
de
->
ode
 = 
d
->
i_num
;

516 
	`ry
(
de
->
me
,"..");

517 
ode
->
i_ƚks
 = 2;

518 
d_block
->
b_dt
 = 1;

519 
	`bl
(
d_block
);

520 
ode
->
i_mode
 = 
I_DIRECTORY
 | (
mode
 & 0777 & ~
cut
->
umask
);

521 
ode
->
i_dt
 = 1;

522 
bh
 = 
	`add_y
(
d
,
bame
,
m
,&
de
);

523 i(!
bh
) {

524 
	`ut
(
d
);

525 
	`_block
(
ode
->
i_dev
,ode->
i_ze
[0]);

526 
ode
->
i_ƚks
=0;

527 
	`ut
(
ode
);

528  -
ENOSPC
;

530 
de
->
ode
 = inode->
i_num
;

531 
bh
->
b_dt
 = 1;

532 
d
->
i_ƚks
++;

533 
d
->
i_dt
 = 1;

534 
	`ut
(
d
);

535 
	`ut
(
ode
);

536 
	`bl
(
bh
);

538 
	}
}

543 
	$emy_d
(
m_ode
 * 
ode
)

545 

,
block
;

546 
n
;

547 
bufr_hd
 * 
bh
;

548 
d_y
 * 
de
;

550 
n
 = 
ode
->
i_size
 /  (
d_y
);

551 i(
n
<2 || !
ode
->
i_ze
[0] ||

552 !(
bh
=
	`bad
(
ode
->
i_dev
,ode->
i_ze
[0]))) {

553 
	`tk
("wng - bad dey odev %04x\n",
ode
->
i_dev
);

556 
de
 = (
d_y
 *
bh
->
b_da
;

557 i(
de
[0].
ode
 !ode->
i_num
 || !de[1].inode ||

558 
	`rcmp
(".",
de
[0].
me
) || strcmp("..",de[1].name)) {

559 
	`tk
("wng - bad dey odev %04x\n",
ode
->
i_dev
);

562 

 = 2;

563 
de
 += 2;

564 

<
n
) {

565 i((*
de
 >(*(
bh
->
b_da
+
BLOCK_SIZE
)) {

566 
	`bl
(
bh
);

567 
block
=
	`bm
(
ode
,

/
DIR_ENTRIES_PER_BLOCK
);

568 i(!
block
) {

569 

 +
DIR_ENTRIES_PER_BLOCK
;

572 i(!(
bh
=
	`bad
(
ode
->
i_dev
,
block
)))

574 
de
 = (
d_y
 *
bh
->
b_da
;

576 i(
de
->
ode
) {

577 
	`bl
(
bh
);

580 
de
++;

581 

++;

583 
	`bl
(
bh
);

585 
	}
}

587 
	$sys_rmd
(cڡ * 
me
)

589 cڡ * 
bame
;

590 
m
;

591 
m_ode
 * 
d
, * 
ode
;

592 
bufr_hd
 * 
bh
;

593 
d_y
 * 
de
;

595 i(!
	`sur
())

596  -
EPERM
;

597 i(!(
d
 = 
	`d_mei
(
me
,&
m
,&
bame
)))

598  -
ENOENT
;

599 i(!
m
) {

600 
	`ut
(
d
);

601  -
ENOENT
;

603 i(!
	`rmissi
(
d
,
MAY_WRITE
)) {

604 
	`ut
(
d
);

605  -
EPERM
;

607 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

608 i(!
bh
) {

609 
	`ut
(
d
);

610  -
ENOENT
;

612 i(!(
ode
 = 
	`ig
(
d
->
i_dev
, 
de
->inode))) {

613 
	`ut
(
d
);

614 
	`bl
(
bh
);

615  -
EPERM
;

617 i((
d
->
i_mode
 & 
S_ISVTX
&& 
cut
->
euid
 &&

618 
ode
->
i_uid
 !
cut
->
euid
) {

619 
	`ut
(
d
);

620 
	`ut
(
ode
);

621 
	`bl
(
bh
);

622  -
EPERM
;

624 i(
ode
->
i_dev
 !
d
->i_dev || inode->
i_cou
>1) {

625 
	`ut
(
d
);

626 
	`ut
(
ode
);

627 
	`bl
(
bh
);

628  -
EPERM
;

630 i(
ode
 =
d
) {

631 
	`ut
(
ode
);

632 
	`ut
(
d
);

633 
	`bl
(
bh
);

634  -
EPERM
;

636 i(!
	`S_ISDIR
(
ode
->
i_mode
)) {

637 
	`ut
(
ode
);

638 
	`ut
(
d
);

639 
	`bl
(
bh
);

640  -
ENOTDIR
;

642 i(!
	`emy_d
(
ode
)) {

643 
	`ut
(
ode
);

644 
	`ut
(
d
);

645 
	`bl
(
bh
);

646  -
ENOTEMPTY
;

648 i(
ode
->
i_ƚks
 != 2)

649 
	`tk
("emy dey haƚk!=2 (%d)",
ode
->
i_ƚks
);

650 
de
->
ode
 = 0;

651 
bh
->
b_dt
 = 1;

652 
	`bl
(
bh
);

653 
ode
->
i_ƚks
=0;

654 
ode
->
i_dt
=1;

655 
d
->
i_ƚks
--;

656 
d
->
i_ime
 = d->
i_mtime
 = 
CURRENT_TIME
;

657 
d
->
i_dt
=1;

658 
	`ut
(
d
);

659 
	`ut
(
ode
);

661 
	}
}

663 
	$sys_uƚk
(cڡ * 
me
)

665 cڡ * 
bame
;

666 
m
;

667 
m_ode
 * 
d
, * 
ode
;

668 
bufr_hd
 * 
bh
;

669 
d_y
 * 
de
;

671 i(!(
d
 = 
	`d_mei
(
me
,&
m
,&
bame
)))

672  -
ENOENT
;

673 i(!
m
) {

674 
	`ut
(
d
);

675  -
ENOENT
;

677 i(!
	`rmissi
(
d
,
MAY_WRITE
)) {

678 
	`ut
(
d
);

679  -
EPERM
;

681 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

682 i(!
bh
) {

683 
	`ut
(
d
);

684  -
ENOENT
;

686 i(!(
ode
 = 
	`ig
(
d
->
i_dev
, 
de
->inode))) {

687 
	`ut
(
d
);

688 
	`bl
(
bh
);

689  -
ENOENT
;

691 i((
d
->
i_mode
 & 
S_ISVTX
&& !
	`sur
() &&

692 
cut
->
euid
 !
ode
->
i_uid
 &&

693 
cut
->
euid
 !
d
->
i_uid
) {

694 
	`ut
(
d
);

695 
	`ut
(
ode
);

696 
	`bl
(
bh
);

697  -
EPERM
;

699 i(
	`S_ISDIR
(
ode
->
i_mode
)) {

700 
	`ut
(
ode
);

701 
	`ut
(
d
);

702 
	`bl
(
bh
);

703  -
EPERM
;

705 i(!
ode
->
i_ƚks
) {

706 
	`tk
("Deletingonexistent file (%04x:%d), %d\n",

707 
ode
->
i_dev
,ode->
i_num
,ode->
i_ƚks
);

708 
ode
->
i_ƚks
=1;

710 
de
->
ode
 = 0;

711 
bh
->
b_dt
 = 1;

712 
	`bl
(
bh
);

713 
ode
->
i_ƚks
--;

714 
ode
->
i_dt
 = 1;

715 
ode
->
i_ime
 = 
CURRENT_TIME
;

716 
	`ut
(
ode
);

717 
	`ut
(
d
);

719 
	}
}

721 
	$sys_lk
(cڡ * 
dme
, cڡ * 
wme
)

723 
d_y
 * 
de
;

724 
m_ode
 * 
dode
, * 
d
;

725 
bufr_hd
 * 
bh
;

726 cڡ * 
bame
;

727 
m
;

729 
dode
=
	`mei
(
dme
);

730 i(!
dode
)

731  -
ENOENT
;

732 i(
	`S_ISDIR
(
dode
->
i_mode
)) {

733 
	`ut
(
dode
);

734  -
EPERM
;

736 
d
 = 
	`d_mei
(
wme
,&
m
,&
bame
);

737 i(!
d
) {

738 
	`ut
(
dode
);

739  -
EACCES
;

741 i(!
m
) {

742 
	`ut
(
dode
);

743 
	`ut
(
d
);

744  -
EPERM
;

746 i(
d
->
i_dev
 !
dode
->i_dev) {

747 
	`ut
(
d
);

748 
	`ut
(
dode
);

749  -
EXDEV
;

751 i(!
	`rmissi
(
d
,
MAY_WRITE
)) {

752 
	`ut
(
d
);

753 
	`ut
(
dode
);

754  -
EACCES
;

756 
bh
 = 
	`fd_y
(&
d
,
bame
,
m
,&
de
);

757 i(
bh
) {

758 
	`bl
(
bh
);

759 
	`ut
(
d
);

760 
	`ut
(
dode
);

761  -
EEXIST
;

763 
bh
 = 
	`add_y
(
d
,
bame
,
m
,&
de
);

764 i(!
bh
) {

765 
	`ut
(
d
);

766 
	`ut
(
dode
);

767  -
ENOSPC
;

769 
de
->
ode
 = 
dode
->
i_num
;

770 
bh
->
b_dt
 = 1;

771 
	`bl
(
bh
);

772 
	`ut
(
d
);

773 
dode
->
i_ƚks
++;

774 
dode
->
i_ime
 = 
CURRENT_TIME
;

775 
dode
->
i_dt
 = 1;

776 
	`ut
(
dode
);

778 
	}
}

	@fs/open.c

7 
	~<rg.h
>

8 
	~<o.h
>

9 
	~<f.h
>

10 
	~<sys/tys.h
>

11 
	~<utime.h
>

12 
	~<sys/.h
>

14 
	~<lux/sched.h
>

15 
	~<lux/y.h
>

16 
	~<lux/kl.h
>

17 
	~<asm/gmt.h
>

19 
	$sys_u
(
dev
, 
u
 * 
ubuf
)

21  -
ENOSYS
;

22 
	}
}

24 
	$sys_utime
(* 
fame
, 
utimbuf
 * 
times
)

26 
m_ode
 * 
ode
;

27 
aime
,
modtime
;

29 i(!(
ode
=
	`mei
(
fame
)))

30  -
ENOENT
;

31 i(
times
) {

32 
aime
 = 
	`g_fs_lg
((*&
times
->actime);

33 
modtime
 = 
	`g_fs_lg
((*&
times
->modtime);

35 
aime
 = 
modtime
 = 
CURRENT_TIME
;

36 
ode
->
i_ime
 = 
aime
;

37 
ode
->
i_mtime
 = 
modtime
;

38 
ode
->
i_dt
 = 1;

39 
	`ut
(
ode
);

41 
	}
}

47 
	$sys_acss
(cڡ * 
fame
,
mode
)

49 
m_ode
 * 
ode
;

50 
s
, 
i_mode
;

52 
mode
 &= 0007;

53 i(!(
ode
=
	`mei
(
fame
)))

54  -
EACCES
;

55 
i_mode
 = 
s
 = 
ode
->i_mode & 0777;

56 
	`ut
(
ode
);

57 i(
cut
->
uid
 =
ode
->
i_uid
)

58 
s
 >>= 6;

59 i(
cut
->
gid
 =
ode
->
i_gid
)

60 
s
 >>= 6;

61 i((
s
 & 0007 & 
mode
) == mode)

69 i((!
cut
->
uid
) &&

70 (!(
mode
 & 1|| (
i_mode
 & 0111)))

72  -
EACCES
;

73 
	}
}

75 
	$sys_chd
(cڡ * 
fame
)

77 
m_ode
 * 
ode
;

79 i(!(
ode
 = 
	`mei
(
fame
)))

80  -
ENOENT
;

81 i(!
	`S_ISDIR
(
ode
->
i_mode
)) {

82 
	`ut
(
ode
);

83  -
ENOTDIR
;

85 
	`ut
(
cut
->
pwd
);

86 
cut
->
pwd
 = 
ode
;

88 
	}
}

90 
	$sys_chro
(cڡ * 
fame
)

92 
m_ode
 * 
ode
;

94 i(!(
ode
=
	`mei
(
fame
)))

95  -
ENOENT
;

96 i(!
	`S_ISDIR
(
ode
->
i_mode
)) {

97 
	`ut
(
ode
);

98  -
ENOTDIR
;

100 
	`ut
(
cut
->
ro
);

101 
cut
->
ro
 = 
ode
;

103 
	}
}

105 
	$sys_chmod
(cڡ * 
fame
,
mode
)

107 
m_ode
 * 
ode
;

109 i(!(
ode
=
	`mei
(
fame
)))

110  -
ENOENT
;

111 i((
cut
->
euid
 !
ode
->
i_uid
&& !
	`sur
()) {

112 
	`ut
(
ode
);

113  -
EACCES
;

115 
ode
->
i_mode
 = (
mode
 & 07777) | (inode->i_mode & ~07777);

116 
ode
->
i_dt
 = 1;

117 
	`ut
(
ode
);

119 
	}
}

121 
	$sys_chown
(cڡ * 
fame
,
uid
,
gid
)

123 
m_ode
 * 
ode
;

125 i(!(
ode
=
	`mei
(
fame
)))

126  -
ENOENT
;

127 i(!
	`sur
()) {

128 
	`ut
(
ode
);

129  -
EACCES
;

131 
ode
->
i_uid
=
uid
;

132 
ode
->
i_gid
=
gid
;

133 
ode
->
i_dt
=1;

134 
	`ut
(
ode
);

136 
	}
}

138 
	$sys_ݒ
(cڡ * 
fame
,
ag
,
mode
)

140 
m_ode
 * 
ode
;

141 
fe
 * 
f
;

142 
i
,
fd
;

144 
mode
 &0777 & ~
cut
->
umask
;

145 
fd
=0 ; fd<
NR_OPEN
 ; fd++)

146 i(!
cut
->
fp
[
fd
])

148 i(
fd
>=
NR_OPEN
)

149  -
EINVAL
;

150 
cut
->
o__exec
 &~(1<<
fd
);

151 
f
=0+
fe_b
;

152 
i
=0 ; i<
NR_FILE
 ; i++,
f
++)

153 i(!
f
->
f_cou
) ;

154 i(
i
>=
NR_FILE
)

155  -
EINVAL
;

156 (
cut
->
fp
[
fd
]=
f
)->
f_cou
++;

157 i((
i
=
	`ݒ_mei
(
fame
,
ag
,
mode
,&
ode
))<0) {

158 
cut
->
fp
[
fd
]=
NULL
;

159 
f
->
f_cou
=0;

160  
i
;

163 i(
	`S_ISCHR
(
ode
->
i_mode
))

164 i(
	`MAJOR
(
ode
->
i_ze
[0])==4) {

165 i(
cut
->
ad
 && cut->
y
<0) {

166 
cut
->
y
 = 
	`MINOR
(
ode
->
i_ze
[0]);

167 
y_b
[
cut
->
y
].
pg
 = current->pgrp;

169 } i(
	`MAJOR
(
ode
->
i_ze
[0])==5)

170 i(
cut
->
y
<0) {

171 
	`ut
(
ode
);

172 
cut
->
fp
[
fd
]=
NULL
;

173 
f
->
f_cou
=0;

174  -
EPERM
;

177 i(
	`S_ISBLK
(
ode
->
i_mode
))

178 
	`check_disk_chge
(
ode
->
i_ze
[0]);

179 
f
->
f_mode
 = 
ode
->
i_mode
;

180 
f
->
f_ags
 = 
ag
;

181 
f
->
f_cou
 = 1;

182 
f
->
f_ode
 = 
ode
;

183 
f
->
f_pos
 = 0;

184  (
fd
);

185 
	}
}

187 
	$sys_t
(cڡ * 
thme
, 
mode
)

189  
	`sys_ݒ
(
thme
, 
O_CREAT
 | 
O_TRUNC
, 
mode
);

190 
	}
}

192 
	$sys_o
(
fd
)

194 
fe
 * 
fp
;

196 i(
fd
 >
NR_OPEN
)

197  -
EINVAL
;

198 
cut
->
o__exec
 &~(1<<
fd
);

199 i(!(
fp
 = 
cut
->fp[
fd
]))

200  -
EINVAL
;

201 
cut
->
fp
[
fd
] = 
NULL
;

202 i(
fp
->
f_cou
 == 0)

203 
	`nic
("Close: file count is 0");

204 i(--
fp
->
f_cou
)

206 
	`ut
(
fp
->
f_ode
);

208 
	}
}

	@fs/pipe.c

7 
	~<sigl.h
>

9 
	~<lux/sched.h
>

10 
	~<lux/mm.h
>

11 
	~<asm/gmt.h
>

13 
	$ad_pe
(
m_ode
 * 
ode
, * 
buf
, 
cou
)

15 
chs
, 
size
, 
ad
 = 0;

17 
cou
>0) {

18 !(
size
=
	`PIPE_SIZE
(*
ode
))) {

19 
	`wake_up
(&
ode
->
i_wa
);

20 i(
ode
->
i_cou
 != 2)

21  
ad
;

22 
	`p_
(&
ode
->
i_wa
);

24 
chs
 = 
PAGE_SIZE
-
	`PIPE_TAIL
(*
ode
);

25 i(
chs
 > 
cou
)

26 
chs
 = 
cou
;

27 i(
chs
 > 
size
)

28 
chs
 = 
size
;

29 
cou
 -
chs
;

30 
ad
 +
chs
;

31 
size
 = 
	`PIPE_TAIL
(*
ode
);

32 
	`PIPE_TAIL
(*
ode
+
chs
;

33 
	`PIPE_TAIL
(*
ode
&(
PAGE_SIZE
-1);

34 
chs
-->0)

35 
	`put_fs_by
(((*)
ode
->
i_size
)[
size
++],
buf
++);

37 
	`wake_up
(&
ode
->
i_wa
);

38  
ad
;

39 
	}
}

41 
	$wre_pe
(
m_ode
 * 
ode
, * 
buf
, 
cou
)

43 
chs
, 
size
, 
wrn
 = 0;

45 
cou
>0) {

46 !(
size
=(
PAGE_SIZE
-1)-
	`PIPE_SIZE
(*
ode
))) {

47 
	`wake_up
(&
ode
->
i_wa
);

48 i(
ode
->
i_cou
 != 2) {

49 
cut
->
sigl
 |(1<<(
SIGPIPE
-1));

50  
wrn
?written:-1;

52 
	`p_
(&
ode
->
i_wa
);

54 
chs
 = 
PAGE_SIZE
-
	`PIPE_HEAD
(*
ode
);

55 i(
chs
 > 
cou
)

56 
chs
 = 
cou
;

57 i(
chs
 > 
size
)

58 
chs
 = 
size
;

59 
cou
 -
chs
;

60 
wrn
 +
chs
;

61 
size
 = 
	`PIPE_HEAD
(*
ode
);

62 
	`PIPE_HEAD
(*
ode
+
chs
;

63 
	`PIPE_HEAD
(*
ode
&(
PAGE_SIZE
-1);

64 
chs
-->0)

65 ((*)
ode
->
i_size
)[
size
++]=
	`g_fs_by
(
buf
++);

67 
	`wake_up
(&
ode
->
i_wa
);

68  
wrn
;

69 
	}
}

71 
	$sys_pe
(* 
fdes
)

73 
m_ode
 * 
ode
;

74 
fe
 * 
f
[2];

75 
fd
[2];

76 
i
,
j
;

78 
j
=0;

79 
i
=0;
j
<2 && i<
NR_FILE
;i++)

80 i(!
fe_b
[
i
].
f_cou
)

81 (
f
[
j
++]=
i
+
fe_b
)->
f_cou
++;

82 i(
j
==1)

83 
f
[0]->
f_cou
=0;

84 i(
j
<2)

86 
j
=0;

87 
i
=0;
j
<2 && i<
NR_OPEN
;i++)

88 i(!
cut
->
fp
[
i
]) {

89 
cut
->
fp
[ 
fd
[
j
]=
i
 ] = 
f
[j];

90 
j
++;

92 i(
j
==1)

93 
cut
->
fp
[
fd
[0]]=
NULL
;

94 i(
j
<2) {

95 
f
[0]->
f_cou
=f[1]->f_count=0;

98 i(!(
ode
=
	`g_pe_ode
())) {

99 
cut
->
fp
[
fd
[0]] =

100 
cut
->
fp
[
fd
[1]] = 
NULL
;

101 
f
[0]->
f_cou
 = f[1]->f_count = 0;

104 
f
[0]->
f_ode
 = f[1]->f_od
ode
;

105 
f
[0]->
f_pos
 = f[1]->f_pos = 0;

106 
f
[0]->
f_mode
 = 1;

107 
f
[1]->
f_mode
 = 2;

108 
	`put_fs_lg
(
fd
[0],0+
fdes
);

109 
	`put_fs_lg
(
fd
[1],1+
fdes
);

111 
	}
}

	@fs/read_write.c

7 
	~<sys/.h
>

8 
	~<o.h
>

9 
	~<sys/tys.h
>

11 
	~<lux/kl.h
>

12 
	~<lux/sched.h
>

13 
	~<asm/gmt.h
>

15 
rw_ch
(
rw
,
dev
, * 
buf
, 
cou
, 
off_t
 * 
pos
);

16 
ad_pe
(
m_ode
 * 
ode
, * 
buf
, 
cou
);

17 
wre_pe
(
m_ode
 * 
ode
, * 
buf
, 
cou
);

18 
block_ad
(
dev
, 
off_t
 * 
pos
, * 
buf
, 
cou
);

19 
block_wre
(
dev
, 
off_t
 * 
pos
, * 
buf
, 
cou
);

20 
fe_ad
(
m_ode
 * 
ode
, 
fe
 * 
fp
,

21 * 
buf
, 
cou
);

22 
fe_wre
(
m_ode
 * 
ode
, 
fe
 * 
fp
,

23 * 
buf
, 
cou
);

25 
	$sys_lek
(
fd
,
off_t
 
offt
, 
ig
)

27 
fe
 * file;

28 
tmp
;

30 i(
fd
 >
NR_OPEN
 || !(
fe
=
cut
->
fp
[fd]|| !(fe->
f_ode
)

31 || !
	`IS_SEEKABLE
(
	`MAJOR
(
fe
->
f_ode
->
i_dev
)))

32  -
EBADF
;

33 i(
fe
->
f_ode
->
i_pe
)

34  -
ESPIPE
;

35 
ig
) {

37 i(
offt
<0 -
EINVAL
;

38 
fe
->
f_pos
=
offt
;

41 i(
fe
->
f_pos
+
offt
<0 -
EINVAL
;

42 
fe
->
f_pos
 +
offt
;

45 i((
tmp
=
fe
->
f_ode
->
i_size
+
offt
) < 0)

46  -
EINVAL
;

47 
fe
->
f_pos
 = 
tmp
;

50  -
EINVAL
;

52  
fe
->
f_pos
;

53 
	}
}

55 
	$sys_ad
(
fd
,* 
buf
,
cou
)

57 
fe
 * file;

58 
m_ode
 * 
ode
;

60 i(
fd
>=
NR_OPEN
 || 
cou
<0 || !(
fe
=
cut
->
fp
[fd]))

61  -
EINVAL
;

62 i(!
cou
)

64 
	`vify_
(
buf
,
cou
);

65 
ode
 = 
fe
->
f_ode
;

66 i(
ode
->
i_pe
)

67  (
fe
->
f_mode
&1)?
	`ad_pe
(
ode
,
buf
,
cou
):-
EIO
;

68 i(
	`S_ISCHR
(
ode
->
i_mode
))

69  
	`rw_ch
(
READ
,
ode
->
i_ze
[0],
buf
,
cou
,&
fe
->
f_pos
);

70 i(
	`S_ISBLK
(
ode
->
i_mode
))

71  
	`block_ad
(
ode
->
i_ze
[0],&
fe
->
f_pos
,
buf
,
cou
);

72 i(
	`S_ISDIR
(
ode
->
i_mode
|| 
	`S_ISREG
(inode->i_mode)) {

73 i(
cou
+
fe
->
f_pos
 > 
ode
->
i_size
)

74 
cou
 = 
ode
->
i_size
 - 
fe
->
f_pos
;

75 i(
cou
<=0)

77  
	`fe_ad
(
ode
,
fe
,
buf
,
cou
);

79 
	`tk
("(Rd)ode->i_mode=%06o\n\r",
ode
->
i_mode
);

80  -
EINVAL
;

81 
	}
}

83 
	$sys_wre
(
fd
,* 
buf
,
cou
)

85 
fe
 * file;

86 
m_ode
 * 
ode
;

88 i(
fd
>=
NR_OPEN
 || 
cou
 <0 || !(
fe
=
cut
->
fp
[fd]))

89  -
EINVAL
;

90 i(!
cou
)

92 
ode
=
fe
->
f_ode
;

93 i(
ode
->
i_pe
)

94  (
fe
->
f_mode
&2)?
	`wre_pe
(
ode
,
buf
,
cou
):-
EIO
;

95 i(
	`S_ISCHR
(
ode
->
i_mode
))

96  
	`rw_ch
(
WRITE
,
ode
->
i_ze
[0],
buf
,
cou
,&
fe
->
f_pos
);

97 i(
	`S_ISBLK
(
ode
->
i_mode
))

98  
	`block_wre
(
ode
->
i_ze
[0],&
fe
->
f_pos
,
buf
,
cou
);

99 i(
	`S_ISREG
(
ode
->
i_mode
))

100  
	`fe_wre
(
ode
,
fe
,
buf
,
cou
);

101 
	`tk
("(Wre)ode->i_mode=%06o\n\r",
ode
->
i_mode
);

102  -
EINVAL
;

103 
	}
}

	@fs/stat.c

7 
	~<o.h
>

8 
	~<sys/.h
>

10 
	~<lux/fs.h
>

11 
	~<lux/sched.h
>

12 
	~<lux/kl.h
>

13 
	~<asm/gmt.h
>

15 
	$_
(
m_ode
 * 
ode
, 

 * 
buf
)

17 

 
tmp
;

18 
i
;

20 
	`vify_
(
buf
, (* statbuf));

21 
tmp
.
_dev
 = 
ode
->
i_dev
;

22 
tmp
.
_o
 = 
ode
->
i_num
;

23 
tmp
.
_mode
 = 
ode
->
i_mode
;

24 
tmp
.
_ƚk
 = 
ode
->
i_ƚks
;

25 
tmp
.
_uid
 = 
ode
->
i_uid
;

26 
tmp
.
_gid
 = 
ode
->
i_gid
;

27 
tmp
.
_rdev
 = 
ode
->
i_ze
[0];

28 
tmp
.
_size
 = 
ode
->
i_size
;

29 
tmp
.
_ime
 = 
ode
->
i_ime
;

30 
tmp
.
_mtime
 = 
ode
->
i_mtime
;

31 
tmp
.
_ime
 = 
ode
->
i_ime
;

32 
i
=0 ; i< (
tmp
) ; i++)

33 
	`put_fs_by
(((*&
tmp
)[
i
],&((*
buf
)[i]);

34 
	}
}

36 
	$sys_
(* 
fame
, 

 * 
buf
)

38 
m_ode
 * 
ode
;

40 i(!(
ode
=
	`mei
(
fame
)))

41  -
ENOENT
;

42 
	`_
(
ode
,
buf
);

43 
	`ut
(
ode
);

45 
	}
}

47 
	$sys_f
(
fd
, 

 * 
buf
)

49 
fe
 * 
f
;

50 
m_ode
 * 
ode
;

52 i(
fd
 >
NR_OPEN
 || !(
f
=
cut
->
fp
[fd]|| !(
ode
=f->
f_ode
))

53  -
EBADF
;

54 
	`_
(
ode
,
buf
);

56 
	}
}

	@fs/super.c

10 
	~<lux/cfig.h
>

11 
	~<lux/sched.h
>

12 
	~<lux/kl.h
>

13 
	~<asm/syem.h
>

15 
	~<o.h
>

16 
	~<sys/.h
>

18 
sync_dev
(
dev
);

19 
wa_f_keyess
();

22 
	#t_b
(
b
,
addr
) ({ \

23 
__s
 
	`__asm__
("ax"); \

24 
	`__asm__
("b%2,%3;tb %%":"" (
__s
):"a" (0),"r" (
b
),"m" (*(
addr
))); \

25 
__s
; })

	)

27 
sur_block
 
	gsur_block
[
NR_SUPER
];

29 
	gROOT_DEV
 = 0;

31 
	$lock_sur
(
sur_block
 * 
sb
)

33 
	`i
();

34 
sb
->
s_lock
)

35 
	`p_
(&(
sb
->
s_wa
));

36 
sb
->
s_lock
 = 1;

37 
	`i
();

38 
	}
}

40 
	$_sur
(
sur_block
 * 
sb
)

42 
	`i
();

43 
sb
->
s_lock
 = 0;

44 
	`wake_up
(&(
sb
->
s_wa
));

45 
	`i
();

46 
	}
}

48 
	$wa__sur
(
sur_block
 * 
sb
)

50 
	`i
();

51 
sb
->
s_lock
)

52 
	`p_
(&(
sb
->
s_wa
));

53 
	`i
();

54 
	}
}

56 
sur_block
 * 
	$g_sur
(
dev
)

58 
sur_block
 * 
s
;

60 i(!
dev
)

61  
NULL
;

62 
s
 = 0+
sur_block
;

63 
s
 < 
NR_SUPER
+
sur_block
)

64 i(
s
->
s_dev
 =
dev
) {

65 
	`wa__sur
(
s
);

66 i(
s
->
s_dev
 =
dev
)

67  
s
;

68 
s
 = 0+
sur_block
;

70 
s
++;

71  
NULL
;

72 
	}
}

74 
	$put_sur
(
dev
)

76 
sur_block
 * 
sb
;

77 
m_ode
 * 
ode
;

78 
i
;

80 i(
dev
 =
ROOT_DEV
) {

81 
	`tk
("root diskette changed:repare forrmageddon\n\r");

84 i(!(
sb
 = 
	`g_sur
(
dev
)))

86 i(
sb
->
s_imou
) {

87 
	`tk
("Mounted disk changed -ssk,ssk\n\r");

90 
	`lock_sur
(
sb
);

91 
sb
->
s_dev
 = 0;

92 
i
=0;i<
I_MAP_SLOTS
;i++)

93 
	`bl
(
sb
->
s_im
[
i
]);

94 
i
=0;i<
Z_MAP_SLOTS
;i++)

95 
	`bl
(
sb
->
s_zm
[
i
]);

96 
	`_sur
(
sb
);

98 
	}
}

100 
sur_block
 * 
	$ad_sur
(
dev
)

102 
sur_block
 * 
s
;

103 
bufr_hd
 * 
bh
;

104 
i
,
block
;

106 i(!
dev
)

107  
NULL
;

108 
	`check_disk_chge
(
dev
);

109 i(
s
 = 
	`g_sur
(
dev
))

110  
s
;

111 
s
 = 0+
sur_block
 ;; s++) {

112 i(
s
 >
NR_SUPER
+
sur_block
)

113  
NULL
;

114 i(!
s
->
s_dev
)

117 
s
->
s_dev
 = 
dev
;

118 
s
->
s_isup
 = 
NULL
;

119 
s
->
s_imou
 = 
NULL
;

120 
s
->
s_time
 = 0;

121 
s
->
s_rd_ly
 = 0;

122 
s
->
s_dt
 = 0;

123 
	`lock_sur
(
s
);

124 i(!(
bh
 = 
	`bad
(
dev
,1))) {

125 
s
->
s_dev
=0;

126 
	`_sur
(
s
);

127  
NULL
;

129 *((
d_sur_block
 *
s
) =

130 *((
d_sur_block
 *
bh
->
b_da
);

131 
	`bl
(
bh
);

132 i(
s
->
s_magic
 !
SUPER_MAGIC
) {

133 
s
->
s_dev
 = 0;

134 
	`_sur
(
s
);

135  
NULL
;

137 
i
=0;i<
I_MAP_SLOTS
;i++)

138 
s
->
s_im
[
i
] = 
NULL
;

139 
i
=0;i<
Z_MAP_SLOTS
;i++)

140 
s
->
s_zm
[
i
] = 
NULL
;

141 
block
=2;

142 
i
=0 ; i < 
s
->
s_im_blocks
 ; i++)

143 i(
s
->
s_im
[
i
]=
	`bad
(
dev
,
block
))

144 
block
++;

147 
i
=0 ; i < 
s
->
s_zm_blocks
 ; i++)

148 i(
s
->
s_zm
[
i
]=
	`bad
(
dev
,
block
))

149 
block
++;

152 i(
block
 !2+
s
->
s_im_blocks
+s->
s_zm_blocks
) {

153 
i
=0;i<
I_MAP_SLOTS
;i++)

154 
	`bl
(
s
->
s_im
[
i
]);

155 
i
=0;i<
Z_MAP_SLOTS
;i++)

156 
	`bl
(
s
->
s_zm
[
i
]);

157 
s
->
s_dev
=0;

158 
	`_sur
(
s
);

159  
NULL
;

161 
s
->
s_im
[0]->
b_da
[0] |= 1;

162 
s
->
s_zm
[0]->
b_da
[0] |= 1;

163 
	`_sur
(
s
);

164  
s
;

165 
	}
}

167 
	$sys_umou
(* 
dev_me
)

169 
m_ode
 * 
ode
;

170 
sur_block
 * 
sb
;

171 
dev
;

173 i(!(
ode
=
	`mei
(
dev_me
)))

174  -
ENOENT
;

175 
dev
 = 
ode
->
i_ze
[0];

176 i(!
	`S_ISBLK
(
ode
->
i_mode
)) {

177 
	`ut
(
ode
);

178  -
ENOTBLK
;

180 
	`ut
(
ode
);

181 i(
dev
==
ROOT_DEV
)

182  -
EBUSY
;

183 i(!(
sb
=
	`g_sur
(
dev
)|| !(sb->
s_imou
))

184  -
ENOENT
;

185 i(!
sb
->
s_imou
->
i_mou
)

186 
	`tk
("Mounted inode has i_mount=0\n");

187 
ode
=
ode_b
+0 ; inode<ode_b+
NR_INODE
 ; inode++)

188 i(
ode
->
i_dev
==
dev
 && inode->
i_cou
)

189  -
EBUSY
;

190 
sb
->
s_imou
->
i_mou
=0;

191 
	`ut
(
sb
->
s_imou
);

192 
sb
->
s_imou
 = 
NULL
;

193 
	`ut
(
sb
->
s_isup
);

194 
sb
->
s_isup
 = 
NULL
;

195 
	`put_sur
(
dev
);

196 
	`sync_dev
(
dev
);

198 
	}
}

200 
	$sys_mou
(* 
dev_me
, * 
d_me
, 
rw_ag
)

202 
m_ode
 * 
dev_i
, * 
d_i
;

203 
sur_block
 * 
sb
;

204 
dev
;

206 i(!(
dev_i
=
	`mei
(
dev_me
)))

207  -
ENOENT
;

208 
dev
 = 
dev_i
->
i_ze
[0];

209 i(!
	`S_ISBLK
(
dev_i
->
i_mode
)) {

210 
	`ut
(
dev_i
);

211  -
EPERM
;

213 
	`ut
(
dev_i
);

214 i(!(
d_i
=
	`mei
(
d_me
)))

215  -
ENOENT
;

216 i(
d_i
->
i_cou
 !1 || d_i->
i_num
 =
ROOT_INO
) {

217 
	`ut
(
d_i
);

218  -
EBUSY
;

220 i(!
	`S_ISDIR
(
d_i
->
i_mode
)) {

221 
	`ut
(
d_i
);

222  -
EPERM
;

224 i(!(
sb
=
	`ad_sur
(
dev
))) {

225 
	`ut
(
d_i
);

226  -
EBUSY
;

228 i(
sb
->
s_imou
) {

229 
	`ut
(
d_i
);

230  -
EBUSY
;

232 i(
d_i
->
i_mou
) {

233 
	`ut
(
d_i
);

234  -
EPERM
;

236 
sb
->
s_imou
=
d_i
;

237 
d_i
->
i_mou
=1;

238 
d_i
->
i_dt
=1;

240 
	}
}

242 
	$mou_ro
()

244 
i
,

;

245 
sur_block
 * 
p
;

246 
m_ode
 * 
mi
;

248 i(32 ! (
d_ode
))

249 
	`nic
("bad i-node size");

250 
i
=0;i<
NR_FILE
;i++)

251 
fe_b
[
i
].
f_cou
=0;

252 i(
	`MAJOR
(
ROOT_DEV
) == 2) {

253 
	`tk
("Insertoot floppyndress ENTER");

254 
	`wa_f_keyess
();

256 
p
 = &
sur_block
[0] ; < &sur_block[
NR_SUPER
] ;++) {

257 
p
->
s_dev
 = 0;

258 
p
->
s_lock
 = 0;

259 
p
->
s_wa
 = 
NULL
;

261 i(!(
p
=
	`ad_sur
(
ROOT_DEV
)))

262 
	`nic
("Unableo mountoot");

263 i(!(
mi
=
	`ig
(
ROOT_DEV
,
ROOT_INO
)))

264 
	`nic
("Unableoeadoot i-node");

265 
mi
->
i_cou
 += 3 ;

266 
p
->
s_isup
 =->
s_imou
 = 
mi
;

267 
cut
->
pwd
 = 
mi
;

268 
cut
->
ro
 = 
mi
;

269 

=0;

270 
i
=
p
->
s_nzes
;

271 -- 
i
 >= 0)

272 i(!
	`t_b
(
i
&8191,
p
->
s_zm
[i>>13]->
b_da
))

273 

++;

274 
	`tk
("%d/%d fblocks\n\r",

,
p
->
s_nzes
);

275 

=0;

276 
i
=
p
->
s_nodes
+1;

277 -- 
i
 >= 0)

278 i(!
	`t_b
(
i
&8191,
p
->
s_im
[i>>13]->
b_da
))

279 

++;

280 
	`tk
("%d/%d fodes\n\r",

,
p
->
s_nodes
);

281 
	}
}

	@fs/truncate.c

7 
	~<lux/sched.h
>

9 
	~<sys/.h
>

11 
	$_d
(
dev
,
block
)

13 
bufr_hd
 * 
bh
;

14 * 
p
;

15 
i
;

17 i(!
block
)

19 i(
bh
=
	`bad
(
dev
,
block
)) {

20 
p
 = (*
bh
->
b_da
;

21 
i
=0;i<512;i++,
p
++)

22 i(*
p
)

23 
	`_block
(
dev
,*
p
);

24 
	`bl
(
bh
);

26 
	`_block
(
dev
,
block
);

27 
	}
}

29 
	$_dd
(
dev
,
block
)

31 
bufr_hd
 * 
bh
;

32 * 
p
;

33 
i
;

35 i(!
block
)

37 i(
bh
=
	`bad
(
dev
,
block
)) {

38 
p
 = (*
bh
->
b_da
;

39 
i
=0;i<512;i++,
p
++)

40 i(*
p
)

41 
	`_d
(
dev
,*
p
);

42 
	`bl
(
bh
);

44 
	`_block
(
dev
,
block
);

45 
	}
}

47 
	$un
(
m_ode
 * 
ode
)

49 
i
;

51 i(!(
	`S_ISREG
(
ode
->
i_mode
|| 
	`S_ISDIR
(inode->i_mode)))

53 
i
=0;i<7;i++)

54 i(
ode
->
i_ze
[
i
]) {

55 
	`_block
(
ode
->
i_dev
,ode->
i_ze
[
i
]);

56 
ode
->
i_ze
[
i
]=0;

58 
	`_d
(
ode
->
i_dev
,ode->
i_ze
[7]);

59 
	`_dd
(
ode
->
i_dev
,ode->
i_ze
[8]);

60 
ode
->
i_ze
[7] = inode->i_zone[8] = 0;

61 
ode
->
i_size
 = 0;

62 
ode
->
i_dt
 = 1;

63 
ode
->
i_mtime
 = inode->
i_ime
 = 
CURRENT_TIME
;

64 
	}
}

	@include/a.out.h

1 #ide
_A_OUT_H


2 
	#_A_OUT_H


	)

4 
	#__GNU_EXEC_MACROS__


	)

6 
	sexec
 {

7 
	ma_magic
;

8 
	ma_xt
;

9 
	ma_da
;

10 
	ma_bss
;

11 
	ma_syms
;

12 
	ma_y
;

13 
	ma_size
;

14 
	ma_drsize
;

17 #ide
N_MAGIC


18 
	#N_MAGIC
(
exec
(xec).
a_magic
)

	)

21 #ide
OMAGIC


23 
	#OMAGIC
 0407

	)

25 
	#NMAGIC
 0410

	)

27 
	#ZMAGIC
 0413

	)

30 #ide
N_BADMAG


31 
	#N_BADMAG
(
x
) \

32 (
	`N_MAGIC
(
x
!
OMAGIC
 && N_MAGIC(x!
NMAGIC
 \

33 && 
	`N_MAGIC
(
x
!
ZMAGIC
)

	)

36 
	#_N_BADMAG
(
x
) \

37 (
	`N_MAGIC
(
x
!
OMAGIC
 && N_MAGIC(x!
NMAGIC
 \

38 && 
	`N_MAGIC
(
x
!
ZMAGIC
)

	)

40 
	#_N_HDROFF
(
x
(
SEGMENT_SIZE
 -  (
exec
))

	)

42 #ide
N_TXTOFF


43 
	#N_TXTOFF
(
x
) \

44 (
	`N_MAGIC
(
x
=
ZMAGIC
 ? 
	`_N_HDROFF
((x)+  (
exec
:  (exec))

	)

47 #ide
N_DATOFF


48 
	#N_DATOFF
(
x
(
	`N_TXTOFF
(x+ (x).
a_xt
)

	)

51 #ide
N_TRELOFF


52 
	#N_TRELOFF
(
x
(
	`N_DATOFF
(x+ (x).
a_da
)

	)

55 #ide
N_DRELOFF


56 
	#N_DRELOFF
(
x
(
	`N_TRELOFF
(x+ (x).
a_size
)

	)

59 #ide
N_SYMOFF


60 
	#N_SYMOFF
(
x
(
	`N_DRELOFF
(x+ (x).
a_drsize
)

	)

63 #ide
N_STROFF


64 
	#N_STROFF
(
x
(
	`N_SYMOFF
(x+ (x).
a_syms
)

	)

68 #ide
N_TXTADDR


69 
	#N_TXTADDR
(
x
0

	)

75 #i
defed
(
vax
|| defed(
hp300
|| defed(
pyr
)

76 
	#SEGMENT_SIZE
 
PAGE_SIZE


	)

78 #ifdef 
hp300


79 
	#PAGE_SIZE
 4096

	)

81 #ifdef 
sy


82 
	#SEGMENT_SIZE
 0x2000

	)

84 #ifde
is68k


85 
	#SEGMENT_SIZE
 0x20000

	)

87 #i
defed
(
m68k
&& defed(
PORTAR
)

88 
	#PAGE_SIZE
 0x400

	)

89 
	#SEGMENT_SIZE
 
PAGE_SIZE


	)

92 
	#PAGE_SIZE
 4096

	)

93 
	#SEGMENT_SIZE
 1024

	)

95 
	#_N_SEGMENT_ROUND
(
x
(((x+ 
SEGMENT_SIZE
 - 1& ~(SEGMENT_SIZE - 1))

	)

97 
	#_N_TXTENDADDR
(
x
(
	`N_TXTADDR
(x)+(x).
a_xt
)

	)

99 #ide
N_DATADDR


100 
	#N_DATADDR
(
x
) \

101 (
	`N_MAGIC
(
x
)==
OMAGIC
? (
	`_N_TXTENDADDR
(x)) \

102 : (
	`_N_SEGMENT_ROUND
 (
	`_N_TXTENDADDR
(
x
))))

	)

106 #ide
N_BSSADDR


107 
	#N_BSSADDR
(
x
(
	`N_DATADDR
(x+ (x).
a_da
)

	)

110 #ide
N_NLIST_DECLARED


111 
	si
 {

113 *
	mn_me
;

114 
i
 *
	mn_xt
;

115 
	mn_rx
;

116 } 
	mn_un
;

117 
	mn_ty
;

118 
	mn_h
;

119 
	mn_desc
;

120 
	mn_vue
;

124 #ide
N_UNDF


125 
	#N_UNDF
 0

	)

127 #ide
N_ABS


128 
	#N_ABS
 2

	)

130 #ide
N_TEXT


131 
	#N_TEXT
 4

	)

133 #ide
N_DATA


134 
	#N_DATA
 6

	)

136 #ide
N_BSS


137 
	#N_BSS
 8

	)

139 #ide
N_COMM


140 
	#N_COMM
 18

	)

142 #ide
N_FN


143 
	#N_FN
 15

	)

146 #ide
N_EXT


147 
	#N_EXT
 1

	)

149 #ide
N_TYPE


150 
	#N_TYPE
 036

	)

152 #ide
N_STAB


153 
	#N_STAB
 0340

	)

164 
	#N_INDR
 0xa

	)

178 
	#N_SETA
 0x14

	)

179 
	#N_SETT
 0x16

	)

180 
	#N_SETD
 0x18

	)

181 
	#N_SETB
 0x1A

	)

184 
	#N_SETV
 0x1C

	)

186 #ide
N_RELOCATION_INFO_DECLARED


193 
	sloti_fo


196 
	mr_addss
;

198 
	mr_symbnum
:24;

202 
	mr_p
:1;

205 
	mr_ngth
:2;

212 
	mr_ex
:1;

215 
	mr_d
:4;

	@include/asm/io.h

1 
	#outb
(
vue
,
pt
) \

2 
	`__asm__
 ("outb %%,%%dx"::"a" (
vue
),"d" (
pt
))

	)

5 
	#b
(
pt
) ({ \

6 
_v
; \

7 
__asm__
 vީ("b %%dx,%%":"" (
_v
):"d" (
pt
)); \

8 
_v
; \

9 })

	)

11 
	#outb_p
(
vue
,
pt
) \

12 
	`__asm__
 ("outb %%al,%%dx\n" \

15 "1:"::"a" (
vue
),"d" (
pt
))

	)

17 
	#b_p
(
pt
) ({ \

18 
_v
; \

19 
__asm__
 volatile ("inb %%dx,%%al\n" \

22 "1:":"" (
_v
):"d" (
pt
)); \

23 
_v
; \

24 })

	)

	@include/asm/memory.h

8 
	#memy
(
de
,
c
,
n
) ({ \

9 * 
_s
 = 
de
; \

10 
	`__asm__
 ("cld;rep;movsb" \

11 ::"D" (()(
_s
)),"S" (()(
c
)),"c" (((
n
)) \

13 
_s
; \

14 })

	)

	@include/asm/segment.h

1 
le
 
	$g_fs_by
(cڡ * 
addr
)

3 
_v
;

5 
	`__asm__
 ("movb %%fs:%1,%0":"" (
_v
):"m" (*
addr
));

6  
_v
;

7 
	}
}

9 
le
 
	$g_fs_wd
(cڡ *
addr
)

11 
_v
;

13 
	`__asm__
 ("movw %%fs:%1,%0":"" (
_v
):"m" (*
addr
));

14  
_v
;

15 
	}
}

17 
le
 
	$g_fs_lg
(cڡ *
addr
)

19 
_v
;

21 
	`__asm__
 ("mov%%fs:%1,%0":"" (
_v
):"m" (*
addr
)); \

22  
_v
;

23 
	}
}

25 
le
 
	$put_fs_by
(
v
,*
addr
)

27 
	`__asm__
 ("movb %0,%%fs:%1"::"r" (
v
),"m" (*
addr
));

28 
	}
}

30 
le
 
	$put_fs_wd
(
v
,* 
addr
)

32 
	`__asm__
 ("movw %0,%%fs:%1"::"r" (
v
),"m" (*
addr
));

33 
	}
}

35 
le
 
	$put_fs_lg
(
v
,* 
addr
)

37 
	`__asm__
 ("mov%0,%%fs:%1"::"r" (
v
),"m" (*
addr
));

38 
	}
}

47 
le
 
	$g_fs
()

49 
_v
;

50 
	`__asm__
("mov %%fs,%%ax":"" (
_v
):);

51  
_v
;

52 
	}
}

54 
le
 
	$g_ds
()

56 
_v
;

57 
	`__asm__
("mov %%ds,%%ax":"" (
_v
):);

58  
_v
;

59 
	}
}

61 
le
 
	$t_fs
(
v
)

63 
	`__asm__
("mov %0,%%fs"::"a" ((
v
));

64 
	}
}

	@include/asm/system.h

1 
	#move_to_ur_mode
() \

2 
	`__asm__
 ("movl %%esp,%%eax\n\t" \

14 :::"ax")

	)

16 
	#i
(
	`__asm__
 ("sti"::)

17 
	#i
(
	`__asm__
 ("cli"::)

18 
	#n
(
	`__asm__
 ("n"::)

	)

20 
	#
(
	`__asm__
 (""::)

	)

22 
	#_t_ge
(
ge_addr
,
ty
,
d
,
addr
) \

23 
	`__asm__
 ("movw %%dx,%%ax\n\t" \

28 : "i" (((0x8000+(
d
<<13)+(
ty
<<8))), \

29 "o" (*((*(
ge_addr
))), \

30 "o" (*(4+(*(
ge_addr
))), \

31 "d" ((*(
addr
)),"a" (0x00080000))

	)

33 
	#t__ge
(
n
,
addr
) \

34 
	`_t_ge
(&
idt
[
n
],14,0,
addr
)

	)

36 
	#t__ge
(
n
,
addr
) \

37 
	`_t_ge
(&
idt
[
n
],15,0,
addr
)

	)

39 
	#t_syem_ge
(
n
,
addr
) \

40 
	`_t_ge
(&
idt
[
n
],15,3,
addr
)

	)

42 
	#_t_g_desc
(
ge_addr
,
ty
,
d
,
ba
,
lim
) {\

43 *(
ge_addr
((
ba
) & 0xff000000) | \

44 (((
ba
) & 0x00ff0000)>>16) | \

45 ((
lim
) & 0xf0000) | \

46 ((
d
)<<13) | \

48 ((
ty
)<<8); \

49 *((
ge_addr
)+1(((
ba
) & 0x0000ffff)<<16) | \

50 ((
lim
& 0x0ffff); }

	)

52 
	#_t_tsdt_desc
(
n
,
addr
,
ty
) \

53 
	`__asm__
 ("movw $104,%1\n\t" \

57 "movb $" 
ty
 ",%4\n\t" \

61 ::"a" (
addr
), "m" (*(
n
)), "m" (*(n+2)), "m" (*(n+4)), \

62 "m" (*(
n
+5)), "m" (*(n+6)), "m" (*(n+7)) \

63 )

	)

65 
	#t_tss_desc
(
n
,
addr

	`_t_tsdt_desc
(((*)),addr,"0x89")

	)

66 
	#t_ldt_desc
(
n
,
addr

	`_t_tsdt_desc
(((*)),addr,"0x82")

	)

	@include/const.h

1 #ide
_CONST_H


2 
	#_CONST_H


	)

4 
	#BUFFER_END
 0x200000

	)

6 
	#I_TYPE
 0170000

	)

7 
	#I_DIRECTORY
 0040000

	)

8 
	#I_REGULAR
 0100000

	)

9 
	#I_BLOCK_SPECIAL
 0060000

	)

10 
	#I_CHAR_SPECIAL
 0020000

	)

11 
	#I_NAMED_PIPE
 0010000

	)

12 
	#I_SET_UID_BIT
 0004000

	)

13 
	#I_SET_GID_BIT
 0002000

	)

	@include/ctype.h

1 #ide
_CTYPE_H


2 
	#_CTYPE_H


	)

4 
	#_U
 0x01

	)

5 
	#_L
 0x02

	)

6 
	#_D
 0x04

	)

7 
	#_C
 0x08

	)

8 
	#_P
 0x10

	)

9 
	#_S
 0x20

	)

10 
	#_X
 0x40

	)

11 
	#_SP
 0x80

	)

13 
_y
[];

14 
_mp
;

16 
	#ium
(
c
((
_y
+1)[c]&(
_U
|
_L
|
_D
))

	)

17 
	#iha
(
c
((
_y
+1)[c]&(
_U
|
_L
))

	)

18 
	#isl
(
c
((
_y
+1)[c]&(
_C
))

	)

19 
	#isdig
(
c
((
_y
+1)[c]&(
_D
))

	)

20 
	#isgph
(
c
((
_y
+1)[c]&(
_P
|
_U
|
_L
|
_D
))

	)

21 
	#iow
(
c
((
_y
+1)[c]&(
_L
))

	)

22 
	#irt
(
c
((
_y
+1)[c]&(
_P
|
_U
|
_L
|
_D
|
_SP
))

	)

23 
	#iun
(
c
((
_y
+1)[c]&(
_P
))

	)

24 
	#isa
(
c
((
_y
+1)[c]&(
_S
))

	)

25 
	#isu
(
c
((
_y
+1)[c]&(
_U
))

	)

26 
	#isxdig
(
c
((
_y
+1)[c]&(
_D
|
_X
))

	)

28 
	#iscii
(
c
(((c)<=0x7f)

	)

29 
	#tscii
(
c
(((c)&0x7f)

	)

31 
	#tow
(
c
(
_mp
=c,
	`isu
(_mp)?_mp-('A'-'a'):_mp)

	)

32 
	#tou
(
c
(
_mp
=c,
	`iow
(_mp)?_mp-('a'-'A'):_mp)

	)

	@include/errno.h

1 #ide
_ERRNO_H


2 
	#_ERRNO_H


	)

17 
o
;

19 
	#ERROR
 99

	)

20 
	#EPERM
 1

	)

21 
	#ENOENT
 2

	)

22 
	#ESRCH
 3

	)

23 
	#EINTR
 4

	)

24 
	#EIO
 5

	)

25 
	#ENXIO
 6

	)

26 
	#E2BIG
 7

	)

27 
	#ENOEXEC
 8

	)

28 
	#EBADF
 9

	)

29 
	#ECHILD
 10

	)

30 
	#EAGAIN
 11

	)

31 
	#ENOMEM
 12

	)

32 
	#EACCES
 13

	)

33 
	#EFAULT
 14

	)

34 
	#ENOTBLK
 15

	)

35 
	#EBUSY
 16

	)

36 
	#EEXIST
 17

	)

37 
	#EXDEV
 18

	)

38 
	#ENODEV
 19

	)

39 
	#ENOTDIR
 20

	)

40 
	#EISDIR
 21

	)

41 
	#EINVAL
 22

	)

42 
	#ENFILE
 23

	)

43 
	#EMFILE
 24

	)

44 
	#ENOTTY
 25

	)

45 
	#ETXTBSY
 26

	)

46 
	#EFBIG
 27

	)

47 
	#ENOSPC
 28

	)

48 
	#ESPIPE
 29

	)

49 
	#EROFS
 30

	)

50 
	#EMLINK
 31

	)

51 
	#EPIPE
 32

	)

52 
	#EDOM
 33

	)

53 
	#ERANGE
 34

	)

54 
	#EDEADLK
 35

	)

55 
	#ENAMETOOLONG
 36

	)

56 
	#ENOLCK
 37

	)

57 
	#ENOSYS
 38

	)

58 
	#ENOTEMPTY
 39

	)

	@include/fcntl.h

1 #ide
_FCNTL_H


2 
	#_FCNTL_H


	)

4 
	~<sys/tys.h
>

7 
	#O_ACCMODE
 00003

	)

8 
	#O_RDONLY
 00

	)

9 
	#O_WRONLY
 01

	)

10 
	#O_RDWR
 02

	)

11 
	#O_CREAT
 00100

	)

12 
	#O_EXCL
 00200

	)

13 
	#O_NOCTTY
 00400

	)

14 
	#O_TRUNC
 01000

	)

15 
	#O_APPEND
 02000

	)

16 
	#O_NONBLOCK
 04000

	)

17 
	#O_NDELAY
 
O_NONBLOCK


	)

23 
	#F_DUPFD
 0

	)

24 
	#F_GETFD
 1

	)

25 
	#F_SETFD
 2

	)

26 
	#F_GETFL
 3

	)

27 
	#F_SETFL
 4

	)

28 
	#F_GETLK
 5

	)

29 
	#F_SETLK
 6

	)

30 
	#F_SETLKW
 7

	)

33 
	#FD_CLOEXEC
 1

	)

38 
	#F_RDLCK
 0

	)

39 
	#F_WRLCK
 1

	)

40 
	#F_UNLCK
 2

	)

43 
	sock
 {

44 
	ml_ty
;

45 
	ml_wh
;

46 
off_t
 
	ml_t
;

47 
off_t
 
	ml_n
;

48 
pid_t
 
	ml_pid
;

51 
t
(cڡ * 
fame
,
mode_t
 
mode
);

52 
f
(
fdes
,
cmd
, ...);

53 
ݒ
(cڡ * 
fame
, 
ags
, ...);

	@include/linux/config.h

1 #ide
_CONFIG_H


2 
	#_CONFIG_H


	)

19 
	#KBD_FINNISH


	)

	@include/linux/fdreg.h

6 #ide
_FDREG_H


7 
	#_FDREG_H


	)

9 
ticks_to_py_
(

);

10 
py_
(

);

11 
py_off
(

);

12 
py_
(

);

13 
py_de
(

);

16 
	#FD_STATUS
 0x3f4

	)

17 
	#FD_DATA
 0x3f5

	)

18 
	#FD_DOR
 0x3f2

	)

19 
	#FD_DIR
 0x3f7

	)

20 
	#FD_DCR
 0x3f7

	)

23 
	#STATUS_BUSYMASK
 0x0F

	)

24 
	#STATUS_BUSY
 0x10

	)

25 
	#STATUS_DMA
 0x20

	)

26 
	#STATUS_DIR
 0x40

	)

27 
	#STATUS_READY
 0x80

	)

30 
	#ST0_DS
 0x03

	)

31 
	#ST0_HA
 0x04

	)

32 
	#ST0_NR
 0x08

	)

33 
	#ST0_ECE
 0x10

	)

34 
	#ST0_SE
 0x20

	)

35 
	#ST0_INTR
 0xC0

	)

38 
	#ST1_MAM
 0x01

	)

39 
	#ST1_WP
 0x02

	)

40 
	#ST1_ND
 0x04

	)

41 
	#ST1_OR
 0x10

	)

42 
	#ST1_CRC
 0x20

	)

43 
	#ST1_EOC
 0x80

	)

46 
	#ST2_MAM
 0x01

	)

47 
	#ST2_BC
 0x02

	)

48 
	#ST2_SNS
 0x04

	)

49 
	#ST2_SEH
 0x08

	)

50 
	#ST2_WC
 0x10

	)

51 
	#ST2_CRC
 0x20

	)

52 
	#ST2_CM
 0x40

	)

55 
	#ST3_HA
 0x04

	)

56 
	#ST3_TZ
 0x10

	)

57 
	#ST3_WP
 0x40

	)

60 
	#FD_RECALIBRATE
 0x07

	)

61 
	#FD_SEEK
 0x0F

	)

62 
	#FD_READ
 0xE6

	)

63 
	#FD_WRITE
 0xC5

	)

64 
	#FD_SENSEI
 0x08

	)

65 
	#FD_SPECIFY
 0x03

	)

68 
	#DMA_READ
 0x46

	)

69 
	#DMA_WRITE
 0x4A

	)

	@include/linux/fs.h

6 #ide
_FS_H


7 
	#_FS_H


	)

9 
	~<sys/tys.h
>

24 
	#IS_SEEKABLE
(
x
((x)>=1 && (x)<=3)

	)

26 
	#READ
 0

	)

27 
	#WRITE
 1

	)

28 
	#READA
 2

	)

29 
	#WRITEA
 3

	)

31 
bufr_
(
bufr_d
);

33 
	#MAJOR
(
a
((()))>>8)

	)

34 
	#MINOR
(
a
()&0xff)

	)

36 
	#NAME_LEN
 14

	)

37 
	#ROOT_INO
 1

	)

39 
	#I_MAP_SLOTS
 8

	)

40 
	#Z_MAP_SLOTS
 8

	)

41 
	#SUPER_MAGIC
 0x137F

	)

43 
	#NR_OPEN
 20

	)

44 
	#NR_INODE
 32

	)

45 
	#NR_FILE
 64

	)

46 
	#NR_SUPER
 8

	)

47 
	#NR_HASH
 307

	)

48 
	#NR_BUFFERS
 
_bufrs


	)

49 
	#BLOCK_SIZE
 1024

	)

50 
	#BLOCK_SIZE_BITS
 10

	)

51 #ide
NULL


52 
	#NULL
 ((*0)

	)

55 
	#INODES_PER_BLOCK
 ((
BLOCK_SIZE
)/( (
d_ode
)))

	)

56 
	#DIR_ENTRIES_PER_BLOCK
 ((
BLOCK_SIZE
)/( (
d_y
)))

	)

58 
	#PIPE_HEAD
(
ode
((ode).
i_ze
[0])

	)

59 
	#PIPE_TAIL
(
ode
((ode).
i_ze
[1])

	)

60 
	#PIPE_SIZE
(
ode
((
	`PIPE_HEAD
(ode)-
	`PIPE_TAIL
(ode))&(
PAGE_SIZE
-1))

	)

61 
	#PIPE_EMPTY
(
ode
(
	`PIPE_HEAD
(ode)==
	`PIPE_TAIL
(ode))

	)

62 
	#PIPE_FULL
(
ode
(
	`PIPE_SIZE
(ode)==(
PAGE_SIZE
-1))

	)

63 
	#INC_PIPE
(
hd
) \

64 
	`__asm__
(" %0\n\nd$4095,%0"::"m" (
hd
))

	)

66 
	tbufr_block
[
BLOCK_SIZE
];

68 
	sbufr_hd
 {

69 * 
	mb_da
;

70 
	mb_block
;

71 
	mb_dev
;

72 
	mb_uode
;

73 
	mb_dt
;

74 
	mb_cou
;

75 
	mb_lock
;

76 
sk_ru
 * 
	mb_wa
;

77 
bufr_hd
 * 
	mb_ev
;

78 
bufr_hd
 * 
	mb_xt
;

79 
bufr_hd
 * 
	mb_ev_
;

80 
bufr_hd
 * 
	mb_xt_
;

83 
	sd_ode
 {

84 
	mi_mode
;

85 
	mi_uid
;

86 
	mi_size
;

87 
	mi_time
;

88 
	mi_gid
;

89 
	mi_ƚks
;

90 
	mi_ze
[9];

93 
	sm_ode
 {

94 
	mi_mode
;

95 
	mi_uid
;

96 
	mi_size
;

97 
	mi_mtime
;

98 
	mi_gid
;

99 
	mi_ƚks
;

100 
	mi_ze
[9];

102 
sk_ru
 * 
	mi_wa
;

103 
	mi_ime
;

104 
	mi_ime
;

105 
	mi_dev
;

106 
	mi_num
;

107 
	mi_cou
;

108 
	mi_lock
;

109 
	mi_dt
;

110 
	mi_pe
;

111 
	mi_mou
;

112 
	mi_ek
;

113 
	mi_upde
;

116 
	sfe
 {

117 
	mf_mode
;

118 
	mf_ags
;

119 
	mf_cou
;

120 
m_ode
 * 
	mf_ode
;

121 
off_t
 
	mf_pos
;

124 
	ssur_block
 {

125 
	ms_nodes
;

126 
	ms_nzes
;

127 
	ms_im_blocks
;

128 
	ms_zm_blocks
;

129 
	ms_fdaze
;

130 
	ms_log_ze_size
;

131 
	ms_max_size
;

132 
	ms_magic
;

134 
bufr_hd
 * 
	ms_im
[8];

135 
bufr_hd
 * 
	ms_zm
[8];

136 
	ms_dev
;

137 
m_ode
 * 
	ms_isup
;

138 
m_ode
 * 
	ms_imou
;

139 
	ms_time
;

140 
sk_ru
 * 
	ms_wa
;

141 
	ms_lock
;

142 
	ms_rd_ly
;

143 
	ms_dt
;

146 
	sd_sur_block
 {

147 
	ms_nodes
;

148 
	ms_nzes
;

149 
	ms_im_blocks
;

150 
	ms_zm_blocks
;

151 
	ms_fdaze
;

152 
	ms_log_ze_size
;

153 
	ms_max_size
;

154 
	ms_magic
;

157 
	sd_y
 {

158 
	mode
;

159 
	mme
[
NAME_LEN
];

162 
m_ode
 
ode_b
[
NR_INODE
];

163 
fe
 
fe_b
[
NR_FILE
];

164 
sur_block
 sur_block[
NR_SUPER
];

165 
bufr_hd
 * 
t_bufr
;

166 
_bufrs
;

168 
check_disk_chge
(
dev
);

169 
py_chge
(

);

170 
ticks_to_py_
(
dev
);

171 
py_
(
dev
);

172 
py_off
(
dev
);

173 
un
(
m_ode
 * 
ode
);

174 
sync_odes
();

175 
wa_
(
m_ode
 * 
ode
);

176 
bm
(
m_ode
 * 
ode
,
block
);

177 
_block
(
m_ode
 * 
ode
,
block
);

178 
m_ode
 * 
mei
(cڡ * 
thme
);

179 
ݒ_mei
(cڡ * 
thme
, 
ag
, 
mode
,

180 
m_ode
 ** 
s_ode
);

181 
ut
(
m_ode
 * 
ode
);

182 
m_ode
 * 
ig
(
dev
,

);

183 
m_ode
 * 
g_emy_ode
();

184 
m_ode
 * 
g_pe_ode
();

185 
bufr_hd
 * 
g_hash_b
(
dev
, 
block
);

186 
bufr_hd
 * 
gblk
(
dev
, 
block
);

187 
_rw_block
(
rw
, 
bufr_hd
 * 
bh
);

188 
bl
(
bufr_hd
 * 
buf
);

189 
bufr_hd
 * 
bad
(
dev
,
block
);

190 
bad_ge
(
addr
,
dev
,
b
[4]);

191 
bufr_hd
 * 
bada
(
dev
,
block
,...);

192 
w_block
(
dev
);

193 
_block
(
dev
, 
block
);

194 
m_ode
 * 
w_ode
(
dev
);

195 
_ode
(
m_ode
 * 
ode
);

196 
sync_dev
(
dev
);

197 
sur_block
 * 
g_sur
(
dev
);

198 
ROOT_DEV
;

200 
mou_ro
();

	@include/linux/hdreg.h

6 #ide
_HDREG_H


7 
	#_HDREG_H


	)

10 
	#HD_DATA
 0x1f0

	)

11 
	#HD_ERROR
 0x1f1

	)

12 
	#HD_NSECTOR
 0x1f2

	)

13 
	#HD_SECTOR
 0x1f3

	)

14 
	#HD_LCYL
 0x1f4

	)

15 
	#HD_HCYL
 0x1f5

	)

16 
	#HD_CURRENT
 0x1f6

	)

17 
	#HD_STATUS
 0x1f7

	)

18 
	#HD_PRECOMP
 
HD_ERROR


	)

19 
	#HD_COMMAND
 
HD_STATUS


	)

21 
	#HD_CMD
 0x3f6

	)

24 
	#ERR_STAT
 0x01

	)

25 
	#INDEX_STAT
 0x02

	)

26 
	#ECC_STAT
 0x04

	)

27 
	#DRQ_STAT
 0x08

	)

28 
	#SEEK_STAT
 0x10

	)

29 
	#WRERR_STAT
 0x20

	)

30 
	#READY_STAT
 0x40

	)

31 
	#BUSY_STAT
 0x80

	)

34 
	#WIN_RESTORE
 0x10

	)

35 
	#WIN_READ
 0x20

	)

36 
	#WIN_WRITE
 0x30

	)

37 
	#WIN_VERIFY
 0x40

	)

38 
	#WIN_FORMAT
 0x50

	)

39 
	#WIN_INIT
 0x60

	)

40 
	#WIN_SEEK
 0x70

	)

41 
	#WIN_DIAGNOSE
 0x90

	)

42 
	#WIN_SPECIFY
 0x91

	)

45 
	#MARK_ERR
 0x01

	)

46 
	#TRK0_ERR
 0x02

	)

47 
	#ABRT_ERR
 0x04

	)

48 
	#ID_ERR
 0x10

	)

49 
	#ECC_ERR
 0x40

	)

50 
	#BBD_ERR
 0x80

	)

52 
	si
 {

53 
	mbo_d
;

54 
	mhd
;

55 
	m
;

56 
	mcyl
;

57 
	msys_d
;

58 
	md_hd
;

59 
	md_
;

60 
	md_cyl
;

61 
	mt_
;

62 
	m_s
;

	@include/linux/head.h

1 #ide
_HEAD_H


2 
	#_HEAD_H


	)

4 
	sdesc_ru
 {

5 
	ma
,
	mb
;

6 } 
	tdesc_b
[256];

8 
pg_d
[1024];

9 
desc_b
 
idt
,
gdt
;

11 
	#GDT_NUL
 0

	)

12 
	#GDT_CODE
 1

	)

13 
	#GDT_DATA
 2

	)

14 
	#GDT_TMP
 3

	)

16 
	#LDT_NUL
 0

	)

17 
	#LDT_CODE
 1

	)

18 
	#LDT_DATA
 2

	)

	@include/linux/kernel.h

4 
vify_
(* 
addr
,
cou
);

5 vީ
nic
(cڡ * 
r
);

6 
tf
(cڡ * 
fmt
, ...);

7 
tk
(cڡ * 
fmt
, ...);

8 
y_wre
(
ch
,* 
buf
,
cou
);

9 * 
mloc
(
size
);

10 
_s
(* 
obj
, 
size
);

12 
	#
(
x

	`_s
((x), 0)

	)

21 
	#sur
((
cut
->
euid
 =0)

	)

	@include/linux/mm.h

1 #ide
_MM_H


2 
	#_MM_H


	)

4 
	#PAGE_SIZE
 4096

	)

6 
g__ge
();

7 
put_ge
(
ge
,
addss
);

8 
_ge
(
addr
);

	@include/linux/sched.h

1 #ide
_SCHED_H


2 
	#_SCHED_H


	)

4 
	#NR_TASKS
 64

	)

5 
	#HZ
 100

	)

7 
	#FIRST_TASK
 
sk
[0]

	)

8 
	#LAST_TASK
 
sk
[
NR_TASKS
-1]

	)

10 
	~<lux/hd.h
>

11 
	~<lux/fs.h
>

12 
	~<lux/mm.h
>

13 
	~<sigl.h
>

15 #i(
NR_OPEN
 > 32)

19 
	#TASK_RUNNING
 0

	)

20 
	#TASK_INTERRUPTIBLE
 1

	)

21 
	#TASK_UNINTERRUPTIBLE
 2

	)

22 
	#TASK_ZOMBIE
 3

	)

23 
	#TASK_STOPPED
 4

	)

25 #ide
NULL


26 
	#NULL
 ((*0)

	)

29 
cy_ge_bs
(
om
, 
to
, 
size
);

30 
_ge_bs
(
om
, 
size
);

32 
sched_
();

33 
schedu
();

34 
_
();

35 
nic
(cڡ * 
r
);

36 
y_wre
(
m
,* 
buf
,
cou
);

38 (*
	g_r
)();

40 
	si387_ru
 {

41 
	mcwd
;

42 
	mswd
;

43 
	mtwd
;

44 
	mf
;

45 
	mfcs
;

46 
	mfoo
;

47 
	mfos
;

48 
	m_a
[20];

52 
	stss_ru
 {

53 
	mback_lk
;

54 
	me0
;

55 
	mss0
;

56 
	me1
;

57 
	mss1
;

58 
	me2
;

59 
	mss2
;

60 
	m3
;

61 
	me
;

62 
	meags
;

63 
	mx
,
	mecx
,
	medx
,
	mebx
;

64 
	me
;

65 
	mebp
;

66 
	mesi
;

67 
	medi
;

68 
	mes
;

69 
	mcs
;

70 
	mss
;

71 
	mds
;

72 
	mfs
;

73 
	mgs
;

74 
	mldt
;

75 
	ma_bm
;

76 
i387_ru
 
	mi387
;

79 
	ssk_ru
 {

81 
	me
;

82 
	mcou
;

83 
	miܙy
;

84 
	msigl
;

85 
sigai
 
	msigai
[32];

86 
	mblocked
;

88 
	mex_code
;

89 
	mt_code
,
	md_code
,
	md_da
,
	mbrk
,
	mt_ack
;

90 
	mpid
,
	mth
,
	mpg
,
	mssi
,
	mad
;

91 
	muid
,
	meuid
,
	msuid
;

92 
	mgid
,
	megid
,
	msgid
;

93 
	mm
;

94 
	mutime
,
	mime
,
	mcutime
,
	mcime
,
	mt_time
;

95 
	mud_mh
;

97 
	my
;

98 
	mumask
;

99 
m_ode
 * 
	mpwd
;

100 
m_ode
 * 
	mro
;

101 
m_ode
 * 
	mexecub
;

102 
	mo__exec
;

103 
fe
 * 
	mfp
[
NR_OPEN
];

105 
desc_ru
 
	mldt
[3];

107 
tss_ru
 
	mtss
;

125  -1,0022,
	gNULL
,NULL,NULL,0, \

126  {
	gNULL
,}, \

132  {0,
	gPAGE_SIZE
+()&
	g_sk
,0x10,0,0,0,0,()&
	gpg_d
,\

135 
_LDT
(0),0x80000000, \

140 
sk_ru
 *
sk
[
NR_TASKS
];

141 
sk_ru
 *
ϡ_sk_ud_mh
;

142 
sk_ru
 *
cut
;

143 vީ
jiffs
;

144 
tup_time
;

146 
	#CURRENT_TIME
 (
tup_time
+
jiffs
/
HZ
)

	)

148 
add_tim
(
jiffs
, (*

)());

149 
	`p_
(
sk_ru
 ** 
p
);

150 
	`uib_p_
(
sk_ru
 ** 
p
);

151 
	`wake_up
(
sk_ru
 ** 
p
);

157 
	#FIRST_TSS_ENTRY
 4

158 
	#FIRST_LDT_ENTRY
 (
FIRST_TSS_ENTRY
+1)

159 
	#_TSS
(
n
((((n)<<4)+(
FIRST_TSS_ENTRY
<<3))

	)

160 
	#_LDT
(
n
((((n)<<4)+(
FIRST_LDT_ENTRY
<<3))

	)

161 
	#r
(
n

	`__asm__
("ɸ%%ax"::"a" (
	`_TSS
)))

	)

162 
	#dt
(
n

	`__asm__
("d%%ax"::"a" (
	`_LDT
)))

	)

163 
	#r
(
n
) \

164 
	`__asm__
("str %%ax\n\t" \

167 :"" (
n
) \

168 :"a" (0),"i" (
FIRST_TSS_ENTRY
<<3))

	)

175 
	#swch_to
(
n
) {\

176 ru {
a
,
b
;} 
__tmp
; \

177 
	`__asm__
("cmpl %%ecx,_current\n\t" \

186 ::"m" (*&
__tmp
.
a
),"m" (*&__tmp.
b
), \

187 "d" (
	`_TSS
(
n
)),"c" ((
sk
[n])); \

188 
	}

	)
}

190 
	#PAGE_ALIGN
(
n
(()+0xfff)&0xfffff000)

	)

192 
	#_t_ba
(
addr
,
ba
) \

193 
	`__asm__
("movw %%dx,%0\n\t" \

197 ::"m" (*((
addr
)+2)), \

198 "m" (*((
addr
)+4)), \

199 "m" (*((
addr
)+7)), \

200 "d" (
ba
) \

201 :"dx")

	)

203 
	#_t_lim
(
addr
,
lim
) \

204 
	`__asm__
("movw %%dx,%0\n\t" \

210 ::"m" (*(
addr
)), \

211 "m" (*((
addr
)+6)), \

212 "d" (
lim
) \

213 :"dx")

	)

215 
	#t_ba
(
ldt
,
ba

	`_t_ba
((*)&dt), ba )

	)

216 
	#t_lim
(
ldt
,
lim

	`_t_lim
((*)&dt), (lim-1)>>12 )

	)

218 
	#_g_ba
(
addr
) ({\

219 
__ba
; \

220 
	`__asm__
("movb %3,%%dh\n\t" \

224 :"=d" (
__ba
) \

225 :"m" (*((
addr
)+2)), \

226 "m" (*((
addr
)+4)), \

227 "m" (*((
addr
)+7))); \

228 
__ba
;})

	)

230 
	#g_ba
(
ldt

	`_g_ba
((*)&dt))

	)

232 
	#g_lim
(
gmt
) ({ \

233 
__lim
; \

234 
	`__asm__
("l%1,%0\n\t %0":"" (
__lim
):"r" (
gmt
)); \

235 
__lim
;})

	)

	@include/linux/sys.h

1 
sys_tup
();

2 
sys_ex
();

3 
sys_fk
();

4 
sys_ad
();

5 
sys_wre
();

6 
sys_ݒ
();

7 
sys_o
();

8 
sys_wapid
();

9 
sys_t
();

10 
sys_lk
();

11 
sys_uƚk
();

12 
sys_execve
();

13 
sys_chd
();

14 
sys_time
();

15 
sys_mknod
();

16 
sys_chmod
();

17 
sys_chown
();

18 
sys_bak
();

19 
sys_
();

20 
sys_lek
();

21 
sys_gpid
();

22 
sys_mou
();

23 
sys_umou
();

24 
sys_tuid
();

25 
sys_guid
();

26 
sys_ime
();

27 
sys_
();

28 
sys_m
();

29 
sys_f
();

30 
sys_u
();

31 
sys_utime
();

32 
sys_ty
();

33 
sys_gy
();

34 
sys_acss
();

35 
sys_ni
();

36 
sys_ime
();

37 
sys_sync
();

38 
sys_kl
();

39 
sys_me
();

40 
sys_mkd
();

41 
sys_rmd
();

42 
sys_dup
();

43 
sys_pe
();

44 
sys_times
();

45 
sys_of
();

46 
sys_brk
();

47 
sys_tgid
();

48 
sys_ggid
();

49 
sys_sigl
();

50 
sys_geuid
();

51 
sys_gegid
();

52 
sys_ac
();

53 
sys_phys
();

54 
sys_lock
();

55 
sys_iol
();

56 
sys_f
();

57 
sys_mpx
();

58 
sys_gid
();

59 
sys_ulim
();

60 
sys_ume
();

61 
sys_umask
();

62 
sys_chro
();

63 
sys_u
();

64 
sys_dup2
();

65 
sys_gid
();

66 
sys_gpg
();

67 
sys_tsid
();

68 
sys_sigai
();

69 
sys_sgmask
();

70 
sys_stmask
();

71 
sys_euid
();

72 
sys_egid
();

74 
_r
 
	gsys__b
[] = { 
sys_tup
, 
sys_ex
, 
sys_fk
, 
sys_ad
,

75 
sys_wre
, 
sys_ݒ
, 
sys_o
, 
sys_wapid
, 
sys_t
, 
sys_lk
,

76 
sys_uƚk
, 
sys_execve
, 
sys_chd
, 
sys_time
, 
sys_mknod
, 
sys_chmod
,

77 
sys_chown
, 
sys_bak
, 
sys_
, 
sys_lek
, 
sys_gpid
, 
sys_mou
,

78 
sys_umou
, 
sys_tuid
, 
sys_guid
, 
sys_ime
, 
sys_
, 
sys_m
,

79 
sys_f
, 
sys_u
, 
sys_utime
, 
sys_ty
, 
sys_gy
, 
sys_acss
,

80 
sys_ni
, 
sys_ime
, 
sys_sync
, 
sys_kl
, 
sys_me
, 
sys_mkd
,

81 
sys_rmd
, 
sys_dup
, 
sys_pe
, 
sys_times
, 
sys_of
, 
sys_brk
, 
sys_tgid
,

82 
sys_ggid
, 
sys_sigl
, 
sys_geuid
, 
sys_gegid
, 
sys_ac
, 
sys_phys
,

83 
sys_lock
, 
sys_iol
, 
sys_f
, 
sys_mpx
, 
sys_gid
, 
sys_ulim
,

84 
sys_ume
, 
sys_umask
, 
sys_chro
, 
sys_u
, 
sys_dup2
, 
sys_gid
,

85 
sys_gpg
, 
sys_tsid
, 
sys_sigai
, 
sys_sgmask
, 
sys_stmask
,

86 
sys_euid
,
sys_egid
 };

	@include/linux/tty.h

9 #ide
_TTY_H


10 
	#_TTY_H


	)

12 
	~<rmios.h
>

14 
	#TTY_BUF_SIZE
 1024

	)

16 
	sy_queue
 {

17 
	mda
;

18 
	mhd
;

19 
	m
;

20 
sk_ru
 * 
	moc_li
;

21 
	mbuf
[
TTY_BUF_SIZE
];

24 
	#INC
(
a
(()+1& (
TTY_BUF_SIZE
-1))

	)

25 
	#DEC
(
a
(()-1& (
TTY_BUF_SIZE
-1))

	)

26 
	#EMPTY
(
a
().
hd
 =).

)

	)

27 
	#LEFT
(
a
(().

-).
hd
-1)&(
TTY_BUF_SIZE
-1))

	)

28 
	#LAST
(
a
().
buf
[(
TTY_BUF_SIZE
-1)&().
hd
-1)])

	)

29 
	#FULL
(
a
(!
	`LEFT
))

	)

30 
	#CHARS
(
a
(().
hd
-).

)&(
TTY_BUF_SIZE
-1))

	)

31 
	#GETCH
(
queue
,
c
) \

32 ()({
c
=(
queue
).
buf
[(queue).

];
	`INC
((queue).);})

	)

33 
	#PUTCH
(
c
,
queue
) \

34 ()({(
queue
).
buf
[(queue).
hd
]=(
c
);
	`INC
((queue).hd);})

	)

36 
	#INTR_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VINTR
])

	)

37 
	#QUIT_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VQUIT
])

	)

38 
	#ERASE_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VERASE
])

	)

39 
	#KILL_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VKILL
])

	)

40 
	#EOF_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VEOF
])

	)

41 
	#START_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VSTART
])

	)

42 
	#STOP_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VSTOP
])

	)

43 
	#SUSPEND_CHAR
(
y
(ty)->
rmios
.
c_cc
[
VSUSP
])

	)

45 
	sy_ru
 {

46 
rmios
 
	mrmios
;

47 
	mpg
;

48 
	mݳd
;

49 (*
	mwre
)(
y_ru
 * 
	my
);

50 
y_queue
 
	mad_q
;

51 
y_queue
 
	mwre_q
;

52 
y_queue
 
	mcdy
;

55 
y_ru
 
y_b
[];

63 
	#INIT_C_CC
 "\003\034\177\025\004\0\1\0\021\023\032\0\022\017\027\026\0"

	)

65 
rs_
();

66 
c_
();

67 
y_
();

69 
y_ad
(
c
, * 
buf
, 
n
);

70 
y_wre
(
c
, * 
buf
, 
n
);

72 
rs_wre
(
y_ru
 * 
y
);

73 
c_wre
(
y_ru
 * 
y
);

75 
cy_to_cooked
(
y_ru
 * 
y
);

	@include/signal.h

1 #ide
_SIGNAL_H


2 
	#_SIGNAL_H


	)

4 
	~<sys/tys.h
>

6 
	tsig_omic_t
;

7 
	tsigt_t
;

9 
	#_NSIG
 32

	)

10 
	#NSIG
 
_NSIG


	)

12 
	#SIGHUP
 1

	)

13 
	#SIGINT
 2

	)

14 
	#SIGQUIT
 3

	)

15 
	#SIGILL
 4

	)

16 
	#SIGTRAP
 5

	)

17 
	#SIGABRT
 6

	)

18 
	#SIGIOT
 6

	)

19 
	#SIGUNUSED
 7

	)

20 
	#SIGFPE
 8

	)

21 
	#SIGKILL
 9

	)

22 
	#SIGUSR1
 10

	)

23 
	#SIGSEGV
 11

	)

24 
	#SIGUSR2
 12

	)

25 
	#SIGPIPE
 13

	)

26 
	#SIGALRM
 14

	)

27 
	#SIGTERM
 15

	)

28 
	#SIGSTKFLT
 16

	)

29 
	#SIGCHLD
 17

	)

30 
	#SIGCONT
 18

	)

31 
	#SIGSTOP
 19

	)

32 
	#SIGTSTP
 20

	)

33 
	#SIGTTIN
 21

	)

34 
	#SIGTTOU
 22

	)

37 
	#SA_NOCLDSTOP
 1

	)

38 
	#SA_NOMASK
 0x40000000

	)

39 
	#SA_ONESHOT
 0x80000000

	)

41 
	#SIG_BLOCK
 0

	)

42 
	#SIG_UNBLOCK
 1

	)

43 
	#SIG_SETMASK
 2

	)

45 
	#SIG_DFL
 (((*)())0

	)

46 
	#SIG_IGN
 (((*)())1

	)

48 
	ssigai
 {

49 (*
	m_hdr
)();

50 
sigt_t
 
	m_mask
;

51 
	m_ags
;

52 (*
	m_ܔ
)();

55 (*
sigl
(
_sig
, (*
_func
)()))();

56 
	`i
(
sig
);

57 
	`kl
(
pid_t
 
pid
, 
sig
);

58 
	`sigaddt
(
sigt_t
 *
mask
, 
signo
);

59 
	`sigdt
(
sigt_t
 *
mask
, 
signo
);

60 
	`sigemyt
(
sigt_t
 *
mask
);

61 
	`sigflt
(
sigt_t
 *
mask
);

62 
	`sigismemb
(
sigt_t
 *
mask
, 
signo
);

63 
	`signdg
(
sigt_t
 *
t
);

64 
	`sigocmask
(
how
, 
sigt_t
 *
t
, sigt_*
dt
);

65 
	`sigsud
(
sigt_t
 *
sigmask
);

66 
	`sigai
(
sig
, 
sigai
 *
a
, sigai *
da
);

	@include/stdarg.h

1 #ide
_STDARG_H


2 
	#_STDARG_H


	)

4 *
	tva_li
;

9 
	#__va_rounded_size
(
TYPE
) \

10 ((( (
TYPE
+  (- 1/  ()*  ())

	)

12 #ide
__c__


13 
	#va_t
(
AP
, 
LASTARG
) \

14 (
AP
 = ((*&(
LASTARG
+ 
	`__va_rounded_size
 (LASTARG)))

	)

16 
	#va_t
(
AP
, 
LASTARG
) \

17 (
	`__but_vegs
 (), \

18 
AP
 = ((*&(
LASTARG
+ 
	`__va_rounded_size
 (LASTARG)))

	)

21 
va_d
 (
va_li
);

22 
	#va_d
(
AP
)

	)

24 
	#va_g
(
AP
, 
TYPE
) \

25 (
AP
 +
	`__va_rounded_size
 (
TYPE
), \

26 *((
TYPE
 *(
AP
 - 
	`__va_rounded_size
 (TYPE))))

	)

	@include/stddef.h

1 #ide
_STDDEF_H


2 
	#_STDDEF_H


	)

4 #ide
_PTRDIFF_T


5 
	#_PTRDIFF_T


	)

6 
	trdiff_t
;

9 #ide
_SIZE_T


10 
	#_SIZE_T


	)

11 
	tsize_t
;

14 #unde
NULL


15 
	#NULL
 ((*)0)

	)

17 
	#offtof
(
TYPE
, 
MEMBER
((
size_t
&((TYPE *)0)->MEMBER)

	)

	@include/string.h

1 #ide
_STRING_H_


2 
	#_STRING_H_


	)

4 #ide
NULL


5 
	#NULL
 ((*0)

	)

8 #ide
_SIZE_T


9 
	#_SIZE_T


	)

10 
	tsize_t
;

13 * 

(
o
);

27 
le
 * 
	$ry
(* 
de
,cڡ *
c
)

29 
	`__asm__
("cld\n"

34 ::"S" (
c
),"D" (
de
):"si","di","ax");

35  
de
;

36 
	}
}

38 
le
 * 
	$y
(* 
de
,cڡ *
c
,
cou
)

40 
	`__asm__
("cld\n"

50 ::"S" (
c
),"D" (
de
),"c" (
cou
):"si","di","ax","cx");

51  
de
;

52 
	}
}

54 
le
 * 
	$rt
(* 
de
,cڡ * 
c
)

56 
	`__asm__
("cld\n\t"

64 ::"S" (
c
),"D" (
de
),"a" (0),"c" (0xffffffff):"si","di","ax","cx");

65  
de
;

66 
	}
}

68 
le
 * 
	$t
(* 
de
,cڡ * 
c
,
cou
)

70 
	`__asm__
("cld\n\t"

83 ::"S" (
c
),"D" (
de
),"a" (0),"c" (0xffffffff),"g" (
cou
)

85  
de
;

86 
	}
}

88 
le
 
	$rcmp
(cڡ * 
cs
,cڡ * 

)

90 
__s
 
	`__asm__
("ax");

91 
	`__asm__
("cld\n"

103 :"" (
__s
):"D" (
cs
),"S" (

):"si","di");

104  
__s
;

105 
	}
}

107 
le
 
	$cmp
(cڡ * 
cs
,cڡ * 

,
cou
)

109 
__s
 
	`__asm__
("ax");

110 
	`__asm__
("cld\n"

124 :"" (
__s
):"D" (
cs
),"S" (

),"c" (
cou
):"si","di","cx");

125  
__s
;

126 
	}
}

128 
le
 * 
	$rchr
(cڡ * 
s
,
c
)

130 * 
__s
 
	`__asm__
("ax");

131 
	`__asm__
("cld\n\t"

141 :"" (
__s
):"S" (
s
),"0" (
c
):"si");

142  
__s
;

143 
	}
}

145 
le
 * 
	$chr
(cڡ * 
s
,
c
)

147 * 
__s
 
	`__asm__
("dx");

148 
	`__asm__
("cld\n\t"

157 :"=d" (
__s
):"0" (0),"S" (
s
),"a" (
c
):"ax","si");

158  
__s
;

159 
	}
}

161 
le
 
	$rn
(cڡ * 
cs
, cڡ * 

)

163 * 
__s
 
	`__asm__
("si");

164 
	`__asm__
("cld\n\t"

180 :"=S" (
__s
):"a" (0),"c" (0xffffffff),"0" (
cs
),"g" (

)

182  
__s
-
cs
;

183 
	}
}

185 
le
 
	$rcn
(cڡ * 
cs
, cڡ * 

)

187 * 
__s
 
	`__asm__
("si");

188 
	`__asm__
("cld\n\t"

204 :"=S" (
__s
):"a" (0),"c" (0xffffffff),"0" (
cs
),"g" (

)

206  
__s
-
cs
;

207 
	}
}

209 
le
 * 
	$brk
(cڡ * 
cs
,cڡ * 

)

211 * 
__s
 
	`__asm__
("si");

212 
	`__asm__
("cld\n\t"

231 :"=S" (
__s
):"a" (0),"c" (0xffffffff),"0" (
cs
),"g" (

)

233  
__s
;

234 
	}
}

236 
le
 * 
	$rr
(cڡ * 
cs
,cڡ * 

)

238 * 
__s
 
	`__asm__
("ax");

239 
	`__asm__
("cld\n\t" \

258 :"" (
__s
):"0" (0),"c" (0xffffffff),"S" (
cs
),"g" (

)

260  
__s
;

261 
	}
}

263 
le
 
	$
(cڡ * 
s
)

265 
__s
 
	`__asm__
("cx");

266 
	`__asm__
("cld\n\t"

271 :"=c" (
__s
):"D" (
s
),"a" (0),"0" (0xffffffff):"di");

272  
__s
;

273 
	}
}

275 * 
___ok
;

277 
le
 * 
	$ok
(* 
s
,cڡ * 

)

279 * 
__s
 
	`__asm__
("si");

280 
	`__asm__
("testl %1,%1\n\t"

330 :"=b" (
__s
),"=S" (
___ok
)

331 :"0" (
___ok
),"1" (
s
),"g" (

)

333  
__s
;

334 
	}
}

336 
le
 * 
	$memy
(* 
de
,cڡ * 
c
, 
n
)

338 
	`__asm__
("cld\n\t"

341 ::"c" (
n
),"S" (
c
),"D" (
de
)

343  
de
;

344 
	}
}

346 
le
 * 
	$memmove
(* 
de
,cڡ * 
c
, 
n
)

348 i(
de
<
c
)

349 
	`__asm__
("cld\n\t"

352 ::"c" (
n
),"S" (
c
),"D" (
de
)

355 
	`__asm__
("std\n\t"

358 ::"c" (
n
),"S" (
c
+n-1),"D" (
de
+n-1)

360  
de
;

361 
	}
}

363 
le
 
	$memcmp
(cڡ * 
cs
,cڡ * 

,
cou
)

365 
__s
 
	`__asm__
("ax");

366 
	`__asm__
("cld\n\t"

374 :"" (
__s
):"0" (0),"D" (
cs
),"S" (

),"c" (
cou
)

376  
__s
;

377 
	}
}

379 
le
 * 
	$memchr
(cڡ * 
cs
,
c
,
cou
)

381 * 
__s
 
	`__asm__
("di");

382 i(!
cou
)

383  
NULL
;

384 
	`__asm__
("cld\n\t"

390 :"=D" (
__s
):"a" (
c
),"D" (
cs
),"c" (
cou
)

392  
__s
;

393 
	}
}

395 
le
 * 
	$memt
(* 
s
,
c
,
cou
)

397 
	`__asm__
("cld\n\t"

400 ::"a" (
c
),"D" (
s
),"c" (
cou
)

402  
s
;

403 
	}
}

	@include/sys/stat.h

1 #ide
_SYS_STAT_H


2 
	#_SYS_STAT_H


	)

4 
	~<sys/tys.h
>

6 
	s
 {

7 
dev_t
 
	m_dev
;

8 
o_t
 
	m_o
;

9 
umode_t
 
	m_mode
;

10 
ƚk_t
 
	m_ƚk
;

11 
uid_t
 
	m_uid
;

12 
gid_t
 
	m_gid
;

13 
dev_t
 
	m_rdev
;

14 
off_t
 
	m_size
;

15 
time_t
 
	m_ime
;

16 
time_t
 
	m_mtime
;

17 
time_t
 
	m_ime
;

20 
	#S_IFMT
 00170000

	)

21 
	#S_IFREG
 0100000

	)

22 
	#S_IFBLK
 0060000

	)

23 
	#S_IFDIR
 0040000

	)

24 
	#S_IFCHR
 0020000

	)

25 
	#S_IFIFO
 0010000

	)

26 
	#S_ISUID
 0004000

	)

27 
	#S_ISGID
 0002000

	)

28 
	#S_ISVTX
 0001000

	)

30 
	#S_ISREG
(
m
(((m& 
S_IFMT
=
S_IFREG
)

	)

31 
	#S_ISDIR
(
m
(((m& 
S_IFMT
=
S_IFDIR
)

	)

32 
	#S_ISCHR
(
m
(((m& 
S_IFMT
=
S_IFCHR
)

	)

33 
	#S_ISBLK
(
m
(((m& 
S_IFMT
=
S_IFBLK
)

	)

34 
	#S_ISFIFO
(
m
(((m& 
S_IFMT
=
S_IFIFO
)

	)

36 
	#S_IRWXU
 00700

	)

37 
	#S_IRUSR
 00400

	)

38 
	#S_IWUSR
 00200

	)

39 
	#S_IXUSR
 00100

	)

41 
	#S_IRWXG
 00070

	)

42 
	#S_IRGRP
 00040

	)

43 
	#S_IWGRP
 00020

	)

44 
	#S_IXGRP
 00010

	)

46 
	#S_IRWXO
 00007

	)

47 
	#S_IROTH
 00004

	)

48 
	#S_IWOTH
 00002

	)

49 
	#S_IXOTH
 00001

	)

51 
chmod
(cڡ *
_th
, 
mode_t
 
mode
);

52 
f
(
fdes
, 

 *
_buf
);

53 
mkd
(cڡ *
_th
, 
mode_t
 
mode
);

54 
mkfifo
(cڡ *
_th
, 
mode_t
 
mode
);

55 

(cڡ *
fame
,  *
_buf
);

56 
mode_t
 
umask
(mode_
mask
);

	@include/sys/times.h

1 #ide
_TIMES_H


2 
	#_TIMES_H


	)

4 
	~<sys/tys.h
>

6 
	stms
 {

7 
time_t
 
	mtms_utime
;

8 
time_t
 
	mtms_ime
;

9 
time_t
 
	mtms_cutime
;

10 
time_t
 
	mtms_cime
;

13 
time_t
 
times
(
tms
 * 

);

	@include/sys/types.h

1 #ide
_SYS_TYPES_H


2 
	#_SYS_TYPES_H


	)

4 #ide
_SIZE_T


5 
	#_SIZE_T


	)

6 
	tsize_t
;

9 #ide
_TIME_T


10 
	#_TIME_T


	)

11 
	ttime_t
;

14 #ide
_PTRDIFF_T


15 
	#_PTRDIFF_T


	)

16 
	trdiff_t
;

19 #ide
NULL


20 
	#NULL
 ((*0)

	)

23 
	tpid_t
;

24 
	tuid_t
;

25 
	tgid_t
;

26 
	tdev_t
;

27 
	to_t
;

28 
	tmode_t
;

29 
	tumode_t
;

30 
	tƚk_t
;

31 
	tdaddr_t
;

32 
	toff_t
;

33 
	tu_ch
;

34 
	tusht
;

36 ru { 
	mqu
,
	mm
; } 
	tdiv_t
;

37 ru { 
	mqu
,
	mm
; } 
	tldiv_t
;

39 
	su
 {

40 
daddr_t
 
	mf_t
;

41 
o_t
 
	mf_tode
;

42 
	mf_ame
[6];

43 
	mf_ack
[6];

	@include/sys/utsname.h

1 #ide
_SYS_UTSNAME_H


2 
	#_SYS_UTSNAME_H


	)

4 
	~<sys/tys.h
>

6 
	sutame
 {

7 
	msyame
[9];

8 
	mnodame
[9];

9 
	ma
[9];

10 
	mvsi
[9];

11 
	mmache
[9];

14 
ume
(
utame
 * 
utsbuf
);

	@include/sys/wait.h

1 #ide
_SYS_WAIT_H


2 
	#_SYS_WAIT_H


	)

4 
	~<sys/tys.h
>

6 
	#_LOW
(
v
(v& 0377)

	)

7 
	#_HIGH
(
v
((v>> 8& 0377)

	)

10 
	#WNOHANG
 1

	)

11 
	#WUNTRACED
 2

	)

13 
	#WIFEXITED
(
s
(!((s)&0xFF)

	)

14 
	#WIFSTOPPED
(
s
(((s)&0xFF)==0x7F)

	)

15 
	#WEXITSTATUS
(
s
(((s)>>8)&0xFF)

	)

16 
	#WTERMSIG
(
s
((s)&0x7F)

	)

17 
	#WSTOPSIG
(
s
(((s)>>8)&0xFF)

	)

18 
	#WIFSIGNALED
(
s
((()(s)-1 & 0xFFFF< 0xFF)

	)

20 
pid_t
 
wa
(*
_loc
);

21 
pid_t
 
wapid
id_
pid
, *
_loc
, 
tis
);

	@include/termios.h

1 #ide
_TERMIOS_H


2 
	#_TERMIOS_H


	)

4 
	#TTY_BUF_SIZE
 1024

	)

8 
	#TCGETS
 0x5401

	)

9 
	#TCSETS
 0x5402

	)

10 
	#TCSETSW
 0x5403

	)

11 
	#TCSETSF
 0x5404

	)

12 
	#TCGETA
 0x5405

	)

13 
	#TCSETA
 0x5406

	)

14 
	#TCSETAW
 0x5407

	)

15 
	#TCSETAF
 0x5408

	)

16 
	#TCSBRK
 0x5409

	)

17 
	#TCXONC
 0x540A

	)

18 
	#TCFLSH
 0x540B

	)

19 
	#TIOCEXCL
 0x540C

	)

20 
	#TIOCNXCL
 0x540D

	)

21 
	#TIOCSCTTY
 0x540E

	)

22 
	#TIOCGPGRP
 0x540F

	)

23 
	#TIOCSPGRP
 0x5410

	)

24 
	#TIOCOUTQ
 0x5411

	)

25 
	#TIOCSTI
 0x5412

	)

26 
	#TIOCGWINSZ
 0x5413

	)

27 
	#TIOCSWINSZ
 0x5414

	)

28 
	#TIOCMGET
 0x5415

	)

29 
	#TIOCMBIS
 0x5416

	)

30 
	#TIOCMBIC
 0x5417

	)

31 
	#TIOCMSET
 0x5418

	)

32 
	#TIOCGSOFTCAR
 0x5419

	)

33 
	#TIOCSSOFTCAR
 0x541A

	)

34 
	#TIOCINQ
 0x541B

	)

36 
	swsize
 {

37 
	mws_row
;

38 
	mws_c
;

39 
	mws_xpix
;

40 
	mws_ypix
;

43 
	#NCC
 8

	)

44 
	srmio
 {

45 
	mc_iag
;

46 
	mc_oag
;

47 
	mc_cag
;

48 
	mc_lag
;

49 
	mc_le
;

50 
	mc_cc
[
NCC
];

53 
	#NCCS
 17

	)

54 
	srmios
 {

55 
	mc_iag
;

56 
	mc_oag
;

57 
	mc_cag
;

58 
	mc_lag
;

59 
	mc_le
;

60 
	mc_cc
[
NCCS
];

64 
	#VINTR
 0

	)

65 
	#VQUIT
 1

	)

66 
	#VERASE
 2

	)

67 
	#VKILL
 3

	)

68 
	#VEOF
 4

	)

69 
	#VTIME
 5

	)

70 
	#VMIN
 6

	)

71 
	#VSWTC
 7

	)

72 
	#VSTART
 8

	)

73 
	#VSTOP
 9

	)

74 
	#VSUSP
 10

	)

75 
	#VEOL
 11

	)

76 
	#VREPRINT
 12

	)

77 
	#VDISCARD
 13

	)

78 
	#VWERASE
 14

	)

79 
	#VLNEXT
 15

	)

80 
	#VEOL2
 16

	)

83 
	#IGNBRK
 0000001

	)

84 
	#BRKINT
 0000002

	)

85 
	#IGNPAR
 0000004

	)

86 
	#PARMRK
 0000010

	)

87 
	#INPCK
 0000020

	)

88 
	#ISTRIP
 0000040

	)

89 
	#INLCR
 0000100

	)

90 
	#IGNCR
 0000200

	)

91 
	#ICRNL
 0000400

	)

92 
	#IUCLC
 0001000

	)

93 
	#IXON
 0002000

	)

94 
	#IXANY
 0004000

	)

95 
	#IXOFF
 0010000

	)

96 
	#IMAXBEL
 0020000

	)

99 
	#OPOST
 0000001

	)

100 
	#OLCUC
 0000002

	)

101 
	#ONLCR
 0000004

	)

102 
	#OCRNL
 0000010

	)

103 
	#ONOCR
 0000020

	)

104 
	#ONLRET
 0000040

	)

105 
	#OFILL
 0000100

	)

106 
	#OFDEL
 0000200

	)

107 
	#NLDLY
 0000400

	)

108 
	#NL0
 0000000

	)

109 
	#NL1
 0000400

	)

110 
	#CRDLY
 0003000

	)

111 
	#CR0
 0000000

	)

112 
	#CR1
 0001000

	)

113 
	#CR2
 0002000

	)

114 
	#CR3
 0003000

	)

115 
	#TABDLY
 0014000

	)

116 
	#TAB0
 0000000

	)

117 
	#TAB1
 0004000

	)

118 
	#TAB2
 0010000

	)

119 
	#TAB3
 0014000

	)

120 
	#XTABS
 0014000

	)

121 
	#BSDLY
 0020000

	)

122 
	#BS0
 0000000

	)

123 
	#BS1
 0020000

	)

124 
	#VTDLY
 0040000

	)

125 
	#VT0
 0000000

	)

126 
	#VT1
 0040000

	)

127 
	#FFDLY
 0040000

	)

128 
	#FF0
 0000000

	)

129 
	#FF1
 0040000

	)

132 
	#CBAUD
 0000017

	)

133 
	#B0
 0000000

	)

134 
	#B50
 0000001

	)

135 
	#B75
 0000002

	)

136 
	#B110
 0000003

	)

137 
	#B134
 0000004

	)

138 
	#B150
 0000005

	)

139 
	#B200
 0000006

	)

140 
	#B300
 0000007

	)

141 
	#B600
 0000010

	)

142 
	#B1200
 0000011

	)

143 
	#B1800
 0000012

	)

144 
	#B2400
 0000013

	)

145 
	#B4800
 0000014

	)

146 
	#B9600
 0000015

	)

147 
	#B19200
 0000016

	)

148 
	#B38400
 0000017

	)

149 
	#EXTA
 
B19200


	)

150 
	#EXTB
 
B38400


	)

151 
	#CSIZE
 0000060

	)

152 
	#CS5
 0000000

	)

153 
	#CS6
 0000020

	)

154 
	#CS7
 0000040

	)

155 
	#CS8
 0000060

	)

156 
	#CSTOPB
 0000100

	)

157 
	#CREAD
 0000200

	)

158 
	#CPARENB
 0000400

	)

159 
	#CPARODD
 0001000

	)

160 
	#HUPCL
 0002000

	)

161 
	#CLOCAL
 0004000

	)

162 
	#CIBAUD
 03600000

	)

163 
	#CRTSCTS
 020000000000

	)

165 
	#PARENB
 
CPARENB


	)

166 
	#PARODD
 
CPARODD


	)

169 
	#ISIG
 0000001

	)

170 
	#ICANON
 0000002

	)

171 
	#XCASE
 0000004

	)

172 
	#ECHO
 0000010

	)

173 
	#ECHOE
 0000020

	)

174 
	#ECHOK
 0000040

	)

175 
	#ECHONL
 0000100

	)

176 
	#NOFLSH
 0000200

	)

177 
	#TOSTOP
 0000400

	)

178 
	#ECHOCTL
 0001000

	)

179 
	#ECHOPRT
 0002000

	)

180 
	#ECHOKE
 0004000

	)

181 
	#FLUSHO
 0010000

	)

182 
	#PENDIN
 0040000

	)

183 
	#IEXTEN
 0100000

	)

186 
	#TIOCM_LE
 0x001

	)

187 
	#TIOCM_DTR
 0x002

	)

188 
	#TIOCM_RTS
 0x004

	)

189 
	#TIOCM_ST
 0x008

	)

190 
	#TIOCM_SR
 0x010

	)

191 
	#TIOCM_CTS
 0x020

	)

192 
	#TIOCM_CAR
 0x040

	)

193 
	#TIOCM_RNG
 0x080

	)

194 
	#TIOCM_DSR
 0x100

	)

195 
	#TIOCM_CD
 
TIOCM_CAR


	)

196 
	#TIOCM_RI
 
TIOCM_RNG


	)

199 
	#TCOOFF
 0

	)

200 
	#TCOON
 1

	)

201 
	#TCIOFF
 2

	)

202 
	#TCION
 3

	)

205 
	#TCIFLUSH
 0

	)

206 
	#TCOFLUSH
 1

	)

207 
	#TCIOFLUSH
 2

	)

210 
	#TCSANOW
 0

	)

211 
	#TCSADRAIN
 1

	)

212 
	#TCSAFLUSH
 2

	)

214 
	td_t
;

216 
d_t
 
cfgid
(
rmios
 *
rmios_p
);

217 
d_t
 
cfgod
(
rmios
 *
rmios_p
);

218 
cftid
(
rmios
 *
rmios_p
, 
d_t
 
d
);

219 
cftod
(
rmios
 *
rmios_p
, 
d_t
 
d
);

220 
tcd
(
fdes
);

221 
tcow
(
fdes
, 
ai
);

222 
tcush
(
fdes
, 
queue_
);

223 
tcg
(
fdes
, 
rmios
 *
rmios_p
);

224 
tcndbak
(
fdes
, 
duti
);

225 
tcr
(
fdes
, 
tiڮ_ais
,

226 
rmios
 *
rmios_p
);

	@include/time.h

1 #ide
_TIME_H


2 
	#_TIME_H


	)

4 #ide
_TIME_T


5 
	#_TIME_T


	)

6 
	ttime_t
;

9 #ide
_SIZE_T


10 
	#_SIZE_T


	)

11 
	tsize_t
;

14 
	#CLOCKS_PER_SEC
 100

	)

16 
	tock_t
;

18 
	stm
 {

19 
	mtm_c
;

20 
	mtm_m
;

21 
	mtm_hour
;

22 
	mtm_mday
;

23 
	mtm_m
;

24 
	mtm_yr
;

25 
	mtm_wday
;

26 
	mtm_yday
;

27 
	mtm_isd
;

30 
ock_t
 
ock
();

31 
time_t
 
time
ime_* 

);

32 
difime
(
time_t
 
time2
,ime_
time1
);

33 
time_t
 
mktime
(
tm
 * 

);

35 * 
asime
(cڡ 
tm
 * 

);

36 * 
ime
(cڡ 
time_t
 * 

);

37 
tm
 * 
gmtime
(cڡ 
time_t
 *

);

38 
tm
 *
loime
(cڡ 
time_t
 * 

);

39 
size_t
 
rime
(* 
s
, size_
smax
, cڡ * 
fmt
, cڡ 
tm
 * 

);

40 
tzt
();

	@include/unistd.h

1 #ide
_UNISTD_H


2 
	#_UNISTD_H


	)

5 
	#_POSIX_VERSION
 198808L

	)

7 
	#_POSIX_CHOWN_RESTRICTED


	)

8 
	#_POSIX_NO_TRUNC


	)

9 
	#_POSIX_VDISABLE
 '\0'

	)

13 
	#STDIN_FILENO
 0

	)

14 
	#STDOUT_FILENO
 1

	)

15 
	#STDERR_FILENO
 2

	)

17 #ide
NULL


18 
	#NULL
 ((*)0)

	)

22 
	#F_OK
 0

	)

23 
	#X_OK
 1

	)

24 
	#W_OK
 2

	)

25 
	#R_OK
 4

	)

28 
	#SEEK_SET
 0

	)

29 
	#SEEK_CUR
 1

	)

30 
	#SEEK_END
 2

	)

33 
	#_SC_ARG_MAX
 1

	)

34 
	#_SC_CHILD_MAX
 2

	)

35 
	#_SC_CLOCKS_PER_SEC
 3

	)

36 
	#_SC_NGROUPS_MAX
 4

	)

37 
	#_SC_OPEN_MAX
 5

	)

38 
	#_SC_JOB_CONTROL
 6

	)

39 
	#_SC_SAVED_IDS
 7

	)

40 
	#_SC_VERSION
 8

	)

43 
	#_PC_LINK_MAX
 1

	)

44 
	#_PC_MAX_CANON
 2

	)

45 
	#_PC_MAX_INPUT
 3

	)

46 
	#_PC_NAME_MAX
 4

	)

47 
	#_PC_PATH_MAX
 5

	)

48 
	#_PC_PIPE_BUF
 6

	)

49 
	#_PC_NO_TRUNC
 7

	)

50 
	#_PC_VDISABLE
 8

	)

51 
	#_PC_CHOWN_RESTRICTED
 9

	)

53 
	~<sys/.h
>

54 
	~<sys/times.h
>

55 
	~<sys/utame.h
>

56 
	~<utime.h
>

58 #ifde
__LIBRARY__


60 
	#__NR_tup
 0

	)

61 
	#__NR_ex
 1

	)

62 
	#__NR_fk
 2

	)

63 
	#__NR_ad
 3

	)

64 
	#__NR_wre
 4

	)

65 
	#__NR_ݒ
 5

	)

66 
	#__NR_o
 6

	)

67 
	#__NR_wapid
 7

	)

68 
	#__NR_t
 8

	)

69 
	#__NR_lk
 9

	)

70 
	#__NR_uƚk
 10

	)

71 
	#__NR_execve
 11

	)

72 
	#__NR_chd
 12

	)

73 
	#__NR_time
 13

	)

74 
	#__NR_mknod
 14

	)

75 
	#__NR_chmod
 15

	)

76 
	#__NR_chown
 16

	)

77 
	#__NR_bak
 17

	)

78 
	#__NR_
 18

	)

79 
	#__NR_lek
 19

	)

80 
	#__NR_gpid
 20

	)

81 
	#__NR_mou
 21

	)

82 
	#__NR_umou
 22

	)

83 
	#__NR_tuid
 23

	)

84 
	#__NR_guid
 24

	)

85 
	#__NR_ime
 25

	)

86 
	#__NR_
 26

	)

87 
	#__NR_m
 27

	)

88 
	#__NR_f
 28

	)

89 
	#__NR_u
 29

	)

90 
	#__NR_utime
 30

	)

91 
	#__NR_ty
 31

	)

92 
	#__NR_gy
 32

	)

93 
	#__NR_acss
 33

	)

94 
	#__NR_ni
 34

	)

95 
	#__NR_ime
 35

	)

96 
	#__NR_sync
 36

	)

97 
	#__NR_kl
 37

	)

98 
	#__NR_me
 38

	)

99 
	#__NR_mkd
 39

	)

100 
	#__NR_rmd
 40

	)

101 
	#__NR_dup
 41

	)

102 
	#__NR_pe
 42

	)

103 
	#__NR_times
 43

	)

104 
	#__NR_of
 44

	)

105 
	#__NR_brk
 45

	)

106 
	#__NR_tgid
 46

	)

107 
	#__NR_ggid
 47

	)

108 
	#__NR_sigl
 48

	)

109 
	#__NR_geuid
 49

	)

110 
	#__NR_gegid
 50

	)

111 
	#__NR_ac
 51

	)

112 
	#__NR_phys
 52

	)

113 
	#__NR_lock
 53

	)

114 
	#__NR_iol
 54

	)

115 
	#__NR_f
 55

	)

116 
	#__NR_mpx
 56

	)

117 
	#__NR_gid
 57

	)

118 
	#__NR_ulim
 58

	)

119 
	#__NR_ume
 59

	)

120 
	#__NR_umask
 60

	)

121 
	#__NR_chro
 61

	)

122 
	#__NR_u
 62

	)

123 
	#__NR_dup2
 63

	)

124 
	#__NR_gid
 64

	)

125 
	#__NR_gpg
 65

	)

126 
	#__NR_tsid
 66

	)

127 
	#__NR_sigai
 67

	)

128 
	#__NR_sgmask
 68

	)

129 
	#__NR_stmask
 69

	)

130 
	#__NR_euid
 70

	)

131 
	#__NR_egid
 71

	)

133 
	#_sys0
(
ty
,
me
) \

134 
ty
 
	`me
() \

136 
__s
; \

137 
__asm__
 volatile ("int $0x80" \

138 : "" (
__s
) \

139 : "0" (
__NR_
##
me
)); \

140 i(
__s
 >= 0) \

141  (
ty

__s
; \

142 
o
 = -
__s
; \

144 }

	)

146 
	#_sys1
(
ty
,
me
,
y
,
a
) \

147 
ty
 
	`me
(
y
 
a
) \

149 
__s
; \

150 
__asm__
 volatile ("int $0x80" \

151 : "" (
__s
) \

152 : "0" (
__NR_
##
me
),"b" (()(
a
))); \

153 i(
__s
 >= 0) \

154  (
ty

__s
; \

155 
o
 = -
__s
; \

157 }

	)

159 
	#_sys2
(
ty
,
me
,
y
,
a
,
bty
,
b
) \

160 
ty
 
	`me
(
y
 
a
,
bty
 
b
) \

162 
__s
; \

163 
__asm__
 volatile ("int $0x80" \

164 : "" (
__s
) \

165 : "0" (
__NR_
##
me
),"b" (()(
a
)),"c" (()(
b
))); \

166 i(
__s
 >= 0) \

167  (
ty

__s
; \

168 
o
 = -
__s
; \

170 }

	)

172 
	#_sys3
(
ty
,
me
,
y
,
a
,
bty
,
b
,
y
,
c
) \

173 
ty
 
	`me
(
y
 
a
,
bty
 
b
,
y
 
c
) \

175 
__s
; \

176 
__asm__
 volatile ("int $0x80" \

177 : "" (
__s
) \

178 : "0" (
__NR_
##
me
),"b" (()(
a
)),"c" (()(
b
)),"d" (()(
c
))); \

179 i(
__s
>=0) \

180  (
ty

__s
; \

181 
o
=-
__s
; \

183 }

	)

187 
o
;

189 
acss
(cڡ * 
fame
, 
mode_t
 
mode
);

190 
ac
(cڡ * 
fame
);

191 
m
(
c
);

192 
brk
(* 
d_da_gmt
);

193 * 
sbrk
(
rdiff_t
 
emt
);

194 
chd
(cڡ * 
fame
);

195 
chmod
(cڡ * 
fame
, 
mode_t
 
mode
);

196 
chown
(cڡ * 
fame
, 
uid_t
 
owr
, 
gid_t
 
group
);

197 
chro
(cڡ * 
fame
);

198 
o
(
fdes
);

199 
t
(cڡ * 
fame
, 
mode_t
 
mode
);

200 
dup
(
fdes
);

201 
execve
(cڡ * 
fame
, ** 
gv
, ** 
vp
);

202 
execv
(cڡ * 
thme
, ** 
gv
);

203 
execvp
(cڡ * 
fe
, ** 
gv
);

204 
exe
(cڡ * 
thme
, * 
g0
, ...);

205 
exep
(cڡ * 
fe
, * 
g0
, ...);

206 
exee
(cڡ * 
thme
, * 
g0
, ...);

207 vީ
ex
(
us
);

208 vީ
_ex
(
us
);

209 
f
(
fdes
, 
cmd
, ...);

210 
fk
();

211 
gpid
();

212 
guid
();

213 
geuid
();

214 
ggid
();

215 
gegid
();

216 
iol
(
fdes
, 
cmd
, ...);

217 
kl
(
pid_t
 
pid
, 
sigl
);

218 
lk
(cڡ * 
fame1
, cڡ * 
fame2
);

219 
lek
(
fdes
, 
off_t
 
offt
, 
ig
);

220 
mknod
(cڡ * 
fame
, 
mode_t
 
mode
, 
dev_t
 
dev
);

221 
mou
(cڡ * 
eclfe
, cڡ * 
d
, 
rwag
);

222 
ni
(
v
);

223 
ݒ
(cڡ * 
fame
, 
ag
, ...);

224 
u
();

225 
pe
(* 
fdes
);

226 
ad
(
fdes
, * 
buf
, 
off_t
 
cou
);

227 
g
();

228 
gid
(
pid_t
 
pid
,pid_
pgid
);

229 
tuid
(
uid_t
 
uid
);

230 
tgid
(
gid_t
 
gid
);

231 (*
sigl
(
sig
, (*

)()))();

232 
	`
(cڡ * 
fame
, 

 * 
_buf
);

233 
	`f
(
fdes
, 

 * 
_buf
);

234 
	`ime
(
time_t
 * 

);

235 
	`sync
();

236 
time_t
 
	`time
ime_* 
oc
);

237 
time_t
 
	`times
(
tms
 * 
tbuf
);

238 
	`ulim
(
cmd
, 
lim
);

239 
mode_t
 
	`umask
(mode_
mask
);

240 
	`umou
(cڡ * 
eclfe
);

241 
	`ume
(
utame
 * 
me
);

242 
	`uƚk
(cڡ * 
fame
);

243 
	`u
(
dev_t
 
dev
, 
u
 * 
ubuf
);

244 
	`utime
(cڡ * 
fame
, 
utimbuf
 * 
times
);

245 
pid_t
 
	`wapid
id_
pid
,* 
wa_
,
tis
);

246 
pid_t
 
	`wa
(* 
wa_
);

247 
	`wre
(
fdes
, cڡ * 
buf
, 
off_t
 
cou
);

248 
	`dup2
(
dfd
, 
wfd
);

249 
	`gid
();

250 
pid_t
 
	`gpg
();

251 
pid_t
 
	`tsid
();

	@include/utime.h

1 #ide
_UTIME_H


2 
	#_UTIME_H


	)

4 
	~<sys/tys.h
>

6 
	sutimbuf
 {

7 
time_t
 
	maime
;

8 
time_t
 
	mmodtime
;

11 
utime
(cڡ *
fame
, 
utimbuf
 *
times
);

	@init/main.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

9 
	~<time.h
>

23 
le
 
	$_sys0
(,
fk
)

24 
le
 
	$_sys0
(,
u
)

25 
le
 
	$_sys1
(,
tup
,*,
BIOS
)

26 
le
 
	$_sys0
(,
sync
)

28 
	~<lux/y.h
>

29 
	~<lux/sched.h
>

30 
	~<lux/hd.h
>

31 
	~<asm/syem.h
>

32 
	~<asm/io.h
>

34 
	~<ddef.h
>

35 
	~<dg.h
>

36 
	~<unid.h
>

37 
	~<f.h
>

38 
	~<sys/tys.h
>

40 
	~<lux/fs.h
>

42 
tbuf
[1024];

44 
	`vrtf
();

45 
	`
();

46 
	`blk_dev_
();

47 
	`chr_dev_
();

48 
	`hd_
();

49 
	`py_
();

50 
	`mem_
(
t
, 
d
);

51 
	`rd_
(
mem_t
, 
ngth
);

52 
	`kl_mktime
(
tm
 *m);

53 
tup_time
;

58 
	#EXT_MEM_K
 (*(*)0x90002)

59 
	#DRIVE_INFO
 (*(
drive_fo
 *)0x90080

	)

60 
	#ORIG_ROOT_DEV
 (*(*)0x901FC)

61 

	)

69 
	#CMOS_READ
(
addr
) ({ \

70 
	`outb_p
(0x80|
addr
,0x70); \

71 
	`b_p
(0x71); \

72 
	}
})

	)

74 
	#BCD_TO_BIN
(
v
((v)=((v)&15+ ((v)>>4)*10)

	)

76 
	$time_
()

78 
tm
 
time
;

81 
time
.
tm_c
 = 
	`CMOS_READ
(0);

82 
time
.
tm_m
 = 
	`CMOS_READ
(2);

83 
time
.
tm_hour
 = 
	`CMOS_READ
(4);

84 
time
.
tm_mday
 = 
	`CMOS_READ
(7);

85 
time
.
tm_m
 = 
	`CMOS_READ
(8);

86 
time
.
tm_yr
 = 
	`CMOS_READ
(9);

87 } 
time
.
tm_c
 !
	`CMOS_READ
(0));

88 
	`BCD_TO_BIN
(
time
.
tm_c
);

89 
	`BCD_TO_BIN
(
time
.
tm_m
);

90 
	`BCD_TO_BIN
(
time
.
tm_hour
);

91 
	`BCD_TO_BIN
(
time
.
tm_mday
);

92 
	`BCD_TO_BIN
(
time
.
tm_m
);

93 
	`BCD_TO_BIN
(
time
.
tm_yr
);

94 
time
.
tm_m
--;

95 
tup_time
 = 
	`kl_mktime
(&
time
);

96 
	}
}

98 
	gmemy_d
 = 0;

99 
	gbufr_memy_d
 = 0;

100 
	gma_memy_t
 = 0;

103 
	sdrive_fo
 { 
	mdummy
[32]; } 
	gdrive_fo
;

105 
	$ma
()

111 
ROOT_DEV
 = 
ORIG_ROOT_DEV
;

112 
drive_fo
 = 
DRIVE_INFO
;

113 
memy_d
 = (1<<20+ (
EXT_MEM_K
<<10);

114 
memy_d
 &= 0xfffff000;

115 i(
memy_d
 > 16*1024*1024)

116 
memy_d
 = 16*1024*1024;

117 i(
memy_d
 > 12*1024*1024)

118 
bufr_memy_d
 = 4*1024*1024;

119 i(
memy_d
 > 6*1024*1024)

120 
bufr_memy_d
 = 2*1024*1024;

122 
bufr_memy_d
 = 1*1024*1024;

123 
ma_memy_t
 = 
bufr_memy_d
;

124 #ifde
RAMDISK


125 
ma_memy_t
 +
	`rd_
(ma_memy_t, 
RAMDISK
*1024);

127 
	`mem_
(
ma_memy_t
,
memy_d
);

128 
	`_
();

129 
	`blk_dev_
();

130 
	`chr_dev_
();

131 
	`y_
();

132 
	`time_
();

133 
	`sched_
();

134 
	`bufr_
(
bufr_memy_d
);

135 
	`hd_
();

136 
	`py_
();

137 
	`i
();

138 
	`move_to_ur_mode
();

139 i(!
	`fk
()) {

140 
	`
();

149 ;;
	`u
();

150 
	}
}

152 
	$tf
(cڡ *
fmt
, ...)

154 
va_li
 
gs
;

155 
i
;

157 
	`va_t
(
gs
, 
fmt
);

158 
	`wre
(1,
tbuf
,
i
=
	`vrtf
rtbuf, 
fmt
, 
gs
));

159 
	`va_d
(
gs
);

160  
i
;

161 
	}
}

163 * 
	ggv_rc
[] = { "/b/sh", 
NULL
 };

164 * 
	gvp_rc
[] = { "HOME=/", 
NULL
 };

166 * 
	ggv
[] = { "-/b/sh",
NULL
 };

167 * 
	gvp
[] = { "HOME=/u/ro", 
NULL
 };

169 
	$
()

171 
pid
,
i
;

173 
	`tup
((*&
drive_fo
);

174 (
	`ݒ
("/dev/y0",
O_RDWR
,0);

175 (
	`dup
(0);

176 (
	`dup
(0);

177 
	`tf
("%d bufr%d bybuf㸥a\n\r",
NR_BUFFERS
,

178 
NR_BUFFERS
*
BLOCK_SIZE
);

179 
	`tf
("Fmem: %d bys\n\r",
memy_d
-
ma_memy_t
);

180 i(!(
pid
=
	`fk
())) {

181 
	`o
(0);

182 i(
	`ݒ
("/c/rc",
O_RDONLY
,0))

183 
	`_ex
(1);

184 
	`execve
("/b/sh",
gv_rc
,
vp_rc
);

185 
	`_ex
(2);

187 i(
pid
>0)

188 
pid
 !
	`wa
(&
i
))

191 i((
pid
=
	`fk
())<0) {

192 
	`tf
("Fork failed in init\r\n");

195 i(!
pid
) {

196 
	`o
(0);close(1);close(2);

197 
	`tsid
();

198 (
	`ݒ
("/dev/y0",
O_RDWR
,0);

199 (
	`dup
(0);

200 (
	`dup
(0);

201 
	`_ex
(
	`execve
("/b/sh",
gv
,
vp
));

204 i(
pid
 =
	`wa
(&
i
))

206 
	`tf
("\n\rchd %d dd wh cod%04x\n\r",
pid
,
i
);

207 
	`sync
();

209 
	`_ex
(0);

210 
	}
}

	@kernel/asm.s

14 .
globl
 
	g_divide_r
,
	g_debug
,
	g_nmi
,
	g_t3
,
	g_ovow
,
	g_bounds
,
	g_vid_


15 .
globl
 
	g_doub_u
,
	g_cross_gmt_ovrun


16 .
globl
 
	g_vid_TSS
,
	g_gmt_n_e
,
	g_ack_gmt


17 .
globl
 
	g_g_ei
,
	g_cross_r
,
	g_q13
,
_rved


19 
	g_divide_r
:

20 
pushl
 
$_do_divide_r


21 
no_r_code
:

22 
xchgl
 %
x
,(%
	ge
)

23 
	gpushl
 %
ebx


24 
	gpushl
 %
ecx


25 
	gpushl
 %
edx


26 
	gpushl
 %
edi


27 
	gpushl
 %
esi


28 
	gpushl
 %
ebp


29 
	gpush
 %
ds


30 
	gpush
 %
es


31 
	gpush
 %
fs


32 
pushl
 
	g$0
 #"
r
 
	gcode
"

33 
	ga
 44(%
	ge
),%
edx


34 
	gpushl
 %
edx


35 
movl
 
	g$0x10
,%
edx


36 
	gmov
 %
	gdx
,%
ds


37 
	gmov
 %
	gdx
,%
es


38 
	gmov
 %
	gdx
,%
fs


39 
	g
 *%
x


40 
addl
 
	g$8
,%
e


41 
	gp
 %
fs


42 
	gp
 %
es


43 
	gp
 %
ds


44 
	gpl
 %
ebp


45 
	gpl
 %
esi


46 
	gpl
 %
edi


47 
	gpl
 %
edx


48 
	gpl
 %
ecx


49 
	gpl
 %
ebx


50 
	gpl
 %
x


51 



53 
	g_debug
:

54 
pushl
 
$_do_t3
 #_do_debug

55 
jmp
 
no_r_code


57 
_nmi
:

58 
pushl
 
$_do_nmi


59 
jmp
 
no_r_code


61 
_t3
:

62 
pushl
 
$_do_t3


63 
jmp
 
no_r_code


65 
_ovow
:

66 
pushl
 
$_do_ovow


67 
jmp
 
no_r_code


69 
_bounds
:

70 
pushl
 
$_do_bounds


71 
jmp
 
no_r_code


73 
_vid_
:

74 
pushl
 
$_do_vid_


75 
jmp
 
no_r_code


77 
_cross_gmt_ovrun
:

78 
pushl
 
$_do_cross_gmt_ovrun


79 
jmp
 
no_r_code


81 
_rved
:

82 
pushl
 
$_do_rved


83 
jmp
 
no_r_code


85 
_q13
:

86 
pushl
 %
x


87 
xb
 %

,%al

88 
	goutb
 %
	g
,
$0xF0


89 
movb
 
	g$0x20
,%



90 
	goutb
 %
	g
,
$0x20


91 
	gjmp
 1f

92 1: 
jmp
 1f

93 1: 
outb
 %

,
$0xA0


94 
	gpl
 %
x


95 
jmp
 
_cross_r


97 
	g_doub_u
:

98 
pushl
 
$_do_doub_u


99 
r_code
:

100 
xchgl
 %
x
,4(%
	ge
#r 
	gcode
 <-> %eax

101 
	gxchgl
 %
	gebx
,(%
	ge
#&
	gfuni
 <-> %
ebx


102 
	gpushl
 %
ecx


103 
	gpushl
 %
edx


104 
	gpushl
 %
edi


105 
	gpushl
 %
esi


106 
	gpushl
 %
ebp


107 
	gpush
 %
ds


108 
	gpush
 %
es


109 
	gpush
 %
fs


110 
	gpushl
 %
	gx
 #r 
code


111 
	ga
 44(%
	ge
),%
	gx
 #offset

112 
	gpushl
 %
x


113 
movl
 
	g$0x10
,%
x


114 
	gmov
 %
	gax
,%
ds


115 
	gmov
 %
	gax
,%
es


116 
	gmov
 %
	gax
,%
fs


117 
	g
 *%
ebx


118 
addl
 
	g$8
,%
e


119 
	gp
 %
fs


120 
	gp
 %
es


121 
	gp
 %
ds


122 
	gpl
 %
ebp


123 
	gpl
 %
esi


124 
	gpl
 %
edi


125 
	gpl
 %
edx


126 
	gpl
 %
ecx


127 
	gpl
 %
ebx


128 
	gpl
 %
x


129 



131 
	g_vid_TSS
:

132 
pushl
 
$_do_vid_TSS


133 
jmp
 
r_code


135 
_gmt_n_e
:

136 
pushl
 
$_do_gmt_n_e


137 
jmp
 
r_code


139 
_ack_gmt
:

140 
pushl
 
$_do_ack_gmt


141 
jmp
 
r_code


143 
_g_ei
:

144 
pushl
 
$_do_g_ei


145 
jmp
 
r_code


	@kernel/blk_drv/blk.h

1 #ide
_BLK_H


2 
	#_BLK_H


	)

4 
	#NR_BLK_DEV
 7

	)

15 
	#NR_REQUEST
 32

	)

23 
	sque
 {

24 
	mdev
;

25 
	mcmd
;

26 
	mrs
;

27 
	m
;

28 
	m_s
;

29 * 
	mbufr
;

30 
sk_ru
 * 
	mwag
;

31 
bufr_hd
 * 
	mbh
;

32 
que
 * 
	mxt
;

40 
	#IN_ORDER
(
s1
,
s2
) \

41 ((
s1
)->
cmd
<(
s2
)->cmd || (s1)->cmd==(s2)->cmd && \

42 ((
s1
)->
dev
 < (
s2
)->dev || ((s1)->dev == (s2)->dev && \

43 (
s1
)->

 < (
s2
)->)))

	)

45 
	sblk_dev_ru
 {

46 (*
	mque_
)();

47 
que
 * 
	mcut_que
;

50 
blk_dev_ru
 
blk_dev
[
NR_BLK_DEV
];

51 
que
eque[
NR_REQUEST
];

52 
sk_ru
 * 
wa_f_que
;

54 #ifde
MAJOR_NR


61 #i(
MAJOR_NR
 == 1)

63 
	#DEVICE_NAME
 "mdisk"

	)

64 
	#DEVICE_REQUEST
 
do_rd_que


	)

65 
	#DEVICE_NR
(
devi
((devi& 7)

	)

66 
	#DEVICE_ON
(
devi
)

	)

67 
	#DEVICE_OFF
(
devi
)

	)

69 #i(
MAJOR_NR
 == 2)

71 
	#DEVICE_NAME
 "py"

	)

72 
	#DEVICE_INTR
 
do_py


	)

73 
	#DEVICE_REQUEST
 
do_fd_que


	)

74 
	#DEVICE_NR
(
devi
((devi& 3)

	)

75 
	#DEVICE_ON
(
devi

	`py_
(
	`DEVICE_NR
(devi))

	)

76 
	#DEVICE_OFF
(
devi

	`py_off
(
	`DEVICE_NR
(devi))

	)

78 #i(
MAJOR_NR
 == 3)

80 
	#DEVICE_NAME
 "hddisk"

	)

81 
	#DEVICE_INTR
 
do_hd


	)

82 
	#DEVICE_REQUEST
 
do_hd_que


	)

83 
	#DEVICE_NR
(
devi
(
	`MINOR
(devi)/5)

	)

84 
	#DEVICE_ON
(
devi
)

	)

85 
	#DEVICE_OFF
(
devi
)

	)

93 
	#CURRENT
 (
blk_dev
[
MAJOR_NR
].
cut_que
)

	)

94 
	#CURRENT_DEV
 
	`DEVICE_NR
(
CURRENT
->
dev
)

	)

96 #ifde
DEVICE_INTR


97 (*
DEVICE_INTR
)(
NULL
;

99 (
DEVICE_REQUEST
)();

101 
le
 
	$uock_bufr
(
bufr_hd
 * 
bh
)

103 i(!
bh
->
b_lock
)

104 
	`tk
(
DEVICE_NAME
 ": free buffer being unlocked\n");

105 
bh
->
b_lock
=0;

106 
	`wake_up
(&
bh
->
b_wa
);

107 
	}
}

109 
le
 
	$d_que
(
uode
)

111 
	`DEVICE_OFF
(
CURRENT
->
dev
);

112 i(
CURRENT
->
bh
) {

113 
CURRENT
->
bh
->
b_uode
 = 
uode
;

114 
	`uock_bufr
(
CURRENT
->
bh
);

116 i(!
uode
) {

117 
	`tk
(
DEVICE_NAME
 " I/Orror\n\r");

118 
	`tk
("dev %04x, block %d\n\r",
CURRENT
->
dev
,

119 
CURRENT
->
bh
->
b_block
);

121 
	`wake_up
(&
CURRENT
->
wag
);

122 
	`wake_up
(&
wa_f_que
);

123 
CURRENT
->
dev
 = -1;

124 
CURRENT
 = CURRENT->
xt
;

125 
	}
}

127 
	#INIT_REQUEST
 \

128 

: \

129 i(!
CURRENT
) \

131 i(
	`MAJOR
(
CURRENT
->
dev
!
MAJOR_NR
) \

132 
	`nic
(
DEVICE_NAME
 ":equestist destroyed"); \

133 i(
CURRENT
->
bh
) { \

134 i(!
CURRENT
->
bh
->
b_lock
) \

135 
	`nic
(
DEVICE_NAME
 ": blockotocked"); \

136 }

	)

	@kernel/blk_drv/floppy.c

33 
	~<lux/sched.h
>

34 
	~<lux/fs.h
>

35 
	~<lux/kl.h
>

36 
	~<lux/fdg.h
>

37 
	~<asm/syem.h
>

38 
	~<asm/io.h
>

39 
	~<asm/gmt.h
>

41 
	#MAJOR_NR
 2

	)

42 
	~"blk.h
"

44 
	glib
 = 0;

45 
	gt
 = 0;

46 
	gek
 = 0;

48 
cut_DOR
;

50 
	#immoutb_p
(
v
,
pt
) \

51 
	`__asm__
("outb %0,%1\n\tjm1f\n1:\tjm1f\n1:"::"a" (((
v
)),"i" (
pt
))

	)

53 
	#TYPE
(
x
((x)>>2)

	)

54 
	#DRIVE
(
x
((x)&0x03)

	)

60 
	#MAX_ERRORS
 8

	)

65 
	#MAX_REPLIES
 7

	)

66 
	gy_bufr
[
MAX_REPLIES
];

67 
	#ST0
 (
y_bufr
[0])

	)

68 
	#ST1
 (
y_bufr
[1])

	)

69 
	#ST2
 (
y_bufr
[2])

	)

70 
	#ST3
 (
y_bufr
[3])

	)

82 
	spy_ru
 {

83 
	msize
, 
	m
, 
	mhd
, 
	mack
, 
	mtch
;

84 
	mg
,
	m
,
	mec1
;

85 } 
	gpy_ty
[] = {

104 
py_u
();

105 
tmp_py_
[1024];

112 
	gcur_ec1
 = -1;

113 
	gcur_
 = -1;

114 
py_ru
 * 
	gpy
 = 
py_ty
;

115 
	gcut_drive
 = 0;

116 
	g
 = 0;

117 
	ghd
 = 0;

118 
	gack
 = 0;

119 
	gek_ack
 = 0;

120 
	gcut_ack
 = 255;

121 
	gcommd
 = 0;

122 
	ged
 = 0;

123 
sk_ru
 * 
	gwa__py_
 = 
NULL
;

125 
	$py_de
(

)

127 i(

 !(
cut_DOR
 & 3))

128 
	`tk
("floppy_deselect: driveot selected\n\r");

129 
ed
 = 0;

130 
	`wake_up
(&
wa__py_
);

131 
	}
}

139 
	$py_chge
(

)

141 

:

142 
	`py_
(

);

143 (
cut_DOR
 & 3!

 && 
ed
)

144 
	`uib_p_
(&
wa__py_
);

145 i((
cut_DOR
 & 3!

)

146 

;

147 i(
	`b
(
FD_DIR
) & 0x80) {

148 
	`py_off
(

);

151 
	`py_off
(

);

153 
	}
}

155 
	#cy_bufr
(
om
,
to
) \

156 
	`__asm__
("cld ;ep ; movsl" \

157 ::"c" (
BLOCK_SIZE
/4),"S" (()(
om
)),"D" (()(
to
)) \

158 :"cx","di","si")

	)

160 
	$tup_DMA
()

162 
addr
 = (
CURRENT
->
bufr
;

164 
	`i
();

165 i(
addr
 >= 0x100000) {

166 
addr
 = (
tmp_py_
;

167 i(
commd
 =
FD_WRITE
)

168 
	`cy_bufr
(
CURRENT
->
bufr
,
tmp_py_
);

171 
	`immoutb_p
(4|2,10);

174 
	`__asm__
("outb %%al,$12\n\tjmp 1f\n1:\tjmp 1f\n1:\t"

176 "a" ((((
commd
 =
FD_READ
)?
DMA_READ
:
DMA_WRITE
)));

178 
	`immoutb_p
(
addr
,4);

179 
addr
 >>= 8;

181 
	`immoutb_p
(
addr
,4);

182 
addr
 >>= 8;

184 
	`immoutb_p
(
addr
,0x81);

186 
	`immoutb_p
(0xff,5);

188 
	`immoutb_p
(3,5);

190 
	`immoutb_p
(0|2,10);

191 
	`i
();

192 
	}
}

194 
	$ouut_by
(
by
)

196 
cou
;

197 
us
;

199 i(
t
)

201 
cou
 = 0 ; counter < 10000 ; counter++) {

202 
us
 = 
	`b_p
(
FD_STATUS
& (
STATUS_READY
 | 
STATUS_DIR
);

203 i(
us
 =
STATUS_READY
) {

204 
	`outb
(
by
,
FD_DATA
);

208 
t
 = 1;

209 
	`tk
("Unableo send byteo FDC\n\r");

210 
	}
}

212 
	$su
()

214 
i
 = 0, 
cou
, 
us
;

216 i(
t
)

218 
cou
 = 0 ; counter < 10000 ; counter++) {

219 
us
 = 
	`b_p
(
FD_STATUS
)&(
STATUS_DIR
|
STATUS_READY
|
STATUS_BUSY
);

220 i(
us
 =
STATUS_READY
)

221  
i
;

222 i(
us
 =(
STATUS_DIR
|
STATUS_READY
|
STATUS_BUSY
)) {

223 i(
i
 >
MAX_REPLIES
)

225 
y_bufr
[
i
++] = 
	`b_p
(
FD_DATA
);

228 
t
 = 1;

229 
	`tk
("Getstatusimes out\n\r");

231 
	}
}

233 
	$bad_p_
()

235 
CURRENT
->
rs
++;

236 i(
CURRENT
->
rs
 > 
MAX_ERRORS
) {

237 
	`py_de
(
cut_drive
);

238 
	`d_que
(0);

240 i(
CURRENT
->
rs
 > 
MAX_ERRORS
/2)

241 
t
 = 1;

243 
lib
 = 1;

244 
	}
}

250 
	$rw_u
()

252 i(
	`su
(!7 || (
ST0
 & 0xf8|| (
ST1
 & 0xbf|| (
ST2
 & 0x73)) {

253 i(
ST1
 & 0x02) {

254 
	`tk
("Driv%d iwreed\n\r",
cut_drive
);

255 
	`py_de
(
cut_drive
);

256 
	`d_que
(0);

258 
	`bad_p_
();

259 
	`do_fd_que
();

262 i(
commd
 =
FD_READ
 && ()(
CURRENT
->
bufr
) >= 0x100000)

263 
	`cy_bufr
(
tmp_py_
,
CURRENT
->
bufr
);

264 
	`py_de
(
cut_drive
);

265 
	`d_que
(1);

266 
	`do_fd_que
();

267 
	}
}

269 
le
 
	$tup_rw_py
()

271 
	`tup_DMA
();

272 
do_py
 = 
rw_u
;

273 
	`ouut_by
(
commd
);

274 
	`ouut_by
(
hd
<<2 | 
cut_drive
);

275 
	`ouut_by
(
ack
);

276 
	`ouut_by
(
hd
);

277 
	`ouut_by
(

);

278 
	`ouut_by
(2);

279 
	`ouut_by
(
py
->

);

280 
	`ouut_by
(
py
->
g
);

281 
	`ouut_by
(0xFF);

282 i(
t
)

283 
	`do_fd_que
();

284 
	}
}

291 
	$ek_u
()

294 
	`ouut_by
(
FD_SENSEI
);

295 i(
	`su
(!2 || (
ST0
 & 0xF8!0x20 || 
ST1
 !
ek_ack
) {

296 
	`bad_p_
();

297 
	`do_fd_que
();

300 
cut_ack
 = 
ST1
;

301 
	`tup_rw_py
();

302 
	}
}

309 
	$sr
()

311 i(
cur_ec1
 !
py
->
ec1
) {

312 
cur_ec1
 = 
py
->
ec1
;

313 
	`ouut_by
(
FD_SPECIFY
);

314 
	`ouut_by
(
cur_ec1
);

315 
	`ouut_by
(6);

317 i(
cur_
 !
py
->

)

318 
	`outb_p
(
cur_
 = 
py
->

,
FD_DCR
);

319 i(
t
) {

320 
	`do_fd_que
();

323 i(!
ek
) {

324 
	`tup_rw_py
();

327 
do_py
 = 
ek_u
;

328 i(
ek_ack
) {

329 
	`ouut_by
(
FD_SEEK
);

330 
	`ouut_by
(
hd
<<2 | 
cut_drive
);

331 
	`ouut_by
(
ek_ack
);

333 
	`ouut_by
(
FD_RECALIBRATE
);

334 
	`ouut_by
(
hd
<<2 | 
cut_drive
);

336 i(
t
)

337 
	`do_fd_que
();

338 
	}
}

343 
	$l_u
()

345 
	`ouut_by
(
FD_SENSEI
);

346 i(
	`su
()!=2 || (
ST0
 & 0xE0) == 0x60)

347 
t
 = 1;

349 
lib
 = 0;

350 
	`do_fd_que
();

351 
	}
}

353 
	$uxed_py_u
()

355 
	`ouut_by
(
FD_SENSEI
);

356 i(
	`su
()!=2 || (
ST0
 & 0xE0) == 0x60)

357 
t
 = 1;

359 
lib
 = 1;

360 
	}
}

362 
	$lib_py
()

364 
lib
 = 0;

365 
cut_ack
 = 0;

366 
do_py
 = 
l_u
;

367 
	`ouut_by
(
FD_RECALIBRATE
);

368 
	`ouut_by
(
hd
<<2 | 
cut_drive
);

369 i(
t
)

370 
	`do_fd_que
();

371 
	}
}

373 
	$t_u
()

375 
	`ouut_by
(
FD_SENSEI
);

376 (
	`su
();

377 
	`ouut_by
(
FD_SPECIFY
);

378 
	`ouut_by
(
cur_ec1
);

379 
	`ouut_by
(6);

380 
	`do_fd_que
();

381 
	}
}

386 
	$t_py
()

388 
i
;

390 
t
 = 0;

391 
cur_ec1
 = -1;

392 
cur_
 = -1;

393 
lib
 = 1;

394 
	`tk
("Reset-floppy called\n\r");

395 
	`i
();

396 
do_py
 = 
t_u
;

397 
	`outb_p
(
cut_DOR
 & ~0x04,
FD_DOR
);

398 
i
=0 ; i<100 ; i++)

399 
	`__asm__
("nop");

400 
	`outb
(
cut_DOR
,
FD_DOR
);

401 
	`i
();

402 
	}
}

404 
	$py__u
()

407 
ed
 = 1;

408 i(
cut_drive
 !(
cut_DOR
 & 3)) {

409 
cut_DOR
 &= 0xFC;

410 
cut_DOR
 |
cut_drive
;

411 
	`outb
(
cut_DOR
,
FD_DOR
);

412 
	`add_tim
(2,&
sr
);

414 
	`sr
();

415 
	}
}

417 
	$do_fd_que
()

419 
block
;

421 
ek
 = 0;

422 i(
t
) {

423 
	`t_py
();

426 i(
lib
) {

427 
	`lib_py
();

430 
INIT_REQUEST
;

431 
py
 = (
	`MINOR
(
CURRENT
->
dev
)>>2+ 
py_ty
;

432 i(
cut_drive
 !
CURRENT_DEV
)

433 
ek
 = 1;

434 
cut_drive
 = 
CURRENT_DEV
;

435 
block
 = 
CURRENT
->

;

436 i(
block
+2 > 
py
->
size
) {

437 
	`d_que
(0);

438 

;

440 

 = 
block
 % 
py
->

;

441 
block
 /
py
->

;

442 
hd
 = 
block
 % 
py
->head;

443 
ack
 = 
block
 / 
py
->
hd
;

444 
ek_ack
 = 
ack
 << 
py
->
tch
;

445 i(
ek_ack
 !
cut_ack
)

446 
ek
 = 1;

447 

++;

448 i(
CURRENT
->
cmd
 =
READ
)

449 
commd
 = 
FD_READ
;

450 i(
CURRENT
->
cmd
 =
WRITE
)

451 
commd
 = 
FD_WRITE
;

453 
	`nic
("do_fd_request: unknown command");

454 
	`add_tim
(
	`ticks_to_py_
(
cut_drive
),&
py__u
);

455 
	}
}

457 
	$py_
()

459 
blk_dev
[
MAJOR_NR
].
que_
 = 
DEVICE_REQUEST
;

460 
	`t__ge
(0x26,&
py_u
);

461 
	`outb
(
	`b_p
(0x21)&~0x40,0x21);

462 
	}
}

	@kernel/blk_drv/hd.c

16 
	~<lux/cfig.h
>

17 
	~<lux/sched.h
>

18 
	~<lux/fs.h
>

19 
	~<lux/kl.h
>

20 
	~<lux/hdg.h
>

21 
	~<asm/syem.h
>

22 
	~<asm/io.h
>

23 
	~<asm/gmt.h
>

25 
	#MAJOR_NR
 3

	)

26 
	~"blk.h
"

28 
	#CMOS_READ
(
addr
) ({ \

29 
	`outb_p
(0x80|
addr
,0x70); \

30 
	`b_p
(0x71); \

31 })

	)

34 
	#MAX_ERRORS
 7

	)

35 
	#MAX_HD
 2

	)

37 
l_
();

39 
	glib
 = 1;

40 
	gt
 = 1;

45 
	shd_i_ru
 {

46 
	mhd
,
	m
,
	mcyl
,
	mwpcom
,
	mlze
,
	ml
;

48 #ifde
HD_TYPE


49 
hd_i_ru
 
	ghd_fo
[] = { 
HD_TYPE
 };

50 
	#NR_HD
 (( (
hd_fo
))/( (
hd_i_ru
)))

	)

52 
hd_i_ru
 
	ghd_fo
[] = { {0,0,0,0,0,0},{0,0,0,0,0,0} };

53 
	gNR_HD
 = 0;

56 
	shd_ru
 {

57 
	mt_
;

58 
	m_s
;

59 } 
	ghd
[5*
MAX_HD
]={{0,0},};

61 
	#pt_ad
(
pt
,
buf
,

) \

62 
	`__asm__
("d;p;sw"::"d" (
pt
),"D" (
buf
),"c" (

):"cx","di")

	)

64 
	#pt_wre
(
pt
,
buf
,

) \

65 
	`__asm__
("d;p;outsw"::"d" (
pt
),"S" (
buf
),"c" (

):"cx","si")

	)

67 
hd_u
();

68 
rd_ld
();

71 
	$sys_tup
(* 
BIOS
)

73 
ab
 = 1;

74 
i
,
drive
;

75 
cmos_disks
;

76 
i
 *
p
;

77 
bufr_hd
 * 
bh
;

79 i(!
ab
)

81 
ab
 = 0;

82 #ide
HD_TYPE


83 
drive
=0 ; drive<2 ; drive++) {

84 
hd_fo
[
drive
].
cyl
 = *(*
BIOS
;

85 
hd_fo
[
drive
].
hd
 = *(*(2+
BIOS
);

86 
hd_fo
[
drive
].
wpcom
 = *(*(5+
BIOS
);

87 
hd_fo
[
drive
].
l
 = *(*(8+
BIOS
);

88 
hd_fo
[
drive
].
lze
 = *(*(12+
BIOS
);

89 
hd_fo
[
drive
].

 = *(*(14+
BIOS
);

90 
BIOS
 += 16;

92 i(
hd_fo
[1].
cyl
)

93 
NR_HD
=2;

95 
NR_HD
=1;

97 
i
=0 ; i<
NR_HD
 ; i++) {

98 
hd
[
i
*5].
t_
 = 0;

99 
hd
[
i
*5].
_s
 = 
hd_fo
[i].
hd
*

100 
hd_fo
[
i
].

*hd_fo[i].
cyl
;

125 i((
cmos_disks
 = 
	`CMOS_READ
(0x12)) & 0xf0)

126 i(
cmos_disks
 & 0x0f)

127 
NR_HD
 = 2;

129 
NR_HD
 = 1;

131 
NR_HD
 = 0;

132 
i
 = 
NR_HD
 ; i < 2 ; i++) {

133 
hd
[
i
*5].
t_
 = 0;

134 
hd
[
i
*5].
_s
 = 0;

136 
drive
=0 ; drive<
NR_HD
 ; drive++) {

137 i(!(
bh
 = 
	`bad
(0x300 + 
drive
*5,0))) {

138 
	`tk
("Unableoeadartitionable of drive %d\n\r",

139 
drive
);

140 
	`nic
("");

142 i(
bh
->
b_da
[510] != 0x55 || ()

143 
bh
->
b_da
[511] != 0xAA) {

144 
	`tk
("Badtiځab odriv%d\n\r",
drive
);

145 
	`nic
("");

147 
p
 = 0x1BE + (*)
bh
->
b_da
;

148 
i
=1;i<5;i++,
p
++) {

149 
hd
[
i
+5*
drive
].
t_
 = 
p
->start_sect;

150 
hd
[
i
+5*
drive
].
_s
 = 
p
->nr_sects;

152 
	`bl
(
bh
);

154 i(
NR_HD
)

155 
	`tk
("Ptiځab%ok.\n\r",(
NR_HD
>1)?"s":"");

156 
	`rd_ld
();

157 
	`mou_ro
();

159 
	}
}

161 
	$cڌr_ady
()

163 
s
=10000;

165 --
s
 && (
	`b_p
(
HD_STATUS
)&0xc0)!=0x40);

166  (
s
);

167 
	}
}

169 
	$w_su
()

171 
i
=
	`b_p
(
HD_STATUS
);

173 i((
i
 & (
BUSY_STAT
 | 
READY_STAT
 | 
WRERR_STAT
 | 
SEEK_STAT
 | 
ERR_STAT
))

174 =(
READY_STAT
 | 
SEEK_STAT
))

176 i(
i
&1i=
	`b
(
HD_ERROR
);

178 
	}
}

180 
hd_out
(
drive
,
n
,

,

181 
hd
,
cyl
,
cmd
,

182 (*
_addr
)())

184 
pt
 
	`asm
("dx");

186 i(
drive
>1 || 
hd
>15)

187 
	`nic
("Tryingo write bad sector");

188 i(!
	`cڌr_ady
())

189 
	`nic
("HD controlleroteady");

190 
do_hd
 = 
_addr
;

191 
	`outb_p
(
hd_fo
[
drive
].
l
,
HD_CMD
);

192 
pt
=
HD_DATA
;

193 
	`outb_p
(
hd_fo
[
drive
].
wpcom
>>2,++
pt
);

194 
	`outb_p
(
n
,++
pt
);

195 
	`outb_p
(

,++
pt
);

196 
	`outb_p
(
cyl
,++
pt
);

197 
	`outb_p
(
cyl
>>8,++
pt
);

198 
	`outb_p
(0xA0|(
drive
<<4)|
hd
,++
pt
);

199 
	`outb
(
cmd
,++
pt
);

200 
	}
}

202 
	$drive_busy
()

204 
i
;

206 
i
 = 0; i < 10000; i++)

207 i(
READY_STAT
 =(
	`b_p
(
HD_STATUS
& (
BUSY_STAT
|READY_STAT)))

209 
i
 = 
	`b
(
HD_STATUS
);

210 
i
 &
BUSY_STAT
 | 
READY_STAT
 | 
SEEK_STAT
;

211 i(
i
 =
READY_STAT
 | 
SEEK_STAT
)

213 
	`tk
("HD controllerimes out\n\r");

215 
	}
}

217 
	$t_cڌr
()

219 
i
;

221 
	`outb
(4,
HD_CMD
);

222 
i
 = 0; i < 100; i++
	`n
();

223 
	`outb
(
hd_fo
[0].
l
 & 0x0,
HD_CMD
);

224 i(
	`drive_busy
())

225 
	`tk
("HD-controller still busy\n\r");

226 i((
i
 = 
	`b
(
HD_ERROR
)) != 1)

227 
	`tk
("HD-cڌ˸ed: %02x\n\r",
i
);

228 
	}
}

230 
	$t_hd
(

)

232 
	`t_cڌr
();

233 
	`hd_out
(

,
hd_fo
[].

,hd_fo[].,hd_fo[].
hd
-1,

234 
hd_fo
[

].
cyl
,
WIN_SPECIFY
,&
l_
);

235 
	}
}

237 
	$uxed_hd_u
()

239 
	`tk
("Unexpected HD interrupt\n\r");

240 
	}
}

242 
	$bad_rw_
()

244 i(++
CURRENT
->
rs
 >
MAX_ERRORS
)

245 
	`d_que
(0);

246 i(
CURRENT
->
rs
 > 
MAX_ERRORS
/2)

247 
t
 = 1;

248 
	}
}

250 
	$ad_
()

252 i(
	`w_su
()) {

253 
	`bad_rw_
();

254 
	`do_hd_que
();

257 
	`pt_ad
(
HD_DATA
,
CURRENT
->
bufr
,256);

258 
CURRENT
->
rs
 = 0;

259 
CURRENT
->
bufr
 += 512;

260 
CURRENT
->

++;

261 i(--
CURRENT
->
_s
) {

262 
do_hd
 = &
ad_
;

265 
	`d_que
(1);

266 
	`do_hd_que
();

267 
	}
}

269 
	$wre_
()

271 i(
	`w_su
()) {

272 
	`bad_rw_
();

273 
	`do_hd_que
();

276 i(--
CURRENT
->
_s
) {

277 
CURRENT
->

++;

278 
CURRENT
->
bufr
 += 512;

279 
do_hd
 = &
wre_
;

280 
	`pt_wre
(
HD_DATA
,
CURRENT
->
bufr
,256);

283 
	`d_que
(1);

284 
	`do_hd_que
();

285 
	}
}

287 
	$l_
()

289 i(
	`w_su
())

290 
	`bad_rw_
();

291 
	`do_hd_que
();

292 
	}
}

294 
	$do_hd_que
()

296 
i
,
r
;

297 
block
,
dev
;

298 
c
,
hd
,
cyl
;

299 
n
;

301 
INIT_REQUEST
;

302 
dev
 = 
	`MINOR
(
CURRENT
->dev);

303 
block
 = 
CURRENT
->

;

304 i(
dev
 >5*
NR_HD
 || 
block
+2 > 
hd
[dev].
_s
) {

305 
	`d_que
(0);

306 

;

308 
block
 +
hd
[
dev
].
t_
;

309 
dev
 /= 5;

310 
	`__asm__
("div%4":"" (
block
),"=d" (
c
):"0" (block),"1" (0),

311 "r" (
hd_fo
[
dev
].

));

312 
	`__asm__
("div%4":"" (
cyl
),"=d" (
hd
):"0" (
block
),"1" (0),

313 "r" (
hd_fo
[
dev
].
hd
));

314 
c
++;

315 
n
 = 
CURRENT
->
_s
;

316 i(
t
) {

317 
t
 = 0;

318 
lib
 = 1;

319 
	`t_hd
(
CURRENT_DEV
);

322 i(
lib
) {

323 
lib
 = 0;

324 
	`hd_out
(
dev
,
hd_fo
[
CURRENT_DEV
].

,0,0,0,

325 
WIN_RESTORE
,&
l_
);

328 i(
CURRENT
->
cmd
 =
WRITE
) {

329 
	`hd_out
(
dev
,
n
,
c
,
hd
,
cyl
,
WIN_WRITE
,&
wre_
);

330 
i
=0 ; i<3000 && !(
r
=
	`b_p
(
HD_STATUS
)&
DRQ_STAT
) ; i++)

332 i(!
r
) {

333 
	`bad_rw_
();

334 

;

336 
	`pt_wre
(
HD_DATA
,
CURRENT
->
bufr
,256);

337 } i(
CURRENT
->
cmd
 =
READ
) {

338 
	`hd_out
(
dev
,
n
,
c
,
hd
,
cyl
,
WIN_READ
,&
ad_
);

340 
	`nic
("unknown hd-command");

341 
	}
}

343 
	$hd_
()

345 
blk_dev
[
MAJOR_NR
].
que_
 = 
DEVICE_REQUEST
;

346 
	`t__ge
(0x2E,&
hd_u
);

347 
	`outb_p
(
	`b_p
(0x21)&0xfb,0x21);

348 
	`outb
(
	`b_p
(0xA1)&0xbf,0xA1);

349 
	}
}

	@kernel/blk_drv/ll_rw_blk.c

10 
	~<o.h
>

11 
	~<lux/sched.h
>

12 
	~<lux/kl.h
>

13 
	~<asm/syem.h
>

15 
	~"blk.h
"

21 
que
 
	gque
[
NR_REQUEST
];

26 
sk_ru
 * 
	gwa_f_que
 = 
NULL
;

32 
blk_dev_ru
 
	gblk_dev
[
NR_BLK_DEV
] = {

33 { 
NULL
, NULL },

34 { 
NULL
, NULL },

35 { 
NULL
, NULL },

36 { 
NULL
, NULL },

37 { 
NULL
, NULL },

38 { 
NULL
, NULL },

39 { 
NULL
, NULL }

42 
le
 
	$lock_bufr
(
bufr_hd
 * 
bh
)

44 
	`i
();

45 
bh
->
b_lock
)

46 
	`p_
(&
bh
->
b_wa
);

47 
bh
->
b_lock
=1;

48 
	`i
();

49 
	}
}

51 
le
 
	$uock_bufr
(
bufr_hd
 * 
bh
)

53 i(!
bh
->
b_lock
)

54 
	`tk
("ll_rw_block.c: bufferotocked\n\r");

55 
bh
->
b_lock
 = 0;

56 
	`wake_up
(&
bh
->
b_wa
);

57 
	}
}

64 
	$add_que
(
blk_dev_ru
 * 
dev
, 
que
 * 
q
)

66 
que
 * 
tmp
;

68 
q
->
xt
 = 
NULL
;

69 
	`i
();

70 i(
q
->
bh
)

71 
q
->
bh
->
b_dt
 = 0;

72 i(!(
tmp
 = 
dev
->
cut_que
)) {

73 
dev
->
cut_que
 = 
q
;

74 
	`i
();

75 (
dev
->
que_
)();

78  ; 
tmp
->
xt
 ;mp=tmp->next)

79 i((
	`IN_ORDER
(
tmp
,
q
) ||

80 !
	`IN_ORDER
(
tmp
,tmp->
xt
)) &&

81 
	`IN_ORDER
(
q
,
tmp
->
xt
))

83 
q
->
xt
=
tmp
->next;

84 
tmp
->
xt
=
q
;

85 
	`i
();

86 
	}
}

88 
	$make_que
(
maj
,
rw
, 
bufr_hd
 * 
bh
)

90 
que
 * 
q
;

91 
rw_ahd
;

95 i(
rw_ahd
 = (
rw
 =
READA
 ||w =
WRITEA
)) {

96 i(
bh
->
b_lock
)

98 i(
rw
 =
READA
)

99 
rw
 = 
READ
;

101 
rw
 = 
WRITE
;

103 i(
rw
!=
READ
 &&w!=
WRITE
)

104 
	`nic
("Bad block dev command, must be R/W/RA/WA");

105 
	`lock_bufr
(
bh
);

106 i((
rw
 =
WRITE
 && !
bh
->
b_dt
|| (rw =
READ
 && bh->
b_uode
)) {

107 
	`uock_bufr
(
bh
);

110 

:

115 i(
rw
 =
READ
)

116 
q
 = 
que
+
NR_REQUEST
;

118 
q
 = 
que
+((
NR_REQUEST
*2)/3);

120 --
q
 >
que
)

121 i(
q
->
dev
<0)

124 i(
q
 < 
que
) {

125 i(
rw_ahd
) {

126 
	`uock_bufr
(
bh
);

129 
	`p_
(&
wa_f_que
);

130 

;

133 
q
->
dev
 = 
bh
->
b_dev
;

134 
q
->
cmd
 = 
rw
;

135 
q
->
rs
=0;

136 
q
->

 = 
bh
->
b_block
<<1;

137 
q
->
_s
 = 2;

138 
q
->
bufr
 = 
bh
->
b_da
;

139 
q
->
wag
 = 
NULL
;

140 
q
->
bh
 = bh;

141 
q
->
xt
 = 
NULL
;

142 
	`add_que
(
maj
+
blk_dev
,
q
);

143 
	}
}

145 
	$_rw_block
(
rw
, 
bufr_hd
 * 
bh
)

147 
maj
;

149 i((
maj
=
	`MAJOR
(
bh
->
b_dev
)>
NR_BLK_DEV
 ||

150 !(
blk_dev
[
maj
].
que_
)) {

151 
	`tk
("Tryingoeadonexistent block-device\n\r");

154 
	`make_que
(
maj
,
rw
,
bh
);

155 
	}
}

157 
	$blk_dev_
()

159 
i
;

161 
i
=0 ; i<
NR_REQUEST
 ; i++) {

162 
que
[
i
].
dev
 = -1;

163 
que
[
i
].
xt
 = 
NULL
;

165 
	}
}

	@kernel/blk_drv/ramdisk.c

7 
	~<rg.h
>

9 
	~<lux/cfig.h
>

10 
	~<lux/sched.h
>

11 
	~<lux/fs.h
>

12 
	~<lux/kl.h
>

13 
	~<asm/syem.h
>

14 
	~<asm/gmt.h
>

15 
	~<asm/memy.h
>

17 
	#MAJOR_NR
 1

	)

18 
	~"blk.h
"

20 *
	grd_t
;

21 
	grd_ngth
 = 0;

23 
	$do_rd_que
()

25 
n
;

26 *
addr
;

28 
INIT_REQUEST
;

29 
addr
 = 
rd_t
 + (
CURRENT
->

 << 9);

30 
n
 = 
CURRENT
->
_s
 << 9;

31 i((
	`MINOR
(
CURRENT
->
dev
!1|| (
addr
+
n
 > 
rd_t
+
rd_ngth
)) {

32 
	`d_que
(0);

33 

;

35 i(
CURRENT
-> 
cmd
 =
WRITE
) {

36 (
	`memy
(
addr
,

37 
CURRENT
->
bufr
,

38 
n
);

39 } i(
CURRENT
->
cmd
 =
READ
) {

40 (
	`memy
(
CURRENT
->
bufr
,

41 
addr
,

42 
n
);

44 
	`nic
("unknownamdisk-command");

45 
	`d_que
(1);

46 

;

47 
	}
}

52 
	$rd_
(
mem_t
, 
ngth
)

54 
i
;

55 *

;

57 
blk_dev
[
MAJOR_NR
].
que_
 = 
DEVICE_REQUEST
;

58 
rd_t
 = (*
mem_t
;

59 
rd_ngth
 = 
ngth
;

60 

 = 
rd_t
;

61 
i
=0; i < 
ngth
; i++)

62 *

++ = '\0';

63 (
ngth
);

64 
	}
}

71 
	$rd_ld
()

73 
bufr_hd
 *
bh
;

74 
sur_block
 
s
;

75 
block
 = 256;

76 
i
 = 1;

77 
nblocks
;

78 *

;

80 i(!
rd_ngth
)

82 
	`tk
("Ram disk: %d bys, sg0x%x\n", 
rd_ngth
,

83 (
rd_t
);

84 i(
	`MAJOR
(
ROOT_DEV
) != 2)

86 
bh
 = 
	`bada
(
ROOT_DEV
,
block
+1,block,block+2,-1);

87 i(!
bh
) {

88 
	`tk
("Diskrror whileooking foramdisk!\n");

91 *((
d_sur_block
 *&
s
*((d_sur_block *
bh
->
b_da
);

92 
	`bl
(
bh
);

93 i(
s
.
s_magic
 !
SUPER_MAGIC
)

96 
nblocks
 = 
s
.
s_nzes
 << s.
s_log_ze_size
;

97 i(
nblocks
 > (
rd_ngth
 >> 
BLOCK_SIZE_BITS
)) {

98 
	`tk
("Ram disk imageoo big! (%d blocks, %dvail)\n",

99 
nblocks
, 
rd_ngth
 >> 
BLOCK_SIZE_BITS
);

102 
	`tk
("Loading %d bytes intoam disk... 0000k",

103 
nblocks
 << 
BLOCK_SIZE_BITS
);

104 

 = 
rd_t
;

105 
nblocks
) {

106 i(
nblocks
 > 2)

107 
bh
 = 
	`bada
(
ROOT_DEV
, 
block
, block+1, block+2, -1);

109 
bh
 = 
	`bad
(
ROOT_DEV
, 
block
);

110 i(!
bh
) {

111 
	`tk
("I/Orror on block %d,bortingoad\n",

112 
block
);

115 (
	`memy
(

, 
bh
->
b_da
, 
BLOCK_SIZE
);

116 
	`bl
(
bh
);

117 
	`tk
("\010\010\010\010\010%4dk",
i
);

118 

 +
BLOCK_SIZE
;

119 
block
++;

120 
nblocks
--;

121 
i
++;

123 
	`tk
("\010\010\010\010\010done \n");

124 
ROOT_DEV
=0x0101;

125 
	}
}

	@kernel/chr_drv/console.c

30 
	~<lux/sched.h
>

31 
	~<lux/y.h
>

32 
	~<asm/io.h
>

33 
	~<asm/syem.h
>

39 
	#ORIG_X
 (*(*)0x90000)

	)

40 
	#ORIG_Y
 (*(*)0x90001)

	)

41 
	#ORIG_VIDEO_PAGE
 (*(*)0x90004)

	)

42 
	#ORIG_VIDEO_MODE
 ((*(*)0x90006& 0xff)

	)

43 
	#ORIG_VIDEO_COLS
 (((*(*)0x90006& 0xff00>> 8)

	)

44 
	#ORIG_VIDEO_LINES
 (25)

	)

45 
	#ORIG_VIDEO_EGA_AX
 (*(*)0x90008)

	)

46 
	#ORIG_VIDEO_EGA_BX
 (*(*)0x9000a)

	)

47 
	#ORIG_VIDEO_EGA_CX
 (*(*)0x9000c)

	)

49 
	#VIDEO_TYPE_MDA
 0x10

	)

50 
	#VIDEO_TYPE_CGA
 0x11

	)

51 
	#VIDEO_TYPE_EGAM
 0x20

	)

52 
	#VIDEO_TYPE_EGAC
 0x21

	)

54 
	#NPAR
 16

	)

56 
keybrd_u
();

58 
	gvideo_ty
;

59 
	gvideo_num_cumns
;

60 
	gvideo_size_row
;

61 
	gvideo_num_les
;

62 
	gvideo_ge
;

63 
	gvideo_mem_t
;

64 
	gvideo_mem_d
;

65 
	gvideo_pt_g
;

66 
	gvideo_pt_v
;

67 
	gvideo_a_ch
;

69 
	gig
;

70 
	gs_d
;

71 
	gpos
;

72 
	gx
,
	gy
;

73 
	gt
,
	gbtom
;

74 
	ge
=0;

75 
	gŬ
,
	gr
[
NPAR
];

76 
	gques
=0;

77 
	g
=0x07;

79 
sysbp
();

85 
	#RESPONSE
 "\033[?1;2c"

	)

88 
le
 
	$goxy
(
w_x
,
w_y
)

90 i(
w_x
 > 
video_num_cumns
 || 
w_y
 >
video_num_les
)

92 
x
=
w_x
;

93 
y
=
w_y
;

94 
pos
=
ig
 + 
y
*
video_size_row
 + (
x
<<1);

95 
	}
}

97 
le
 
	$t_ig
()

99 
	`i
();

100 
	`outb_p
(12, 
video_pt_g
);

101 
	`outb_p
(0xff&((
ig
-
video_mem_t
)>>9), 
video_pt_v
);

102 
	`outb_p
(13, 
video_pt_g
);

103 
	`outb_p
(0xff&((
ig
-
video_mem_t
)>>1), 
video_pt_v
);

104 
	`i
();

105 
	}
}

107 
	$sup
()

109 i(
video_ty
 =
VIDEO_TYPE_EGAC
 || video_ty =
VIDEO_TYPE_EGAM
)

111 i(!
t
 && 
btom
 =
video_num_les
) {

112 
ig
 +
video_size_row
;

113 
pos
 +
video_size_row
;

114 
s_d
 +
video_size_row
;

115 i(
s_d
 > 
video_mem_d
) {

116 
	`__asm__
("cld\n\t"

122 ::"a" (
video_a_ch
),

123 "c" ((
video_num_les
-1)*
video_num_cumns
>>1),

124 "D" (
video_mem_t
),

125 "S" (
ig
)

127 
s_d
 -
ig
-
video_mem_t
;

128 
pos
 -
ig
-
video_mem_t
;

129 
ig
 = 
video_mem_t
;

131 
	`__asm__
("cld\n\t"

134 ::"a" (
video_a_ch
),

135 "c" (
video_num_cumns
),

136 "D" (
s_d
-
video_size_row
)

139 
	`t_ig
();

141 
	`__asm__
("cld\n\t"

147 ::"a" (
video_a_ch
),

148 "c" ((
btom
-
t
-1)*
video_num_cumns
>>1),

149 "D" (
ig
+
video_size_row
*
t
),

150 "S" (
ig
+
video_size_row
*(
t
+1))

156 
	`__asm__
("cld\n\t"

162 ::"a" (
video_a_ch
),

163 "c" ((
btom
-
t
-1)*
video_num_cumns
>>1),

164 "D" (
ig
+
video_size_row
*
t
),

165 "S" (
ig
+
video_size_row
*(
t
+1))

168 
	}
}

170 
	$sdown
()

172 i(
video_ty
 =
VIDEO_TYPE_EGAC
 || video_ty =
VIDEO_TYPE_EGAM
)

174 
	`__asm__
("std\n\t"

181 ::"a" (
video_a_ch
),

182 "c" ((
btom
-
t
-1)*
video_num_cumns
>>1),

183 "D" (
ig
+
video_size_row
*
btom
-4),

184 "S" (
ig
+
video_size_row
*(
btom
-1)-4)

189 
	`__asm__
("std\n\t"

196 ::"a" (
video_a_ch
),

197 "c" ((
btom
-
t
-1)*
video_num_cumns
>>1),

198 "D" (
ig
+
video_size_row
*
btom
-4),

199 "S" (
ig
+
video_size_row
*(
btom
-1)-4)

202 
	}
}

204 
	$lf
()

206 i(
y
+1<
btom
) {

207 
y
++;

208 
pos
 +
video_size_row
;

211 
	`sup
();

212 
	}
}

214 
	$ri
()

216 i(
y
>
t
) {

217 
y
--;

218 
pos
 -
video_size_row
;

221 
	`sdown
();

222 
	}
}

224 
	$
()

226 
pos
 -
x
<<1;

227 
x
=0;

228 
	}
}

230 
	$d
()

232 i(
x
) {

233 
pos
 -= 2;

234 
x
--;

235 *(*)
pos
 = 
video_a_ch
;

237 
	}
}

239 
	$csi_J
(
r
)

241 
cou
 
	`__asm__
("cx");

242 
t
 
	`__asm__
("di");

244 
r
) {

246 
cou
 = (
s_d
-
pos
)>>1;

247 
t
 = 
pos
;

250 
cou
 = (
pos
-
ig
)>>1;

251 
t
 = 
ig
;

254 
cou
 = 
video_num_cumns
 * 
video_num_les
;

255 
t
 = 
ig
;

260 
	`__asm__
("cld\n\t"

263 ::"c" (
cou
),

264 "D" (
t
),"a" (
video_a_ch
)

266 
	}
}

268 
	$csi_K
(
r
)

270 
cou
 
	`__asm__
("cx");

271 
t
 
	`__asm__
("di");

273 
r
) {

275 i(
x
>=
video_num_cumns
)

277 
cou
 = 
video_num_cumns
-
x
;

278 
t
 = 
pos
;

281 
t
 = 
pos
 - (
x
<<1);

282 
cou
 = (
x
<
video_num_cumns
)?x:video_num_columns;

285 
t
 = 
pos
 - (
x
<<1);

286 
cou
 = 
video_num_cumns
;

291 
	`__asm__
("cld\n\t"

294 ::"c" (
cou
),

295 "D" (
t
),"a" (
video_a_ch
)

297 
	}
}

299 
	$csi_m
()

301 
i
;

303 
i
=0;i<=
Ŭ
;i++)

304 
r
[
i
]) {

305 0:

=0x07;;

306 1:

=0x0f;;

307 4:

=0x0f;;

308 7:

=0x70;;

309 27:

=0x07;;

311 
	}
}

313 
le
 
	$t_curs
()

315 
	`i
();

316 
	`outb_p
(14, 
video_pt_g
);

317 
	`outb_p
(0xff&((
pos
-
video_mem_t
)>>9), 
video_pt_v
);

318 
	`outb_p
(15, 
video_pt_g
);

319 
	`outb_p
(0xff&((
pos
-
video_mem_t
)>>1), 
video_pt_v
);

320 
	`i
();

321 
	}
}

323 
	$d
(
y_ru
 * 
y
)

325 * 
p
 = 
RESPONSE
;

327 
	`i
();

328 *
p
) {

329 
	`PUTCH
(*
p
,
y
->
ad_q
);

330 
p
++;

332 
	`i
();

333 
	`cy_to_cooked
(
y
);

334 
	}
}

336 
	$_ch
()

338 
i
=
x
;

339 
tmp
, 
d
 = 
video_a_ch
;

340 * 
p
 = (*
pos
;

342 
i
++<
video_num_cumns
) {

343 
tmp
=*
p
;

344 *
p
=
d
;

345 
d
=
tmp
;

346 
p
++;

348 
	}
}

350 
	$_le
()

352 
dt
,
dbtom
;

354 
dt
=
t
;

355 
dbtom
=
btom
;

356 
t
=
y
;

357 
btom
 = 
video_num_les
;

358 
	`sdown
();

359 
t
=
dt
;

360 
btom
=
dbtom
;

361 
	}
}

363 
	$de_ch
()

365 
i
;

366 * 
p
 = (*
pos
;

368 i(
x
>=
video_num_cumns
)

370 
i
 = 
x
;

371 ++
i
 < 
video_num_cumns
) {

372 *
p
 = *(p+1);

373 
p
++;

375 *
p
 = 
video_a_ch
;

376 
	}
}

378 
	$de_le
()

380 
dt
,
dbtom
;

382 
dt
=
t
;

383 
dbtom
=
btom
;

384 
t
=
y
;

385 
btom
 = 
video_num_les
;

386 
	`sup
();

387 
t
=
dt
;

388 
btom
=
dbtom
;

389 
	}
}

391 
	$csi_
(

)

393 i(

 > 
video_num_cumns
)

394 

 = 
video_num_cumns
;

395 i(!

)

396 

 = 1;

397 

--)

398 
	`_ch
();

399 
	}
}

401 
	$csi_L
(

)

403 i(

 > 
video_num_les
)

404 

 = 
video_num_les
;

405 i(!

)

406 

 = 1;

407 

--)

408 
	`_le
();

409 
	}
}

411 
	$csi_P
(

)

413 i(

 > 
video_num_cumns
)

414 

 = 
video_num_cumns
;

415 i(!

)

416 

 = 1;

417 

--)

418 
	`de_ch
();

419 
	}
}

421 
	$csi_M
(

)

423 i(

 > 
video_num_les
)

424 

 = 
video_num_les
;

425 i(!

)

426 

=1;

427 

--)

428 
	`de_le
();

429 
	}
}

431 
	gved_x
=0;

432 
	gved_y
=0;

434 
	$ve_cur
()

436 
ved_x
=
x
;

437 
ved_y
=
y
;

438 
	}
}

440 
	$e_cur
()

442 
	`goxy
(
ved_x
, 
ved_y
);

443 
	}
}

445 
	$c_wre
(
y_ru
 * 
y
)

447 

;

448 
c
;

450 

 = 
	`CHARS
(
y
->
wre_q
);

451 

--) {

452 
	`GETCH
(
y
->
wre_q
,
c
);

453 
e
) {

455 i(
c
>31 && c<127) {

456 i(
x
>=
video_num_cumns
) {

457 
x
 -
video_num_cumns
;

458 
pos
 -
video_size_row
;

459 
	`lf
();

461 
	`__asm__
("movb _attr,%%ah\n\t"

463 ::"a" (
c
),"m" (*(*)
pos
)

465 
pos
 += 2;

466 
x
++;

467 } i(
c
==27)

468 
e
=1;

469 i(
c
==10 || c==11 || c==12)

470 
	`lf
();

471 i(
c
==13)

472 
	`
();

473 i(
c
==
	`ERASE_CHAR
(
y
))

474 
	`d
();

475 i(
c
==8) {

476 i(
x
) {

477 
x
--;

478 
pos
 -= 2;

480 } i(
c
==9) {

481 
c
=8-(
x
&7);

482 
x
 +
c
;

483 
pos
 +
c
<<1;

484 i(
x
>
video_num_cumns
) {

485 
x
 -
video_num_cumns
;

486 
pos
 -
video_size_row
;

487 
	`lf
();

489 
c
=9;

490 } i(
c
==7)

491 
	`sysbp
();

494 
e
=0;

495 i(
c
=='[')

496 
e
=2;

497 i(
c
=='E')

498 
	`goxy
(0,
y
+1);

499 i(
c
=='M')

500 
	`ri
();

501 i(
c
=='D')

502 
	`lf
();

503 i(
c
=='Z')

504 
	`d
(
y
);

505 i(
x
=='7')

506 
	`ve_cur
();

507 i(
x
=='8')

508 
	`e_cur
();

511 
Ŭ
=0;Ŭ<
NPAR
;npar++)

512 
r
[
Ŭ
]=0;

513 
Ŭ
=0;

514 
e
=3;

515 i(
ques
=(
c
=='?'))

518 i(
c
==';' && 
Ŭ
<
NPAR
-1) {

519 
Ŭ
++;

521 } i(
c
>='0' && c<='9') {

522 
r
[
Ŭ
]=10*r[Ŭ]+
c
-'0';

524 } 
e
=4;

526 
e
=0;

527 
c
) {

529 i(
r
[0])ar[0]--;

530 
	`goxy
(
r
[0],
y
);

533 i(!
r
[0])ar[0]++;

534 
	`goxy
(
x
,
y
-
r
[0]);

537 i(!
r
[0])ar[0]++;

538 
	`goxy
(
x
,
y
+
r
[0]);

541 i(!
r
[0])ar[0]++;

542 
	`goxy
(
x
+
r
[0],
y
);

545 i(!
r
[0])ar[0]++;

546 
	`goxy
(
x
-
r
[0],
y
);

549 i(!
r
[0])ar[0]++;

550 
	`goxy
(0,
y
+
r
[0]);

553 i(!
r
[0])ar[0]++;

554 
	`goxy
(0,
y
-
r
[0]);

557 i(
r
[0])ar[0]--;

558 
	`goxy
(
x
,
r
[0]);

561 i(
r
[0])ar[0]--;

562 i(
r
[1])ar[1]--;

563 
	`goxy
(
r
[1],par[0]);

566 
	`csi_J
(
r
[0]);

569 
	`csi_K
(
r
[0]);

572 
	`csi_L
(
r
[0]);

575 
	`csi_M
(
r
[0]);

578 
	`csi_P
(
r
[0]);

581 
	`csi_
(
r
[0]);

584 
	`csi_m
();

587 i(
r
[0])ar[0]--;

588 i(!
r
[1]r[1] = 
video_num_les
;

589 i(
r
[0] <ar[1] &&

590 
r
[1] <
video_num_les
) {

591 
t
=
r
[0];

592 
btom
=
r
[1];

596 
	`ve_cur
();

599 
	`e_cur
();

604 
	`t_curs
();

605 
	}
}

617 
	$c_
()

619 
a
;

620 *
diy_desc
 = "????";

621 *
diy_r
;

623 
video_num_cumns
 = 
ORIG_VIDEO_COLS
;

624 
video_size_row
 = 
video_num_cumns
 * 2;

625 
video_num_les
 = 
ORIG_VIDEO_LINES
;

626 
video_ge
 = 
ORIG_VIDEO_PAGE
;

627 
video_a_ch
 = 0x0720;

629 i(
ORIG_VIDEO_MODE
 == 7)

631 
video_mem_t
 = 0xb0000;

632 
video_pt_g
 = 0x3b4;

633 
video_pt_v
 = 0x3b5;

634 i((
ORIG_VIDEO_EGA_BX
 & 0xff) != 0x10)

636 
video_ty
 = 
VIDEO_TYPE_EGAM
;

637 
video_mem_d
 = 0xb8000;

638 
diy_desc
 = "EGAm";

642 
video_ty
 = 
VIDEO_TYPE_MDA
;

643 
video_mem_d
 = 0xb2000;

644 
diy_desc
 = "*MDA";

649 
video_mem_t
 = 0xb8000;

650 
video_pt_g
 = 0x3d4;

651 
video_pt_v
 = 0x3d5;

652 i((
ORIG_VIDEO_EGA_BX
 & 0xff) != 0x10)

654 
video_ty
 = 
VIDEO_TYPE_EGAC
;

655 
video_mem_d
 = 0xbc000;

656 
diy_desc
 = "EGAc";

660 
video_ty
 = 
VIDEO_TYPE_CGA
;

661 
video_mem_d
 = 0xba000;

662 
diy_desc
 = "*CGA";

668 
diy_r
 = ((*)
video_mem_t
+ 
video_size_row
 - 8;

669 *
diy_desc
)

671 *
diy_r
++ = *
diy_desc
++;

672 
diy_r
++;

677 
ig
 = 
video_mem_t
;

678 
s_d
 = 
video_mem_t
 + 
video_num_les
 * 
video_size_row
;

679 
t
 = 0;

680 
btom
 = 
video_num_les
;

682 
	`goxy
(
ORIG_X
,
ORIG_Y
);

683 
	`t__ge
(0x21,&
keybrd_u
);

684 
	`outb_p
(
	`b_p
(0x21)&0xfd,0x21);

685 
a
=
	`b_p
(0x61);

686 
	`outb_p
(
a
|0x80,0x61);

687 
	`outb
(
a
,0x61);

688 
	}
}

691 
	$sysbp
()

694 
	`outb
(
	`b_p
(0x61)&0xFC, 0x61);

695 
	}
}

697 
	gbpcou
 = 0;

699 
	$sysbp
()

702 
	`outb_p
(
	`b_p
(0x61)|3, 0x61);

704 
	`outb_p
(0xB6, 0x43);

706 
	`outb_p
(0x37, 0x42);

707 
	`outb
(0x06, 0x42);

709 
bpcou
 = 
HZ
/8;

710 
	}
}

	@kernel/chr_drv/keyboard.S

13 
	~<lux/cfig.h
>

15 .
	gxt


16 .
globl
 
_keybrd_u


21 
	gsize
 = 1024

23 
hd
 = 4

24 

 = 8

25 
oc_li
 = 12

26 
buf
 = 16

28 
mode
: .
by
 0

29 
ds
: .
by
 2

30 
e0
: .
by
 0

37 
_keybrd_u
:

38 
pushl
 %
x


39 
pushl
 %
ebx


40 
pushl
 %
ecx


41 
pushl
 %
edx


42 
push
 %
ds


43 
push
 %
es


44 
movl
 
$0x10
,%
x


45 
	gmov
 %
	gax
,%
ds


46 
	gmov
 %
	gax
,%
es


47 
	gxl
 %
	g
,%



48 
b
 
	g$0x60
,%



49 
cmpb
 
	g$0xe0
,%



50 
je
 
t_e0


51 
cmpb
 
	g$0xe1
,%



52 
je
 
t_e1


53 

 
key_b
(,%
x
,4)

54 
movb
 
	g$0
,
e0


55 
	ge0_e1
: 
b
 
$0x61
,%



56 
	gjmp
 1f

57 1: 
jmp
 1f

58 1: 
b
 
$0x80
,%



59 
	gjmp
 1f

60 1: 
jmp
 1f

61 1: 
outb
 %

,
$0x61


62 
	gjmp
 1f

63 1: 
jmp
 1f

64 1: 
db
 
$0x7F
,%



65 
	goutb
 %
	g
,
$0x61


66 
movb
 
	g$0x20
,%



67 
	goutb
 %
	g
,
$0x20


68 
pushl
 
$0


69 

 
_do_y_u


70 
addl
 
	g$4
,%
e


71 
	gp
 %
es


72 
	gp
 %
ds


73 
	gpl
 %
edx


74 
	gpl
 %
ecx


75 
	gpl
 %
ebx


76 
	gpl
 %
x


77 



78 
	gt_e0
: 
movb
 
$1
,
e0


79 
jmp
 
e0_e1


80 
	gt_e1
: 
movb
 
$2
,
e0


81 
jmp
 
e0_e1


88 
	gput_queue
:

89 
pushl
 %
ecx


90 
pushl
 %
edx


91 
movl
 
_b_li
,%
	gedx
 #ad-
queue
 
cse


92 
movl
 
hd
(%
edx
),%
	gecx


93 1: 
movb
 %

,
buf
(%
edx
,%
ecx
)

94 
	g
 %
ecx


95 
dl
 
	g$size
-1,%
ecx


96 
cm
 

(%
edx
),%
	gecx
 #buf
	gfu
 - 
disrd
 
evythg


97 
	gje
 3f

98 
shrdl
 
	g$8
,%
	gebx
,%
x


99 
	gje
 2f

100 
sh
 
	g$8
,%
ebx


101 
	gjmp
 1b

102 2: 
movl
 %
ecx
,
hd
(%
edx
)

103 
movl
 
oc_li
(%
edx
),%
ecx


104 
	gl
 %
	gecx
,%
ecx


105 
	gje
 3f

106 
movl
 
	g$0
,(%
	gecx
)

107 3: 
pl
 %
edx


108 
pl
 %
ecx


109 
t


111 

: 
movb
 
$0x04
,%



112 
	gjmp
 1f

113 
	gt
: 
movb
 
$0x10
,%
	g


114 1: 
cmpb
 
$0
,
e0


115 
	gje
 2f

116 
	gaddb
 %
	g
,%al

117 2: 
b
 %

,
mode


118 
t


119 
	gun
: 
movb
 
$0x04
,%



120 
	gjmp
 1f

121 
	gu
: 
movb
 
$0x10
,%
	g


122 1: 
cmpb
 
$0
,
e0


123 
	gje
 2f

124 
	gaddb
 %
	g
,%al

125 2: 
nb
 %



126 
db
 %

,
mode


127 
t


129 
	glshi
:

130 
b
 
$0x01
,
mode


131 
t


132 
	gushi
:

133 
db
 
$0x
,
mode


134 
t


135 
	grshi
:

136 
b
 
$0x02
,
mode


137 
t


138 
	gushi
:

139 
db
 
$0xfd
,
mode


140 
t


142 
	gps
: 
b
 
$0x80
,
mode


143 
	gj
 1f

144 
xb
 
	g$4
,
ds


145 
xb
 
	g$0x40
,
mode


146 
b
 
	g$0x80
,
mode


147 
	gt_ds
:

148 

 
kb_wa


149 
movb
 
$0xed
,%



150 
	goutb
 %
	g
,
$0x60


151 

 
kb_wa


152 
movb
 
	gds
,%



153 
	goutb
 %
	g
,
$0x60


154 
t


155 
	gunps
: 
db
 
$0x7f
,
mode


156 
t


157 
	gsl
:

158 
xb
 
$1
,
ds


159 
jmp
 
t_ds


160 
	gnum
: 
xb
 
$2
,
ds


161 
jmp
 
t_ds


167 
	gcurs
:

168 
subb
 
$0x47
,%



169 
	gjb
 1f

170 
cmpb
 
	g$12
,%



171 
	gja
 1f

172 
j
 
cur2


173 
b
 
	g$0x0c
,
mode


174 
je
 
cur2


175 
b
 
	g$0x30
,
mode


176 
j
 
bo


177 
	gcur2
: 
cmpb
 
$0x01
,
e0


178 
je
 
cur


179 
b
 
	g$0x02
,
ds


180 
je
 
cur


181 
b
 
	g$0x03
,
mode


182 
j
 
cur


183 
	gxl
 %
	gebx
,%
ebx


184 
movb
 
num_b
(%
x
),%



185 
jmp
 
	gput_queue


186 1: 
t


188 
cur
: 
movb
 
cur_b
(%
x
),%



189 
cmpb
 
	g$
'9,%al

190 
ja
 
ok_cur


191 
movb
 
	g$
'~,%ah

192 
	gok_cur
: 
sh
 
$16
,%
x


193 
movw
 
	g$0x5b1b
,%
ax


194 
	gxl
 %
	gebx
,%
ebx


195 
jmp
 
	gput_queue


197 #i
defed
(
KBD_FR
)

198 
	gnum_b
:

199 .
ascii
 "789 456 1230."

201 
num_b
:

202 .
ascii
 "789 456 1230,"

204 
cur_b
:

205 .
ascii
 "HA5 DGC YB623"

210 
func
:

211 
pushl
 %
x


212 
pushl
 %
ecx


213 
pushl
 %
edx


214 

 
_show_


215 
pl
 %
edx


216 
pl
 %
ecx


217 
pl
 %
x


218 
subb
 
$0x3B
,%



219 
jb
 
d_func


220 
cmpb
 
	g$9
,%



221 
jbe
 
ok_func


222 
subb
 
	g$18
,%



223 
cmpb
 
	g$10
,%



224 
jb
 
d_func


225 
cmpb
 
	g$11
,%



226 
ja
 
d_func


227 
	gok_func
:

228 
cm
 
$4
,%
ecx


229 
jl
 
d_func


230 
movl
 
func_b
(,%
x
,4),%eax

231 
	gxl
 %
	gebx
,%
ebx


232 
jmp
 
put_queue


233 
	gd_func
:

234 
t


239 
func_b
:

244 #if 
defed
(
KBD_FINNISH
)

245 
	gkey_m
:

246 .
by
 0,27

247 .
	gascii
 "1234567890+'"

248 .
	gby
 127,9

249 .
	gascii
 "qwertyuiop}"

250 .
	gby
 0,13,0

251 .
	gascii
 "asdfghjkl|{"

252 .
	gby
 0,0

253 .
	gascii
 "'zxcvbnm,.-"

254 .
	gby
 0,'*,0,32 /* 36-39 */

255 .
	gfl
 16,1,0

256 .
	gby
 '-,0,0,0,'+

257 .
	gby
 0,0,0,0,0,0,0

258 .
	gby
 '<

259 .
	gfl
 10,1,0

261 
	gshi_m
:

262 .
by
 0,27

263 .
	gascii
 "!\"#$%&/()=?`"

264 .
	gby
 127,9

265 .
	gascii
 "QWERTYUIOP]^"

266 .
	gby
 13,0

267 .
	gascii
 "ASDFGHJKL\\["

268 .
	gby
 0,0

269 .
	gascii
 "*ZXCVBNM;:_"

270 .
	gby
 0,'*,0,32 /* 36-39 */

271 .
	gfl
 16,1,0

272 .
	gby
 '-,0,0,0,'+

273 .
	gby
 0,0,0,0,0,0,0

274 .
	gby
 '>

275 .
	gfl
 10,1,0

277 
	gt_m
:

278 .
by
 0,0

279 .
	gascii
 "\0@\0$\0\0{[]}\\\0"

280 .
	gby
 0,0

281 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

282 .
	gby
 '~,13,0

283 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

284 .
	gby
 0,0

285 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

286 .
	gby
 0,0,0,0

287 .
	gfl
 16,1,0

288 .
	gby
 0,0,0,0,0

289 .
	gby
 0,0,0,0,0,0,0

290 .
	gby
 '|

291 .
	gfl
 10,1,0

293 #i
defed
(
KBD_US
)

295 
	gkey_m
:

296 .
by
 0,27

297 .
	gascii
 "1234567890-="

298 .
	gby
 127,9

299 .
	gascii
 "qwertyuiop[]"

300 .
	gby
 13,0

301 .
	gascii
 "asdfghjkl;'"

302 .
	gby
 '`,0

303 .
	gascii
 "\\zxcvbnm,./"

304 .
	gby
 0,'*,0,32 /* 36-39 */

305 .
	gfl
 16,1,0

306 .
	gby
 '-,0,0,0,'+

307 .
	gby
 0,0,0,0,0,0,0

308 .
	gby
 '<

309 .
	gfl
 10,1,0

312 
	gshi_m
:

313 .
by
 0,27

314 .
	gascii
 "!@#$%^&*()_+"

315 .
	gby
 127,9

316 .
	gascii
 "QWERTYUIOP{}"

317 .
	gby
 13,0

318 .
	gascii
 "ASDFGHJKL:\""

319 .
	gby
 '~,0

320 .
	gascii
 "|ZXCVBNM<>?"

321 .
	gby
 0,'*,0,32 /* 36-39 */

322 .
	gfl
 16,1,0

323 .
	gby
 '-,0,0,0,'+

324 .
	gby
 0,0,0,0,0,0,0

325 .
	gby
 '>

326 .
	gfl
 10,1,0

328 
	gt_m
:

329 .
by
 0,0

330 .
	gascii
 "\0@\0$\0\0{[]}\\\0"

331 .
	gby
 0,0

332 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

333 .
	gby
 '~,13,0

334 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

335 .
	gby
 0,0

336 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

337 .
	gby
 0,0,0,0

338 .
	gfl
 16,1,0

339 .
	gby
 0,0,0,0,0

340 .
	gby
 0,0,0,0,0,0,0

341 .
	gby
 '|

342 .
	gfl
 10,1,0

344 #i
defed
(
KBD_GR
)

346 
	gkey_m
:

347 .
by
 0,27

348 .
	gascii
 "1234567890\\'"

349 .
	gby
 127,9

350 .
	gascii
 "qwertzuiop@+"

351 .
	gby
 13,0

352 .
	gascii
 "asdfghjkl[]^"

353 .
	gby
 0,'#

354 .
	gascii
 "yxcvbnm,.-"

355 .
	gby
 0,'*,0,32 /* 36-39 */

356 .
	gfl
 16,1,0

357 .
	gby
 '-,0,0,0,'+

358 .
	gby
 0,0,0,0,0,0,0

359 .
	gby
 '<

360 .
	gfl
 10,1,0

363 
	gshi_m
:

364 .
by
 0,27

365 .
	gascii
 "!\"#$%&/()=?`"

366 .
	gby
 127,9

367 .
	gascii
 "QWERTZUIOP\\*"

368 .
	gby
 13,0

369 .
	gascii
 "ASDFGHJKL{}~"

370 .
	gby
 0,''

371 .
	gascii
 "YXCVBNM;:_"

372 .
	gby
 0,'*,0,32 /* 36-39 */

373 .
	gfl
 16,1,0

374 .
	gby
 '-,0,0,0,'+

375 .
	gby
 0,0,0,0,0,0,0

376 .
	gby
 '>

377 .
	gfl
 10,1,0

379 
	gt_m
:

380 .
by
 0,0

381 .
	gascii
 "\0@\0$\0\0{[]}\\\0"

382 .
	gby
 0,0

383 .
	gby
 '@,0,0,0,0,0,0,0,0,0,0

384 .
	gby
 '~,13,0

385 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

386 .
	gby
 0,0

387 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

388 .
	gby
 0,0,0,0

389 .
	gfl
 16,1,0

390 .
	gby
 0,0,0,0,0

391 .
	gby
 0,0,0,0,0,0,0

392 .
	gby
 '|

393 .
	gfl
 10,1,0

396 #i
defed
(
KBD_FR
)

398 
	gkey_m
:

399 .
by
 0,27

400 .
	gascii
 "&{\"'(-}_/@)="

401 .
	gby
 127,9

402 .
	gascii
 "azertyuiop^$"

403 .
	gby
 13,0

404 .
	gascii
 "qsdfghjklm|"

405 .
	gby
 '`,0,42 /* co sugauche, d'
t
 
	gknow
, [*|
mu
] */

406 .
	gascii
 "wxcvbn,;:!"

407 .
	gby
 0,'*,0,32 /* 36-39 */

408 .
	gfl
 16,1,0

409 .
	gby
 '-,0,0,0,'+

410 .
	gby
 0,0,0,0,0,0,0

411 .
	gby
 '<

412 .
	gfl
 10,1,0

414 
	gshi_m
:

415 .
by
 0,27

416 .
	gascii
 "1234567890]+"

417 .
	gby
 127,9

418 .
	gascii
 "AZERTYUIOP<>"

419 .
	gby
 13,0

420 .
	gascii
 "QSDFGHJKLM%"

421 .
	gby
 '~,0,'#
.
	gascii
 "WXCVBN?./\\"

422 .
	gby
 0,'*,0,32 /* 36-39 */

423 .
	gfl
 16,1,0

424 .
	gby
 '-,0,0,0,'+

425 .
	gby
 0,0,0,0,0,0,0

426 .
	gby
 '>

427 .
	gfl
 10,1,0

429 
	gt_m
:

430 .
by
 0,0

431 .
	gascii
 "\0~#{[|`\\^@]}"

432 .
	gby
 0,0

433 .
	gby
 '@,0,0,0,0,0,0,0,0,0,0

434 .
	gby
 '~,13,0

435 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

436 .
	gby
 0,0

437 .
	gby
 0,0,0,0,0,0,0,0,0,0,0

438 .
	gby
 0,0,0,0

439 .
	gfl
 16,1,0

440 .
	gby
 0,0,0,0,0

441 .
	gby
 0,0,0,0,0,0,0

442 .
	gby
 '|

443 .
	gfl
 10,1,0

452 
	gdo_lf
:

453 
a
 
t_m
,%
ebx


454 
b
 
	g$0x20
,
mode


455 
	gj
 1f

456 
a
 
	gshi_m
,%
ebx


457 
b
 
	g$0x03
,
mode


458 
	gj
 1f

459 
a
 
	gkey_m
,%
	gebx


460 1: 
movb
 (%
ebx
,%
x
),%



461 
	gb
 %
	g
,%



462 
je
 
ne


463 
b
 
	g$0x4c
,
mode


464 
	gje
 2f

465 
cmpb
 
	g$
'a,%al

466 
	gjb
 2f

467 
cmpb
 
	g$
'},%al

468 
	gja
 2f

469 
subb
 
	g$32
,%
	g


470 2: 
b
 
$0x0c
,
mode


471 
	gje
 3f

472 
cmpb
 
	g$64
,%



473 
	gjb
 3f

474 
cmpb
 
	g$64
+32,%



475 
	gj
 3f

476 
subb
 
	g$64
,%
	g


477 3: 
b
 
$0x10
,
mode


478 
	gje
 4f

479 
b
 
	g$0x80
,%
	g


480 4: 
dl
 
$0xff
,%
x


481 
	gxl
 %
	gebx
,%
ebx


482 

 
put_queue


483 
	gne
: 
t


490 
mus
: 
cmpb
 
$1
,
e0


491 
j
 
do_lf


492 
movl
 
	g$
'/,%eax

493 
	gxl
 %
	gebx
,%
ebx


494 
jmp
 
put_queue


501 
	gkey_b
:

502 .
ne
,
	gdo_lf
,do_self,do_self

503 .
	gdo_lf
,do_self,do_self,do_self

504 .
	gdo_lf
,do_self,do_self,do_self

505 .
	gdo_lf
,do_self,do_self,do_self

506 .
	gdo_lf
,do_self,do_self,do_self

507 .
	gdo_lf
,do_self,do_self,do_self

508 .
	gdo_lf
,do_self,do_self,do_self

509 .
	gdo_lf
,
	g
,do_self,do_self

510 .
	gdo_lf
,do_self,do_self,do_self

511 .
	gdo_lf
,do_self,do_self,do_self

512 .
	gdo_lf
,do_lf,
	glshi
,do_self

513 .
	gdo_lf
,do_self,do_self,do_self

514 .
	gdo_lf
,do_self,do_self,do_self

515 .
	gdo_lf
,
	gmus
,
	grshi
,do_self

516 .
	gt
,
	gdo_lf
,
	gps
,
	gfunc


517 .
	gfunc
,func,func,func

518 .
	gfunc
,func,func,func

519 .
	gfunc
,
	gnum
,
	gsl
,
	gcurs


520 .
	gcurs
,curs,
	gdo_lf
,cursor

521 .
	gcurs
,curs,
	gdo_lf
,cursor

522 .
	gcurs
,cursor,cursor,cursor

523 .
	gne
,ne,
	gdo_lf
,
	gfunc


524 .
	gfunc
,
	gne
,none,none

525 .
	gne
,none,none,none

526 .
	gne
,none,none,none

527 .
	gne
,none,none,none

528 .
	gne
,none,none,none

529 .
	gne
,none,none,none

530 .
	gne
,none,none,none

531 .
	gne
,none,none,none

532 .
	gne
,none,none,none

533 .
	gne
,none,none,none

534 .
	gne
,none,none,none

535 .
	gne
,none,none,none

536 .
	gne
,none,none,none

537 .
	gne
,none,none,none

538 .
	gne
,none,none,none

539 .
	gne
,none,none,none

540 .
	gne
,none,none,none

541 .
	gne
,
	gun
,none,none

542 .
	gne
,none,none,none

543 .
	gne
,none,none,none

544 .
	gne
,ne,
	gushi
,none

545 .
	gne
,none,none,none

546 .
	gne
,none,none,none

547 .
	gne
,ne,
	gushi
,none

548 .
	gu
,
	gne
,
	gunps
,none

549 .
	gne
,none,none,none

550 .
	gne
,none,none,none

551 .
	gne
,none,none,none

552 .
	gne
,none,none,none

553 .
	gne
,none,none,none

554 .
	gne
,none,none,none

555 .
	gne
,none,none,none

556 .
	gne
,none,none,none

557 .
	gne
,none,none,none

558 .
	gne
,none,none,none

559 .
	gne
,none,none,none

560 .
	gne
,none,none,none

561 .
	gne
,none,none,none

562 .
	gne
,none,none,none

563 .
	gne
,none,none,none

564 .
	gne
,none,none,none

565 .
	gne
,ne,ne,
ne


571 
	gkb_wa
:

572 
pushl
 %
x


573 1: 
b
 
$0x64
,%



574 
b
 
	g$0x02
,%



575 
	gj
 1b

576 
	gpl
 %
x


577 
t


582 
	gbo
:

583 

 
kb_wa


584 
movw
 
$0x1234
,0x472

585 
movb
 
	g$0xfc
,%



586 
	goutb
 %
	g
,
$0x64


587 
	gd
: 
jmp
 
d


	@kernel/chr_drv/rs_io.s

13 .
	gxt


14 .
globl
 
	g_rs1_u
,
_rs2_u


16 
	gsize
 = 1024

21 
rs_addr
 = 0

22 
hd
 = 4

23 

 = 8

24 
oc_li
 = 12

25 
buf
 = 16

27 
tup
 = 256

33 .
ign
 2

34 
_rs1_u
:

35 
pushl
 
$_b_li
+8

36 
jmp
 
rs_t


37 .
ign
 2

38 
_rs2_u
:

39 
pushl
 
$_b_li
+16

40 
rs_t
:

41 
pushl
 %
edx


42 
pushl
 %
ecx


43 
pushl
 %
ebx


44 
pushl
 %
x


45 
push
 %
es


46 
push
 %
ds


47 
pushl
 
$0x10


48 
p
 %
ds


49 
pushl
 
$0x10


50 
p
 %
es


51 
movl
 24(%
e
),%
edx


52 
movl
 (%
edx
),%edx

53 
movl
 
rs_addr
(%
edx
),%edx

54 
addl
 
	g$2
,%
edx


55 
	gp_t
:

56 
xl
 %
x
,%eax

57 
	gb
 %
	gdx
,%



58 
b
 
	g$1
,%



59 
j
 
d


60 
cmpb
 
	g$6
,%



61 
ja
 
d


62 
	gmovl
 24(%
	ge
),%
ecx


63 
	gpushl
 %
edx


64 
subl
 
	g$2
,%
edx


65 

 
jmp_b
(,%
x
,2)

66 
	gpl
 %
edx


67 
jmp
 
p_t


68 
	gd
: 
movb
 
$0x20
,%



69 
	goutb
 %
	g
,
$0x20


70 
	gp
 %
ds


71 
	gp
 %
es


72 
	gpl
 %
x


73 
	gpl
 %
ebx


74 
	gpl
 %
ecx


75 
	gpl
 %
edx


76 
addl
 
	g$4
,%
	ge
 #jum
ov
 
_b_li
 
y


77 



79 
	gjmp_b
:

80 .
modem_us
,
	gwre_ch
,
	gad_ch
,
	gle_us


82 .
	gign
 2

83 
	gmodem_us
:

84 
addl
 
$6
,%
edx


85 
	gb
 %
	gdx
,%



86 
	gt


88 .
	gign
 2

89 
	gle_us
:

90 
addl
 
$5
,%
edx


91 
	gb
 %
	gdx
,%



92 
	gt


94 .
	gign
 2

95 
	gad_ch
:

96 
b
 %
dx
,%



97 
	gmovl
 %
	gecx
,%
edx


98 
subl
 
	g$_b_li
,%
edx


99 
sh
 
	g$3
,%
edx


100 
movl
 (%
ecx
),%
	gecx
 #ad-
queue


101 
movl
 
hd
(%
ecx
),%
ebx


102 
	gmovb
 %
	g
,
buf
(%
ecx
,%
ebx
)

103 
	g
 %
ebx


104 
dl
 
	g$size
-1,%
ebx


105 
cm
 

(%
ecx
),%
ebx


106 
	gje
 1f

107 
	gmovl
 %
	gebx
,
hd
(%
ecx
)

108 1: 
pushl
 %
edx


109 

 
_do_y_u


110 
addl
 
$4
,%
e


111 
	gt


113 .
	gign
 2

114 
	gwre_ch
:

115 
movl
 4(%
ecx
),%
	gecx
 #wre-
queue


116 
movl
 
hd
(%
ecx
),%
ebx


117 
subl
 

(%
ecx
),%
ebx


118 
dl
 
	g$size
-1,%
	gebx
 # 
chs
 

 
queue


119 
je
 
wre_bufr_emy


120 
cm
 
	g$tup
,%
ebx


121 
	gja
 1f

122 
movl
 
oc_li
(%
ecx
),%
	gebx
 #wak
up
 
pg
 
oss


123 
	gl
 %
	gebx
,%ebx #i
the
 
	gy
?

124 
	gje
 1f

125 
movl
 
	g$0
,(%
	gebx
)

126 1: 
movl
 

(%
ecx
),%
ebx


127 
movb
 
buf
(%
ecx
,%
ebx
),%



128 
	goutb
 %
	g
,%
dx


129 
	g
 %
ebx


130 
dl
 
	g$size
-1,%
ebx


131 
	gmovl
 %
	gebx
,

(%
ecx
)

132 
cm
 
hd
(%
ecx
),%
ebx


133 
je
 
wre_bufr_emy


134 
	gt


135 .
	gign
 2

136 
	gwre_bufr_emy
:

137 
movl
 
oc_li
(%
ecx
),%
	gebx
 #wak
up
 
pg
 
oss


138 
	gl
 %
	gebx
,%ebx #i
the
 
	gy
?

139 
	gje
 1f

140 
movl
 
	g$0
,(%
	gebx
)

141 1: 

 %
edx


142 
b
 %
dx
,%



143 
	gjmp
 1f

144 1: 
jmp
 1f

145 1: 
db
 
$0xd
,%



146 
	goutb
 %
	g
,%
dx


147 
	gt


	@kernel/chr_drv/serial.c

16 
	~<lux/y.h
>

17 
	~<lux/sched.h
>

18 
	~<asm/syem.h
>

19 
	~<asm/io.h
>

21 
	#WAKEUP_CHARS
 (
TTY_BUF_SIZE
/4)

	)

23 
rs1_u
();

24 
rs2_u
();

26 
	$
(
pt
)

28 
	`outb_p
(0x80,
pt
+3);

29 
	`outb_p
(0x30,
pt
);

30 
	`outb_p
(0x00,
pt
+1);

31 
	`outb_p
(0x03,
pt
+3);

32 
	`outb_p
(0x0b,
pt
+4);

33 
	`outb_p
(0x0d,
pt
+1);

34 ()
	`b
(
pt
);

35 
	}
}

37 
	$rs_
()

39 
	`t__ge
(0x24,
rs1_u
);

40 
	`t__ge
(0x23,
rs2_u
);

41 
	`
(
y_b
[1].
ad_q
.
da
);

42 
	`
(
y_b
[2].
ad_q
.
da
);

43 
	`outb
(
	`b_p
(0x21)&0xE7,0x21);

44 
	}
}

53 
	$rs_wre
(
y_ru
 * 
y
)

55 
	`i
();

56 i(!
	`EMPTY
(
y
->
wre_q
))

57 
	`outb
(
	`b_p
(
y
->
wre_q
.
da
+1)|0x02,tty->write_q.data+1);

58 
	`i
();

59 
	}
}

	@kernel/chr_drv/tty_io.c

13 
	~<y.h
>

14 
	~<o.h
>

15 
	~<sigl.h
>

17 
	#ALRMMASK
 (1<<(
SIGALRM
-1))

	)

18 
	#KILLMASK
 (1<<(
SIGKILL
-1))

	)

19 
	#INTMASK
 (1<<(
SIGINT
-1))

	)

20 
	#QUITMASK
 (1<<(
SIGQUIT
-1))

	)

21 
	#TSTPMASK
 (1<<(
SIGTSTP
-1))

	)

23 
	~<lux/sched.h
>

24 
	~<lux/y.h
>

25 
	~<asm/gmt.h
>

26 
	~<asm/syem.h
>

28 
	#_L_FLAG
(
y
,
f
(ty)->
rmios
.
c_lag
 & f)

	)

29 
	#_I_FLAG
(
y
,
f
(ty)->
rmios
.
c_iag
 & f)

	)

30 
	#_O_FLAG
(
y
,
f
(ty)->
rmios
.
c_oag
 & f)

	)

32 
	#L_CANON
(
y

	`_L_FLAG
(ty),
ICANON
)

	)

33 
	#L_ISIG
(
y

	`_L_FLAG
(ty),
ISIG
)

	)

34 
	#L_ECHO
(
y

	`_L_FLAG
(ty),
ECHO
)

	)

35 
	#L_ECHOE
(
y

	`_L_FLAG
(ty),
ECHOE
)

	)

36 
	#L_ECHOK
(
y

	`_L_FLAG
(ty),
ECHOK
)

	)

37 
	#L_ECHOCTL
(
y

	`_L_FLAG
(ty),
ECHOCTL
)

	)

38 
	#L_ECHOKE
(
y

	`_L_FLAG
(ty),
ECHOKE
)

	)

40 
	#I_UCLC
(
y

	`_I_FLAG
(ty),
IUCLC
)

	)

41 
	#I_NLCR
(
y

	`_I_FLAG
(ty),
INLCR
)

	)

42 
	#I_CRNL
(
y

	`_I_FLAG
(ty),
ICRNL
)

	)

43 
	#I_NOCR
(
y

	`_I_FLAG
(ty),
IGNCR
)

	)

45 
	#O_POST
(
y

	`_O_FLAG
(ty),
OPOST
)

	)

46 
	#O_NLCR
(
y

	`_O_FLAG
(ty),
ONLCR
)

	)

47 
	#O_CRNL
(
y

	`_O_FLAG
(ty),
OCRNL
)

	)

48 
	#O_NLRET
(
y

	`_O_FLAG
(ty),
ONLRET
)

	)

49 
	#O_LCUC
(
y

	`_O_FLAG
(ty),
OLCUC
)

	)

51 
y_ru
 
	gy_b
[] = {

53 {
ICRNL
,

54 
OPOST
|
ONLCR
,

56 
ISIG
 | 
ICANON
 | 
ECHO
 | 
ECHOCTL
 | 
ECHOKE
,

58 
INIT_C_CC
},

61 
c_wre
,

68 
B2400
 | 
CS8
,

71 
INIT_C_CC
},

74 
rs_wre
,

81 
B2400
 | 
CS8
,

84 
INIT_C_CC
},

87 
rs_wre
,

99 
y_queue
 * 
	gb_li
[]={

100 &
y_b
[0].
ad_q
, &y_b[0].
wre_q
,

101 &
y_b
[1].
ad_q
, &y_b[1].
wre_q
,

102 &
y_b
[2].
ad_q
, &y_b[2].
wre_q


105 
	$y_
()

107 
	`rs_
();

108 
	`c_
();

109 
	}
}

111 
	$y_
(
y_ru
 * 
y
, 
mask
)

113 
i
;

115 i(
y
->
pg
 <= 0)

117 
i
=0;i<
NR_TASKS
;i++)

118 i(
sk
[
i
] &&ask[i]->
pg
==
y
->pgrp)

119 
sk
[
i
]->
sigl
 |
mask
;

120 
	}
}

122 
	$p_if_emy
(
y_queue
 * 
queue
)

124 
	`i
();

125 !
cut
->
sigl
 && 
	`EMPTY
(*
queue
))

126 
	`uib_p_
(&
queue
->
oc_li
);

127 
	`i
();

128 
	}
}

130 
	$p_if_fu
(
y_queue
 * 
queue
)

132 i(!
	`FULL
(*
queue
))

134 
	`i
();

135 !
cut
->
sigl
 && 
	`LEFT
(*
queue
)<128)

136 
	`uib_p_
(&
queue
->
oc_li
);

137 
	`i
();

138 
	}
}

140 
	$wa_f_keyess
()

142 
	`p_if_emy
(&
y_b
[0].
cdy
);

143 
	}
}

145 
	$cy_to_cooked
(
y_ru
 * 
y
)

147 sigd 
c
;

149 !
	`EMPTY
(
y
->
ad_q
&& !
	`FULL
ty->
cdy
)) {

150 
	`GETCH
(
y
->
ad_q
,
c
);

151 i(
c
==13)

152 i(
	`I_CRNL
(
y
))

153 
c
=10;

154 i(
	`I_NOCR
(
y
))

157 i(
c
==10 && 
	`I_NLCR
(
y
))

158 
c
=13;

159 i(
	`I_UCLC
(
y
))

160 
c
=
	`tow
(c);

161 i(
	`L_CANON
(
y
)) {

162 i(
c
==
	`KILL_CHAR
(
y
)) {

164 !(
	`EMPTY
(
y
->
cdy
) ||

165 (
c
=
	`LAST
(
y
->
cdy
))==10 ||

166 
c
==
	`EOF_CHAR
(
y
))) {

167 i(
	`L_ECHO
(
y
)) {

168 i(
c
<32)

169 
	`PUTCH
(127,
y
->
wre_q
);

170 
	`PUTCH
(127,
y
->
wre_q
);

171 
y
->
	`wre
(tty);

173 
	`DEC
(
y
->
cdy
.
hd
);

177 i(
c
==
	`ERASE_CHAR
(
y
)) {

178 i(
	`EMPTY
(
y
->
cdy
) ||

179 (
c
=
	`LAST
(
y
->
cdy
))==10 ||

180 
c
==
	`EOF_CHAR
(
y
))

182 i(
	`L_ECHO
(
y
)) {

183 i(
c
<32)

184 
	`PUTCH
(127,
y
->
wre_q
);

185 
	`PUTCH
(127,
y
->
wre_q
);

186 
y
->
	`wre
(tty);

188 
	`DEC
(
y
->
cdy
.
hd
);

191 i(
c
==
	`STOP_CHAR
(
y
)) {

192 
y
->
ݳd
=1;

195 i(
c
==
	`START_CHAR
(
y
)) {

196 
y
->
ݳd
=0;

200 i(
	`L_ISIG
(
y
)) {

201 i(
c
==
	`INTR_CHAR
(
y
)) {

202 
	`y_
(
y
,
INTMASK
);

205 i(
c
==
	`QUIT_CHAR
(
y
)) {

206 
	`y_
(
y
,
QUITMASK
);

210 i(
c
==10 || c==
	`EOF_CHAR
(
y
))

211 
y
->
cdy
.
da
++;

212 i(
	`L_ECHO
(
y
)) {

213 i(
c
==10) {

214 
	`PUTCH
(10,
y
->
wre_q
);

215 
	`PUTCH
(13,
y
->
wre_q
);

216 } i(
c
<32) {

217 i(
	`L_ECHOCTL
(
y
)) {

218 
	`PUTCH
('^',
y
->
wre_q
);

219 
	`PUTCH
(
c
+64,
y
->
wre_q
);

222 
	`PUTCH
(
c
,
y
->
wre_q
);

223 
y
->
	`wre
(tty);

225 
	`PUTCH
(
c
,
y
->
cdy
);

227 
	`wake_up
(&
y
->
cdy
.
oc_li
);

228 
	}
}

230 
	$y_ad
(
chl
, * 
buf
, 

)

232 
y_ru
 * 
y
;

233 
c
, * 
b
=
buf
;

234 
mimum
,
time
,
ag
=0;

235 
dm
;

237 i(
chl
>2 || 

<0)  -1;

238 
y
 = &
y_b
[
chl
];

239 
dm
 = 
cut
->
m
;

240 
time
 = 10L*
y
->
rmios
.
c_cc
[
VTIME
];

241 
mimum
 = 
y
->
rmios
.
c_cc
[
VMIN
];

242 i(
time
 && !
mimum
) {

243 
mimum
=1;

244 i(
ag
=(!
dm
 || 
time
+
jiffs
<oldalarm))

245 
cut
->
m
 = 
time
+
jiffs
;

247 i(
mimum
>

)

248 
mimum
=

;

249 

>0) {

250 i(
ag
 && (
cut
->
sigl
 & 
ALRMMASK
)) {

251 
cut
->
sigl
 &~
ALRMMASK
;

254 i(
cut
->
sigl
)

256 i(
	`EMPTY
(
y
->
cdy
|| (
	`L_CANON
(tty) &&

257 !
y
->
cdy
.
da
 && 
	`LEFT
(tty->secondary)>20)) {

258 
	`p_if_emy
(&
y
->
cdy
);

262 
	`GETCH
(
y
->
cdy
,
c
);

263 i(
c
==
	`EOF_CHAR
(
y
) || c==10)

264 
y
->
cdy
.
da
--;

265 i(
c
==
	`EOF_CHAR
(
y
&& 
	`L_CANON
(tty))

266  (
b
-
buf
);

268 
	`put_fs_by
(
c
,
b
++);

269 i(!--

)

272 } 

>0 && !
	`EMPTY
(
y
->
cdy
));

273 i(
time
 && !
	`L_CANON
(
y
))

274 i(
ag
=(!
dm
 || 
time
+
jiffs
<oldalarm))

275 
cut
->
m
 = 
time
+
jiffs
;

277 
cut
->
m
 = 
dm
;

278 i(
	`L_CANON
(
y
)) {

279 i(
b
-
buf
)

281 } i(
b
-
buf
 >
mimum
)

284 
cut
->
m
 = 
dm
;

285 i(
cut
->
sigl
 && !(
b
-
buf
))

286  -
EINTR
;

287  (
b
-
buf
);

288 
	}
}

290 
	$y_wre
(
chl
, * 
buf
, 

)

292 
_ag
=0;

293 
y_ru
 * 
y
;

294 
c
, *
b
=
buf
;

296 i(
chl
>2 || 

<0)  -1;

297 
y
 = 
chl
 + 
y_b
;

298 

>0) {

299 
	`p_if_fu
(&
y
->
wre_q
);

300 i(
cut
->
sigl
)

302 

>0 && !
	`FULL
(
y
->
wre_q
)) {

303 
c
=
	`g_fs_by
(
b
);

304 i(
	`O_POST
(
y
)) {

305 i(
c
=='\r' && 
	`O_CRNL
(
y
))

306 
c
='\n';

307 i(
c
=='\n' && 
	`O_NLRET
(
y
))

308 
c
='\r';

309 i(
c
=='\n' && !
_ag
 && 
	`O_NLCR
(
y
)) {

310 
_ag
 = 1;

311 
	`PUTCH
(13,
y
->
wre_q
);

314 i(
	`O_LCUC
(
y
))

315 
c
=
	`tou
(c);

317 
b
++; 

--;

318 
_ag
 = 0;

319 
	`PUTCH
(
c
,
y
->
wre_q
);

321 
y
->
	`wre
(tty);

322 i(

>0)

323 
	`schedu
();

325  (
b
-
buf
);

326 
	}
}

342 
	$do_y_u
(
y
)

344 
	`cy_to_cooked
(
y_b
+
y
);

345 
	}
}

347 
	$chr_dev_
()

349 
	}
}

	@kernel/chr_drv/tty_ioctl.c

7 
	~<o.h
>

8 
	~<rmios.h
>

10 
	~<lux/sched.h
>

11 
	~<lux/kl.h
>

12 
	~<lux/y.h
>

14 
	~<asm/io.h
>

15 
	~<asm/gmt.h
>

16 
	~<asm/syem.h
>

18 
	gquٛ
[] = {

24 
	$chge_d
(
y_ru
 * 
y
)

26 
pt
,
qu
;

28 i(!(
pt
 = 
y
->
ad_q
.
da
))

30 
qu
 = 
quٛ
[
y
->
rmios
.
c_cag
 & 
CBAUD
];

31 
	`i
();

32 
	`outb_p
(0x80,
pt
+3);

33 
	`outb_p
(
qu
 & 0xff,
pt
);

34 
	`outb_p
(
qu
 >> 8,
pt
+1);

35 
	`outb
(0x03,
pt
+3);

36 
	`i
();

37 
	}
}

39 
	$ush
(
y_queue
 * 
queue
)

41 
	`i
();

42 
queue
->
hd
 = queue->

;

43 
	`i
();

44 
	}
}

46 
	$wa_u_
(
y_ru
 * 
y
)

49 
	}
}

51 
	$nd_bak
(
y_ru
 * 
y
)

54 
	}
}

56 
	$g_rmios
(
y_ru
 * 
y
, 
rmios
 *ermios)

58 
i
;

60 
	`vify_
(
rmios
,  (*termios));

61 
i
=0 ; i< ( (*
rmios
)) ; i++)

62 
	`put_fs_by
((*)&
y
->
rmios
)[
i
] , i+(*)termios );

64 
	}
}

66 
	$t_rmios
(
y_ru
 * 
y
, 
rmios
 *ermios)

68 
i
;

70 
i
=0 ; i< ( (*
rmios
)) ; i++)

71 ((*)&
y
->
rmios
)[
i
]=
	`g_fs_by
(i+(*)termios);

72 
	`chge_d
(
y
);

74 
	}
}

76 
	$g_rmio
(
y_ru
 * 
y
, 
rmio
 *ermio)

78 
i
;

79 
rmio
 
tmp_rmio
;

81 
	`vify_
(
rmio
,  (*termio));

82 
tmp_rmio
.
c_iag
 = 
y
->
rmios
.c_iflag;

83 
tmp_rmio
.
c_oag
 = 
y
->
rmios
.c_oflag;

84 
tmp_rmio
.
c_cag
 = 
y
->
rmios
.c_cflag;

85 
tmp_rmio
.
c_lag
 = 
y
->
rmios
.c_lflag;

86 
tmp_rmio
.
c_le
 = 
y
->
rmios
.c_line;

87 
i
=0 ; i < 
NCC
 ; i++)

88 
tmp_rmio
.
c_cc
[
i
] = 
y
->
rmios
.c_cc[i];

89 
i
=0 ; i< ( (*
rmio
)) ; i++)

90 
	`put_fs_by
((*)&
tmp_rmio
)[
i
] , i+(*)
rmio
 );

92 
	}
}

97 
	$t_rmio
(
y_ru
 * 
y
, 
rmio
 *ermio)

99 
i
;

100 
rmio
 
tmp_rmio
;

102 
i
=0 ; i< ( (*
rmio
)) ; i++)

103 ((*)&
tmp_rmio
)[
i
]=
	`g_fs_by
(i+(*)
rmio
);

104 *(*)&
y
->
rmios
.
c_iag
 = 
tmp_rmio
.c_iflag;

105 *(*)&
y
->
rmios
.
c_oag
 = 
tmp_rmio
.c_oflag;

106 *(*)&
y
->
rmios
.
c_cag
 = 
tmp_rmio
.c_cflag;

107 *(*)&
y
->
rmios
.
c_lag
 = 
tmp_rmio
.c_lflag;

108 
y
->
rmios
.
c_le
 = 
tmp_rmio
.c_line;

109 
i
=0 ; i < 
NCC
 ; i++)

110 
y
->
rmios
.
c_cc
[
i
] = 
tmp_rmio
.c_cc[i];

111 
	`chge_d
(
y
);

113 
	}
}

115 
	$y_iol
(
dev
, 
cmd
, 
g
)

117 
y_ru
 * 
y
;

118 i(
	`MAJOR
(
dev
) == 5) {

119 
dev
=
cut
->
y
;

120 i(
dev
<0)

121 
	`nic
("tty_ioctl: dev<0");

123 
dev
=
	`MINOR
(dev);

124 
y
 = 
dev
 + 
y_b
;

125 
cmd
) {

126 
TCGETS
:

127  
	`g_rmios
(
y
,(
rmios
 *
g
);

128 
TCSETSF
:

129 
	`ush
(&
y
->
ad_q
);

130 
TCSETSW
:

131 
	`wa_u_
(
y
);

132 
TCSETS
:

133  
	`t_rmios
(
y
,(
rmios
 *
g
);

134 
TCGETA
:

135  
	`g_rmio
(
y
,(
rmio
 *
g
);

136 
TCSETAF
:

137 
	`ush
(&
y
->
ad_q
);

138 
TCSETAW
:

139 
	`wa_u_
(
y
);

140 
TCSETA
:

141  
	`t_rmio
(
y
,(
rmio
 *
g
);

142 
TCSBRK
:

143 i(!
g
) {

144 
	`wa_u_
(
y
);

145 
	`nd_bak
(
y
);

148 
TCXONC
:

149  -
EINVAL
;

150 
TCFLSH
:

151 i(
g
==0)

152 
	`ush
(&
y
->
ad_q
);

153 i(
g
==1)

154 
	`ush
(&
y
->
wre_q
);

155 i(
g
==2) {

156 
	`ush
(&
y
->
ad_q
);

157 
	`ush
(&
y
->
wre_q
);

159  -
EINVAL
;

161 
TIOCEXCL
:

162  -
EINVAL
;

163 
TIOCNXCL
:

164  -
EINVAL
;

165 
TIOCSCTTY
:

166  -
EINVAL
;

167 
TIOCGPGRP
:

168 
	`vify_
((*
g
,4);

169 
	`put_fs_lg
(
y
->
pg
,(*
g
);

171 
TIOCSPGRP
:

172 
y
->
pg
=
	`g_fs_lg
((*
g
);

174 
TIOCOUTQ
:

175 
	`vify_
((*
g
,4);

176 
	`put_fs_lg
(
	`CHARS
(
y
->
wre_q
),(*
g
);

178 
TIOCINQ
:

179 
	`vify_
((*
g
,4);

180 
	`put_fs_lg
(
	`CHARS
(
y
->
cdy
),

181 (*
g
);

183 
TIOCSTI
:

184  -
EINVAL
;

185 
TIOCGWINSZ
:

186  -
EINVAL
;

187 
TIOCSWINSZ
:

188  -
EINVAL
;

189 
TIOCMGET
:

190  -
EINVAL
;

191 
TIOCMBIS
:

192  -
EINVAL
;

193 
TIOCMBIC
:

194  -
EINVAL
;

195 
TIOCMSET
:

196  -
EINVAL
;

197 
TIOCGSOFTCAR
:

198  -
EINVAL
;

199 
TIOCSSOFTCAR
:

200  -
EINVAL
;

202  -
EINVAL
;

204 
	}
}

	@kernel/exit.c

7 
	~<o.h
>

8 
	~<sigl.h
>

9 
	~<sys/wa.h
>

11 
	~<lux/sched.h
>

12 
	~<lux/kl.h
>

13 
	~<lux/y.h
>

14 
	~<asm/gmt.h
>

16 
sys_u
();

17 
sys_o
(
fd
);

19 
	$a
(
sk_ru
 * 
p
)

21 
i
;

23 i(!
p
)

25 
i
=1 ; i<
NR_TASKS
 ; i++)

26 i(
sk
[
i
]==
p
) {

27 
sk
[
i
]=
NULL
;

28 
	`_ge
(()
p
);

29 
	`schedu
();

32 
	`nic
("tryingoeleaseon-existentask");

33 
	}
}

35 
le
 
	$nd_sig
(
sig
,
sk_ru
 * 
p
,
iv
)

37 i(!
p
 || 
sig
<1 || sig>32)

38  -
EINVAL
;

39 i(
iv
 || (
cut
->
euid
==
p
->euid|| 
	`sur
())

40 
p
->
sigl
 |(1<<(
sig
-1));

42  -
EPERM
;

44 
	}
}

46 
	$kl_ssi
()

48 
sk_ru
 **
p
 = 
NR_TASKS
 + 
sk
;

50 --
p
 > &
FIRST_TASK
) {

51 i(*
p
 && (*p)->
ssi
 =
cut
->session)

52 (*
p
)->
sigl
 |1<<(
SIGHUP
-1);

54 
	}
}

60 
	$sys_kl
(
pid
,
sig
)

62 
sk_ru
 **
p
 = 
NR_TASKS
 + 
sk
;

63 
r
, 
tv
 = 0;

65 i(!
pid
--
p
 > &
FIRST_TASK
) {

66 i(*
p
 && (*p)->
pg
 =
cut
->
pid
)

67 i(
r
=
	`nd_sig
(
sig
,*
p
,1))

68 
tv
 = 
r
;

69 } i(
pid
>0--
p
 > &
FIRST_TASK
) {

70 i(*
p
 && (*p)->
pid
 ==id)

71 i(
r
=
	`nd_sig
(
sig
,*
p
,0))

72 
tv
 = 
r
;

73 } i(
pid
 =-1--
p
 > &
FIRST_TASK
)

74 i(
r
 = 
	`nd_sig
(
sig
,*
p
,0))

75 
tv
 = 
r
;

76 --
p
 > &
FIRST_TASK
)

77 i(*
p
 && (*p)->
pg
 =-
pid
)

78 i(
r
 = 
	`nd_sig
(
sig
,*
p
,0))

79 
tv
 = 
r
;

80  
tv
;

81 
	}
}

83 
	$_th
(
pid
)

85 
i
;

87 i(
pid
)

88 
i
=0;i<
NR_TASKS
;i++) {

89 i(!
sk
[
i
])

91 i(
sk
[
i
]->
pid
 !=id)

93 
sk
[
i
]->
sigl
 |(1<<(
SIGCHLD
-1));

98 
	`tk
("BAD BAD -o father found\n\r");

99 
	`a
(
cut
);

100 
	}
}

102 
	$do_ex
(
code
)

104 
i
;

106 
	`_ge_bs
(
	`g_ba
(
cut
->
ldt
[1]),
	`g_lim
(0x0f));

107 
	`_ge_bs
(
	`g_ba
(
cut
->
ldt
[2]),
	`g_lim
(0x17));

108 
i
=0 ; i<
NR_TASKS
 ; i++)

109 i(
sk
[
i
] &&ask[i]->
th
 =
cut
->
pid
) {

110 
sk
[
i
]->
th
 = 1;

111 i(
sk
[
i
]->
e
 =
TASK_ZOMBIE
)

113 (
	`nd_sig
(
SIGCHLD
, 
sk
[1], 1);

115 
i
=0 ; i<
NR_OPEN
 ; i++)

116 i(
cut
->
fp
[
i
])

117 
	`sys_o
(
i
);

118 
	`ut
(
cut
->
pwd
);

119 
cut
->
pwd
=
NULL
;

120 
	`ut
(
cut
->
ro
);

121 
cut
->
ro
=
NULL
;

122 
	`ut
(
cut
->
execub
);

123 
cut
->
execub
=
NULL
;

124 i(
cut
->
ad
 && cut->
y
 >= 0)

125 
y_b
[
cut
->
y
].
pg
 = 0;

126 i(
ϡ_sk_ud_mh
 =
cut
)

127 
ϡ_sk_ud_mh
 = 
NULL
;

128 i(
cut
->
ad
)

129 
	`kl_ssi
();

130 
cut
->
e
 = 
TASK_ZOMBIE
;

131 
cut
->
ex_code
 = 
code
;

132 
	`_th
(
cut
->
th
);

133 
	`schedu
();

135 
	}
}

137 
	$sys_ex
(
r_code
)

139  
	`do_ex
((
r_code
&0xff)<<8);

140 
	}
}

142 
	$sys_wapid
(
pid_t
 
pid
,* 
_addr
, 
tis
)

144 
ag
, 
code
;

145 
sk_ru
 ** 
p
;

147 
	`vify_
(
_addr
,4);

148 

:

149 
ag
=0;

150 
p
 = &
LAST_TASK
 ; > &
FIRST_TASK
 ; --p) {

151 i(!*
p
 || *=
cut
)

153 i((*
p
)->
th
 !
cut
->
pid
)

155 i(
pid
>0) {

156 i((*
p
)->
pid
 !=id)

158 } i(!
pid
) {

159 i((*
p
)->
pg
 !
cut
->pgrp)

161 } i(
pid
 != -1) {

162 i((*
p
)->
pg
 !-
pid
)

165 (*
p
)->
e
) {

166 
TASK_STOPPED
:

167 i(!(
tis
 & 
WUNTRACED
))

169 
	`put_fs_lg
(0x7f,
_addr
);

170  (*
p
)->
pid
;

171 
TASK_ZOMBIE
:

172 
cut
->
cutime
 +(*
p
)->
utime
;

173 
cut
->
cime
 +(*
p
)->
ime
;

174 
ag
 = (*
p
)->
pid
;

175 
code
 = (*
p
)->
ex_code
;

176 
	`a
(*
p
);

177 
	`put_fs_lg
(
code
,
_addr
);

178  
ag
;

180 
ag
=1;

184 i(
ag
) {

185 i(
tis
 & 
WNOHANG
)

187 
cut
->
e
=
TASK_INTERRUPTIBLE
;

188 
	`schedu
();

189 i(!(
cut
->
sigl
 &~(1<<(
SIGCHLD
-1))))

190 

;

192  -
EINTR
;

194  -
ECHILD
;

195 
	}
}

	@kernel/fork.c

13 
	~<o.h
>

15 
	~<lux/sched.h
>

16 
	~<lux/kl.h
>

17 
	~<asm/gmt.h
>

18 
	~<asm/syem.h
>

20 
wre_vify
(
addss
);

22 
	gϡ_pid
=0;

24 
	$vify_
(* 
addr
,
size
)

26 
t
;

28 
t
 = (
addr
;

29 
size
 +
t
 & 0xfff;

30 
t
 &= 0xfffff000;

31 
t
 +
	`g_ba
(
cut
->
ldt
[2]);

32 
size
>0) {

33 
size
 -= 4096;

34 
	`wre_vify
(
t
);

35 
t
 += 4096;

37 
	}
}

39 
	$cy_mem
(

,
sk_ru
 * 
p
)

41 
d_da_ba
,
w_da_ba
,
da_lim
;

42 
d_code_ba
,
w_code_ba
,
code_lim
;

44 
code_lim
=
	`g_lim
(0x0f);

45 
da_lim
=
	`g_lim
(0x17);

46 
d_code_ba
 = 
	`g_ba
(
cut
->
ldt
[1]);

47 
d_da_ba
 = 
	`g_ba
(
cut
->
ldt
[2]);

48 i(
d_da_ba
 !
d_code_ba
)

49 
	`nic
("We don't support separate I&D");

50 i(
da_lim
 < 
code_lim
)

51 
	`nic
("Bad data_limit");

52 
w_da_ba
 = 
w_code_ba
 = 

 * 0x4000000;

53 
p
->
t_code
 = 
w_code_ba
;

54 
	`t_ba
(
p
->
ldt
[1],
w_code_ba
);

55 
	`t_ba
(
p
->
ldt
[2],
w_da_ba
);

56 i(
	`cy_ge_bs
(
d_da_ba
,
w_da_ba
,
da_lim
)) {

57 
	`_ge_bs
(
w_da_ba
,
da_lim
);

58  -
ENOMEM
;

61 
	}
}

68 
	$cy_oss
(

,
ebp
,
edi
,
esi
,
gs
,
ne
,

69 
ebx
,
ecx
,
edx
,

70 
fs
,
es
,
ds
,

71 
e
,
cs
,
eags
,
e
,
ss
)

73 
sk_ru
 *
p
;

74 
i
;

75 
fe
 *
f
;

77 
p
 = (
sk_ru
 *
	`g__ge
();

78 i(!
p
)

79  -
EAGAIN
;

80 
sk
[

] = 
p
;

81 *
p
 = *
cut
;

82 
p
->
e
 = 
TASK_UNINTERRUPTIBLE
;

83 
p
->
pid
 = 
ϡ_pid
;

84 
p
->
th
 = 
cut
->
pid
;

85 
p
->
cou
 =->
iܙy
;

86 
p
->
sigl
 = 0;

87 
p
->
m
 = 0;

88 
p
->
ad
 = 0;

89 
p
->
utime
 =->
ime
 = 0;

90 
p
->
cutime
 =->
cime
 = 0;

91 
p
->
t_time
 = 
jiffs
;

92 
p
->
tss
.
back_lk
 = 0;

93 
p
->
tss
.
e0
 = 
PAGE_SIZE
 + ();

94 
p
->
tss
.
ss0
 = 0x10;

95 
p
->
tss
.
e
 =ip;

96 
p
->
tss
.
eags
 =flags;

97 
p
->
tss
.
x
 = 0;

98 
p
->
tss
.
ecx
 =cx;

99 
p
->
tss
.
edx
 =dx;

100 
p
->
tss
.
ebx
 =bx;

101 
p
->
tss
.
e
 =sp;

102 
p
->
tss
.
ebp
 =bp;

103 
p
->
tss
.
esi
 =si;

104 
p
->
tss
.
edi
 =di;

105 
p
->
tss
.
es
 =s & 0xffff;

106 
p
->
tss
.
cs
 = cs & 0xffff;

107 
p
->
tss
.
ss
 = ss & 0xffff;

108 
p
->
tss
.
ds
 = ds & 0xffff;

109 
p
->
tss
.
fs
 = fs & 0xffff;

110 
p
->
tss
.
gs
 = gs & 0xffff;

111 
p
->
tss
.
ldt
 = 
	`_LDT
(

);

112 
p
->
tss
.
a_bm
 = 0x80000000;

113 i(
ϡ_sk_ud_mh
 =
cut
)

114 
	`__asm__
("t; fnv%0"::"m" (
p
->
tss
.
i387
));

115 i(
	`cy_mem
(

,
p
)) {

116 
sk
[

] = 
NULL
;

117 
	`_ge
((
p
);

118  -
EAGAIN
;

120 
i
=0; i<
NR_OPEN
;i++)

121 i(
f
=
p
->
fp
[
i
])

122 
f
->
f_cou
++;

123 i(
cut
->
pwd
)

124 
cut
->
pwd
->
i_cou
++;

125 i(
cut
->
ro
)

126 
cut
->
ro
->
i_cou
++;

127 i(
cut
->
execub
)

128 
cut
->
execub
->
i_cou
++;

129 
	`t_tss_desc
(
gdt
+(

<<1)+
FIRST_TSS_ENTRY
,&(
p
->
tss
));

130 
	`t_ldt_desc
(
gdt
+(

<<1)+
FIRST_LDT_ENTRY
,&(
p
->
ldt
));

131 
p
->
e
 = 
TASK_RUNNING
;

132  
ϡ_pid
;

133 
	}
}

138 
	$fd_emy_oss
()

140 
i
;

142 

:

143 i((++
ϡ_pid
)<0)ast_pid=1;

145 
i
=0 ; i<
NR_TASKS
 ; i++)

146 i(
sk
[
i
] &&ask[i]->
pid
 =
ϡ_pid


;

148 
i
=1 ; i<
NR_TASKS
 ; i++)

149 i(!
sk
[
i
])

150  
i
;

151  -
EAGAIN
;

152 
	}
}

	@kernel/math/math_emulate.c

12 
	~<sigl.h
>

14 
	~<lux/sched.h
>

15 
	~<lux/kl.h
>

16 
	~<asm/gmt.h
>

18 
	$mh_emuϋ
(
edi
, 
esi
, 
ebp
, 
sys__t
,

19 
x
,
ebx
,
ecx
,
edx
,

20 
fs
,
es
,
ds
,

21 
e
,
cs
,
eags
,

22 
ss
, 
e
)

24 
f
, 
cd
;

27 i(
cs
 != 0x000F) {

28 
	`tk
("mh_emuϋ: %04x:%08x\n\r",
cs
,
e
);

29 
	`nic
("Mathmulationeeded in kernel");

31 
f
 = 
	`g_fs_by
((*)((*&
e
)++));

32 
cd
 = 
	`g_fs_by
((*)((*&
e
)++));

33 
	`tk
("%04x:%08x %02x %02x\n\r",
cs
,
e
-2,
f
,
cd
);

34 
cut
->
sigl
 |1<<(
SIGFPE
-1);

35 
	}
}

37 
	$mh_r
()

39 
	`__asm__
("fnclex");

40 i(
ϡ_sk_ud_mh
)

41 
ϡ_sk_ud_mh
->
sigl
 |1<<(
SIGFPE
-1);

42 
	}
}

	@kernel/mktime.c

7 
	~<time.h
>

20 
	#MINUTE
 60

	)

21 
	#HOUR
 (60*
MINUTE
)

	)

22 
	#DAY
 (24*
HOUR
)

	)

23 
	#YEAR
 (365*
DAY
)

	)

26 
	gmth
[12] = {

28 
DAY
*(31),

29 
DAY
*(31+29),

30 
DAY
*(31+29+31),

31 
DAY
*(31+29+31+30),

32 
DAY
*(31+29+31+30+31),

33 
DAY
*(31+29+31+30+31+30),

34 
DAY
*(31+29+31+30+31+30+31),

35 
DAY
*(31+29+31+30+31+30+31+31),

36 
DAY
*(31+29+31+30+31+30+31+31+30),

37 
DAY
*(31+29+31+30+31+30+31+31+30+31),

38 
DAY
*(31+29+31+30+31+30+31+31+30+31+30)

41 
	$kl_mktime
(
tm
 *m)

43 
s
;

44 
yr
;

46 
yr
 = 
tm
->
tm_yr
 - 70;

48 
s
 = 
YEAR
*
yr
 + 
DAY
*((year+1)/4);

49 
s
 +
mth
[
tm
->
tm_m
];

51 i(
tm
->
tm_m
>1 && ((
yr
+2)%4))

52 
s
 -
DAY
;

53 
s
 +
DAY
*(
tm
->
tm_mday
-1);

54 
s
 +
HOUR
*
tm
->
tm_hour
;

55 
s
 +
MINUTE
*
tm
->
tm_m
;

56 
s
 +
tm
->
tm_c
;

57  
s
;

58 
	}
}

	@kernel/panic.c

11 
	~<lux/kl.h
>

12 
	~<lux/sched.h
>

14 
sys_sync
();

16 vީ
	$nic
(cڡ * 
s
)

18 
	`tk
("Kȷnic: %s\n\r",
s
);

19 i(
cut
 =
sk
[0])

20 
	`tk
("In swapperask -ot syncing\n\r");

22 
	`sys_sync
();

24 
	}
}

	@kernel/printk.c

12 
	~<dg.h
>

13 
	~<ddef.h
>

15 
	~<lux/kl.h
>

17 
	gbuf
[1024];

19 
vrtf
(* 
buf
, cڡ * 
fmt
, 
va_li
 
gs
);

21 
	$tk
(cڡ *
fmt
, ...)

23 
va_li
 
gs
;

24 
i
;

26 
	`va_t
(
gs
, 
fmt
);

27 
i
=
	`vrtf
(
buf
,
fmt
,
gs
);

28 
	`va_d
(
gs
);

29 
	`__asm__
("push %%fs\n\t"

39 ::"r" (
i
):"ax","cx","dx");

40  
i
;

41 
	}
}

	@kernel/sched.c

13 
	~<lux/sched.h
>

14 
	~<lux/kl.h
>

15 
	~<lux/sys.h
>

16 
	~<lux/fdg.h
>

17 
	~<asm/syem.h
>

18 
	~<asm/io.h
>

19 
	~<asm/gmt.h
>

21 
	~<sigl.h
>

23 
	#_S
(

(1<<(r)-1))

	)

24 
	#_BLOCKABLE
 (~(
	`_S
(
SIGKILL
| _S(
SIGSTOP
)))

	)

26 
	$show_sk
(

,
sk_ru
 * 
p
)

28 
i
,
j
 = 4096-(
sk_ru
);

30 
	`tk
("%d:id=%d, s=%d, ",

,
p
->
pid
,p->
e
);

31 
i
=0;

32 
i
<
j
 && !((*)(
p
+1))[i])

33 
i
++;

34 
	`tk
("%d (o%dch ikȡack\n\r",
i
,
j
);

35 
	}
}

37 
	$show_
()

39 
i
;

41 
i
=0;i<
NR_TASKS
;i++)

42 i(
sk
[
i
])

43 
	`show_sk
(
i
,
sk
[i]);

44 
	}
}

46 
	#LATCH
 (1193180/
HZ
)

47 

	)

48 
mem_u
();

50 
tim_u
();

51 
syem_
();

53 
	usk_uni
 {

54 
sk_ru
 
	msk
;

55 
	mack
[
PAGE_SIZE
];

58 
sk_uni
 
	g_sk
 = {
INIT_TASK
,};

60 vީ
	gjiffs
=0;

61 
	gtup_time
=0;

62 
sk_ru
 *
	gcut
 = &(
_sk
.
sk
);

63 
sk_ru
 *
	gϡ_sk_ud_mh
 = 
NULL
;

66 
sk_ru
 * 
	gsk
[
NR_TASKS
] = {&(
_sk
.
sk
), };

68 
	gur_ack
 [ 
PAGE_SIZE
>>2 ] ;

71 * 
	ma
;

72 
	mb
;

73 } 
	gack_t
 = { & 
ur_ack
 [
PAGE_SIZE
>>2] , 0x10 };

78 
	$mh_e_e
()

80 i(
ϡ_sk_ud_mh
 =
cut
)

82 
	`__asm__
("fwait");

83 i(
ϡ_sk_ud_mh
) {

84 
	`__asm__
("v%0"::"m" (
ϡ_sk_ud_mh
->
tss
.
i387
));

86 
ϡ_sk_ud_mh
=
cut
;

87 i(
cut
->
ud_mh
) {

88 
	`__asm__
(" %0"::"m" (
cut
->
tss
.
i387
));

90 
	`__asm__
("fninit"::);

91 
cut
->
ud_mh
=1;

93 
	}
}

105 
	$schedu
()

107 
i
,
xt
,
c
;

108 
sk_ru
 ** 
p
;

112 
p
 = &
LAST_TASK
 ; > &
FIRST_TASK
 ; --p)

113 i(*
p
) {

114 i((*
p
)->
m
 && (*p)->m < 
jiffs
) {

115 (*
p
)->
sigl
 |(1<<(
SIGALRM
-1));

116 (*
p
)->
m
 = 0;

118 i(((*
p
)->
sigl
 & ~(
_BLOCKABLE
 & (*p)->
blocked
)) &&

119 (*
p
)->
e
==
TASK_INTERRUPTIBLE
)

120 (*
p
)->
e
=
TASK_RUNNING
;

126 
c
 = -1;

127 
xt
 = 0;

128 
i
 = 
NR_TASKS
;

129 
p
 = &
sk
[
NR_TASKS
];

130 --
i
) {

131 i(!*--
p
)

133 i((*
p
)->
e
 =
TASK_RUNNING
 && (*p)->
cou
 > 
c
)

134 
c
 = (*
p
)->
cou
, 
xt
 = 
i
;

136 i(
c
) ;

137 
p
 = &
LAST_TASK
 ; > &
FIRST_TASK
 ; --p)

138 i(*
p
)

139 (*
p
)->
cou
 = ((*p)->counter >> 1) +

140 (*
p
)->
iܙy
;

142 
	`swch_to
(
xt
);

143 
	}
}

145 
	$sys_u
()

147 
cut
->
e
 = 
TASK_INTERRUPTIBLE
;

148 
	`schedu
();

150 
	}
}

152 
	$p_
(
sk_ru
 **
p
)

154 
sk_ru
 *
tmp
;

156 i(!
p
)

158 i(
cut
 =&(
_sk
.
sk
))

159 
	`nic
("task[0]ryingo sleep");

160 
tmp
 = *
p
;

161 *
p
 = 
cut
;

162 
cut
->
e
 = 
TASK_UNINTERRUPTIBLE
;

163 
	`schedu
();

164 i(
tmp
)

165 
tmp
->
e
=0;

166 
	}
}

168 
	$uib_p_
(
sk_ru
 **
p
)

170 
sk_ru
 *
tmp
;

172 i(!
p
)

174 i(
cut
 =&(
_sk
.
sk
))

175 
	`nic
("task[0]ryingo sleep");

176 
tmp
=*
p
;

177 *
p
=
cut
;

178 

: 
cut
->
e
 = 
TASK_INTERRUPTIBLE
;

179 
	`schedu
();

180 i(*
p
 && *!
cut
) {

181 (**
p
).
e
=0;

182 

;

184 *
p
=
NULL
;

185 i(
tmp
)

186 
tmp
->
e
=0;

187 
	}
}

189 
	$wake_up
(
sk_ru
 **
p
)

191 i(
p
 && *p) {

192 (**
p
).
e
=0;

193 *
p
=
NULL
;

195 
	}
}

202 
sk_ru
 * 
	gwa_m
[4] = {
NULL
,NULL,NULL,NULL};

203 
	gm_tim
[4]={0,0,0,0};

204 
	gmoff_tim
[4]={0,0,0,0};

205 
	gcut_DOR
 = 0x0C;

207 
	$ticks_to_py_
(

)

209 
ed
;

210 
mask
 = 0x10 << 

;

212 i(

>3)

213 
	`nic
("floppy_on:r>3");

214 
moff_tim
[

]=10000;

215 
	`i
();

216 
mask
 |
cut_DOR
;

217 i(!
ed
) {

218 
mask
 &= 0xFC;

219 
mask
 |

;

221 i(
mask
 !
cut_DOR
) {

222 
	`outb
(
mask
,
FD_DOR
);

223 i((
mask
 ^ 
cut_DOR
) & 0xf0)

224 
m_tim
[

] = 
HZ
/2;

225 i(
m_tim
[

] < 2)

226 
m_tim
[

] = 2;

227 
cut_DOR
 = 
mask
;

229 
	`i
();

230  
m_tim
[

];

231 
	}
}

233 
	$py_
(

)

235 
	`i
();

236 
	`ticks_to_py_
(

))

237 
	`p_
(

+
wa_m
);

238 
	`i
();

239 
	}
}

241 
	$py_off
(

)

243 
moff_tim
[

]=3*
HZ
;

244 
	}
}

246 
	$do_py_tim
()

248 
i
;

249 
mask
 = 0x10;

251 
i
=0 ; i<4 ; i++,
mask
 <<= 1) {

252 i(!(
mask
 & 
cut_DOR
))

254 i(
m_tim
[
i
]) {

255 i(!--
m_tim
[
i
])

256 
	`wake_up
(
i
+
wa_m
);

257 } i(!
moff_tim
[
i
]) {

258 
cut_DOR
 &~
mask
;

259 
	`outb
(
cut_DOR
,
FD_DOR
);

261 
moff_tim
[
i
]--;

263 
	}
}

265 
	#TIME_REQUESTS
 64

	)

267 
	stim_li
 {

268 
	mjiffs
;

269 (*
	m
)();

270 
tim_li
 * 
	mxt
;

271 } 
	gtim_li
[
TIME_REQUESTS
], * 
	gxt_tim
 = 
NULL
;

273 
add_tim
(
jiffs
, (*

)())

275 
tim_li
 * 
p
;

277 i(!

)

279 
	`i
();

280 i(
jiffs
 <= 0)

281 (

)();

283 
p
 = 
tim_li
 ; <im_li + 
TIME_REQUESTS
 ;++)

284 i(!
p
->

)

286 i(
p
 >
tim_li
 + 
TIME_REQUESTS
)

287 
	`nic
("No moreimeequests free");

288 
p
->

 = fn;

289 
p
->
jiffs
 = jiffies;

290 
p
->
xt
 = 
xt_tim
;

291 
xt_tim
 = 
p
;

292 
p
->
xt
 &&->xt->
jiffs
 <->jiffies) {

293 
p
->
jiffs
 -p->
xt
->jiffies;

294 

 = 
p
->fn;

295 
p
->

 =->
xt
->fn;

296 
p
->
xt
->

 = fn;

297 
jiffs
 = 
p
->jiffies;

298 
p
->
jiffs
 =->
xt
->jiffies;

299 
p
->
xt
->
jiffs
 = jiffies;

300 
p
 =->
xt
;

303 
	`i
();

304 
	}
}

306 
	$do_tim
(
l
)

308 
bpcou
;

309 
	`sysbp
();

311 i(
bpcou
)

312 i(!--
bpcou
)

313 
	`sysbp
();

315 i(
l
)

316 
cut
->
utime
++;

318 
cut
->
ime
++;

320 i(
xt_tim
) {

321 
xt_tim
->
jiffs
--;

322 
xt_tim
 &&ext_tim->
jiffs
 <= 0) {

323 (*

)();

325 

 = 
xt_tim
->fn;

326 
xt_tim
->

 = 
NULL
;

327 
xt_tim
 =ext_tim->
xt
;

328 (

)();

331 i(
cut_DOR
 & 0xf0)

332 
	`do_py_tim
();

333 i((--
cut
->
cou
)>0) ;

334 
cut
->
cou
=0;

335 i(!
l
) ;

336 
	`schedu
();

337 
	}
}

339 
	$sys_m
(
cds
)

341 
d
 = 
cut
->
m
;

343 i(
d
)

344 
d
 = (d - 
jiffs
/ 
HZ
;

345 
cut
->
m
 = (
cds
>0)?(
jiffs
+
HZ
*seconds):0;

346  (
d
);

347 
	}
}

349 
	$sys_gpid
()

351  
cut
->
pid
;

352 
	}
}

354 
	$sys_gid
()

356  
cut
->
th
;

357 
	}
}

359 
	$sys_guid
()

361  
cut
->
uid
;

362 
	}
}

364 
	$sys_geuid
()

366  
cut
->
euid
;

367 
	}
}

369 
	$sys_ggid
()

371  
cut
->
gid
;

372 
	}
}

374 
	$sys_gegid
()

376  
cut
->
egid
;

377 
	}
}

379 
	$sys_ni
(
emt
)

381 i(
cut
->
iܙy
-
emt
>0)

382 
cut
->
iܙy
 -
emt
;

384 
	}
}

386 
	$sched_
()

388 
i
;

389 
desc_ru
 * 
p
;

391 i((
sigai
) != 16)

392 
	`nic
("Struct sigaction MUST be 16 bytes");

393 
	`t_tss_desc
(
gdt
+
FIRST_TSS_ENTRY
,&(
_sk
.
sk
.
tss
));

394 
	`t_ldt_desc
(
gdt
+
FIRST_LDT_ENTRY
,&(
_sk
.
sk
.
ldt
));

395 
p
 = 
gdt
+2+
FIRST_TSS_ENTRY
;

396 
i
=1;i<
NR_TASKS
;i++) {

397 
sk
[
i
] = 
NULL
;

398 
p
->
a
->
b
=0;

399 
p
++;

400 
p
->
a
->
b
=0;

401 
p
++;

404 
	`__asm__
("pushfl ;ndl $0xffffbfff,(%esp) ;opfl");

405 
	`r
(0);

406 
	`dt
(0);

407 
	`outb_p
(0x36,0x43);

408 
	`outb_p
(
LATCH
 & 0xff , 0x40);

409 
	`outb
(
LATCH
 >> 8 , 0x40);

410 
	`t__ge
(0x20,&
tim_u
);

411 
	`outb
(
	`b_p
(0x21)&~0x01,0x21);

412 
	`t_syem_ge
(0x80,&
syem_
);

413 
	}
}

	@kernel/signal.c

7 
	~<lux/sched.h
>

8 
	~<lux/kl.h
>

9 
	~<asm/gmt.h
>

11 
	~<sigl.h
>

13 vީ
do_ex
(
r_code
);

15 
	$sys_sgmask
()

17  
cut
->
blocked
;

18 
	}
}

20 
	$sys_stmask
(
wmask
)

22 
d
=
cut
->
blocked
;

24 
cut
->
blocked
 = 
wmask
 & ~(1<<(
SIGKILL
-1));

25  
d
;

26 
	}
}

28 
le
 
	$ve_d
(* 
om
,* 
to
)

30 
i
;

32 
	`vify_
(
to
, (
sigai
));

33 
i
=0 ; i< (
sigai
) ; i++) {

34 
	`put_fs_by
(*
om
,
to
);

35 
om
++;

36 
to
++;

38 
	}
}

40 
le
 
	$g_w
(* 
om
,* 
to
)

42 
i
;

44 
i
=0 ; i< (
sigai
) ; i++)

45 *(
to
++
	`g_fs_by
(
om
++);

46 
	}
}

48 
	$sys_sigl
(
signum
, 
hdr
, 
ܔ
)

50 
sigai
 
tmp
;

52 i(
signum
<1 || signum>32 || signum==
SIGKILL
)

54 
tmp
.
_hdr
 = ((*)()
hdr
;

55 
tmp
.
_mask
 = 0;

56 
tmp
.
_ags
 = 
SA_ONESHOT
 | 
SA_NOMASK
;

57 
tmp
.
_ܔ
 = ((*)()
ܔ
;

58 
hdr
 = (
cut
->
sigai
[
signum
-1].
_hdr
;

59 
cut
->
sigai
[
signum
-1] = 
tmp
;

60  
hdr
;

61 
	}
}

63 
	$sys_sigai
(
signum
, cڡ 
sigai
 * 
ai
,

64 
sigai
 * 
dai
)

66 
sigai
 
tmp
;

68 i(
signum
<1 || signum>32 || signum==
SIGKILL
)

70 
tmp
 = 
cut
->
sigai
[
signum
-1];

71 
	`g_w
((*
ai
,

72 (*(
signum
-1+
cut
->
sigai
));

73 i(
dai
)

74 
	`ve_d
((*&
tmp
,(*
dai
);

75 i(
cut
->
sigai
[
signum
-1].
_ags
 & 
SA_NOMASK
)

76 
cut
->
sigai
[
signum
-1].
_mask
 = 0;

78 
cut
->
sigai
[
signum
-1].
_mask
 |= (1<<(signum-1));

80 
	}
}

82 
	$do_sigl
(
sig
,
x
, 
ebx
, 
ecx
, 
edx
,

83 
fs
, 
es
, 
ds
,

84 
e
, 
cs
, 
eags
,

85 * 
e
, 
ss
)

87 
_hdr
;

88 
d_e
=
e
;

89 
sigai
 * 

 = 
cut
->sigai + 
sig
 - 1;

90 
lgs
;

91 * 
tmp_e
;

93 
_hdr
 = (

->sa_handler;

94 i(
_hdr
==1)

96 i(!
_hdr
) {

97 i(
sig
==
SIGCHLD
)

100 
	`do_ex
(1<<(
sig
-1));

102 i(

->
_ags
 & 
SA_ONESHOT
)

103 

->
_hdr
 = 
NULL
;

104 *(&
e

_hdr
;

105 
lgs
 = (

->
_ags
 & 
SA_NOMASK
)?7:8;

106 *(&
e
-
lgs
;

107 
	`vify_
(
e
,
lgs
*4);

108 
tmp_e
=
e
;

109 
	`put_fs_lg
((

->
_ܔ
,
tmp_e
++);

110 
	`put_fs_lg
(
sig
,
tmp_e
++);

111 i(!(

->
_ags
 & 
SA_NOMASK
))

112 
	`put_fs_lg
(
cut
->
blocked
,
tmp_e
++);

113 
	`put_fs_lg
(
x
,
tmp_e
++);

114 
	`put_fs_lg
(
ecx
,
tmp_e
++);

115 
	`put_fs_lg
(
edx
,
tmp_e
++);

116 
	`put_fs_lg
(
eags
,
tmp_e
++);

117 
	`put_fs_lg
(
d_e
,
tmp_e
++);

118 
cut
->
blocked
 |

->
_mask
;

119 
	}
}

	@kernel/sys.c

7 
	~<o.h
>

9 
	~<lux/sched.h
>

10 
	~<lux/y.h
>

11 
	~<lux/kl.h
>

12 
	~<asm/gmt.h
>

13 
	~<sys/times.h
>

14 
	~<sys/utame.h
>

16 
	$sys_ime
()

18  -
ENOSYS
;

19 
	}
}

21 
	$sys_bak
()

23  -
ENOSYS
;

24 
	}
}

26 
	$sys_
()

28  -
ENOSYS
;

29 
	}
}

31 
	$sys_ty
()

33  -
ENOSYS
;

34 
	}
}

36 
	$sys_gy
()

38  -
ENOSYS
;

39 
	}
}

41 
	$sys_me
()

43  -
ENOSYS
;

44 
	}
}

46 
	$sys_of
()

48  -
ENOSYS
;

49 
	}
}

51 
	$sys_egid
(
rgid
, 
egid
)

53 i(
rgid
>0) {

54 i((
cut
->
gid
 =
rgid
) ||

55 
	`sur
())

56 
cut
->
gid
 = 
rgid
;

58 (-
EPERM
);

60 i(
egid
>0) {

61 i((
cut
->
gid
 =
egid
) ||

62 (
cut
->
egid
 ==gid) ||

63 (
cut
->
sgid
 =
egid
) ||

64 
	`sur
())

65 
cut
->
egid
 =gid;

67 (-
EPERM
);

70 
	}
}

72 
	$sys_tgid
(
gid
)

74 (
	`sys_egid
(
gid
, gid));

75 
	}
}

77 
	$sys_ac
()

79  -
ENOSYS
;

80 
	}
}

82 
	$sys_phys
()

84  -
ENOSYS
;

85 
	}
}

87 
	$sys_lock
()

89  -
ENOSYS
;

90 
	}
}

92 
	$sys_mpx
()

94  -
ENOSYS
;

95 
	}
}

97 
	$sys_ulim
()

99  -
ENOSYS
;

100 
	}
}

102 
	$sys_time
(* 
oc
)

104 
i
;

106 
i
 = 
CURRENT_TIME
;

107 i(
oc
) {

108 
	`vify_
(
oc
,4);

109 
	`put_fs_lg
(
i
,(*)
oc
);

111  
i
;

112 
	}
}

118 
	$sys_euid
(
ruid
, 
euid
)

120 
d_ruid
 = 
cut
->
uid
;

122 i(
ruid
>0) {

123 i((
cut
->
euid
==
ruid
) ||

124 (
d_ruid
 =
ruid
) ||

125 
	`sur
())

126 
cut
->
uid
 = 
ruid
;

128 (-
EPERM
);

130 i(
euid
>0) {

131 i((
d_ruid
 =
euid
) ||

132 (
cut
->
euid
 ==uid) ||

133 
	`sur
())

134 
cut
->
euid
 =uid;

136 
cut
->
uid
 = 
d_ruid
;

137 (-
EPERM
);

141 
	}
}

143 
	$sys_tuid
(
uid
)

145 (
	`sys_euid
(
uid
, uid));

146 
	}
}

148 
	$sys_ime
(* 

)

150 i(!
	`sur
())

151  -
EPERM
;

152 
tup_time
 = 
	`g_fs_lg
((*)

- 
jiffs
/
HZ
;

154 
	}
}

156 
	$sys_times
(
tms
 * 
tbuf
)

158 i(
tbuf
) {

159 
	`vify_
(
tbuf
, *tbuf);

160 
	`put_fs_lg
(
cut
->
utime
,(*)&
tbuf
->
tms_utime
);

161 
	`put_fs_lg
(
cut
->
ime
,(*)&
tbuf
->
tms_ime
);

162 
	`put_fs_lg
(
cut
->
cutime
,(*)&
tbuf
->
tms_cutime
);

163 
	`put_fs_lg
(
cut
->
cime
,(*)&
tbuf
->
tms_cime
);

165  
jiffs
;

166 
	}
}

168 
	$sys_brk
(
d_da_g
)

170 i(
d_da_g
 >
cut
->
d_code
 &&

171 
d_da_g
 < 
cut
->
t_ack
 - 16384)

172 
cut
->
brk
 = 
d_da_g
;

173  
cut
->
brk
;

174 
	}
}

181 
	$sys_gid
(
pid
, 
pgid
)

183 
i
;

185 i(!
pid
)

186 
pid
 = 
cut
->pid;

187 i(!
pgid
)

188 
pgid
 = 
cut
->
pid
;

189 
i
=0 ; i<
NR_TASKS
 ; i++)

190 i(
sk
[
i
] &&ask[i]->
pid
==pid) {

191 i(
sk
[
i
]->
ad
)

192  -
EPERM
;

193 i(
sk
[
i
]->
ssi
 !
cut
->session)

194  -
EPERM
;

195 
sk
[
i
]->
pg
 = 
pgid
;

198  -
ESRCH
;

199 
	}
}

201 
	$sys_gpg
()

203  
cut
->
pg
;

204 
	}
}

206 
	$sys_tsid
()

208 i(
cut
->
ad
 && !
	`sur
())

209  -
EPERM
;

210 
cut
->
ad
 = 1;

211 
cut
->
ssi
 = cut->
pg
 = cut->
pid
;

212 
cut
->
y
 = -1;

213  
cut
->
pg
;

214 
	}
}

216 
	$sys_ume
(
utame
 * 
me
)

218 
utame
 
thiame
 = {

221 
i
;

223 i(!
me
 -
ERROR
;

224 
	`vify_
(
me
, *name);

225 
i
=0;i< *
me
;i++)

226 
	`put_fs_by
(((*&
thiame
)[
i
],i+(*
me
);

228 
	}
}

230 
	$sys_umask
(
mask
)

232 
d
 = 
cut
->
umask
;

234 
cut
->
umask
 = 
mask
 & 0777;

235  (
d
);

236 
	}
}

	@kernel/system_call.s

33 
	gSIG_CHLD
 = 17

35 
EAX
 = 0x00

36 
EBX
 = 0x04

37 
ECX
 = 0x08

38 
EDX
 = 0x0C

39 
FS
 = 0x10

40 
ES
 = 0x14

41 
DS
 = 0x18

42 
EIP
 = 0x1C

43 
CS
 = 0x20

44 
EFLAGS
 = 0x24

45 
OLDESP
 = 0x28

46 
OLDSS
 = 0x2C

48 
e
 = 0 #the 
e
 
offts
 
to
 
the
 
sk
-.

49 
cou
 = 4

50 
iܙy
 = 8

51 
sigl
 = 12

52 
sigai
 = 16 #MUST 
be
 16 (=
n
 
of
 sigaction)

53 
blocked
 = (33*16)

55 #offt
wh
 
sigai


56 
_hdr
 = 0

57 
_mask
 = 4

58 
_ags
 = 8

59 
_ܔ
 = 12

61 
_syem_s
 = 72

67 .
globl
 
_syem_
,
	g_sys_fk
,
	g_tim_u
,
	g_sys_execve


68 .
globl
 
	g_hd_u
,
	g_py_u
,
	g_Ζ_u


69 .
globl
 
	g_devi_n_avaab
, 
	g_cross_r


71 .
	gign
 2

72 
	gbad_sys_
:

73 
movl
 
$
-1,%
x


74 
	g


75 .
	gign
 2

76 
	gschedu
:

77 
pushl
 
$t_om_sys_


78 
jmp
 
_schedu


79 .
ign
 2

80 
_syem_
:

81 
cm
 
$_syem_s
-1,%
x


82 
ja
 
bad_sys_


83 
	gpush
 %
ds


84 
	gpush
 %
es


85 
	gpush
 %
fs


86 
	gpushl
 %
edx


87 
	gpushl
 %
	gecx
 #push %
	gebx
,%ecx,%
edx
 
as
 
ms


88 
	gpushl
 %
	gebx
 #t
the
 
syem
 



89 
movl
 
	g$0x10
,%
	gedx
 #
up
 
	gds
,
es
 
to
 
kl
 
a


90 
	gmov
 %
	gdx
,%
ds


91 
	gmov
 %
	gdx
,%
es


92 
movl
 
	g$0x17
,%
	gedx
 #f
pots
 
to
 
lol
 
da
 
a


93 
	gmov
 %
	gdx
,%
fs


94 

 
_sys__b
(,%
x
,4)

95 
	gpushl
 %
x


96 
movl
 
	g_cut
,%
x


97 
cm
 
	g$0
,
e
(%
x
) #state

98 
j
 
schedu


99 
cm
 
	g$0
,
cou
(%
x
) #counter

100 
je
 
schedu


101 
	gt_om_sys_
:

102 
movl
 
_cut
,%
	gx
 #sk[0] 

 
have
 
sigls


103 
cm
 
	g_sk
,%
x


104 
	gje
 3f

105 
cmpw
 
	g$0x0f
,
CS
(%
e
#wa
d
 
code
 
gmt
 
	gsurvis
 ?

106 
	gj
 3f

107 
cmpw
 
	g$0x17
,
OLDSS
(%
e
#wa
ack
 
	ggmt
 = 0x17 ?

108 
j
 3f

109 
movl
 
sigl
(%
x
),%
ebx


110 
movl
 
blocked
(%
x
),%
ecx


111 
	gnl
 %
ecx


112 
	gdl
 %
	gebx
,%
ecx


113 
	gbs
 %
	gecx
,%
ecx


114 
	gje
 3f

115 
	gbl
 %
	gecx
,%
ebx


116 
	gmovl
 %
	gebx
,
sigl
(%
x
)

117 
	g
 %
ecx


118 
	gpushl
 %
ecx


119 

 
_do_sigl


120 
	gpl
 %
	gx


121 3: 
pl
 %
x


122 
pl
 %
ebx


123 
pl
 %
ecx


124 
pl
 %
edx


125 
p
 %
fs


126 
p
 %
es


127 
p
 %
ds


128 



130 .
ign
 2

131 
_cross_r
:

132 
push
 %
ds


133 
push
 %
es


134 
push
 %
fs


135 
pushl
 %
edx


136 
pushl
 %
ecx


137 
pushl
 %
ebx


138 
pushl
 %
x


139 
movl
 
$0x10
,%
x


140 
	gmov
 %
	gax
,%
ds


141 
	gmov
 %
	gax
,%
es


142 
movl
 
	g$0x17
,%
x


143 
	gmov
 %
	gax
,%
fs


144 
pushl
 
$t_om_sys_


145 
jmp
 
	g_mh_r


147 .
	gign
 2

148 
	g_devi_n_avaab
:

149 
push
 %
ds


150 
push
 %
es


151 
push
 %
fs


152 
pushl
 %
edx


153 
pushl
 %
ecx


154 
pushl
 %
ebx


155 
pushl
 %
x


156 
movl
 
$0x10
,%
x


157 
	gmov
 %
	gax
,%
ds


158 
	gmov
 %
	gax
,%
es


159 
movl
 
	g$0x17
,%
x


160 
	gmov
 %
	gax
,%
fs


161 
pushl
 
$t_om_sys_


162 
	gts
 #
TS
 
so
 
th
 
we
 
n
 
u
 
mh


163 
	gmovl
 %
	g0
,%
x


164 
l
 
	g$0x4
,%
	gx
 #EM (
mh
 
emuti
 
	gb
)

165 
je
 
_mh_e_e


166 
	gpushl
 %
ebp


167 
	gpushl
 %
esi


168 
	gpushl
 %
edi


169 

 
_mh_emuϋ


170 
	gpl
 %
edi


171 
	gpl
 %
esi


172 
	gpl
 %
ebp


173 
	gt


175 .
	gign
 2

176 
	g_tim_u
:

177 
push
 %
ds
 #vds,
es
 
d
 
put
 
kl
 
da
 
a


178 
	gpush
 %
	ges
 #t
	gthem
. %
fs
 
is
 
ud
 
by
 
_syem_


179 
	gpush
 %
fs


180 
	gpushl
 %
	gedx
 #w
	gve
 %
	gx
,%
	gecx
,%
edx
 
as
 
gcc
 
	gdۢ
't

181 
	gpushl
 %
	gecx
 #v
tho
 
aoss
 
funi
 
	gs
. %
ebx


182 
	gpushl
 %
	gebx
 #i
ved
 
as
 
we
 
u
 
th
 

 
t_sys_


183 
	gpushl
 %
x


184 
movl
 
	g$0x10
,%
x


185 
	gmov
 %
	gax
,%
ds


186 
	gmov
 %
	gax
,%
es


187 
movl
 
	g$0x17
,%
x


188 
	gmov
 %
	gax
,%
fs


189 

 
_jiffs


190 
movb
 
	g$0x20
,%
	g
 #EOI 
to
 
u
 
	gcڌr
 #1

191 
	goutb
 %
	g
,
$0x20


192 
movl
 
CS
(%
e
),%
x


193 
dl
 
	g$3
,%
	gx
 #%
x
 
is
 
	$CPL
 (0 

 3, 0=
survis
)

194 
pushl
 %
x


195 

 
_do_tim
 #'
	`do_tim
(
CPL
)' doesverything from

196 
addl
 
$4
,%
e
 #sk 
swchg
 
to
 
accoug
 ...

197 
jmp
 
t_om_sys_


199 .
ign
 2

200 
_sys_execve
:

201 
a
 
	`EIP
(%
e
),%
x


202 
pushl
 %
x


203 

 
_do_execve


204 
addl
 
$4
,%
e


205 
t


207 .
ign
 2

208 
_sys_fk
:

209 

 
_fd_emy_oss


210 
l
 %
x
,%eax

211 
js
 1f

212 
push
 %
gs


213 
pushl
 %
esi


214 
pushl
 %
edi


215 
pushl
 %
ebp


216 
pushl
 %
x


217 

 
_cy_oss


218 
addl
 
$20
,%
e


219 1: 
t


221 
_hd_u
:

222 
pushl
 %
x


223 
pushl
 %
ecx


224 
pushl
 %
edx


225 
push
 %
ds


226 
push
 %
es


227 
push
 %
fs


228 
movl
 
$0x10
,%
x


229 
mov
 %
ax
,%
ds


230 
mov
 %
ax
,%
es


231 
movl
 
$0x17
,%
x


232 
mov
 %
ax
,%
fs


233 
movb
 
$0x20
,%



234 
outb
 %

,
$0xA0
 #EOI 
to
 
u
 
cڌr
 #1

235 
jmp
 1#giv
pt
 
ch
 
to
 
bhe


236 1: 
jmp
 1f

237 1: 
xl
 %
edx
,%edx

238 
xchgl
 
_do_hd
,%
edx


239 
l
 %
edx
,%edx

240 
j
 1f

241 
movl
 
$_uxed_hd_u
,%
edx


242 1: 
outb
 %

,
$0x20


243 

 *%
edx
 #"
g
" way of handling intr.

244 
p
 %
fs


245 
p
 %
es


246 
p
 %
ds


247 
pl
 %
edx


248 
pl
 %
ecx


249 
pl
 %
x


250 



252 
_py_u
:

253 
pushl
 %
x


254 
pushl
 %
ecx


255 
pushl
 %
edx


256 
push
 %
ds


257 
push
 %
es


258 
push
 %
fs


259 
movl
 
$0x10
,%
x


260 
mov
 %
ax
,%
ds


261 
mov
 %
ax
,%
es


262 
movl
 
$0x17
,%
x


263 
mov
 %
ax
,%
fs


264 
movb
 
$0x20
,%



265 
outb
 %

,
$0x20
 #EOI 
to
 
u
 
cڌr
 #1

266 
xl
 %
x
,%eax

267 
xchgl
 
_do_py
,%
x


268 
l
 %
x
,%eax

269 
j
 1f

270 
movl
 
$_uxed_py_u
,%
x


271 1: 

 *%
x
 #"
g
" way of handling intr.

272 
p
 %
fs


273 
p
 %
es


274 
p
 %
ds


275 
pl
 %
edx


276 
pl
 %
ecx


277 
pl
 %
x


278 



280 
_Ζ_u
:

281 
pushl
 %
x


282 
movb
 
$0x20
,%



283 
outb
 %

,
$0x20


284 
pl
 %
x


285 



	@kernel/traps.c

13 
	~<rg.h
>

15 
	~<lux/hd.h
>

16 
	~<lux/sched.h
>

17 
	~<lux/kl.h
>

18 
	~<asm/syem.h
>

19 
	~<asm/gmt.h
>

20 
	~<asm/io.h
>

22 
	#g_g_by
(
g
,
addr
) ({ \

23 
__s
; \

24 
	`__asm__
("push %%fs;mov %%ax,%%fs;movb %%fs:%2,%%al;pop %%fs" \

25 :"" (
__s
):"0" (
g
),"m" (*(
addr
))); \

26 
__s
;})

	)

28 
	#g_g_lg
(
g
,
addr
) ({ \

29 
__s
; \

30 
	`__asm__
("push %%fs;mov %%ax,%%fs;movl %%fs:%2,%%eax;pop %%fs" \

31 :"" (
__s
):"0" (
g
),"m" (*(
addr
))); \

32 
__s
;})

	)

34 
	#_fs
() ({ \

35 
__s
; \

36 
	`__asm__
("mov %%fs,%%ax":"" (
__s
):); \

37 
__s
;})

	)

39 
do_ex
(
code
);

41 
ge_exi
();

43 
divide_r
();

44 
debug
();

45 
nmi
();

46 
t3
();

47 
ovow
();

48 
bounds
();

49 
vid_
();

50 
devi_n_avaab
();

51 
doub_u
();

52 
cross_gmt_ovrun
();

53 
vid_TSS
();

54 
gmt_n_e
();

55 
ack_gmt
();

56 
g_ei
();

57 
ge_u
();

58 
cross_r
();

59 
rved
();

60 
Ζ_u
();

61 
q13
();

63 
	$d
(* 
r
,
e_r
,

)

65 * 
e
 = (*
e_r
;

66 
i
;

68 
	`tk
("%s: %04x\n\r",
r
,

&0xffff);

69 
	`tk
("EIP:\t%04x:%p\nEFLAGS:\t%p\nESP:\t%04x:%p\n",

70 
e
[1],esp[0],esp[2],esp[4],esp[3]);

71 
	`tk
("fs: %04x\n",
	`_fs
());

72 
	`tk
("ba: %p,im: %p\n",
	`g_ba
(
cut
->
ldt
[1]),
	`g_lim
(0x17));

73 i(
e
[4] == 0x17) {

74 
	`tk
("Stack: ");

75 
i
=0;i<4;i++)

76 
	`tk
("%",
	`g_g_lg
(0x17,
i
+(*)
e
[3]));

77 
	`tk
("\n");

79 
	`r
(
i
);

80 
	`tk
("Pid: %d,ros: %d\n\r",
cut
->
pid
,0xfff& 
i
);

81 
i
=0;i<10;i++)

82 
	`tk
("%02x ",0xf& 
	`g_g_by
(
e
[1],(
i
+(*)esp[0])));

83 
	`tk
("\n\r");

84 
	`do_ex
(11);

85 
	}
}

87 
	$do_doub_u
(
e
, 
r_code
)

89 
	`d
("doub fau",
e
,
r_code
);

90 
	}
}

92 
	$do_g_ei
(
e
, 
r_code
)

94 
	`d
("grei",
e
,
r_code
);

95 
	}
}

97 
	$do_divide_r
(
e
, 
r_code
)

99 
	`d
("dividr",
e
,
r_code
);

100 
	}
}

102 
	$do_t3
(* 
e
, 
r_code
,

103 
fs
,
es
,
ds
,

104 
ebp
,
esi
,
edi
,

105 
edx
,
ecx
,
ebx
,
x
)

107 

;

109 
	`__asm__
("%%ax":"" (

):"0" (0));

110 
	`tk
("eax\t\tebx\t\tecx\t\tedx\n\r%8x\t%8x\t%8x\t%8x\n\r",

111 
x
,
ebx
,
ecx
,
edx
);

112 
	`tk
("esi\t\tedi\t\tebp\t\tesp\n\r%8x\t%8x\t%8x\t%8x\n\r",

113 
esi
,
edi
,
ebp
,(
e
);

114 
	`tk
("\n\rds\tes\tfs\ttr\n\r%4x\t%4x\t%4x\t%4x\n\r",

115 
ds
,
es
,
fs
,

);

116 
	`tk
("EIP: %8x CS: %4x EFLAGS: %8x\n\r",
e
[0],esp[1],esp[2]);

117 
	}
}

119 
	$do_nmi
(
e
, 
r_code
)

121 
	`d
("nmi",
e
,
r_code
);

122 
	}
}

124 
	$do_debug
(
e
, 
r_code
)

126 
	`d
("debug",
e
,
r_code
);

127 
	}
}

129 
	$do_ovow
(
e
, 
r_code
)

131 
	`d
("ovow",
e
,
r_code
);

132 
	}
}

134 
	$do_bounds
(
e
, 
r_code
)

136 
	`d
("bounds",
e
,
r_code
);

137 
	}
}

139 
	$do_vid_
(
e
, 
r_code
)

141 
	`d
("vid ond",
e
,
r_code
);

142 
	}
}

144 
	$do_devi_n_avaab
(
e
, 
r_code
)

146 
	`d
("deviهvaab",
e
,
r_code
);

147 
	}
}

149 
	$do_cross_gmt_ovrun
(
e
, 
r_code
)

151 
	`d
("cross segmovrun",
e
,
r_code
);

152 
	}
}

154 
	$do_vid_TSS
(
e
,
r_code
)

156 
	`d
("vid TSS",
e
,
r_code
);

157 
	}
}

159 
	$do_gmt_n_e
(
e
,
r_code
)

161 
	`d
("gmnم",
e
,
r_code
);

162 
	}
}

164 
	$do_ack_gmt
(
e
,
r_code
)

166 
	`d
("ack segmt",
e
,
r_code
);

167 
	}
}

169 
	$do_cross_r
(
e
, 
r_code
)

171 i(
ϡ_sk_ud_mh
 !
cut
)

173 
	`d
("cross܃",
e
,
r_code
);

174 
	}
}

176 
	$do_rved
(
e
, 
r_code
)

178 
	`d
("rved (15,17-47r",
e
,
r_code
);

179 
	}
}

181 
	$_
()

183 
i
;

185 
	`t__ge
(0,&
divide_r
);

186 
	`t__ge
(1,&
debug
);

187 
	`t__ge
(2,&
nmi
);

188 
	`t_syem_ge
(3,&
t3
);

189 
	`t_syem_ge
(4,&
ovow
);

190 
	`t_syem_ge
(5,&
bounds
);

191 
	`t__ge
(6,&
vid_
);

192 
	`t__ge
(7,&
devi_n_avaab
);

193 
	`t__ge
(8,&
doub_u
);

194 
	`t__ge
(9,&
cross_gmt_ovrun
);

195 
	`t__ge
(10,&
vid_TSS
);

196 
	`t__ge
(11,&
gmt_n_e
);

197 
	`t__ge
(12,&
ack_gmt
);

198 
	`t__ge
(13,&
g_ei
);

199 
	`t__ge
(14,&
ge_u
);

200 
	`t__ge
(15,&
rved
);

201 
	`t__ge
(16,&
cross_r
);

202 
i
=17;i<48;i++)

203 
	`t__ge
(
i
,&
rved
);

204 
	`t__ge
(45,&
q13
);

205 
	`outb_p
(
	`b_p
(0x21)&0xfb,0x21);

206 
	`outb
(
	`b_p
(0xA1)&0xdf,0xA1);

207 
	`t__ge
(39,&
Ζ_u
);

208 
	}
}

	@kernel/vsprintf.c

12 
	~<dg.h
>

13 
	~<rg.h
>

16 
	#is_dig
(
c
((c>'0' && (c<'9')

	)

18 
	$sk_oi
(cڡ **
s
)

20 
i
=0;

22 
	`is_dig
(**
s
))

23 
i
 = i*10 + *((*
s
)++) - '0';

24  
i
;

25 
	}
}

27 
	#ZEROPAD
 1

	)

28 
	#SIGN
 2

	)

29 
	#PLUS
 4

	)

30 
	#SPACE
 8

	)

31 
	#LEFT
 16

	)

32 
	#SPECIAL
 32

	)

33 
	#SMALL
 64

	)

35 
	#do_div
(
n
,
ba
) ({ \

36 
__s
; \

37 
	`__asm__
("div%4":"" (
n
),"=d" (
__s
):"0" (n),"1" (0),"r" (
ba
)); \

38 
__s
; })

	)

40 * 
	$numb
(* 
r
, 
num
, 
ba
, 
size
, 
ecisi


41 ,
ty
)

43 
c
,
sign
,
tmp
[36];

44 cڡ *
digs
="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

45 
i
;

47 i(
ty
&
SMALL

digs
="0123456789abcdefghijklmnopqrstuvwxyz";

48 i(
ty
&
LEFT
ty &~
ZEROPAD
;

49 i(
ba
<2 || base>36)

51 
c
 = (
ty
 & 
ZEROPAD
) ? '0' : ' ' ;

52 i(
ty
&
SIGN
 && 
num
<0) {

53 
sign
='-';

54 
num
 = -num;

56 
sign
=(
ty
&
PLUS
? '+' : (y&
SPACE
) ? ' ' : 0);

57 i(
sign

size
--;

58 i(
ty
&
SPECIAL
)

59 i(
ba
==16
size
 -= 2;

60 i(
ba
==8
size
--;

61 
i
=0;

62 i(
num
==0)

63 
tmp
[
i
++]='0';

64 
num
!=0)

65 
tmp
[
i
++]=
digs
[
	`do_div
(
num
,
ba
)];

66 i(
i
>
ecisi
)recision=i;

67 
size
 -
ecisi
;

68 i(!(
ty
&(
ZEROPAD
+
LEFT
)))

69 
size
-->0)

70 *
r
++ = ' ';

71 i(
sign
)

72 *
r
++ = 
sign
;

73 i(
ty
&
SPECIAL
)

74 i(
ba
==8)

75 *
r
++ = '0';

76 i(
ba
==16) {

77 *
r
++ = '0';

78 *
r
++ = 
digs
[33];

80 i(!(
ty
&
LEFT
))

81 
size
-->0)

82 *
r
++ = 
c
;

83 
i
<
ecisi
--)

84 *
r
++ = '0';

85 
i
-->0)

86 *
r
++ = 
tmp
[
i
];

87 
size
-->0)

88 *
r
++ = ' ';

89  
r
;

90 
	}
}

92 
	$vrtf
(*
buf
, cڡ *
fmt
, 
va_li
 
gs
)

94 
n
;

95 
i
;

96 * 
r
;

97 *
s
;

98 *

;

100 
ags
;

102 
fld_width
;

103 
ecisi
;

105 
quifr
;

107 
r
=
buf
 ; *
fmt
 ; ++fmt) {

108 i(*
fmt
 != '%') {

109 *
r
++ = *
fmt
;

114 
ags
 = 0;

115 

:

116 ++
fmt
;

117 *
fmt
) {

118 '-': 
ags
 |
LEFT
; 

;

119 '+': 
ags
 |
PLUS
; 

;

120 ' ': 
ags
 |
SPACE
; 

;

121 '#': 
ags
 |
SPECIAL
; 

;

122 '0': 
ags
 |
ZEROPAD
; 

;

126 
fld_width
 = -1;

127 i(
	`is_dig
(*
fmt
))

128 
fld_width
 = 
	`sk_oi
(&
fmt
);

129 i(*
fmt
 == '*') {

131 
fld_width
 = 
	`va_g
(
gs
, );

132 i(
fld_width
 < 0) {

133 
fld_width
 = -field_width;

134 
ags
 |
LEFT
;

139 
ecisi
 = -1;

140 i(*
fmt
 == '.') {

141 ++
fmt
;

142 i(
	`is_dig
(*
fmt
))

143 
ecisi
 = 
	`sk_oi
(&
fmt
);

144 i(*
fmt
 == '*') {

146 
ecisi
 = 
	`va_g
(
gs
, );

148 i(
ecisi
 < 0)

149 
ecisi
 = 0;

153 
quifr
 = -1;

154 i(*
fmt
 == 'h' || *fmt == 'l' || *fmt == 'L') {

155 
quifr
 = *
fmt
;

156 ++
fmt
;

159 *
fmt
) {

161 i(!(
ags
 & 
LEFT
))

162 --
fld_width
 > 0)

163 *
r
++ = ' ';

164 *
r
++ = (
	`va_g
(
gs
, );

165 --
fld_width
 > 0)

166 *
r
++ = ' ';

170 
s
 = 
	`va_g
(
gs
, *);

171 
n
 = 
	`
(
s
);

172 i(
ecisi
 < 0)

173 
ecisi
 = 
n
;

174 i(
n
 > 
ecisi
)

175 
n
 = 
ecisi
;

177 i(!(
ags
 & 
LEFT
))

178 
n
 < 
fld_width
--)

179 *
r
++ = ' ';

180 
i
 = 0; i < 
n
; ++i)

181 *
r
++ = *
s
++;

182 
n
 < 
fld_width
--)

183 *
r
++ = ' ';

187 
r
 = 
	`numb
(r, 
	`va_g
(
gs
, ), 8,

188 
fld_width
, 
ecisi
, 
ags
);

192 i(
fld_width
 == -1) {

193 
fld_width
 = 8;

194 
ags
 |
ZEROPAD
;

196 
r
 = 
	`numb
(str,

197 (
	`va_g
(
gs
, *), 16,

198 
fld_width
, 
ecisi
, 
ags
);

202 
ags
 |
SMALL
;

204 
r
 = 
	`numb
(r, 
	`va_g
(
gs
, ), 16,

205 
fld_width
, 
ecisi
, 
ags
);

210 
ags
 |
SIGN
;

212 
r
 = 
	`numb
(r, 
	`va_g
(
gs
, ), 10,

213 
fld_width
, 
ecisi
, 
ags
);

217 

 = 
	`va_g
(
gs
, *);

218 *

 = (
r
 - 
buf
);

222 i(*
fmt
 != '%')

223 *
r
++ = '%';

224 i(*
fmt
)

225 *
r
++ = *
fmt
;

227 --
fmt
;

231 *
r
 = '\0';

232  
r
-
buf
;

233 
	}
}

	@lib/_exit.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

10 vީ
	$_ex
(
ex_code
)

12 
	`__asm__
("$0x80"::"a" (
__NR_ex
),"b" (
ex_code
));

13 
	}
}

	@lib/close.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

10 
_sys1
(,
o
,,
fd
)

	@lib/ctype.c

7 
	~<y.h
>

9 
	g_mp
;

10 
	g_y
[] = {0x00,

11 
_C
,_C,_C,_C,_C,_C,_C,_C,

12 
_C
,_C|
_S
,_C|_S,_C|_S,_C|_S,_C|_S,_C,_C,

13 
_C
,_C,_C,_C,_C,_C,_C,_C,

14 
_C
,_C,_C,_C,_C,_C,_C,_C,

15 
_S
|
_SP
,
_P
,_P,_P,_P,_P,_P,_P,

16 
_P
,_P,_P,_P,_P,_P,_P,_P,

17 
_D
,_D,_D,_D,_D,_D,_D,_D,

18 
_D
,_D,
_P
,_P,_P,_P,_P,_P,

19 
_P
,
_U
|
_X
,_U|_X,_U|_X,_U|_X,_U|_X,_U|_X,_U,

20 
_U
,_U,_U,_U,_U,_U,_U,_U,

21 
_U
,_U,_U,_U,_U,_U,_U,_U,

22 
_U
,_U,_U,
_P
,_P,_P,_P,_P,

23 
_P
,
_L
|
_X
,_L|_X,_L|_X,_L|_X,_L|_X,_L|_X,_L,

24 
_L
,_L,_L,_L,_L,_L,_L,_L,

25 
_L
,_L,_L,_L,_L,_L,_L,_L,

26 
_L
,_L,_L,
_P
,_P,_P,_P,
_C
,

	@lib/dup.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

10 
_sys1
(,
dup
,,
fd
)

	@lib/errno.c

7 
	go
;

	@lib/execve.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

10 
_sys3
(,
execve
,cڡ *,
fe
,**,
gv
,**,
vp
)

	@lib/malloc.c

48 
	~<lux/kl.h
>

49 
	~<lux/mm.h
>

50 
	~<asm/syem.h
>

52 
	sbuck_desc
 {

53 *
	mge
;

54 
buck_desc
 *
	mxt
;

55 *
	m䓱r
;

56 
	mft
;

57 
	mbuck_size
;

60 
	s_buck_d
 {

61 
	msize
;

62 
buck_desc
 *
	mcha
;

77 
_buck_d
 
	gbuck_d
[] = {

78 { 16, (
buck_desc
 *) 0},

79 { 32, (
buck_desc
 *) 0},

80 { 64, (
buck_desc
 *) 0},

81 { 128, (
buck_desc
 *) 0},

82 { 256, (
buck_desc
 *) 0},

83 { 512, (
buck_desc
 *) 0},

84 { 1024, (
buck_desc
 *) 0},

85 { 2048, (
buck_desc
 *) 0},

86 { 4096, (
buck_desc
 *) 0},

87 { 0, (
buck_desc
 *) 0}};

92 
buck_desc
 *
	g_buck_desc
 = (bucket_desc *) 0;

97 
le
 
	$_buck_desc
()

99 
buck_desc
 *
bdesc
, *
f
;

100 
i
;

102 
f
 = 
bdesc
 = (
buck_desc
 *
	`g__ge
();

103 i(!
bdesc
)

104 
	`nic
("Out of memory in init_bucket_desc()");

105 
i
 = 
PAGE_SIZE
/(
buck_desc
); i > 1; i--) {

106 
bdesc
->
xt
 = bdesc+1;

107 
bdesc
++;

113 
bdesc
->
xt
 = 
_buck_desc
;

114 
_buck_desc
 = 
f
;

115 
	}
}

117 *
	$mloc
(
n
)

119 
_buck_d
 *
bd
;

120 
buck_desc
 *
bdesc
;

121 *
tv
;

127 
bd
 = 
buck_d
; bd->
size
; bdir++)

128 i(
bd
->
size
 >
n
)

130 i(!
bd
->
size
) {

131 
	`tk
("malloc called with impossiblyargergument (%d)\n",

132 
n
);

133 
	`nic
("malloc: badrg");

138 
	`i
();

139 
bdesc
 = 
bd
->
cha
; bdesc; bdesbdesc->
xt
)

140 i(
bdesc
->
䓱r
)

146 i(!
bdesc
) {

147 *

;

148 
i
;

150 i(!
_buck_desc
)

151 
	`_buck_desc
();

152 
bdesc
 = 
_buck_desc
;

153 
_buck_desc
 = 
bdesc
->
xt
;

154 
bdesc
->
ft
 = 0;

155 
bdesc
->
buck_size
 = 
bd
->
size
;

156 
bdesc
->
ge
 = bdesc->
䓱r
 = (*

 = 
	`g__ge
();

157 i(!

)

158 
	`nic
("Out of memory in kernel malloc()");

160 
i
=
PAGE_SIZE
/
bd
->
size
; i > 1; i--) {

161 *((**

 + 
bd
->
size
;

162 

 +
bd
->
size
;

164 *((**

) = 0;

165 
bdesc
->
xt
 = 
bd
->
cha
;

166 
bd
->
cha
 = 
bdesc
;

168 
tv
 = (*
bdesc
->
䓱r
;

169 
bdesc
->
䓱r
 = *((**
tv
);

170 
bdesc
->
ft
++;

171 
	`i
();

172 (
tv
);

173 
	}
}

182 
	$_s
(*
obj
, 
size
)

184 *
ge
;

185 
_buck_d
 *
bd
;

186 
buck_desc
 *
bdesc
, *
ev
;

189 
ge
 = (*((
obj
 & 0xfffff000);

191 
bd
 = 
buck_d
; bd->
size
; bdir++) {

192 
ev
 = 0;

194 i(
bd
->
size
 < size)

196 
bdesc
 = 
bd
->
cha
; bdesc; bdesbdesc->
xt
) {

197 i(
bdesc
->
ge
 ==age)

198 
found
;

199 
ev
 = 
bdesc
;

202 
	`nic
("Badddressassedo kernel free_s()");

203 
found
:

204 
	`i
();

205 *((**)
obj

bdesc
->
䓱r
;

206 
bdesc
->
䓱r
 = 
obj
;

207 
bdesc
->
ft
--;

208 i(
bdesc
->
ft
 == 0) {

213 i((
ev
 && (ev->
xt
 !
bdesc
)) ||

214 (!
ev
 && (
bd
->
cha
 !
bdesc
)))

215 
ev
 = 
bd
->
cha
;v;v =v->
xt
)

216 i(
ev
->
xt
 =
bdesc
)

218 i(
ev
)

219 
ev
->
xt
 = 
bdesc
->next;

221 i(
bd
->
cha
 !
bdesc
)

222 
	`nic
("malloc bucket chains corrupted");

223 
bd
->
cha
 = 
bdesc
->
xt
;

225 
	`_ge
((
bdesc
->
ge
);

226 
bdesc
->
xt
 = 
_buck_desc
;

227 
_buck_desc
 = 
bdesc
;

229 
	`i
();

231 
	}
}

	@lib/open.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

9 
	~<dg.h
>

11 
	$ݒ
(cڡ * 
fame
, 
ag
, ...)

13 
s
;

14 
va_li
 
g
;

16 
	`va_t
(
g
,
ag
);

17 
	`__asm__
("int $0x80"

18 :"" (
s
)

19 :"0" (
__NR_ݒ
),"b" (
fame
),"c" (
ag
),

20 "d" (
	`va_g
(
g
,)));

21 i(
s
>=0)

22  
s
;

23 
o
 = -
s
;

25 
	}
}

	@lib/setsid.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

10 
_sys0
(
pid_t
,
tsid
)

	@lib/string.c

7 #ide
__GNUC__


8 #r 
I
 
wt
 
gcc
!

11 

	)

12 
	#le


	)

13 
	#__LIBRARY__


	)

14 
	~<rg.h
>

	@lib/wait.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

9 
	~<sys/wa.h
>

11 
	$_sys3
(
pid_t
,
wapid
,pid_t,
pid
,*,
wa_
,,
tis
)

13 
pid_t
 
	$wa
(* 
wa_
)

15  
	`wapid
(-1,
wa_
,0);

16 
	}
}

	@lib/write.c

7 
	#__LIBRARY__


	)

8 
	~<unid.h
>

10 
_sys3
(,
wre
,,
fd
,cڡ *,
buf
,
off_t
,
cou
)

	@mm/memory.c

23 
	~<sigl.h
>

25 
	~<asm/syem.h
>

27 
	~<lux/sched.h
>

28 
	~<lux/hd.h
>

29 
	~<lux/kl.h
>

31 vީ
do_ex
(
code
);

33 
le
 vީ
	$oom
()

35 
	`tk
("out of memory\n\r");

36 
	`do_ex
(
SIGSEGV
);

37 
	}
}

39 
	#vide
() \

40 
	`__asm__
("mov%%x,%%3"::"a" (0))

	)

43 
	#LOW_MEM
 0x100000

44 
	#PAGING_MEMORY
 (15*1024*1024)

45 
	#PAGING_PAGES
 (
PAGING_MEMORY
>>12)

46 
	#MAP_NR
(
addr
((ddr)-
LOW_MEM
)>>12)

47 
	#USED
 100

48 

	)

49 
	#CODE_SPACE
(
addr
) ((((addr)+4095)&~4095) < \

50 
cut
->
t_code
 + cut->
d_code
)

51 

	)

52 
	gHIGH_MEMORY
 = 0;

54 
	#cy_ge
(
om
,
to
) \

55 
	`__asm__
("d ; ; mov"::"S" (
om
),"D" (
to
),"c" (1024):"cx","di","si")

	)

57 
	gmem_m
 [ 
PAGING_PAGES
 ] = {0,};

63 
	$g__ge
()

65 
__s
 
	`asm
("ax");

67 
	`__asm__
("std ;epne ; scasb\n\t"

78 :"" (
__s
)

79 :"0" (0),"i" (
LOW_MEM
),"c" (
PAGING_PAGES
),

80 "D" (
mem_m
+
PAGING_PAGES
-1)

82  
__s
;

83 
	}
}

89 
	$_ge
(
addr
)

91 i(
addr
 < 
LOW_MEM
) ;

92 i(
addr
 >
HIGH_MEMORY
)

93 
	`nic
("tryingo freeonexistentage");

94 
addr
 -
LOW_MEM
;

95 
addr
 >>= 12;

96 i(
mem_m
[
addr
]--) ;

97 
mem_m
[
addr
]=0;

98 
	`nic
("tryingo free freeage");

99 
	}
}

105 
	$_ge_bs
(
om
,
size
)

107 *
pg_b
;

108 * 
d
, 

;

110 i(
om
 & 0x3fffff)

111 
	`nic
("free_page_tables called with wronglignment");

112 i(!
om
)

113 
	`nic
("Tryingo free up swapper memory space");

114 
size
 = (size + 0x3fffff) >> 22;

115 
d
 = (*((
om
>>20) & 0xffc);

116  ; 
size
-->0 ; 
d
++) {

117 i(!(1 & *
d
))

119 
pg_b
 = (*(0xfffff000 & *
d
);

120 

=0 ;r<1024 ;r++) {

121 i(1 & *
pg_b
)

122 
	`_ge
(0xfffff000 & *
pg_b
);

123 *
pg_b
 = 0;

124 
pg_b
++;

126 
	`_ge
(0xfffff000 & *
d
);

127 *
d
 = 0;

129 
	`vide
();

131 
	}
}

150 
	$cy_ge_bs
(
om
,
to
,
size
)

152 * 
om_ge_b
;

153 * 
to_ge_b
;

154 
this_ge
;

155 * 
om_d
, * 
to_d
;

156 

;

158 i((
om
&0x3fffff|| (
to
&0x3fffff))

159 
	`nic
("copy_page_tables called with wronglignment");

160 
om_d
 = (*((
om
>>20) & 0xffc);

161 
to_d
 = (*((
to
>>20) & 0xffc);

162 
size
 = (() (size+0x3fffff)) >> 22;

163  ; 
size
-->0 ; 
om_d
++,
to_d
++) {

164 i(1 & *
to_d
)

165 
	`nic
("copy_page_tables:lreadyxist");

166 i(!(1 & *
om_d
))

168 
om_ge_b
 = (*(0xfffff000 & *
om_d
);

169 i(!(
to_ge_b
 = (*
	`g__ge
()))

171 *
to_d
 = ((
to_ge_b
) | 7;

172 

 = (
om
==0)?0xA0:1024;

173  ; 

-- > 0 ; 
om_ge_b
++,
to_ge_b
++) {

174 
this_ge
 = *
om_ge_b
;

175 i(!(1 & 
this_ge
))

177 
this_ge
 &= ~2;

178 *
to_ge_b
 = 
this_ge
;

179 i(
this_ge
 > 
LOW_MEM
) {

180 *
om_ge_b
 = 
this_ge
;

181 
this_ge
 -
LOW_MEM
;

182 
this_ge
 >>= 12;

183 
mem_m
[
this_ge
]++;

187 
	`vide
();

189 
	}
}

197 
	$put_ge
(
ge
,
addss
)

199 
tmp
, *
ge_b
;

203 i(
ge
 < 
LOW_MEM
 ||ag>
HIGH_MEMORY
)

204 
	`tk
("Trygpug% %p\n",
ge
,
addss
);

205 i(
mem_m
[(
ge
-
LOW_MEM
)>>12] != 1)

206 
	`tk
("mem_m digewh % %p\n",
ge
,
addss
);

207 
ge_b
 = (*((
addss
>>20) & 0xffc);

208 i((*
ge_b
)&1)

209 
ge_b
 = (*) (0xfffff000 & *page_table);

211 i(!(
tmp
=
	`g__ge
()))

213 *
ge_b
 = 
tmp
|7;

214 
ge_b
 = (*
tmp
;

216 
ge_b
[(
addss
>>12& 0x3ff] = 
ge
 | 7;

218  
ge
;

219 
	}
}

221 
	$un_wp_ge
(* 
b_y
)

223 
d_ge
,
w_ge
;

225 
d_ge
 = 0xfffff000 & *
b_y
;

226 i(
d_ge
 >
LOW_MEM
 && 
mem_m
[
	`MAP_NR
(old_page)]==1) {

227 *
b_y
 |= 2;

228 
	`vide
();

231 i(!(
w_ge
=
	`g__ge
()))

232 
	`oom
();

233 i(
d_ge
 >
LOW_MEM
)

234 
mem_m
[
	`MAP_NR
(
d_ge
)]--;

235 *
b_y
 = 
w_ge
 | 7;

236 
	`vide
();

237 
	`cy_ge
(
d_ge
,
w_ge
);

238 
	}
}

247 
	$do_wp_ge
(
r_code
,
addss
)

252 i(
	`CODE_SPACE
(
addss
))

253 
	`do_ex
(
SIGSEGV
);

255 
	`un_wp_ge
((*)

256 (((
addss
>>10) & 0xffc) + (0xfffff000 &

257 *((*((
addss
>>20) &0xffc)))));

259 
	}
}

261 
	$wre_vify
(
addss
)

263 
ge
;

265 i(!(
ge
 = *((*((
addss
>>20) & 0xffc)) )&1))

267 
ge
 &= 0xfffff000;

268 
ge
 +((
addss
>>10) & 0xffc);

269 i((3 & *(*
ge
) == 1)

270 
	`un_wp_ge
((*
ge
);

272 
	}
}

274 
	$g_emy_ge
(
addss
)

276 
tmp
;

278 i(!(
tmp
=
	`g__ge
()|| !
	`put_ge
mp,
addss
)) {

279 
	`_ge
(
tmp
);

280 
	`oom
();

282 
	}
}

292 
	$y_to_she
(
addss
, 
sk_ru
 * 
p
)

294 
om
;

295 
to
;

296 
om_ge
;

297 
to_ge
;

298 
phys_addr
;

300 
om_ge
 = 
to_ge
 = ((
addss
>>20) & 0xffc);

301 
om_ge
 +((
p
->
t_code
>>20) & 0xffc);

302 
to_ge
 +((
cut
->
t_code
>>20) & 0xffc);

304 
om
 = *(*
om_ge
;

305 i(!(
om
 & 1))

307 
om
 &= 0xfffff000;

308 
om_ge
 = 
om
 + ((
addss
>>10) & 0xffc);

309 
phys_addr
 = *(*
om_ge
;

311 i((
phys_addr
 & 0x41) != 0x01)

313 
phys_addr
 &= 0xfffff000;

314 i(
phys_addr
 >
HIGH_MEMORY
 ||hys_add< 
LOW_MEM
)

316 
to
 = *(*
to_ge
;

317 i(!(
to
 & 1))

318 i(
to
 = 
	`g__ge
())

319 *(*
to_ge
 = 
to
 | 7;

321 
	`oom
();

322 
to
 &= 0xfffff000;

323 
to_ge
 = 
to
 + ((
addss
>>10) & 0xffc);

324 i(1 & *(*
to_ge
)

325 
	`nic
("try_to_share:o_pagelreadyxists");

327 *(*
om_ge
 &= ~2;

328 *(*
to_ge
 = *(*
om_ge
;

329 
	`vide
();

330 
phys_addr
 -
LOW_MEM
;

331 
phys_addr
 >>= 12;

332 
mem_m
[
phys_addr
]++;

334 
	}
}

344 
	$she_ge
(
addss
)

346 
sk_ru
 ** 
p
;

348 i(!
cut
->
execub
)

350 i(
cut
->
execub
->
i_cou
 < 2)

352 
p
 = &
LAST_TASK
 ; > &
FIRST_TASK
 ; --p) {

353 i(!*
p
)

355 i(
cut
 =*
p
)

357 i((*
p
)->
execub
 !
cut
->executable)

359 i(
	`y_to_she
(
addss
,*
p
))

363 
	}
}

365 
	$do_no_ge
(
r_code
,
addss
)

367 

[4];

368 
tmp
;

369 
ge
;

370 
block
,
i
;

372 
addss
 &= 0xfffff000;

373 
tmp
 = 
addss
 - 
cut
->
t_code
;

374 i(!
cut
->
execub
 || 
tmp
 >cut->
d_da
) {

375 
	`g_emy_ge
(
addss
);

378 i(
	`she_ge
(
tmp
))

380 i(!(
ge
 = 
	`g__ge
()))

381 
	`oom
();

383 
block
 = 1 + 
tmp
/
BLOCK_SIZE
;

384 
i
=0 ; i<4 ; 
block
++,i++)

385 

[
i
] = 
	`bm
(
cut
->
execub
,
block
);

386 
	`bad_ge
(
ge
,
cut
->
execub
->
i_dev
,

);

387 
i
 = 
tmp
 + 4096 - 
cut
->
d_da
;

388 
tmp
 = 
ge
 + 4096;

389 
i
-- > 0) {

390 
tmp
--;

391 *(*)
tmp
 = 0;

393 i(
	`put_ge
(
ge
,
addss
))

395 
	`_ge
(
ge
);

396 
	`oom
();

397 
	}
}

399 
	$mem_
(
t_mem
, 
d_mem
)

401 
i
;

403 
HIGH_MEMORY
 = 
d_mem
;

404 
i
=0 ; i<
PAGING_PAGES
 ; i++)

405 
mem_m
[
i
] = 
USED
;

406 
i
 = 
	`MAP_NR
(
t_mem
);

407 
d_mem
 -
t_mem
;

408 
d_mem
 >>= 12;

409 
d_mem
-->0)

410 
mem_m
[
i
++]=0;

411 
	}
}

413 
	$lc_mem
()

415 
i
,
j
,
k
,

=0;

416 * 
pg_tbl
;

418 
i
=0 ; i<
PAGING_PAGES
 ; i++)

419 i(!
mem_m
[
i
]

++;

420 
	`tk
("%dage (o%d)\n\r",

,
PAGING_PAGES
);

421 
i
=2 ; i<1024 ; i++) {

422 i(1&
pg_d
[
i
]) {

423 
pg_tbl
=(*(0xfffff000 & 
pg_d
[
i
]);

424 
j
=
k
=0 ; j<1024 ; j++)

425 i(
pg_tbl
[
j
]&1)

426 
k
++;

427 
	`tk
("Pg-d[%d] u%dages\n",
i
,
k
);

430 
	}
}

	@mm/page.s

12 .
globl
 
_ge_u


14 
	g_ge_u
:

15 
xchgl
 %
x
,(%
	ge
)

16 
	gpushl
 %
ecx


17 
	gpushl
 %
edx


18 
	gpush
 %
ds


19 
	gpush
 %
es


20 
	gpush
 %
fs


21 
movl
 
	g$0x10
,%
edx


22 
	gmov
 %
	gdx
,%
ds


23 
	gmov
 %
	gdx
,%
es


24 
	gmov
 %
	gdx
,%
fs


25 
	gmovl
 %
	g2
,%
edx


26 
	gpushl
 %
edx


27 
	gpushl
 %
x


28 
l
 
	g$1
,%
x


29 
	gj
 1f

30 

 
_do_no_ge


31 
	gjmp
 2f

32 1: 

 
_do_wp_ge


33 2: 
addl
 
$8
,%
e


34 
	gp
 %
fs


35 
	gp
 %
es


36 
	gp
 %
ds


37 
	gpl
 %
edx


38 
	gpl
 %
ecx


39 
	gpl
 %
x


40 
	g


	@tools/build.c

23 
	~<dio.h
>

24 
	~<rg.h
>

25 
	~<dlib.h
>

26 
	~<sys/tys.h
>

27 
	~<sys/.h
>

28 
	~<lux/fs.h
>

29 
	~<unid.h
>

30 
	~<f.h
>

32 
	#MINIX_HEADER
 32

	)

33 
	#GCC_HEADER
 1024

	)

35 
	#SYS_SIZE
 0x2000

	)

37 
	#DEFAULT_MAJOR_ROOT
 3

	)

38 
	#DEFAULT_MINOR_ROOT
 6

	)

42 
	#SETUP_SECTS
 4

	)

44 
	#STRINGIFY
(
x
#x

	)

46 
	$d
(* 
r
)

48 
	`rtf
(
dr
,"%s\n",
r
);

49 
	`ex
(1);

50 
	}
}

52 
	$uge
()

54 
	`d
("Usage: build bootsect setup system [rootdev] [> image]");

55 
	}
}

57 
	$ma
(
gc
, ** 
gv
)

59 
i
,
c
,
id
;

60 
buf
[1024];

61 
maj_ro
, 
m_ro
;

62 

 
sb
;

64 i((
gc
 != 4) && (argc != 5))

65 
	`uge
();

66 i(
gc
 == 5) {

67 i(
	`rcmp
(
gv
[4], "FLOPPY")) {

68 i(
	`
(
gv
[4], &
sb
)) {

69 
	`
(
gv
[4]);

70 
	`d
("Couldn't statoot device.");

72 
maj_ro
 = 
	`MAJOR
(
sb
.
_rdev
);

73 
m_ro
 = 
	`MINOR
(
sb
.
_rdev
);

75 
maj_ro
 = 0;

76 
m_ro
 = 0;

79 
maj_ro
 = 
DEFAULT_MAJOR_ROOT
;

80 
m_ro
 = 
DEFAULT_MINOR_ROOT
;

82 
	`rtf
(
dr
, "Ro devi i(%d, %d)\n", 
maj_ro
, 
m_ro
);

83 i((
maj_ro
 != 2) && (major_root != 3) &&

84 (
maj_ro
 != 0)) {

85 
	`rtf
(
dr
, "Illegaloot device (major = %d)\n",

86 
maj_ro
);

87 
	`d
("Badoot device --- major #");

89 
i
=0;i< 
buf
; i++) buf[i]=0;

90 i((
id
=
	`ݒ
(
gv
[1],
O_RDONLY
,0))<0)

91 
	`d
("Unableo open 'boot'");

92 i(
	`ad
(
id
,
buf
,
MINIX_HEADER
) != MINIX_HEADER)

93 
	`d
("Unableoead header of 'boot'");

94 i(((*
buf
)[0]!=0x04100301)

95 
	`d
("Non-Minix header of 'boot'");

96 i(((*
buf
)[1]!=
MINIX_HEADER
)

97 
	`d
("Non-Minix header of 'boot'");

98 i(((*
buf
)[3]!=0)

99 
	`d
("Illegal data segment in 'boot'");

100 i(((*
buf
)[4]!=0)

101 
	`d
("Illegal bss in 'boot'");

102 i(((*
buf
)[5] != 0)

103 
	`d
("Non-Minix header of 'boot'");

104 i(((*
buf
)[7] != 0)

105 
	`d
("Illegal symbolable in 'boot'");

106 
i
=
	`ad
(
id
,
buf
, buf);

107 
	`rtf
(
dr
,"Bo se %d bys.\n",
i
);

108 i(
i
 != 512)

109 
	`d
("Boot block must bexactly 512 bytes");

110 i((*(*)(
buf
+510)) != 0xAA55)

111 
	`d
("Boot block hasn't got boot flag (0xAA55)");

112 
buf
[508] = (
m_ro
;

113 
buf
[509] = (
maj_ro
;

114 
i
=
	`wre
(1,
buf
,512);

115 i(
i
!=512)

116 
	`d
("Write call failed");

117 
	`o
 (
id
);

119 i((
id
=
	`ݒ
(
gv
[2],
O_RDONLY
,0))<0)

120 
	`d
("Unableo open 'setup'");

121 i(
	`ad
(
id
,
buf
,
MINIX_HEADER
) != MINIX_HEADER)

122 
	`d
("Unableoead header of 'setup'");

123 i(((*
buf
)[0]!=0x04100301)

124 
	`d
("Non-Minix header of 'setup'");

125 i(((*
buf
)[1]!=
MINIX_HEADER
)

126 
	`d
("Non-Minix header of 'setup'");

127 i(((*
buf
)[3]!=0)

128 
	`d
("Illegal data segment in 'setup'");

129 i(((*
buf
)[4]!=0)

130 
	`d
("Illegal bss in 'setup'");

131 i(((*
buf
)[5] != 0)

132 
	`d
("Non-Minix header of 'setup'");

133 i(((*
buf
)[7] != 0)

134 
	`d
("Illegal symbolable in 'setup'");

135 
i
=0 ; (
c
=
	`ad
(
id
,
buf
, buf))>0 ; i+=c )

136 i(
	`wre
(1,
buf
,
c
)!=c)

137 
	`d
("Write call failed");

138 
	`o
 (
id
);

139 i(
i
 > 
SETUP_SECTS
*512)

140 
	`d
("Suexed" 
	`STRINGIFY
(
SETUP_SECTS
)

142 
	`rtf
(
dr
,"Sui%d bys.\n",
i
);

143 
c
=0 ; c<(
buf
) ; c++)

144 
buf
[
c
] = '\0';

145 
i
<
SETUP_SECTS
*512) {

146 
c
 = 
SETUP_SECTS
*512-
i
;

147 i(
c
 > (
buf
))

148 
c
 = (
buf
);

149 i(
	`wre
(1,
buf
,
c
) != c)

150 
	`d
("Write call failed");

151 
i
 +
c
;

154 i((
id
=
	`ݒ
(
gv
[3],
O_RDONLY
,0))<0)

155 
	`d
("Unableo open 'system'");

156 i(
	`ad
(
id
,
buf
,
GCC_HEADER
) != GCC_HEADER)

157 
	`d
("Unableoead header of 'system'");

158 i(((*
buf
)[5] != 0)

159 
	`d
("Non-GCC header of 'system'");

160 
i
=0 ; (
c
=
	`ad
(
id
,
buf
, buf))>0 ; i+=c )

161 i(
	`wre
(1,
buf
,
c
)!=c)

162 
	`d
("Write call failed");

163 
	`o
(
id
);

164 
	`rtf
(
dr
,"Syem i%d bys.\n",
i
);

165 i(
i
 > 
SYS_SIZE
*16)

166 
	`d
("System isoo big");

168 
	}
}

	@/usr/include/ctype.h

23 #idef 
_CTYPE_H


24 
	#_CTYPE_H
 1

	)

26 
	~<us.h
>

27 
	~<bs/tys.h
>

29 
	g__BEGIN_DECLS


31 #ide
_ISb


40 
	~<dn.h
>

41 #i
__BYTE_ORDER
 =
__BIG_ENDIAN


42 
	#_ISb
(
b
(1 << (b))

	)

44 
	#_ISb
(
b
((b< 8 ? ((1 << (b)<< 8: ((1 << (b)>> 8))

	)

49 
	m_ISu
 = 
_ISb
 (0),

50 
	m_ISlow
 = 
_ISb
 (1),

51 
	m_ISpha
 = 
_ISb
 (2),

52 
	m_ISdig
 = 
_ISb
 (3),

53 
	m_ISxdig
 = 
_ISb
 (4),

54 
	m_ISa
 = 
_ISb
 (5),

55 
	m_ISt
 = 
_ISb
 (6),

56 
	m_ISgph
 = 
_ISb
 (7),

57 
	m_ISbnk
 = 
_ISb
 (8),

58 
	m_ISl
 = 
_ISb
 (9),

59 
	m_ISpun
 = 
_ISb
 (10),

60 
	m_ISnum
 = 
_ISb
 (11)

80 cڡ **
	$__y_b_loc
 ()

81 
__THROW
 
	`__ibu__
 ((
__cڡ__
));

82 cڡ 
__t32_t
 **
	$__y_tow_loc
 ()

83 
__THROW
 
	`__ibu__
 ((
__cڡ__
));

84 cڡ 
__t32_t
 **
	$__y_tou_loc
 ()

85 
__THROW
 
	`__ibu__
 ((
__cڡ__
));

88 #ide
__lulus


89 
	#__isy
(
c
, 
ty
) \

90 ((*
	`__y_b_loc
 ())[((
c
)] & (
ty
)

	)

91 #i
defed
 
__USE_EXTERN_INLINES


92 
	#__isy_f
(
ty
) \

93 
__ex_le
 \

94 
is
##
	`ty
 (
__c

__THROW
 \

96  (*
	`__y_b_loc
 ())[((
__c
)] & (
_IS
##
ty
; \

97 
	}

	)
}

100 
	#__iscii
(
c
(((c& ~0x7f=0

	)

101 
	#__tscii
(
c
((c& 0x7f

	)

103 
	#__exy
(
me

	`me
 (
__THROW


	)

105 
__BEGIN_NAMESPACE_STD


111 
__exy
 (
ium
);

112 
__exy
 (
iha
);

113 
__exy
 (
isl
);

114 
__exy
 (
isdig
);

115 
__exy
 (
iow
);

116 
__exy
 (
isgph
);

117 
__exy
 (
irt
);

118 
__exy
 (
iun
);

119 
__exy
 (
isa
);

120 
__exy
 (
isu
);

121 
__exy
 (
isxdig
);

125 
	$tow
 (
__c

__THROW
;

128 
	$tou
 (
__c

__THROW
;

130 
__END_NAMESPACE_STD


134 #ifdef 
__USE_ISOC99


135 
__BEGIN_NAMESPACE_C99


137 
	`__exy
 (
isbnk
);

139 
__END_NAMESPACE_C99


142 #ifde
__USE_GNU


144 
	$isy
 (
__c
, 
__mask

__THROW
;

147 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC
 || defed 
__USE_XOPEN


151 
	$iscii
 (
__c

__THROW
;

155 
	$tscii
 (
__c

__THROW
;

159 
	`__exy
 (
_tou
);

160 
	`__exy
 (
_tow
);

164 
	#__tobody
(
c
, 
f
, 
a
, 
gs
) \

165 (
__exnsi__
 \

166 ({ 
__s
; \

167 i( (
c
) > 1) \

169 i(
	`__but_cڡt_p
 (
c
)) \

171 
__c
 = (
c
); \

172 
__s
 = 
__c
 < -128 || __> 255 ? __: (
a
)[__c]; \

175 
__s
 = 
f
 
gs
; \

178 
__s
 = (
a
)[((
c
)]; \

179 
__s
; 
	}
}))

	)

181 #i!
defed
 
__NO_CTYPE


182 #ifde
__isy_f


183 
	$__isy_f
 (
num
)

184 
	$__isy_f
 (
pha
)

185 
	$__isy_f
 (
l
)

186 
	$__isy_f
 (
dig
)

187 
	$__isy_f
 (
low
)

188 
	$__isy_f
 (
gph
)

189 
	$__isy_f
 (
t
)

190 
	$__isy_f
 (
pun
)

191 
	$__isy_f
 (
a
)

192 
	$__isy_f
 (
u
)

193 
	$__isy_f
 (
xdig
)

194 #ifde
__USE_ISOC99


195 
	$__isy_f
 (
bnk
)

197 #i
defed
 
__isy


198 
	#ium
(
c

	`__isy
((c), 
_ISnum
)

	)

199 
	#iha
(
c

	`__isy
((c), 
_ISpha
)

	)

200 
	#isl
(
c

	`__isy
((c), 
_ISl
)

	)

201 
	#isdig
(
c

	`__isy
((c), 
_ISdig
)

	)

202 
	#iow
(
c

	`__isy
((c), 
_ISlow
)

	)

203 
	#isgph
(
c

	`__isy
((c), 
_ISgph
)

	)

204 
	#irt
(
c

	`__isy
((c), 
_ISt
)

	)

205 
	#iun
(
c

	`__isy
((c), 
_ISpun
)

	)

206 
	#isa
(
c

	`__isy
((c), 
_ISa
)

	)

207 
	#isu
(
c

	`__isy
((c), 
_ISu
)

	)

208 
	#isxdig
(
c

	`__isy
((c), 
_ISxdig
)

	)

209 #ifde
__USE_ISOC99


210 
	#isbnk
(
c

	`__isy
((c), 
_ISbnk
)

	)

214 #ifde
__USE_EXTERN_INLINES


215 
__ex_le
 

216 
	`__NTH
 (
	$tow
 (
__c
))

218  
__c
 >-128 && __< 256 ? (*
	`__y_tow_loc
 ())[__c] : __c;

219 
	}
}

221 
__ex_le
 

222 
__NTH
 (
	$tou
 (
__c
))

224  
__c
 >-128 && __< 256 ? (*
	`__y_tou_loc
 ())[__c] : __c;

225 
	}
}

228 #i
__GNUC__
 >2 && 
defed
 
__OPTIMIZE__
 && !defed 
__lulus


229 
	#tow
(
c

	`__tobody
 (c, 
tow
, *
	`__y_tow_loc
 (), (c))

	)

230 
	#tou
(
c

	`__tobody
 (c, 
tou
, *
	`__y_tou_loc
 (), (c))

	)

233 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC
 || defed 
__USE_XOPEN


234 
	#iscii
(
c

	`__iscii
 (c)

	)

235 
	#tscii
(
c

	`__tscii
 (c)

	)

237 
	#_tow
(
c
(((*
	`__y_tow_loc
 ())[((c)])

	)

238 
	#_tou
(
c
(((*
	`__y_tou_loc
 ())[((c)])

	)

244 #ifde
__USE_XOPEN2K8


258 
	~<xlo.h
>

262 
	#__isy_l
(
c
, 
ty
, 
lo
) \

263 ((
lo
)->
__y_b
[((
c
)] & (
ty
)

	)

265 
	#__exy_l
(
me
) \

266 
	`me
 (, 
__lo_t

__THROW


	)

272 
__exy_l
 (
ium_l
);

273 
__exy_l
 (
iha_l
);

274 
__exy_l
 (
isl_l
);

275 
__exy_l
 (
isdig_l
);

276 
__exy_l
 (
iow_l
);

277 
__exy_l
 (
isgph_l
);

278 
__exy_l
 (
irt_l
);

279 
__exy_l
 (
iun_l
);

280 
__exy_l
 (
isa_l
);

281 
__exy_l
 (
isu_l
);

282 
__exy_l
 (
isxdig_l
);

284 
__exy_l
 (
isbnk_l
);

288 
	$__tow_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

289 
	$tow_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

292 
	$__tou_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

293 
	$tou_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

295 #i
__GNUC__
 >2 && 
defed
 
__OPTIMIZE__
 && !defed 
__lulus


296 
	#__tow_l
(
c
, 
lo
) \

297 
	`__tobody
 (
c
, 
__tow_l
, (
lo
)->
__y_tow
, (c,o))

	)

298 
	#__tou_l
(
c
, 
lo
) \

299 
	`__tobody
 (
c
, 
__tou_l
, (
lo
)->
__y_tou
, (c,o))

	)

300 
	#tow_l
(
c
, 
lo

	`__tow_l
 ((c), (lo))

	)

301 
	#tou_l
(
c
, 
lo

	`__tou_l
 ((c), (lo))

	)

305 #ide
__NO_CTYPE


306 
	#__ium_l
(
c
,
l

	`__isy_l
((c), 
_ISnum
, (l))

	)

307 
	#__iha_l
(
c
,
l

	`__isy_l
((c), 
_ISpha
, (l))

	)

308 
	#__isl_l
(
c
,
l

	`__isy_l
((c), 
_ISl
, (l))

	)

309 
	#__isdig_l
(
c
,
l

	`__isy_l
((c), 
_ISdig
, (l))

	)

310 
	#__iow_l
(
c
,
l

	`__isy_l
((c), 
_ISlow
, (l))

	)

311 
	#__isgph_l
(
c
,
l

	`__isy_l
((c), 
_ISgph
, (l))

	)

312 
	#__irt_l
(
c
,
l

	`__isy_l
((c), 
_ISt
, (l))

	)

313 
	#__iun_l
(
c
,
l

	`__isy_l
((c), 
_ISpun
, (l))

	)

314 
	#__isa_l
(
c
,
l

	`__isy_l
((c), 
_ISa
, (l))

	)

315 
	#__isu_l
(
c
,
l

	`__isy_l
((c), 
_ISu
, (l))

	)

316 
	#__isxdig_l
(
c
,
l

	`__isy_l
((c), 
_ISxdig
, (l))

	)

318 
	#__isbnk_l
(
c
,
l

	`__isy_l
((c), 
_ISbnk
, (l))

	)

320 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC


321 
	#__iscii_l
(
c
,
l
(), 
	`__iscii
 (c))

	)

322 
	#__tscii_l
(
c
,
l
(), 
	`__tscii
 (c))

	)

325 
	#ium_l
(
c
,
l

	`__ium_l
 ((c), (l))

	)

326 
	#iha_l
(
c
,
l

	`__iha_l
 ((c), (l))

	)

327 
	#isl_l
(
c
,
l

	`__isl_l
 ((c), (l))

	)

328 
	#isdig_l
(
c
,
l

	`__isdig_l
 ((c), (l))

	)

329 
	#iow_l
(
c
,
l

	`__iow_l
 ((c), (l))

	)

330 
	#isgph_l
(
c
,
l

	`__isgph_l
 ((c), (l))

	)

331 
	#irt_l
(
c
,
l

	`__irt_l
 ((c), (l))

	)

332 
	#iun_l
(
c
,
l

	`__iun_l
 ((c), (l))

	)

333 
	#isa_l
(
c
,
l

	`__isa_l
 ((c), (l))

	)

334 
	#isu_l
(
c
,
l

	`__isu_l
 ((c), (l))

	)

335 
	#isxdig_l
(
c
,
l

	`__isxdig_l
 ((c), (l))

	)

337 
	#isbnk_l
(
c
,
l

	`__isbnk_l
 ((c), (l))

	)

339 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC


340 
	#iscii_l
(
c
,
l

	`__iscii_l
 ((c), (l))

	)

341 
	#tscii_l
(
c
,
l

	`__tscii_l
 ((c), (l))

	)

348 
__END_DECLS


	@/usr/include/errno.h

22 #idef 
_ERRNO_H


26 #idef 
__ed_Emh


27 
	#_ERRNO_H
 1

	)

28 
	~<us.h
>

31 
	g__BEGIN_DECLS


35 
	~<bs/o.h
>

36 #unde
__ed_Emh


38 #ifdef 
_ERRNO_H


45 #idef 
o


46 
o
;

49 #ifde
__USE_GNU


54 *
ogm_voti_me
, *
ogm_voti_sht_me
;

58 
	g__END_DECLS


66 #i
defed
 
__USE_GNU
 || defed 
__ed_r_t


67 #ide
__r_t_defed


68 
	tr_t
;

69 
	#__r_t_defed
 1

	)

71 #unde
__ed_r_t


	@/usr/include/fcntl.h

22 #idef 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<us.h
>

28 
	g__BEGIN_DECLS


31 
	~<bs/tys.h
>

35 
	~<bs/f.h
>

40 #ide
__mode_t_defed


41 
__mode_t
 
	tmode_t
;

42 
	#__mode_t_defed


	)

45 #ide
__off_t_defed


46 #ide
__USE_FILE_OFFSET64


47 
__off_t
 
	toff_t
;

49 
__off64_t
 
	toff_t
;

51 
	#__off_t_defed


	)

54 #i
defed
 
__USE_LARGEFILE64
 && !defed 
__off64_t_defed


55 
__off64_t
 
	toff64_t
;

56 
	#__off64_t_defed


	)

59 #ide
__pid_t_defed


60 
__pid_t
 
	tpid_t
;

61 
	#__pid_t_defed


	)

65 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8


66 
	#__ed_timeec


	)

67 
	~<time.h
>

68 
	~<bs/.h
>

70 
	#S_IFMT
 
__S_IFMT


	)

71 
	#S_IFDIR
 
__S_IFDIR


	)

72 
	#S_IFCHR
 
__S_IFCHR


	)

73 
	#S_IFBLK
 
__S_IFBLK


	)

74 
	#S_IFREG
 
__S_IFREG


	)

75 #ifde
__S_IFIFO


76 
	#S_IFIFO
 
__S_IFIFO


	)

78 #ifde
__S_IFLNK


79 
	#S_IFLNK
 
__S_IFLNK


	)

81 #i(
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K8
&& defed 
__S_IFSOCK


82 
	#S_IFSOCK
 
__S_IFSOCK


	)

87 
	#S_ISUID
 
__S_ISUID


	)

88 
	#S_ISGID
 
__S_ISGID


	)

90 #i
defed
 
__USE_BSD
 || defed 
__USE_MISC
 || defed 
__USE_XOPEN


92 
	#S_ISVTX
 
__S_ISVTX


	)

95 
	#S_IRUSR
 
__S_IREAD


	)

96 
	#S_IWUSR
 
__S_IWRITE


	)

97 
	#S_IXUSR
 
__S_IEXEC


	)

99 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

101 
	#S_IRGRP
 (
S_IRUSR
 >> 3

	)

102 
	#S_IWGRP
 (
S_IWUSR
 >> 3

	)

103 
	#S_IXGRP
 (
S_IXUSR
 >> 3

	)

105 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

107 
	#S_IROTH
 (
S_IRGRP
 >> 3

	)

108 
	#S_IWOTH
 (
S_IWGRP
 >> 3

	)

109 
	#S_IXOTH
 (
S_IXGRP
 >> 3

	)

111 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

114 #ifdef 
__USE_MISC


115 #ide
R_OK


118 
	#R_OK
 4

	)

119 
	#W_OK
 2

	)

120 
	#X_OK
 1

	)

121 
	#F_OK
 0

	)

126 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8


127 
	#SEEK_SET
 0

	)

128 
	#SEEK_CUR
 1

	)

129 
	#SEEK_END
 2

	)

132 #ifde
__USE_ATFILE


133 
	#AT_FDCWD
 -100

	)

136 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

137 
	#AT_REMOVEDIR
 0x200

	)

139 
	#AT_SYMLINK_FOLLOW
 0x400

	)

140 #ifde
__USE_GNU


141 
	#AT_NO_AUTOMOUNT
 0x800

	)

143 
	#AT_EMPTY_PATH
 0x1000

	)

145 
	#AT_EACCESS
 0x200

	)

154 
f
 (
__fd
, 
__cmd
, ...);

162 #ide
__USE_FILE_OFFSET64


163 
	$ݒ
 (cڡ *
__fe
, 
__oag
, ...
	`__nnu
 ((1));

165 #ifde
__REDIRECT


166 
	`__REDIRECT
 (
ݒ
, (cڡ *
__fe
, 
__oag
, ...), 
ݒ64
)

167 
	`__nnu
 ((1));

169 
	#ݒ
 
ݒ64


	)

172 #ifde
__USE_LARGEFILE64


173 
	$ݒ64
 (cڡ *
__fe
, 
__oag
, ...
	`__nnu
 ((1));

176 #ifde
__USE_ATFILE


186 #ide
__USE_FILE_OFFSET64


187 
	$ݒ
 (
__fd
, cڡ *
__fe
, 
__oag
, ...)

188 
	`__nnu
 ((2));

190 #ifde
__REDIRECT


191 
	`__REDIRECT
 (
ݒ
, (
__fd
, cڡ *
__fe
, 
__oag
,

192 ...), 
ݒ64

	`__nnu
 ((2));

194 
	#ݒ
 
ݒ64


	)

197 #ifde
__USE_LARGEFILE64


198 
	$ݒ64
 (
__fd
, cڡ *
__fe
, 
__oag
, ...)

199 
	`__nnu
 ((2));

208 #ide
__USE_FILE_OFFSET64


209 
	$t
 (cڡ *
__fe
, 
mode_t
 
__mode

	`__nnu
 ((1));

211 #ifde
__REDIRECT


212 
	`__REDIRECT
 (
t
, (cڡ *
__fe
, 
mode_t
 
__mode
),

213 
t64

	`__nnu
 ((1));

215 
	#t
 
t64


	)

218 #ifde
__USE_LARGEFILE64


219 
	$t64
 (cڡ *
__fe
, 
mode_t
 
__mode

	`__nnu
 ((1));

222 #i!
defed
 
F_LOCK
 && (defed 
__USE_MISC
 || (defed 
__USE_XOPEN_EXTENDED
 \

223 && !
defed
 
__USE_POSIX
))

232 
	#F_ULOCK
 0

	)

233 
	#F_LOCK
 1

	)

234 
	#F_TLOCK
 2

	)

235 
	#F_TEST
 3

	)

237 #ide
__USE_FILE_OFFSET64


238 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__n
);

240 #ifde
__REDIRECT


241 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__n
), 
lockf64
);

243 
	#lockf
 
lockf64


	)

246 #ifde
__USE_LARGEFILE64


247 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__n
);

251 #ifde
__USE_XOPEN2K


254 #ide
__USE_FILE_OFFSET64


255 
	$posix_dvi
 (
__fd
, 
off_t
 
__offt
, off_
__n
,

256 
__advi

__THROW
;

258 #ifde
__REDIRECT_NTH


259 
	`__REDIRECT_NTH
 (
posix_dvi
, (
__fd
, 
__off64_t
 
__offt
,

260 
__off64_t
 
__n
, 
__advi
),

261 
posix_dvi64
);

263 
	#posix_dvi
 
posix_dvi64


	)

266 #ifde
__USE_LARGEFILE64


267 
	$posix_dvi64
 (
__fd
, 
off64_t
 
__offt
, off64_
__n
,

268 
__advi

__THROW
;

276 #ide
__USE_FILE_OFFSET64


277 
	`posix_o
 (
__fd
, 
off_t
 
__offt
, off_
__n
);

279 #ifde
__REDIRECT


280 
	`__REDIRECT
 (
posix_o
, (
__fd
, 
__off64_t
 
__offt
,

281 
__off64_t
 
__n
),

282 
posix_o64
);

284 
	#posix_o
 
posix_o64


	)

287 #ifde
__USE_LARGEFILE64


288 
	`posix_o64
 (
__fd
, 
off64_t
 
__offt
, off64_
__n
);

294 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ftify_funi
 \

295 && 
defed
 
__va_g_ck_n


296 
	~<bs/f2.h
>

299 
__END_DECLS


	@/usr/include/linux/fdreg.h

1 #ide
_LINUX_FDREG_H


2 
	#_LINUX_FDREG_H


	)

9 #ifde
FDPATCHES


10 
	#FD_IOPORT
 
fdc_e
[
fdc
].
addss


	)

14 
	#FD_IOPORT
 0x3f0

	)

18 
	#FD_STATUS
 (4 + 
FD_IOPORT
 )

	)

19 
	#FD_DATA
 (5 + 
FD_IOPORT
 )

	)

22 
	#FD_DOR
 (2 + 
FD_IOPORT
 )

	)

25 
	#FD_DIR
 (7 + 
FD_IOPORT
 )

	)

28 
	#FD_DCR
 (7 + 
FD_IOPORT
 )

	)

31 
	#STATUS_BUSYMASK
 0x0F

	)

32 
	#STATUS_BUSY
 0x10

	)

33 
	#STATUS_DMA
 0x20

	)

34 
	#STATUS_DIR
 0x40

	)

35 
	#STATUS_READY
 0x80

	)

38 
	#ST0_DS
 0x03

	)

39 
	#ST0_HA
 0x04

	)

40 
	#ST0_NR
 0x08

	)

41 
	#ST0_ECE
 0x10

	)

42 
	#ST0_SE
 0x20

	)

43 
	#ST0_INTR
 0xC0

	)

46 
	#ST1_MAM
 0x01

	)

47 
	#ST1_WP
 0x02

	)

48 
	#ST1_ND
 0x04

	)

49 
	#ST1_OR
 0x10

	)

50 
	#ST1_CRC
 0x20

	)

51 
	#ST1_EOC
 0x80

	)

54 
	#ST2_MAM
 0x01

	)

55 
	#ST2_BC
 0x02

	)

56 
	#ST2_SNS
 0x04

	)

57 
	#ST2_SEH
 0x08

	)

58 
	#ST2_WC
 0x10

	)

59 
	#ST2_CRC
 0x20

	)

60 
	#ST2_CM
 0x40

	)

63 
	#ST3_HA
 0x04

	)

64 
	#ST3_DS
 0x08

	)

65 
	#ST3_TZ
 0x10

	)

66 
	#ST3_RY
 0x20

	)

67 
	#ST3_WP
 0x40

	)

68 
	#ST3_FT
 0x80

	)

71 
	#FD_RECALIBRATE
 0x07

	)

72 
	#FD_SEEK
 0x0F

	)

73 
	#FD_READ
 0xE6

	)

74 
	#FD_WRITE
 0xC5

	)

75 
	#FD_SENSEI
 0x08

	)

76 
	#FD_SPECIFY
 0x03

	)

77 
	#FD_FORMAT
 0x4D

	)

78 
	#FD_VERSION
 0x10

	)

79 
	#FD_CONFIGURE
 0x13

	)

80 
	#FD_PERPENDICULAR
 0x12

	)

81 
	#FD_GETSTATUS
 0x04

	)

82 
	#FD_DUMPREGS
 0x0E

	)

83 
	#FD_READID
 0xEA

	)

84 
	#FD_UNLOCK
 0x14

	)

85 
	#FD_LOCK
 0x94

	)

86 
	#FD_RSEEK_OUT
 0x8

	)

87 
	#FD_RSEEK_IN
 0xc

	)

94 
	#FD_PARTID
 0x18

	)

95 
	#FD_SAVE
 0x2

	)

96 
	#FD_DRIVESPEC
 0x8

	)

100 
	#FD_RESTORE
 0x4

	)

101 
	#FD_POWERDOWN
 0x27

	)

102 
	#FD_FORMAT_N_WRITE
 0xe

	)

103 
	#FD_OPTION
 0x33

	)

107 
	#DMA_READ
 0x46

	)

108 
	#DMA_WRITE
 0x4A

	)

111 
	#FDC_NONE
 0x00

	)

112 
	#FDC_UNKNOWN
 0x10

	)

114 
	#FDC_8272A
 0x20

	)

115 
	#FDC_765ED
 0x30

	)

116 
	#FDC_82072
 0x40

	)

117 
	#FDC_82072A
 0x45

	)

118 
	#FDC_82077_ORIG
 0x51

	)

119 
	#FDC_82077
 0x52

	)

120 
	#FDC_82078_UNKN
 0x5

	)

121 
	#FDC_82078
 0x60

	)

122 
	#FDC_82078_1
 0x61

	)

123 
	#FDC_S82078B
 0x62

	)

125 
	#FDC_87306
 0x63

	)

136 
	#FD_RESET_DELAY
 20

	)

	@/usr/include/linux/fs.h

1 #ide
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

9 
	~<lux/lims.h
>

10 
	~<lux/iol.h
>

11 
	~<lux/tys.h
>

24 #unde
NR_OPEN


25 
	#INR_OPEN_CUR
 1024

	)

26 
	#INR_OPEN_MAX
 4096

	)

28 
	#BLOCK_SIZE_BITS
 10

	)

29 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

31 
	#SEEK_SET
 0

	)

32 
	#SEEK_CUR
 1

	)

33 
	#SEEK_END
 2

	)

34 
	#SEEK_DATA
 3

	)

35 
	#SEEK_HOLE
 4

	)

36 
	#SEEK_MAX
 
SEEK_HOLE


	)

38 
	#RENAME_NOREPLACE
 (1 << 0

	)

39 
	#RENAME_EXCHANGE
 (1 << 1

	)

40 
	#RENAME_WHITEOUT
 (1 << 2

	)

42 
	sfrim_nge
 {

43 
__u64
 
	mt
;

44 
__u64
 
	mn
;

45 
__u64
 
	mmn
;

49 
	sfes__ru
 {

50 
	m_fes
;

51 
	m__fes
;

52 
	mmax_fes
;

55 
	sodes__t
 {

56 
	m_odes
;

57 
	m_unud
;

58 
	mdummy
[5];

62 
	#NR_FILE
 8192

	)

68 
	#MS_RDONLY
 1

	)

69 
	#MS_NOSUID
 2

	)

70 
	#MS_NODEV
 4

	)

71 
	#MS_NOEXEC
 8

	)

72 
	#MS_SYNCHRONOUS
 16

	)

73 
	#MS_REMOUNT
 32

	)

74 
	#MS_MANDLOCK
 64

	)

75 
	#MS_DIRSYNC
 128

	)

76 
	#MS_NOATIME
 1024

	)

77 
	#MS_NODIRATIME
 2048

	)

78 
	#MS_BIND
 4096

	)

79 
	#MS_MOVE
 8192

	)

80 
	#MS_REC
 16384

	)

81 
	#MS_VERBOSE
 32768

	)

83 
	#MS_SILENT
 32768

	)

84 
	#MS_POSIXACL
 (1<<16

	)

85 
	#MS_UNBINDABLE
 (1<<17

	)

86 
	#MS_PRIVATE
 (1<<18

	)

87 
	#MS_SLAVE
 (1<<19

	)

88 
	#MS_SHARED
 (1<<20

	)

89 
	#MS_RELATIME
 (1<<21

	)

90 
	#MS_KERNMOUNT
 (1<<22

	)

91 
	#MS_I_VERSION
 (1<<23

	)

92 
	#MS_STRICTATIME
 (1<<24

	)

95 
	#MS_NOSEC
 (1<<28)

	)

96 
	#MS_BORN
 (1<<29)

	)

97 
	#MS_ACTIVE
 (1<<30)

	)

98 
	#MS_NOUSER
 (1<<31)

	)

103 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
)

	)

108 
	#MS_MGC_VAL
 0xC0ED0000

	)

109 
	#MS_MGC_MSK
 0xffff0000

	)

114 
	#BLKROSET
 
	`_IO
(0x12,93

	)

115 
	#BLKROGET
 
	`_IO
(0x12,94

	)

116 
	#BLKRRPART
 
	`_IO
(0x12,95

	)

117 
	#BLKGETSIZE
 
	`_IO
(0x12,96

	)

118 
	#BLKFLSBUF
 
	`_IO
(0x12,97

	)

119 
	#BLKRASET
 
	`_IO
(0x12,98

	)

120 
	#BLKRAGET
 
	`_IO
(0x12,99

	)

121 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

122 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

123 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

124 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

125 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

127 
	#BLKPG
 
	`_IO
(0x12,105)

	)

131 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

132 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

137 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

138 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

139 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t


	)

140 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_ur_a_tup
)

	)

141 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

142 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

143 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

144 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

145 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

146 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

147 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

148 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

149 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

150 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

151 
	#BLKROTATIONAL
 
	`_IO
(0x12,126)

	)

152 
	#BLKZEROOUT
 
	`_IO
(0x12,127)

	)

154 
	#BMAP_IOCTL
 1

	)

155 
	#FIBMAP
 
	`_IO
(0x00,1

	)

156 
	#FIGETBSZ
 
	`_IO
(0x00,2

	)

157 
	#FIFREEZE
 
	`_IOWR
('X', 119, 

	)

158 
	#FITHAW
 
	`_IOWR
('X', 120, 

	)

159 
	#FITRIM
 
	`_IOWR
('X', 121, 
frim_nge


	)

161 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

162 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

163 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

164 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

165 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
fm
)

	)

166 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

167 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

168 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

169 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

174 
	#FS_SECRM_FL
 0x00000001

	)

175 
	#FS_UNRM_FL
 0x00000002

	)

176 
	#FS_COMPR_FL
 0x00000004

	)

177 
	#FS_SYNC_FL
 0x00000008

	)

178 
	#FS_IMMUTABLE_FL
 0x00000010

	)

179 
	#FS_APPEND_FL
 0x00000020

	)

180 
	#FS_NODUMP_FL
 0x00000040

	)

181 
	#FS_NOATIME_FL
 0x00000080

	)

183 
	#FS_DIRTY_FL
 0x00000100

	)

184 
	#FS_COMPRBLK_FL
 0x00000200

	)

185 
	#FS_NOCOMP_FL
 0x00000400

	)

186 
	#FS_ECOMPR_FL
 0x00000800

	)

188 
	#FS_BTREE_FL
 0x00001000

	)

189 
	#FS_INDEX_FL
 0x00001000

	)

190 
	#FS_IMAGIC_FL
 0x00002000

	)

191 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

192 
	#FS_NOTAIL_FL
 0x00008000

	)

193 
	#FS_DIRSYNC_FL
 0x00010000

	)

194 
	#FS_TOPDIR_FL
 0x00020000

	)

195 
	#FS_EXTENT_FL
 0x00080000

	)

196 
	#FS_DIRECTIO_FL
 0x00100000

	)

197 
	#FS_NOCOW_FL
 0x00800000

	)

198 
	#FS_RESERVED_FL
 0x80000000

	)

200 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

201 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

204 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

205 
	#SYNC_FILE_RANGE_WRITE
 2

	)

206 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

	@/usr/include/linux/hdreg.h

1 #ide
_LINUX_HDREG_H


2 
	#_LINUX_HDREG_H


	)

4 
	~<lux/tys.h
>

10 
	#HDIO_DRIVE_CMD_HDR_SIZE
 (4 * (
__u8
))

	)

11 
	#HDIO_DRIVE_HOB_HDR_SIZE
 (8 * (
__u8
))

	)

12 
	#HDIO_DRIVE_TASK_HDR_SIZE
 (8 * (
__u8
))

	)

14 
	#IDE_DRIVE_TASK_NO_DATA
 0

	)

15 
	#IDE_DRIVE_TASK_INVALID
 -1

	)

16 
	#IDE_DRIVE_TASK_SET_XFER
 1

	)

17 
	#IDE_DRIVE_TASK_IN
 2

	)

18 
	#IDE_DRIVE_TASK_OUT
 3

	)

19 
	#IDE_DRIVE_TASK_RAW_WRITE
 4

	)

24 
	#IDE_TASKFILE_STD_IN_FLAGS
 0xFE

	)

25 
	#IDE_HOB_STD_IN_FLAGS
 0x3C

	)

26 
	#IDE_TASKFILE_STD_OUT_FLAGS
 0xFE

	)

27 
	#IDE_HOB_STD_OUT_FLAGS
 0x3C

	)

29 
	tsk_ieg_t
;

30 
	t_ieg_t
;

32 
	uide_g_vid_s
 {

33 
	ml
 : 16;

35 
	mda
 : 1;

36 
	mr_u
 : 1;

37 
	m
 : 1;

38 
	mn
 : 1;

39 
	mlcyl
 : 1;

40 
	mhcyl
 : 1;

41 
	m
 : 1;

42 
	mus_commd
 : 1;

44 
	mda_hob
 : 1;

45 
	mr_u_hob
 : 1;

46 
	m_hob
 : 1;

47 
	mn_hob
 : 1;

48 
	mlcyl_hob
 : 1;

49 
	mhcyl_hob
 : 1;

50 
	m_hob
 : 1;

51 
	mcڌ_hob
 : 1;

52 } 
	mb
;

53 } 
	tide_g_vid_t
;

55 
	side_sk_que_s
 {

56 
__u8
 
	mio_pts
[8];

57 
__u8
 
	mhob_pts
[8];

58 
ide_g_vid_t
 
	mout_ags
;

59 
ide_g_vid_t
 
	m_ags
;

60 
	mda_pha
;

61 
	mq_cmd
;

62 
	mout_size
;

63 
	m_size
;

64 } 
	tide_sk_que_t
;

66 
	side_iol_que_s
 {

67 
ide_sk_que_t
 *
	msk_que
;

68 *
	mout_bufr
;

69 *
	m_bufr
;

70 } 
	tide_iol_que_t
;

72 
	shd_drive_cmd_hdr
 {

73 
__u8
 
	mcommd
;

74 
__u8
 
	m_numb
;

75 
__u8
 
	mu
;

76 
__u8
 
	m_cou
;

79 
	shd_drive_sk_hdr
 {

80 
__u8
 
	mda
;

81 
__u8
 
	mu
;

82 
__u8
 
	m_cou
;

83 
__u8
 
	m_numb
;

84 
__u8
 
	mlow_cyld
;

85 
__u8
 
	mhigh_cyld
;

86 
__u8
 
	mdevi_hd
;

87 
__u8
 
	mcommd
;

88 } 
	tsk_ru_t
;

90 
	shd_drive_hob_hdr
 {

91 
__u8
 
	mda
;

92 
__u8
 
	mu
;

93 
__u8
 
	m_cou
;

94 
__u8
 
	m_numb
;

95 
__u8
 
	mlow_cyld
;

96 
__u8
 
	mhigh_cyld
;

97 
__u8
 
	mdevi_hd
;

98 
__u8
 
	mcڌ
;

99 } 
	thob_ru_t
;

101 
	#TASKFILE_NO_DATA
 0x0000

	)

103 
	#TASKFILE_IN
 0x0001

	)

104 
	#TASKFILE_MULTI_IN
 0x0002

	)

106 
	#TASKFILE_OUT
 0x0004

	)

107 
	#TASKFILE_MULTI_OUT
 0x0008

	)

108 
	#TASKFILE_IN_OUT
 0x0010

	)

110 
	#TASKFILE_IN_DMA
 0x0020

	)

111 
	#TASKFILE_OUT_DMA
 0x0040

	)

112 
	#TASKFILE_IN_DMAQ
 0x0080

	)

113 
	#TASKFILE_OUT_DMAQ
 0x0100

	)

115 
	#TASKFILE_P_IN
 0x0200

	)

116 
	#TASKFILE_P_OUT
 0x0400

	)

117 
	#TASKFILE_P_IN_DMA
 0x0800

	)

118 
	#TASKFILE_P_OUT_DMA
 0x1000

	)

119 
	#TASKFILE_P_IN_DMAQ
 0x2000

	)

120 
	#TASKFILE_P_OUT_DMAQ
 0x4000

	)

121 
	#TASKFILE_48
 0x8000

	)

122 
	#TASKFILE_INVALID
 0x7fff

	)

125 
	#WIN_NOP
 0x00

	)

129 
	#CFA_REQ_EXT_ERROR_CODE
 0x03

	)

133 
	#WIN_SRST
 0x08

	)

134 
	#WIN_DEVICE_RESET
 0x08

	)

138 
	#WIN_RECAL
 0x10

	)

139 
	#WIN_RESTORE
 
WIN_RECAL


	)

143 
	#WIN_READ
 0x20

	)

144 
	#WIN_READ_ONCE
 0x21

	)

145 
	#WIN_READ_LONG
 0x22

	)

146 
	#WIN_READ_LONG_ONCE
 0x23

	)

147 
	#WIN_READ_EXT
 0x24

	)

148 
	#WIN_READDMA_EXT
 0x25

	)

149 
	#WIN_READDMA_QUEUED_EXT
 0x26

	)

150 
	#WIN_READ_NATIVE_MAX_EXT
 0x27

	)

154 
	#WIN_MULTREAD_EXT
 0x29

	)

158 
	#WIN_WRITE
 0x30

	)

159 
	#WIN_WRITE_ONCE
 0x31

	)

160 
	#WIN_WRITE_LONG
 0x32

	)

161 
	#WIN_WRITE_LONG_ONCE
 0x33

	)

162 
	#WIN_WRITE_EXT
 0x34

	)

163 
	#WIN_WRITEDMA_EXT
 0x35

	)

164 
	#WIN_WRITEDMA_QUEUED_EXT
 0x36

	)

165 
	#WIN_SET_MAX_EXT
 0x37

	)

166 
	#CFA_WRITE_SECT_WO_ERASE
 0x38

	)

167 
	#WIN_MULTWRITE_EXT
 0x39

	)

171 
	#WIN_WRITE_VERIFY
 0x3C

	)

175 
	#WIN_VERIFY
 0x40

	)

176 
	#WIN_VERIFY_ONCE
 0x41

	)

177 
	#WIN_VERIFY_EXT
 0x42

	)

181 
	#WIN_FORMAT
 0x50

	)

185 
	#WIN_INIT
 0x60

	)

189 
	#WIN_SEEK
 0x70

	)

191 
	#CFA_TRANSLATE_SECTOR
 0x87

	)

192 
	#WIN_DIAGNOSE
 0x90

	)

193 
	#WIN_SPECIFY
 0x91

	)

194 
	#WIN_DOWNLOAD_MICROCODE
 0x92

	)

195 
	#WIN_STANDBYNOW2
 0x94

	)

196 
	#WIN_STANDBY2
 0x96

	)

197 
	#WIN_SETIDLE2
 0x97

	)

198 
	#WIN_CHECKPOWERMODE2
 0x98

	)

199 
	#WIN_SLEEPNOW2
 0x99

	)

203 
	#WIN_PACKETCMD
 0xA0

	)

204 
	#WIN_PIDENTIFY
 0xA1

	)

205 
	#WIN_QUEUED_SERVICE
 0xA2

	)

206 
	#WIN_SMART
 0xB0

	)

207 
	#CFA_ERASE_SECTORS
 0xC0

	)

208 
	#WIN_MULTREAD
 0xC4

	)

209 
	#WIN_MULTWRITE
 0xC5

	)

210 
	#WIN_SETMULT
 0xC6

	)

211 
	#WIN_READDMA_QUEUED
 0xC7

	)

212 
	#WIN_READDMA
 0xC8

	)

213 
	#WIN_READDMA_ONCE
 0xC9

	)

214 
	#WIN_WRITEDMA
 0xCA

	)

215 
	#WIN_WRITEDMA_ONCE
 0xCB

	)

216 
	#WIN_WRITEDMA_QUEUED
 0xCC

	)

217 
	#CFA_WRITE_MULTI_WO_ERASE
 0xCD

	)

218 
	#WIN_GETMEDIASTATUS
 0xDA

	)

219 
	#WIN_ACKMEDIACHANGE
 0xDB

	)

220 
	#WIN_POSTBOOT
 0xDC

	)

221 
	#WIN_PREBOOT
 0xDD

	)

222 
	#WIN_DOORLOCK
 0xDE

	)

223 
	#WIN_DOORUNLOCK
 0xDF

	)

224 
	#WIN_STANDBYNOW1
 0xE0

	)

225 
	#WIN_IDLEIMMEDIATE
 0xE1

	)

226 
	#WIN_STANDBY
 0xE2

	)

227 
	#WIN_SETIDLE1
 0xE3

	)

228 
	#WIN_READ_BUFFER
 0xE4

	)

229 
	#WIN_CHECKPOWERMODE1
 0xE5

	)

230 
	#WIN_SLEEPNOW1
 0xE6

	)

231 
	#WIN_FLUSH_CACHE
 0xE7

	)

232 
	#WIN_WRITE_BUFFER
 0xE8

	)

233 
	#WIN_WRITE_SAME
 0xE9

	)

235 
	#WIN_FLUSH_CACHE_EXT
 0xEA

	)

236 
	#WIN_IDENTIFY
 0xEC

	)

237 
	#WIN_MEDIAEJECT
 0xED

	)

238 
	#WIN_IDENTIFY_DMA
 0xEE

	)

239 
	#WIN_SETFEATURES
 0xEF

	)

240 
	#EXABYTE_ENABLE_NEST
 0xF0

	)

241 
	#WIN_SECURITY_SET_PASS
 0xF1

	)

242 
	#WIN_SECURITY_UNLOCK
 0xF2

	)

243 
	#WIN_SECURITY_ERASE_PREPARE
 0xF3

	)

244 
	#WIN_SECURITY_ERASE_UNIT
 0xF4

	)

245 
	#WIN_SECURITY_FREEZE_LOCK
 0xF5

	)

246 
	#WIN_SECURITY_DISABLE
 0xF6

	)

247 
	#WIN_READ_NATIVE_MAX
 0xF8

	)

248 
	#WIN_SET_MAX
 0xF9

	)

249 
	#DISABLE_SEAGATE
 0xFB

	)

253 
	#SMART_READ_VALUES
 0xD0

	)

254 
	#SMART_READ_THRESHOLDS
 0xD1

	)

255 
	#SMART_AUTOSAVE
 0xD2

	)

256 
	#SMART_SAVE
 0xD3

	)

257 
	#SMART_IMMEDIATE_OFFLINE
 0xD4

	)

258 
	#SMART_READ_LOG_SECTOR
 0xD5

	)

259 
	#SMART_WRITE_LOG_SECTOR
 0xD6

	)

260 
	#SMART_WRITE_THRESHOLDS
 0xD7

	)

261 
	#SMART_ENABLE
 0xD8

	)

262 
	#SMART_DISABLE
 0xD9

	)

263 
	#SMART_STATUS
 0xDA

	)

264 
	#SMART_AUTO_OFFLINE
 0xDB

	)

268 
	#SMART_LCYL_PASS
 0x4F

	)

269 
	#SMART_HCYL_PASS
 0xC2

	)

272 
	#SETFEATURES_EN_8BIT
 0x01

	)

273 
	#SETFEATURES_EN_WCACHE
 0x02

	)

274 
	#SETFEATURES_DIS_DEFECT
 0x04

	)

275 
	#SETFEATURES_EN_APM
 0x05

	)

276 
	#SETFEATURES_EN_SAME_R
 0x22

	)

277 
	#SETFEATURES_DIS_MSN
 0x31

	)

278 
	#SETFEATURES_DIS_RETRY
 0x33

	)

279 
	#SETFEATURES_EN_AAM
 0x42

	)

280 
	#SETFEATURES_RW_LONG
 0x44

	)

281 
	#SETFEATURES_SET_CACHE
 0x54

	)

282 
	#SETFEATURES_DIS_RLA
 0x55

	)

283 
	#SETFEATURES_EN_RI
 0x5D

	)

284 
	#SETFEATURES_EN_SI
 0x5E

	)

285 
	#SETFEATURES_DIS_RPOD
 0x66

	)

286 
	#SETFEATURES_DIS_ECC
 0x77

	)

287 
	#SETFEATURES_DIS_8BIT
 0x81

	)

288 
	#SETFEATURES_DIS_WCACHE
 0x82

	)

289 
	#SETFEATURES_EN_DEFECT
 0x84

	)

290 
	#SETFEATURES_DIS_APM
 0x85

	)

291 
	#SETFEATURES_EN_ECC
 0x88

	)

292 
	#SETFEATURES_EN_MSN
 0x95

	)

293 
	#SETFEATURES_EN_RETRY
 0x99

	)

294 
	#SETFEATURES_EN_RLA
 0xAA

	)

295 
	#SETFEATURES_PREFETCH
 0xAB

	)

296 
	#SETFEATURES_EN_REST
 0xAC

	)

297 
	#SETFEATURES_4B_RW_LONG
 0xBB

	)

298 
	#SETFEATURES_DIS_AAM
 0xC2

	)

299 
	#SETFEATURES_EN_RPOD
 0xCC

	)

300 
	#SETFEATURES_DIS_RI
 0xDD

	)

301 
	#SETFEATURES_EN_SAME_M
 0xDD

	)

302 
	#SETFEATURES_DIS_SI
 0xDE

	)

306 
	#SECURITY_SET_PASSWORD
 0xBA

	)

307 
	#SECURITY_UNLOCK
 0xBB

	)

308 
	#SECURITY_ERASE_PREPARE
 0xBC

	)

309 
	#SECURITY_ERASE_UNIT
 0xBD

	)

310 
	#SECURITY_FREEZE_LOCK
 0xBE

	)

311 
	#SECURITY_DISABLE_PASSWORD
 0xBF

	)

313 
	shd_geomry
 {

314 
	mhds
;

315 
	ms
;

316 
	mcylds
;

317 
	mt
;

321 
	#HDIO_GETGEO
 0x0301

	)

322 
	#HDIO_GET_UNMASKINTR
 0x0302

	)

323 
	#HDIO_GET_MULTCOUNT
 0x0304

	)

324 
	#HDIO_GET_QDMA
 0x0305

	)

326 
	#HDIO_SET_XFER
 0x0306

	)

328 
	#HDIO_OBSOLETE_IDENTITY
 0x0307

	)

329 
	#HDIO_GET_KEEPSETTINGS
 0x0308

	)

330 
	#HDIO_GET_32BIT
 0x0309

	)

331 
	#HDIO_GET_NOWERR
 0x030

	)

332 
	#HDIO_GET_DMA
 0x030b

	)

333 
	#HDIO_GET_NICE
 0x030

	)

334 
	#HDIO_GET_IDENTITY
 0x030d

	)

335 
	#HDIO_GET_WCACHE
 0x030

	)

336 
	#HDIO_GET_ACOUSTIC
 0x030

	)

337 
	#HDIO_GET_ADDRESS
 0x0310

	)

339 
	#HDIO_GET_BUSSTATE
 0x031

	)

340 
	#HDIO_TRISTATE_HWIF
 0x031b

	)

341 
	#HDIO_DRIVE_RESET
 0x031

	)

342 
	#HDIO_DRIVE_TASKFILE
 0x031d

	)

343 
	#HDIO_DRIVE_TASK
 0x031

	)

344 
	#HDIO_DRIVE_CMD
 0x031

	)

345 
	#HDIO_DRIVE_CMD_AEB
 
HDIO_DRIVE_TASK


	)

348 
	#HDIO_SET_MULTCOUNT
 0x0321

	)

349 
	#HDIO_SET_UNMASKINTR
 0x0322

	)

350 
	#HDIO_SET_KEEPSETTINGS
 0x0323

	)

351 
	#HDIO_SET_32BIT
 0x0324

	)

352 
	#HDIO_SET_NOWERR
 0x0325

	)

353 
	#HDIO_SET_DMA
 0x0326

	)

354 
	#HDIO_SET_PIO_MODE
 0x0327

	)

355 
	#HDIO_SCAN_HWIF
 0x0328

	)

356 
	#HDIO_UNREGISTER_HWIF
 0x032

	)

357 
	#HDIO_SET_NICE
 0x0329

	)

358 
	#HDIO_SET_WCACHE
 0x032b

	)

359 
	#HDIO_SET_ACOUSTIC
 0x032

	)

360 
	#HDIO_SET_BUSSTATE
 0x032d

	)

361 
	#HDIO_SET_QDMA
 0x032

	)

362 
	#HDIO_SET_ADDRESS
 0x032

	)

366 
	mBUSSTATE_OFF
 = 0,

367 
	mBUSSTATE_ON
,

368 
	mBUSSTATE_TRISTATE


377 
	#__NEW_HD_DRIVE_ID


	)

385 
	shd_driveid
 {

386 
	mcfig
;

387 
	mcyls
;

388 
	mrved2
;

389 
	mhds
;

390 
	mack_bys
;

391 
	m_bys
;

392 
	ms
;

393 
	mvd0
;

394 
	mvd1
;

395 
	mvd2
;

396 
	mrl_no
[20];

397 
	mbuf_ty
;

398 
	mbuf_size
;

401 
	mecc_bys
;

402 
	mfw_v
[8];

403 
	mmod
[40];

404 
	mmax_muɣ
;

405 
	mvd3
;

406 
	mdwd_io
;

407 
	mvd4
;

408 
	mby
;

414 
	mrved50
;

415 
	mvd5
;

416 
	mtPIO
;

417 
	mvd6
;

418 
	mtDMA
;

419 
	mfld_vid
;

424 
	mcur_cyls
;

425 
	mcur_hds
;

426 
	mcur_s
;

427 
	mcur_cy0
;

428 
	mcur_cy1
;

429 
	mmuɣ
;

430 
	mmuɣ_vid
;

431 
	mlba_cy
;

432 
	mdma_1wd
;

433 
	mdma_mwd
;

434 
	meide_pio_modes
;

435 
	meide_dma_m
;

436 
	meide_dma_time
;

437 
	meide_pio
;

438 
	meide_pio_idy
;

439 
	mwds69_70
[2];

442 
	mwds71_74
[4];

445 
	mqueue_dth
;

449 
	mwds76_79
[4];

450 
	mmaj_v_num
;

451 
	mm_v_num
;

452 
	mcommd_t_1
;

470 
	mcommd_t_2
;

488 
	mcfs
;

500 
	mcfs_ab_1
;

519 
	mcfs_ab_2
;

538 
	mcsf_deu
;

550 
	mdma_uɿ
;

551 
	muc
;

552 
	msEuc
;

553 
	mCurAPMvues
;

554 
	mmc
;

555 
	mhw_cfig
;

573 
	macouic
;

577 
	mmqs
;

578 
	msx
;

579 
	ml
;

580 
	mg
;

581 
	mlba_cy_2
;

582 
	mwds104_125
[22];

583 
	mϡ_lun
;

584 
	mwd127
;

592 
	mdlf
;

604 
	mcsfo
;

612 
	mwds130_155
[26];

613 
	mwd156
;

614 
	mwds157_159
[3];

615 
	mc_pow
;

622 
	mwds161_175
[15];

623 
	mwds176_205
[30];

624 
	mwds206_254
[49];

625 
	mgry_wd
;

636 
	#IDE_NICE_DSC_OVERLAP
 (0

	)

637 
	#IDE_NICE_ATAPI_OVERLAP
 (1

	)

638 
	#IDE_NICE_1
 (3

	)

639 
	#IDE_NICE_0
 (2

	)

640 
	#IDE_NICE_2
 (4

	)

	@/usr/include/linux/kernel.h

1 #ide
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<lux/sysfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a

	`__ALIGN_KERNEL_MASK
(x, (
	`tyof
(x))- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
(((x+ (mask)& ~(mask))

	)

	@/usr/include/linux/sched.h

1 #ide
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000f

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

26 
	#CLONE_NEWUTS
 0x04000000

	)

27 
	#CLONE_NEWIPC
 0x08000000

	)

28 
	#CLONE_NEWUSER
 0x10000000

	)

29 
	#CLONE_NEWPID
 0x20000000

	)

30 
	#CLONE_NEWNET
 0x40000000

	)

31 
	#CLONE_IO
 0x80000000

	)

36 
	#SCHED_NORMAL
 0

	)

37 
	#SCHED_FIFO
 1

	)

38 
	#SCHED_RR
 2

	)

39 
	#SCHED_BATCH
 3

	)

41 
	#SCHED_IDLE
 5

	)

43 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

	@/usr/include/linux/tty.h

1 #ide
_LINUX_TTY_H


2 
	#_LINUX_TTY_H


	)

8 
	#NR_LDISCS
 30

	)

11 
	#N_TTY
 0

	)

12 
	#N_SLIP
 1

	)

13 
	#N_MOUSE
 2

	)

14 
	#N_PPP
 3

	)

15 
	#N_STRIP
 4

	)

16 
	#N_AX25
 5

	)

17 
	#N_X25
 6

	)

18 
	#N_6PACK
 7

	)

19 
	#N_MASC
 8

	)

20 
	#N_R3964
 9

	)

21 
	#N_PROFIBUS_FDL
 10

	)

22 
	#N_IRDA
 11

	)

23 
	#N_SMSBLOCK
 12

	)

25 
	#N_HDLC
 13

	)

26 
	#N_SYNC_PPP
 14

	)

27 
	#N_HCI
 15

	)

28 
	#N_GIGASET_M101
 16

	)

29 
	#N_SLCAN
 17

	)

30 
	#N_PPS
 18

	)

31 
	#N_V253
 19

	)

32 
	#N_CAIF
 20

	)

33 
	#N_GSM0710
 21

	)

34 
	#N_TI_WL
 22

	)

35 
	#N_TRACESINK
 23

	)

36 
	#N_TRACEROUTER
 24

	)

	@/usr/include/signal.h

22 #idef 
_SIGNAL_H


24 #i!
defed
 
__ed_sig_omic_t
 && !defed 
__ed_sigt_t


25 
	#_SIGNAL_H


	)

28 
	~<us.h
>

30 
	g__BEGIN_DECLS


32 
	~<bs/sigt.h
>

36 #i
defed
 
__ed_sig_omic_t
 || defed 
_SIGNAL_H


37 #ide
__sig_omic_t_defed


38 
	#__sig_omic_t_defed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_omic_t
 
	tsig_omic_t
;

41 
	g__END_NAMESPACE_STD


43 #unde
__ed_sig_omic_t


46 #i
defed
 
__ed_sigt_t
 || (defed 
_SIGNAL_H
 && defed 
__USE_POSIX
)

47 #ide
__sigt_t_defed


48 
	#__sigt_t_defed


	)

49 
__sigt_t
 
	tsigt_t
;

51 #unde
__ed_sigt_t


54 #ifde
_SIGNAL_H


56 
	~<bs/tys.h
>

57 
	~<bs/signum.h
>

59 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K


60 #ide
__pid_t_defed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_defed


	)

64 #ifde
__USE_XOPEN


66 #ide
__uid_t_defed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_defed


	)

72 #ifde
__USE_POSIX199309


74 
	#__ed_timeec


	)

75 
	~<time.h
>

78 #i
defed
 
__USE_POSIX199309
 || defed 
__USE_XOPEN_EXTENDED


80 
	~<bs/sigfo.h
>

85 (*
	t__sighdr_t
) ();

90 
__sighdr_t
 
	$__sysv_sigl
 (
__sig
, 
__sighdr_t
 
__hdr
)

91 
__THROW
;

92 #ifde
__USE_GNU


93 
__sighdr_t
 
	$sysv_sigl
 (
__sig
, 
__sighdr_t
 
__hdr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifde
__USE_BSD


102 
__sighdr_t
 
	$sigl
 (
__sig
, 
__sighdr_t
 
__hdr
)

103 
__THROW
;

106 #ifde
__REDIRECT_NTH


107 
__sighdr_t
 
	`__REDIRECT_NTH
 (
sigl
,

108 (
__sig
, 
__sighdr_t
 
__hdr
),

109 
__sysv_sigl
);

111 
	#sigl
 
__sysv_sigl


	)

114 
__END_NAMESPACE_STD


116 #ifde
__USE_XOPEN


119 
__sighdr_t
 
	$bsd_sigl
 (
__sig
, 
__sighdr_t
 
__hdr
)

120 
__THROW
;

126 #ifde
__USE_POSIX


127 
	$kl
 (
__pid_t
 
__pid
, 
__sig

__THROW
;

130 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


134 
	$kg
 (
__pid_t
 
__pg
, 
__sig

__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$i
 (
__sig

__THROW
;

140 
__END_NAMESPACE_STD


142 #ifde
__USE_SVID


144 
__sighdr_t
 
	$ssigl
 (
__sig
, 
__sighdr_t
 
__hdr
)

145 
__THROW
;

146 
	$gsigl
 (
__sig

__THROW
;

149 #i
defed
 
__USE_MISC
 || defed 
__USE_XOPEN2K


151 
	`psigl
 (
__sig
, cڡ *
__s
);

154 #ifde
__USE_XOPEN2K


156 
	`psigfo
 (cڡ 
sigfo_t
 *
__pfo
, cڡ *
__s
);

169 
	`__sigu
 (
__sig__mask
, 
__is_sig
);

171 #ifde
__FAVOR_BSD


174 
	$sigu
 (
__mask

__THROW
 
__ibu_dd__
;

176 #ifde
__USE_XOPEN


177 #ifde
__GNUC__


178 
	$sigu
 (
__sig

	`__asm__
 ("__xpg_sigpause");

181 
	#sigu
(
sig

	`__sigu
 ((sig), 1)

	)

187 #ifde
__USE_BSD


194 
	#sigmask
(
sig

	`__sigmask
(sig)

	)

197 
	$sigblock
 (
__mask

__THROW
 
__ibu_dd__
;

200 
	$sigtmask
 (
__mask

__THROW
 
__ibu_dd__
;

203 
	$siggmask
 (
__THROW
 
__ibu_dd__
;

207 #ifde
__USE_MISC


208 
	#NSIG
 
_NSIG


	)

211 #ifde
__USE_GNU


212 
__sighdr_t
 
	tsighdr_t
;

216 #ifde
__USE_BSD


217 
__sighdr_t
 
	tsig_t
;

220 #ifde
__USE_POSIX


223 
	$sigemyt
 (
sigt_t
 *
__t

__THROW
 
	`__nnu
 ((1));

226 
	$sigflt
 (
sigt_t
 *
__t

__THROW
 
	`__nnu
 ((1));

229 
	$sigaddt
 (
sigt_t
 *
__t
, 
__signo

__THROW
 
	`__nnu
 ((1));

232 
	$sigdt
 (
sigt_t
 *
__t
, 
__signo

__THROW
 
	`__nnu
 ((1));

235 
	$sigismemb
 (cڡ 
sigt_t
 *
__t
, 
__signo
)

236 
__THROW
 
	`__nnu
 ((1));

238 #ifde
__USE_GNU


240 
	$sigimyt
 (cڡ 
sigt_t
 *
__t

__THROW
 
	`__nnu
 ((1));

243 
	$sigdt
 (
sigt_t
 *
__t
, cڡ sigt_*
__
,

244 cڡ 
sigt_t
 *
__right

__THROW
 
	`__nnu
 ((1, 2, 3));

247 
	$sigܣt
 (
sigt_t
 *
__t
, cڡ sigt_*
__
,

248 cڡ 
sigt_t
 *
__right

__THROW
 
	`__nnu
 ((1, 2, 3));

253 
	~<bs/sigai.h
>

256 
	$sigocmask
 (
__how
, cڡ 
sigt_t
 *
__ri
 
__t
,

257 
sigt_t
 *
__ri
 
__ot

__THROW
;

264 
	$sigsud
 (cڡ 
sigt_t
 *
__t

	`__nnu
 ((1));

267 
	$sigai
 (
__sig
, cڡ 
sigai
 *
__ri
 
__a
,

268 
sigai
 *
__ri
 
__

__THROW
;

271 
	$signdg
 (
sigt_t
 *
__t

__THROW
 
	`__nnu
 ((1));

278 
	$sigwa
 (cڡ 
sigt_t
 *
__ri
 
__t
, *__ri 
__sig
)

279 
	`__nnu
 ((1, 2));

281 #ifde
__USE_POSIX199309


286 
	$sigwafo
 (cڡ 
sigt_t
 *
__ri
 
__t
,

287 
sigfo_t
 *
__ri
 
__fo

	`__nnu
 ((1));

294 
	$sigtimedwa
 (cڡ 
sigt_t
 *
__ri
 
__t
,

295 
sigfo_t
 *
__ri
 
__fo
,

296 cڡ 
timeec
 *
__ri
 
__timeout
)

297 
	`__nnu
 ((1));

301 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cڡ 
sigv
 
__v
)

302 
__THROW
;

307 #ifde
__USE_BSD


311 cڡ *cڡ 
_sys_sigli
[
_NSIG
];

312 cڡ *cڡ 
sys_sigli
[
_NSIG
];

315 
	ssigvec


317 
__sighdr_t
 
sv_hdr
;

318 
sv_mask
;

320 
sv_ags
;

321 
	#sv_ڡack
 
sv_ags


	)

325 
	#SV_ONSTACK
 (1 << 0)

	)

326 
	#SV_INTERRUPT
 (1 << 1)

	)

327 
	#SV_RESETHAND
 (1 << 2)

	)

335 
	$sigvec
 (
__sig
, cڡ 
sigvec
 *
__vec
,

336 
sigvec
 *
__ovec

__THROW
;

340 
	~<bs/sigcڋxt.h
>

343 
	$sigtu
 (
sigcڋxt
 *
__s

__THROW
;

348 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


349 
	#__ed_size_t


	)

350 
	~<ddef.h
>

355 
	$sigu
 (
__sig
, 
__u

__THROW
;

357 
	~<bs/sigack.h
>

358 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8


360 
	~<sys/ucڋxt.h
>

366 
	$sigack
 (
sigack
 *
__ss
, sigack *
__oss
)

367 
__THROW
 
__ibu_dd__
;

371 
	$sigtack
 (cڡ 
sigtack
 *
__ri
 
__ss
,

372 
sigtack
 *
__ri
 
__oss

__THROW
;

376 #ifde
__USE_XOPEN_EXTENDED


380 
	$sighd
 (
__sig

__THROW
;

383 
	$sigl
 (
__sig

__THROW
;

386 
	$sigigne
 (
__sig

__THROW
;

389 
__sighdr_t
 
	$sigt
 (
__sig
, 
__sighdr_t
 
__di

__THROW
;

392 #i
defed
 
__USE_POSIX199506
 || defed 
__USE_UNIX98


395 
	~<bs/hadtys.h
>

396 
	~<bs/sigthad.h
>

403 
	$__libc_cut_sigm
 (
__THROW
;

405 
	$__libc_cut_sigmax
 (
__THROW
;

409 
__END_DECLS


	@/usr/include/stdio.h

23 #ide
_STDIO_H


25 #i!
defed
 
__ed_FILE
 && !defed 
__ed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<us.h
>

29 
	g__BEGIN_DECLS


31 
	#__ed_size_t


	)

32 
	#__ed_NULL


	)

33 
	~<ddef.h
>

35 
	~<bs/tys.h
>

36 
	#__ed_FILE


	)

37 
	#__ed___FILE


	)

41 #i!
defed
 
__FILE_defed
 && defed 
__ed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #i
defed
 
__USE_LARGEFILE64
 || defed 
__USE_SVID
 || defed 
__USE_POSIX
 \

51 || 
defed
 
	g__USE_BSD
 || defed 
	g__USE_ISOC99
 || defed 
	g__USE_XOPEN
 \

52 || 
defed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defed
 1

	)

58 #unde
__ed_FILE


61 #i!
defed
 
____FILE_defed
 && defed 
__ed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defed
 1

	)

68 #unde
__ed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8


77 #ifde
__GNUC__


78 #ide
_VA_LIST_DEFINED


79 
_G_va_li
 
	tva_li
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<dg.h
>

87 #ifde
__USE_XOPEN2K8


88 #ide
__off_t_defed


89 #ide
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defed


	)

96 #i
defed
 
__USE_LARGEFILE64
 && !defed 
__off64_t_defed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defed


	)

101 #ide
__ssize_t_defed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_defed


	)

108 
__BEGIN_NAMESPACE_STD


109 #ide
__USE_FILE_OFFSET64


110 
_G_os_t
 
	tos_t
;

112 
_G_os64_t
 
	tos_t
;

114 
__END_NAMESPACE_STD


115 #ifde
__USE_LARGEFILE64


116 
_G_os64_t
 
	tos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #ide
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #ide
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifde
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


151 
	#P_tmpd
 "/tmp"

	)

164 
	~<bs/dio_lim.h
>

168 
_IO_FILE
 *
d
;

169 
_IO_FILE
 *
dout
;

170 
_IO_FILE
 *
dr
;

172 
	#d
 
d


	)

173 
	#dout
 
dout


	)

174 
	#dr
 
dr


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$move
 (cڡ *
__fame

__THROW
;

180 
	$me
 (cڡ *
__d
, cڡ *
__w

__THROW
;

181 
__END_NAMESPACE_STD


183 #ifde
__USE_ATFILE


185 
	$mt
 (
__dfd
, cڡ *
__d
, 
__wfd
,

186 cڡ *
__w

__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #ide
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfe
 (
__wur
;

197 #ifde
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64

__wur
;

200 
	#tmpfe
 
tmpfe64


	)

204 #ifde
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfe64
 (
__wur
;

209 *
	$tmam
 (*
__s

__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifde
__USE_MISC


215 *
	$tmam_r
 (*
__s

__THROW
 
__wur
;

219 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


227 *
	$mam
 (cڡ *
__d
, cڡ *
__pfx
)

228 
__THROW
 
__ibu_mloc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`fo
 (
FILE
 *
__am
);

242 
	`fush
 (
FILE
 *
__am
);

243 
__END_NAMESPACE_STD


245 #ifde
__USE_MISC


252 
	`fush_uocked
 (
FILE
 *
__am
);

255 #ifde
__USE_GNU


262 
	`fol
 ();

266 
__BEGIN_NAMESPACE_STD


267 #ide
__USE_FILE_OFFSET64


272 
FILE
 *
	$fݒ
 (cڡ *
__ri
 
__fame
,

273 cڡ *
__ri
 
__modes

__wur
;

278 
FILE
 *
	$eݒ
 (cڡ *
__ri
 
__fame
,

279 cڡ *
__ri
 
__modes
,

280 
FILE
 *
__ri
 
__am

__wur
;

282 #ifde
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
fݒ
, (cڡ *
__ri
 
__fame
,

284 cڡ *
__ri
 
__modes
), 
fݒ64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
eݒ
, (cڡ *
__ri
 
__fame
,

287 cڡ *
__ri
 
__modes
,

288 
FILE
 *
__ri
 
__am
), 
eݒ64
)

289 
__wur
;

291 
	#fݒ
 
fݒ64


	)

292 
	#eݒ
 
eݒ64


	)

295 
__END_NAMESPACE_STD


296 #ifde
__USE_LARGEFILE64


297 
FILE
 *
	$fݒ64
 (cڡ *
__ri
 
__fame
,

298 cڡ *
__ri
 
__modes

__wur
;

299 
FILE
 *
	$eݒ64
 (cڡ *
__ri
 
__fame
,

300 cڡ *
__ri
 
__modes
,

301 
FILE
 *
__ri
 
__am

__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fdݒ
 (
__fd
, cڡ *
__modes

__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$fݒcook
 (*
__ri
 
__magic_cook
,

313 cڡ *
__ri
 
__modes
,

314 
_IO_cook_io_funis_t
 
__io_funcs

__THROW
 
__wur
;

317 #ifde
__USE_XOPEN2K8


319 
FILE
 *
	$fmemݒ
 (*
__s
, 
size_t
 
__n
, cڡ *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$ݒ_memam
 (**
__buoc
, 
size_t
 *
__sizoc

__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$tbuf
 (
FILE
 *
__ri
 
__am
, *__ri 
__buf

__THROW
;

336 
	$tvbuf
 (
FILE
 *
__ri
 
__am
, *__ri 
__buf
,

337 
__modes
, 
size_t
 
__n

__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_BSD


343 
	$tbufr
 (
FILE
 *
__ri
 
__am
, *__ri 
__buf
,

344 
size_t
 
__size

__THROW
;

347 
	$ebuf
 (
FILE
 *
__am

__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`rtf
 (
FILE
 *
__ri
 
__am
,

357 cڡ *
__ri
 
__fm
, ...);

362 
	`tf
 (cڡ *
__ri
 
__fm
, ...);

364 
	$rtf
 (*
__ri
 
__s
,

365 cڡ *
__ri
 
__fm
, ...
__THROWNL
;

371 
	`vrtf
 (
FILE
 *
__ri
 
__s
, cڡ *__ri 
__fm
,

372 
_G_va_li
 
__g
);

377 
	`vtf
 (cڡ *
__ri
 
__fm
, 
_G_va_li
 
__g
);

379 
	$vrtf
 (*
__ri
 
__s
, cڡ *__ri 
__fm
,

380 
_G_va_li
 
__g

__THROWNL
;

381 
__END_NAMESPACE_STD


383 #i
defed
 
__USE_BSD
 || defed 
__USE_ISOC99
 || defed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$tf
 (*
__ri
 
__s
, 
size_t
 
__maxn
,

387 cڡ *
__ri
 
__fm
, ...)

388 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 3, 4)));

390 
	$vtf
 (*
__ri
 
__s
, 
size_t
 
__maxn
,

391 cڡ *
__ri
 
__fm
, 
_G_va_li
 
__g
)

392 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifde
__USE_GNU


399 
	$vartf
 (**
__ri
 
__r
, cڡ *__ri 
__f
,

400 
_G_va_li
 
__g
)

401 
__THROWNL
 
	`__ibu__
 ((
	$__fm__
 (
__tf__
, 2, 0))
__wur
;

402 
	$__artf
 (**
__ri
 
__r
,

403 cڡ *
__ri
 
__fmt
, ...)

404 
__THROWNL
 
	`__ibu__
 ((
	$__fm__
 (
__tf__
, 2, 3))
__wur
;

405 
	$artf
 (**
__ri
 
__r
,

406 cڡ *
__ri
 
__fmt
, ...)

407 
__THROWNL
 
	`__ibu__
 ((
	$__fm__
 (
__tf__
, 2, 3))
__wur
;

410 #ifde
__USE_XOPEN2K8


412 
	$vdtf
 (
__fd
, cڡ *
__ri
 
__fmt
,

413 
_G_va_li
 
__g
)

414 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 0)));

415 
	$dtf
 (
__fd
, cڡ *
__ri
 
__fmt
, ...)

416 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsnf
 (
FILE
 *
__ri
 
__am
,

426 cڡ *
__ri
 
__fm
, ...
__wur
;

431 
	$snf
 (cڡ *
__ri
 
__fm
, ...
__wur
;

433 
	$ssnf
 (cڡ *
__ri
 
__s
,

434 cڡ *
__ri
 
__fm
, ...
__THROW
;

436 #i
defed
 
__USE_ISOC99
 && !defed 
__USE_GNU
 \

437 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

438 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

439 #ifde
__REDIRECT


443 
	`__REDIRECT
 (
fsnf
, (
FILE
 *
__ri
 
__am
,

444 cڡ *
__ri
 
__fm
, ...),

445 
__isoc99_fsnf

__wur
;

446 
	`__REDIRECT
 (
snf
, (cڡ *
__ri
 
__fm
, ...),

447 
__isoc99_snf

__wur
;

448 
	`__REDIRECT_NTH
 (
ssnf
, (cڡ *
__ri
 
__s
,

449 cڡ *
__ri
 
__fm
, ...),

450 
__isoc99_ssnf
);

452 
	$__isoc99_fsnf
 (
FILE
 *
__ri
 
__am
,

453 cڡ *
__ri
 
__fm
, ...
__wur
;

454 
	$__isoc99_snf
 (cڡ *
__ri
 
__fm
, ...
__wur
;

455 
	$__isoc99_ssnf
 (cڡ *
__ri
 
__s
,

456 cڡ *
__ri
 
__fm
, ...
__THROW
;

457 
	#fsnf
 
__isoc99_fsnf


	)

458 
	#snf
 
__isoc99_snf


	)

459 
	#ssnf
 
__isoc99_ssnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsnf
 (
FILE
 *
__ri
 
__s
, cڡ *__ri 
__fm
,

472 
_G_va_li
 
__g
)

473 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 2, 0))
__wur
;

479 
	$vsnf
 (cڡ *
__ri
 
__fm
, 
_G_va_li
 
__g
)

480 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 1, 0))
__wur
;

483 
	$vssnf
 (cڡ *
__ri
 
__s
,

484 cڡ *
__ri
 
__fm
, 
_G_va_li
 
__g
)

485 
__THROW
 
	`__ibu__
 ((
	`__fm__
 (
__snf__
, 2, 0)));

487 #i!
defed
 
__USE_GNU
 \

488 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

489 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

490 #ifde
__REDIRECT


494 
	`__REDIRECT
 (
vfsnf
,

495 (
FILE
 *
__ri
 
__s
,

496 cڡ *
__ri
 
__fm
, 
_G_va_li
 
__g
),

497 
__isoc99_vfsnf
)

498 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 2, 0))
__wur
;

499 
	`__REDIRECT
 (
vsnf
, (cڡ *
__ri
 
__fm
,

500 
_G_va_li
 
__g
), 
__isoc99_vsnf
)

501 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 1, 0))
__wur
;

502 
	`__REDIRECT_NTH
 (
vssnf
,

503 (cڡ *
__ri
 
__s
,

504 cڡ *
__ri
 
__fm
,

505 
_G_va_li
 
__g
), 
__isoc99_vssnf
)

506 
	`__ibu__
 ((
	`__fm__
 (
__snf__
, 2, 0)));

508 
	$__isoc99_vfsnf
 (
FILE
 *
__ri
 
__s
,

509 cڡ *
__ri
 
__fm
,

510 
_G_va_li
 
__g

__wur
;

511 
	$__isoc99_vsnf
 (cڡ *
__ri
 
__fm
,

512 
_G_va_li
 
__g

__wur
;

513 
	$__isoc99_vssnf
 (cڡ *
__ri
 
__s
,

514 cڡ *
__ri
 
__fm
,

515 
_G_va_li
 
__g

__THROW
;

516 
	#vfsnf
 
__isoc99_vfsnf


	)

517 
	#vsnf
 
__isoc99_vsnf


	)

518 
	#vssnf
 
__isoc99_vssnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fgc
 (
FILE
 *
__am
);

532 
	`gc
 (
FILE
 *
__am
);

538 
	`gch
 ();

539 
__END_NAMESPACE_STD


543 
	#gc
(
_

	`_IO_gc
 (_)

	)

545 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


550 
	`gc_uocked
 (
FILE
 *
__am
);

551 
	`gch_uocked
 ();

554 #ifde
__USE_MISC


561 
	`fgc_uocked
 (
FILE
 *
__am
);

565 
__BEGIN_NAMESPACE_STD


573 
	`utc
 (
__c
, 
FILE
 *
__am
);

574 
	`putc
 (
__c
, 
FILE
 *
__am
);

580 
	`putch
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_

	`_IO_putc
 (_ch, _)

	)

587 #ifde
__USE_MISC


594 
	`utc_uocked
 (
__c
, 
FILE
 *
__am
);

597 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


602 
	`putc_uocked
 (
__c
, 
FILE
 *
__am
);

603 
	`putch_uocked
 (
__c
);

607 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC
 \

608 || (
defed
 
__USE_XOPEN
 && !defed 
__USE_XOPEN2K
)

610 
	`gw
 (
FILE
 *
__am
);

613 
	`putw
 (
__w
, 
FILE
 *
__am
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fgs
 (*
__ri
 
__s
, 
__n
, 
FILE
 *__ri 
__am
)

623 
__wur
;

625 #i!
defed
 
__USE_ISOC11
 \

626 || (
defed
 
__lulus
 && __cplusplus <= 201103L)

638 *
	$gs
 (*
__s

__wur
 
__ibu_dd__
;

640 
__END_NAMESPACE_STD


642 #ifde
__USE_GNU


649 *
	$fgs_uocked
 (*
__ri
 
__s
, 
__n
,

650 
FILE
 *
__ri
 
__am

__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__gdim
 (**
__ri
 
__l
,

666 
size_t
 *
__ri
 
__n
, 
__dim
,

667 
FILE
 *
__ri
 
__am

__wur
;

668 
_IO_ssize_t
 
	$gdim
 (**
__ri
 
__l
,

669 
size_t
 *
__ri
 
__n
, 
__dim
,

670 
FILE
 *
__ri
 
__am

__wur
;

678 
_IO_ssize_t
 
	$gle
 (**
__ri
 
__l
,

679 
size_t
 *
__ri
 
__n
,

680 
FILE
 *
__ri
 
__am

__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`uts
 (cڡ *
__ri
 
__s
, 
FILE
 *__ri 
__am
);

695 
	`puts
 (cڡ *
__s
);

702 
	`ungc
 (
__c
, 
FILE
 *
__am
);

709 
size_t
 
	$d
 (*
__ri
 
__r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__ri
 
__am

__wur
;

715 
size_t
 
	`fwre
 (cڡ *
__ri
 
__r
, size_
__size
,

716 
size_t
 
__n
, 
FILE
 *
__ri
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifde
__USE_GNU


726 
	`uts_uocked
 (cڡ *
__ri
 
__s
,

727 
FILE
 *
__ri
 
__am
);

730 #ifde
__USE_MISC


737 
size_t
 
	$d_uocked
 (*
__ri
 
__r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__ri
 
__am

__wur
;

739 
size_t
 
	`fwre_uocked
 (cڡ *
__ri
 
__r
, size_
__size
,

740 
size_t
 
__n
, 
FILE
 *
__ri
 
__am
);

744 
__BEGIN_NAMESPACE_STD


749 
	`fek
 (
FILE
 *
__am
, 
__off
, 
__wh
);

754 
	$l
 (
FILE
 *
__am

__wur
;

759 
	`wd
 (
FILE
 *
__am
);

760 
__END_NAMESPACE_STD


767 #i
defed
 
__USE_LARGEFILE
 || defed 
__USE_XOPEN2K


768 #ide
__USE_FILE_OFFSET64


773 
	`feko
 (
FILE
 *
__am
, 
__off_t
 
__off
, 
__wh
);

778 
__off_t
 
	$lo
 (
FILE
 *
__am

__wur
;

780 #ifde
__REDIRECT


781 
	`__REDIRECT
 (
feko
,

782 (
FILE
 *
__am
, 
__off64_t
 
__off
, 
__wh
),

783 
feko64
);

784 
__off64_t
 
	`__REDIRECT
 (
lo
, (
FILE
 *
__am
), 
lo64
);

786 
	#feko
 
feko64


	)

787 
	#lo
 
lo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #ide
__USE_FILE_OFFSET64


798 
	`fgpos
 (
FILE
 *
__ri
 
__am
, 
os_t
 *__ri 
__pos
);

803 
	`fos
 (
FILE
 *
__am
, cڡ 
os_t
 *
__pos
);

805 #ifde
__REDIRECT


806 
	`__REDIRECT
 (
fgpos
, (
FILE
 *
__ri
 
__am
,

807 
os_t
 *
__ri
 
__pos
), 
fgpos64
);

808 
	`__REDIRECT
 (
fos
,

809 (
FILE
 *
__am
, cڡ 
os_t
 *
__pos
), 
fos64
);

811 
	#fgpos
 
fgpos64


	)

812 
	#fos
 
fos64


	)

815 
__END_NAMESPACE_STD


817 #ifde
__USE_LARGEFILE64


818 
	`feko64
 (
FILE
 *
__am
, 
__off64_t
 
__off
, 
__wh
);

819 
__off64_t
 
	$lo64
 (
FILE
 *
__am

__wur
;

820 
	`fgpos64
 (
FILE
 *
__ri
 
__am
, 
os64_t
 *__ri 
__pos
);

821 
	`fos64
 (
FILE
 *
__am
, cڡ 
os64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$
 (
FILE
 *
__am

__THROW
;

828 
	$of
 (
FILE
 *
__am

__THROW
 
__wur
;

830 
	$
 (
FILE
 *
__am

__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifde
__USE_MISC


835 
	$_uocked
 (
FILE
 *
__am

__THROW
;

836 
	$of_uocked
 (
FILE
 *
__am

__THROW
 
__wur
;

837 
	$_uocked
 (
FILE
 *
__am

__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`
 (cڡ *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<bs/sys_i.h
>

856 #ifdef 
__USE_POSIX


858 
	$fo
 (
FILE
 *
__am

__THROW
 
__wur
;

861 #ifde
__USE_MISC


863 
	$fo_uocked
 (
FILE
 *
__am

__THROW
 
__wur
;

867 #i(
defed
 
__USE_POSIX2
 || defed 
__USE_SVID
 || defed 
__USE_BSD
 || \

868 
defed
 
__USE_MISC
)

873 
FILE
 *
	$pݒ
 (cڡ *
__commd
, cڡ *
__modes

__wur
;

879 
	`po
 (
FILE
 *
__am
);

883 #ifdef 
__USE_POSIX


885 *
	$mid
 (*
__s

__THROW
;

889 #ifde
__USE_XOPEN


891 *
	`curid
 (*
__s
);

895 #ifdef 
__USE_GNU


896 
oback
;

899 
	$oback_tf
 (
oback
 *
__ri
 
__oback
,

900 cڡ *
__ri
 
__fm
, ...)

901 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 3)));

902 
	$oback_vtf
 (
oback
 *
__ri
 
__oback
,

903 cڡ *
__ri
 
__fm
,

904 
_G_va_li
 
__gs
)

905 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 0)));

909 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


913 
	$ockfe
 (
FILE
 *
__am

__THROW
;

917 
	$rylockfe
 (
FILE
 *
__am

__THROW
 
__wur
;

920 
	$fuockfe
 (
FILE
 *
__am

__THROW
;

923 #i
defed
 
__USE_XOPEN
 && !defed 
__USE_XOPEN2K
 && !defed 
__USE_GNU


927 
	#__ed_gt


	)

928 
	~<gt.h
>

933 #ifde
__USE_EXTERN_INLINES


934 
	~<bs/dio.h
>

936 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ftify_funi


937 
	~<bs/dio2.h
>

939 #ifde
__LDBL_COMPAT


940 
	~<bs/dio-ldbl.h
>

943 
__END_DECLS


	@/usr/include/stdlib.h

22 #idef 
_STDLIB_H


24 
	~<us.h
>

27 
	#__ed_size_t


	)

28 #ide
__ed_mloc_d_oc


29 
	#__ed_wch_t


	)

30 
	#__ed_NULL


	)

32 
	~<ddef.h
>

34 
	g__BEGIN_DECLS


36 #ide
__ed_mloc_d_oc


37 
	#_STDLIB_H
 1

	)

39 #i(
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8
&& !defed 
_SYS_WAIT_H


41 
	~<bs/waags.h
>

42 
	~<bs/waus.h
>

44 #ifde
__USE_BSD


49 #i
defed
 
__GNUC__
 && !defed 
__lulus


50 
	#__WAIT_INT
(
us
) \

51 (
	`__exnsi__
 (((uni { 
	`__tyof
(
us

__
; 
__i
; }) \

52 { .
__
 = (
us
}).
__i
))

	)

54 
	#__WAIT_INT
(
us
(*(*&(us))

	)

62 #i!
defed
 
__GNUC__
 || __GNUC__ < 2 || defed 
__lulus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa
 *
	m__ur
;

70 *
	m__
;

71 } 
	t__WAIT_STATUS
 
	t__ibu__
 ((
	t__t_uni__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
us
(us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
us

	`__WEXITSTATUS
 (
	`__WAIT_INT
 (us))

	)

85 
	#WTERMSIG
(
us

	`__WTERMSIG
 (
	`__WAIT_INT
 (us))

	)

86 
	#WSTOPSIG
(
us

	`__WSTOPSIG
 (
	`__WAIT_INT
 (us))

	)

87 
	#WIFEXITED
(
us

	`__WIFEXITED
 (
	`__WAIT_INT
 (us))

	)

88 
	#WIFSIGNALED
(
us

	`__WIFSIGNALED
 (
	`__WAIT_INT
 (us))

	)

89 
	#WIFSTOPPED
(
us

	`__WIFSTOPPED
 (
	`__WAIT_INT
 (us))

	)

90 #ifde
__WIFCONTINUED


91 
	#WIFCONTINUED
(
us

	`__WIFCONTINUED
 (
	`__WAIT_INT
 (us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mqu
;

100 
	mm
;

101 } 
	tdiv_t
;

104 #ide
__ldiv_t_defed


107 
	mqu
;

108 
	mm
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #i
defed
 
__USE_ISOC99
 && !defed 
__div_t_defed


115 
__BEGIN_NAMESPACE_C99


117 
__exnsi__
 struct

119 
	mqu
;

120 
	mm
;

121 } 
	tdiv_t
;

122 
	#__div_t_defed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__y_g_mb_cur_max
 ())

	)

139 
size_t
 
	$__y_g_mb_cur_max
 (
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$of
 (cڡ *
__Ō
)

145 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

147 
	$oi
 (cڡ *
__Ō
)

148 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

150 
	$
 (cڡ *
__Ō
)

151 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

152 
__END_NAMESPACE_STD


154 #i
defed
 
__USE_ISOC99
 || (defed 
__GLIBC_HAVE_LONG_LONG
 && defed 
__USE_MISC
)

155 
__BEGIN_NAMESPACE_C99


157 
__exnsi__
 
	$l
 (cڡ *
__Ō
)

158 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$od
 (cڡ *
__ri
 
__Ō
,

165 **
__ri
 
__dr
)

166 
__THROW
 
	`__nnu
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$of
 (cڡ *
__ri
 
__Ō
,

173 **
__ri
 
__dr

__THROW
 
	`__nnu
 ((1));

175 
	$d
 (cڡ *
__ri
 
__Ō
,

176 **
__ri
 
__dr
)

177 
__THROW
 
	`__nnu
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$
 (cڡ *
__ri
 
__Ō
,

184 **
__ri
 
__dr
, 
__ba
)

185 
__THROW
 
	`__nnu
 ((1));

187 
	$oul
 (cڡ *
__ri
 
__Ō
,

188 **
__ri
 
__dr
, 
__ba
)

189 
__THROW
 
	`__nnu
 ((1));

190 
__END_NAMESPACE_STD


192 #i
defed
 
__GLIBC_HAVE_LONG_LONG
 && defed 
__USE_BSD


194 
__exnsi__


195 
	$oq
 (cڡ *
__ri
 
__Ō
,

196 **
__ri
 
__dr
, 
__ba
)

197 
__THROW
 
	`__nnu
 ((1));

199 
__exnsi__


200 
	$ouq
 (cڡ *
__ri
 
__Ō
,

201 **
__ri
 
__dr
, 
__ba
)

202 
__THROW
 
	`__nnu
 ((1));

205 #i
defed
 
__USE_ISOC99
 || (defed 
__GLIBC_HAVE_LONG_LONG
 && defed 
__USE_MISC
)

206 
__BEGIN_NAMESPACE_C99


208 
__exnsi__


209 
	$l
 (cڡ *
__ri
 
__Ō
,

210 **
__ri
 
__dr
, 
__ba
)

211 
__THROW
 
	`__nnu
 ((1));

213 
__exnsi__


214 
	$ou
 (cڡ *
__ri
 
__Ō
,

215 **
__ri
 
__dr
, 
__ba
)

216 
__THROW
 
	`__nnu
 ((1));

217 
__END_NAMESPACE_C99


221 #ifde
__USE_GNU


235 
	~<xlo.h
>

239 
	$_l
 (cڡ *
__ri
 
__Ō
,

240 **
__ri
 
__dr
, 
__ba
,

241 
__lo_t
 
__loc

__THROW
 
	`__nnu
 ((1, 4));

243 
	$oul_l
 (cڡ *
__ri
 
__Ō
,

244 **
__ri
 
__dr
,

245 
__ba
, 
__lo_t
 
__loc
)

246 
__THROW
 
	`__nnu
 ((1, 4));

248 
__exnsi__


249 
	$l_l
 (cڡ *
__ri
 
__Ō
,

250 **
__ri
 
__dr
, 
__ba
,

251 
__lo_t
 
__loc
)

252 
__THROW
 
	`__nnu
 ((1, 4));

254 
__exnsi__


255 
	$ou_l
 (cڡ *
__ri
 
__Ō
,

256 **
__ri
 
__dr
,

257 
__ba
, 
__lo_t
 
__loc
)

258 
__THROW
 
	`__nnu
 ((1, 4));

260 
	$od_l
 (cڡ *
__ri
 
__Ō
,

261 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

262 
__THROW
 
	`__nnu
 ((1, 3));

264 
	$of_l
 (cڡ *
__ri
 
__Ō
,

265 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

266 
__THROW
 
	`__nnu
 ((1, 3));

268 
	$d_l
 (cڡ *
__ri
 
__Ō
,

269 **
__ri
 
__dr
,

270 
__lo_t
 
__loc
)

271 
__THROW
 
	`__nnu
 ((1, 3));

275 #ifde
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex_le
 

278 
	`__NTH
 (
	$oi
 (cڡ *
__Ō
))

280  (
	`
 (
__Ō
, (**
NULL
, 10);

281 
	}
}

282 
__ex_le
 

283 
__NTH
 (
	$
 (cڡ *
__Ō
))

285  
	`
 (
__Ō
, (**
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #i
defed
 
__USE_MISC
 || defed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__exnsi__
 
__ex_le
 

292 
__NTH
 (
	$l
 (cڡ *
__Ō
))

294  
	`l
 (
__Ō
, (**
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n

__THROW
 
__wur
;

308 
	$a64l
 (cڡ *
__s
)

309 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

313 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_BSD


314 
	~<sys/tys.h
>

321 
	$ndom
 (
__THROW
;

324 
	$dom
 (
__ed

__THROW
;

330 *
	$e
 (
__ed
, *
__ebuf
,

331 
size_t
 
__

__THROW
 
	`__nnu
 ((2));

335 *
	$te
 (*
__ebuf

__THROW
 
	`__nnu
 ((1));

338 #ifde
__USE_MISC


343 
	sndom_da


345 
t32_t
 *

;

346 
t32_t
 *

;

347 
t32_t
 *
e
;

348 
nd_ty
;

349 
nd_deg
;

350 
nd_p
;

351 
t32_t
 *
d_r
;

354 
	$ndom_r
 (
ndom_da
 *
__ri
 
__buf
,

355 
t32_t
 *
__ri
 
__su

__THROW
 
	`__nnu
 ((1, 2));

357 
	$dom_r
 (
__ed
, 
ndom_da
 *
__buf
)

358 
__THROW
 
	`__nnu
 ((2));

360 
	$e_r
 (
__ed
, *
__ri
 
__ebuf
,

361 
size_t
 
__
,

362 
ndom_da
 *
__ri
 
__buf
)

363 
__THROW
 
	`__nnu
 ((2, 4));

365 
	$te_r
 (*
__ri
 
__ebuf
,

366 
ndom_da
 *
__ri
 
__buf
)

367 
__THROW
 
	`__nnu
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$nd
 (
__THROW
;

376 
	$d
 (
__ed

__THROW
;

377 
__END_NAMESPACE_STD


379 #ifde
__USE_POSIX


381 
	$nd_r
 (*
__ed

__THROW
;

385 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


389 
	$dnd48
 (
__THROW
;

390 
	$d48
 (
__xsubi
[3]
__THROW
 
	`__nnu
 ((1));

393 
	$̪d48
 (
__THROW
;

394 
	$Īd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nnu
 ((1));

398 
	$mnd48
 (
__THROW
;

399 
	$jnd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nnu
 ((1));

403 
	$d48
 (
__edv

__THROW
;

404 *
	$ed48
 (
__ed16v
[3])

405 
__THROW
 
	`__nnu
 ((1));

406 
	$lcg48
 (
__m
[7]
__THROW
 
	`__nnu
 ((1));

408 #ifde
__USE_MISC


412 
	sdnd48_da


414 
__x
[3];

415 
__d_x
[3];

416 
__c
;

417 
__
;

418 
__a
;

422 
	$dnd48_r
 (
dnd48_da
 *
__ri
 
__bufr
,

423 *
__ri
 
__su

__THROW
 
	`__nnu
 ((1, 2));

424 
	$d48_r
 (
__xsubi
[3],

425 
dnd48_da
 *
__ri
 
__bufr
,

426 *
__ri
 
__su

__THROW
 
	`__nnu
 ((1, 2));

429 
	$̪d48_r
 (
dnd48_da
 *
__ri
 
__bufr
,

430 *
__ri
 
__su
)

431 
__THROW
 
	`__nnu
 ((1, 2));

432 
	$Īd48_r
 (
__xsubi
[3],

433 
dnd48_da
 *
__ri
 
__bufr
,

434 *
__ri
 
__su
)

435 
__THROW
 
	`__nnu
 ((1, 2));

438 
	$mnd48_r
 (
dnd48_da
 *
__ri
 
__bufr
,

439 *
__ri
 
__su
)

440 
__THROW
 
	`__nnu
 ((1, 2));

441 
	$jnd48_r
 (
__xsubi
[3],

442 
dnd48_da
 *
__ri
 
__bufr
,

443 *
__ri
 
__su
)

444 
__THROW
 
	`__nnu
 ((1, 2));

447 
	$d48_r
 (
__edv
, 
dnd48_da
 *
__bufr
)

448 
__THROW
 
	`__nnu
 ((2));

450 
	$ed48_r
 (
__ed16v
[3],

451 
dnd48_da
 *
__bufr

__THROW
 
	`__nnu
 ((1, 2));

453 
	$lcg48_r
 (
__m
[7],

454 
dnd48_da
 *
__bufr
)

455 
__THROW
 
	`__nnu
 ((1, 2));

461 #ide
__mloc_d_oc_defed


462 
	#__mloc_d_oc_defed


	)

463 
__BEGIN_NAMESPACE_STD


465 *
	$mloc
 (
size_t
 
__size

__THROW
 
__ibu_mloc__
 
__wur
;

467 *
	$oc
 (
size_t
 
__nmemb
, size_
__size
)

468 
__THROW
 
__ibu_mloc__
 
__wur
;

469 
__END_NAMESPACE_STD


472 #ide
__ed_mloc_d_oc


473 
__BEGIN_NAMESPACE_STD


479 *
	$loc
 (*
__r
, 
size_t
 
__size
)

480 
__THROW
 
__ibu_wn_unud_su__
;

482 
	$
 (*
__r

__THROW
;

483 
__END_NAMESPACE_STD


485 #ifdef 
__USE_MISC


487 
	$c
 (*
__r

__THROW
;

490 #i
defed
 
__USE_GNU
 || defed 
__USE_BSD
 || defed 
__USE_MISC


491 
	~<lo.h
>

494 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K
) \

495 || 
defed
 
__USE_BSD


497 *
	$vloc
 (
size_t
 
__size

__THROW
 
__ibu_mloc__
 
__wur
;

500 #ifde
__USE_XOPEN2K


502 
	$posix_memign
 (**
__memr
, 
size_t
 
__ignmt
, size_
__size
)

503 
__THROW
 
	`__nnu
 ((1)
__wur
;

506 #ifde
__USE_ISOC11


508 *
	$igd_loc
 (
size_t
 
__ignmt
, size_
__size
)

509 
__THROW
 
__wur
 
	`__ibu__
 ((
__mloc__
, 
	`__loc_size__
 (2)));

512 
__BEGIN_NAMESPACE_STD


514 
	$abt
 (
__THROW
 
	`__ibu__
 ((
__nܑu__
));

518 
	`ex
 ((*
__func
()
__THROW
 
	`__nnu
 ((1));

520 #i
defed
 
__USE_ISOC11
 || defed 
__USE_ISOCXX11


522 #ifde
__lulus


523 "C++" 
	`_quick_ex
 ((*
__func
) ())

524 
__THROW
 
	`__asm
 ("_quick_ex"
	`__nnu
 ((1));

526 
	`_quick_ex
 ((*
__func
()
__THROW
 
	`__nnu
 ((1));

529 
__END_NAMESPACE_STD


531 #ifdef 
__USE_MISC


534 
	`_ex
 ((*
__func
(
__us
, *
__g
), *__arg)

535 
__THROW
 
	`__nnu
 ((1));

538 
__BEGIN_NAMESPACE_STD


542 
	$ex
 (
__us

__THROW
 
	`__ibu__
 ((
__nܑu__
));

544 #i
defed
 
__USE_ISOC11
 || defed 
__USE_ISOCXX11


548 
	$quick_ex
 (
__us

__THROW
 
	`__ibu__
 ((
__nܑu__
));

550 
__END_NAMESPACE_STD


552 #ifde
__USE_ISOC99


553 
__BEGIN_NAMESPACE_C99


556 
	$_Ex
 (
__us

__THROW
 
	`__ibu__
 ((
__nܑu__
));

557 
__END_NAMESPACE_C99


561 
__BEGIN_NAMESPACE_STD


563 *
	$gv
 (cڡ *
__me

__THROW
 
	`__nnu
 ((1)
__wur
;

564 
__END_NAMESPACE_STD


566 #ifde
__USE_GNU


569 *
	$cu_gv
 (cڡ *
__me
)

570 
__THROW
 
	`__nnu
 ((1)
__wur
;

573 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


577 
	$punv
 (*
__rg

__THROW
 
	`__nnu
 ((1));

580 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN2K


583 
	$nv
 (cڡ *
__me
, cڡ *
__vue
, 
__a
)

584 
__THROW
 
	`__nnu
 ((2));

587 
	$unnv
 (cڡ *
__me

__THROW
 
	`__nnu
 ((1));

590 #ifdef 
__USE_MISC


594 
	$nv
 (
__THROW
;

598 #i
defed
 
__USE_MISC
 \

599 || (
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K8
)

605 *
	$mkmp
 (*
__me

__THROW
 
	`__nnu
 ((1));

608 #i
defed
 
__USE_MISC
 || defed 
__USE_XOPEN_EXTENDED
 \

609 || 
defed
 
__USE_XOPEN2K8


618 #ide
__USE_FILE_OFFSET64


619 
	$mkemp
 (*
__me

	`__nnu
 ((1)
__wur
;

621 #ifde
__REDIRECT


622 
	`__REDIRECT
 (
mkemp
, (*
__me
), 
mkemp64
)

623 
	`__nnu
 ((1)
__wur
;

625 
	#mkemp
 
mkemp64


	)

628 #ifde
__USE_LARGEFILE64


629 
	$mkemp64
 (*
__me

	`__nnu
 ((1)
__wur
;

633 #ifde
__USE_MISC


640 #ide
__USE_FILE_OFFSET64


641 
	$mkemps
 (*
__me
, 
__suffixn

	`__nnu
 ((1)
__wur
;

643 #ifde
__REDIRECT


644 
	`__REDIRECT
 (
mkemps
, (*
__me
, 
__suffixn
),

645 
mkemps64

	`__nnu
 ((1)
__wur
;

647 
	#mkemps
 
mkemps64


	)

650 #ifde
__USE_LARGEFILE64


651 
	$mkemps64
 (*
__me
, 
__suffixn
)

652 
	`__nnu
 ((1)
__wur
;

656 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN2K8


662 *
	$mkdmp
 (*
__me

__THROW
 
	`__nnu
 ((1)
__wur
;

665 #ifde
__USE_GNU


672 #ide
__USE_FILE_OFFSET64


673 
	$mkoemp
 (*
__me
, 
__ags

	`__nnu
 ((1)
__wur
;

675 #ifde
__REDIRECT


676 
	`__REDIRECT
 (
mkoemp
, (*
__me
, 
__ags
), 
mkoemp64
)

677 
	`__nnu
 ((1)
__wur
;

679 
	#mkoemp
 
mkoemp64


	)

682 #ifde
__USE_LARGEFILE64


683 
	$mkoemp64
 (*
__me
, 
__ags

	`__nnu
 ((1)
__wur
;

692 #ide
__USE_FILE_OFFSET64


693 
	$mkoemps
 (*
__me
, 
__suffixn
, 
__ags
)

694 
	`__nnu
 ((1)
__wur
;

696 #ifde
__REDIRECT


697 
	`__REDIRECT
 (
mkoemps
, (*
__me
, 
__suffixn
,

698 
__ags
), 
mkoemps64
)

699 
	`__nnu
 ((1)
__wur
;

701 
	#mkoemps
 
mkoemps64


	)

704 #ifde
__USE_LARGEFILE64


705 
	$mkoemps64
 (*
__me
, 
__suffixn
, 
__ags
)

706 
	`__nnu
 ((1)
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$syem
 (cڡ *
__commd

__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$nilize_fe_me
 (cڡ *
__me
)

724 
__THROW
 
	`__nnu
 ((1)
__wur
;

727 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


733 *
	$th
 (cڡ *
__ri
 
__me
,

734 *
__ri
 
__sved

__THROW
 
__wur
;

739 #ide
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__comr__t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__comr__t
 
	tcomris__t
;

747 #ifde
__USE_GNU


748 (*
	t__comr_d__t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$bch
 (cڡ *
__key
, cڡ *
__ba
,

755 
size_t
 
__nmemb
, size_
__size
, 
__comr__t
 
__comr
)

756 
	`__nnu
 ((1, 2, 5)
__wur
;

760 
	$qst
 (*
__ba
, 
size_t
 
__nmemb
, size_
__size
,

761 
__comr__t
 
__comr

	`__nnu
 ((1, 4));

762 #ifde
__USE_GNU


763 
	$qst_r
 (*
__ba
, 
size_t
 
__nmemb
, size_
__size
,

764 
__comr_d__t
 
__comr
, *
__g
)

765 
	`__nnu
 ((1, 4));

770 
	$abs
 (
__x

__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

771 
	$bs
 (
__x

__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

772 
__END_NAMESPACE_STD


774 #ifde
__USE_ISOC99


775 
__exnsi__
 
	$abs
 (
__x
)

776 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

780 
__BEGIN_NAMESPACE_STD


784 
div_t
 
	$div
 (
__num
, 
__dom
)

785 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

786 
ldiv_t
 
	$ldiv
 (
__num
, 
__dom
)

787 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

788 
__END_NAMESPACE_STD


790 #ifde
__USE_ISOC99


791 
__BEGIN_NAMESPACE_C99


792 
__exnsi__
 
div_t
 
	$div
 (
__num
,

793 
__dom
)

794 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

795 
__END_NAMESPACE_C99


799 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K8
) \

800 || 
defed
 
__USE_SVID


807 *
	$ecvt
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

808 *
__ri
 
__sign

__THROW
 
	`__nnu
 ((3, 4)
__wur
;

813 *
	$fcvt
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

814 *
__ri
 
__sign

__THROW
 
	`__nnu
 ((3, 4)
__wur
;

819 *
	$gcvt
 (
__vue
, 
__ndig
, *
__buf
)

820 
__THROW
 
	`__nnu
 ((3)
__wur
;

823 #ifde
__USE_MISC


825 *
	$qecvt
 (
__vue
, 
__ndig
,

826 *
__ri
 
__det
, *__ri 
__sign
)

827 
__THROW
 
	`__nnu
 ((3, 4)
__wur
;

828 *
	$qfcvt
 (
__vue
, 
__ndig
,

829 *
__ri
 
__det
, *__ri 
__sign
)

830 
__THROW
 
	`__nnu
 ((3, 4)
__wur
;

831 *
	$qgcvt
 (
__vue
, 
__ndig
, *
__buf
)

832 
__THROW
 
	`__nnu
 ((3)
__wur
;

837 
	$ecvt_r
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

838 *
__ri
 
__sign
, *__ri 
__buf
,

839 
size_t
 
__n

__THROW
 
	`__nnu
 ((3, 4, 5));

840 
	$fcvt_r
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

841 *
__ri
 
__sign
, *__ri 
__buf
,

842 
size_t
 
__n

__THROW
 
	`__nnu
 ((3, 4, 5));

844 
	$qecvt_r
 (
__vue
, 
__ndig
,

845 *
__ri
 
__det
, *__ri 
__sign
,

846 *
__ri
 
__buf
, 
size_t
 
__n
)

847 
__THROW
 
	`__nnu
 ((3, 4, 5));

848 
	$qfcvt_r
 (
__vue
, 
__ndig
,

849 *
__ri
 
__det
, *__ri 
__sign
,

850 *
__ri
 
__buf
, 
size_t
 
__n
)

851 
__THROW
 
	`__nnu
 ((3, 4, 5));

856 
__BEGIN_NAMESPACE_STD


859 
	$mbn
 (cڡ *
__s
, 
size_t
 
__n

__THROW
 
__wur
;

862 
	$mbtowc
 (
wch_t
 *
__ri
 
__pwc
,

863 cڡ *
__ri
 
__s
, 
size_t
 
__n

__THROW
 
__wur
;

866 
	$womb
 (*
__s
, 
wch_t
 
__wch

__THROW
 
__wur
;

870 
size_t
 
	$mbowcs
 (
wch_t
 *
__ri
 
__pwcs
,

871 cڡ *
__ri
 
__s
, 
size_t
 
__n

__THROW
;

873 
size_t
 
	$wcombs
 (*
__ri
 
__s
,

874 cڡ 
wch_t
 *
__ri
 
__pwcs
, 
size_t
 
__n
)

875 
__THROW
;

876 
__END_NAMESPACE_STD


879 #ifde
__USE_SVID


884 
	$mch
 (cڡ *
__ڣ

__THROW
 
	`__nnu
 ((1)
__wur
;

888 #i
defed
 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


895 
	$gsubt
 (**
__ri
 
__tip
,

896 *cڡ *
__ri
 
__toks
,

897 **
__ri
 
__vu
)

898 
__THROW
 
	`__nnu
 ((1, 2, 3)
__wur
;

902 #ifde
__USE_XOPEN


904 
	$tkey
 (cڡ *
__key

__THROW
 
	`__nnu
 ((1));

910 #ifde
__USE_XOPEN2KXSI


912 
	$posix_ݒ
 (
__oag

__wur
;

915 #ifde
__USE_XOPEN


920 
	$g
 (
__fd

__THROW
;

924 
	$uock
 (
__fd

__THROW
;

929 *
	$ame
 (
__fd

__THROW
 
__wur
;

932 #ifde
__USE_GNU


936 
	$ame_r
 (
__fd
, *
__buf
, 
size_t
 
__bu
)

937 
__THROW
 
	`__nnu
 ((2));

940 
	`g
 ();

943 #ifde
__USE_BSD


947 
	$gldavg
 (
__ldavg
[], 
__m
)

948 
__THROW
 
	`__nnu
 ((1));

951 
	~<bs/dlib-t.h
>

954 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ftify_funi


955 
	~<bs/dlib.h
>

957 #ifde
__LDBL_COMPAT


958 
	~<bs/dlib-ldbl.h
>

962 #unde
__ed_mloc_d_oc


964 
__END_DECLS


	@/usr/include/string.h

22 #idef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<us.h
>

27 
	g__BEGIN_DECLS


30 
	#__ed_size_t


	)

31 
	#__ed_NULL


	)

32 
	~<ddef.h
>

35 #i
defed
 
__lulus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$memy
 (*
__ri
 
__de
, cڡ *__ri 
__c
,

43 
size_t
 
__n

__THROW
 
	`__nnu
 ((1, 2));

46 *
	$memmove
 (*
__de
, cڡ *
__c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nnu
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #i
defed
 
__USE_SVID
 || defed 
__USE_BSD
 || defed 
__USE_XOPEN


54 *
	$memcy
 (*
__ri
 
__de
, cڡ *__ri 
__c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__nnu
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$memt
 (*
__s
, 
__c
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

65 
	$memcmp
 (cڡ *
__s1
, cڡ *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

69 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"
__ibu_pu__
 
	`__nnu
 ((1));

74 cڡ *
	`memchr
 (cڡ *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"
__ibu_pu__
 
	`__nnu
 ((1));

77 #ifde
__OPTIMIZE__


78 
__ex_ways_le
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n

__THROW


81  
	`__but_memchr
 (
__s
, 
__c
, 
__n
);

84 
__ex_ways_le
 const *

85 
	`memchr
 (cڡ *
__s
, 
__c
, 
size_t
 
__n

__THROW


87  
	`__but_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (cڡ *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

95 
__END_NAMESPACE_STD


97 #ifde
__USE_GNU


100 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$wmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
 
	`__nnu
 ((1));

103 "C++" cڡ *
	$wmemchr
 (cڡ *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
 
	`__nnu
 ((1));

106 *
	$wmemchr
 (cڡ *
__s
, 
__c
)

107 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

111 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"
__ibu_pu__
 
	`__nnu
 ((1));

114 "C++" cڡ *
	$memrchr
 (cڡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"
__ibu_pu__
 
	`__nnu
 ((1));

117 *
	$memrchr
 (cڡ *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$ry
 (*
__ri
 
__de
, cڡ *__ri 
__c
)

126 
__THROW
 
	`__nnu
 ((1, 2));

128 *
	$y
 (*
__ri
 
__de
,

129 cڡ *
__ri
 
__c
, 
size_t
 
__n
)

130 
__THROW
 
	`__nnu
 ((1, 2));

133 *
	$rt
 (*
__ri
 
__de
, cڡ *__ri 
__c
)

134 
__THROW
 
	`__nnu
 ((1, 2));

136 *
	$t
 (*
__ri
 
__de
, cڡ *__ri 
__c
,

137 
size_t
 
__n

__THROW
 
	`__nnu
 ((1, 2));

140 
	$rcmp
 (cڡ *
__s1
, cڡ *
__s2
)

141 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

143 
	$cmp
 (cڡ *
__s1
, cڡ *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

147 
	$rcl
 (cڡ *
__s1
, cڡ *
__s2
)

148 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

150 
size_t
 
	$rxm
 (*
__ri
 
__de
,

151 cڡ *
__ri
 
__c
, 
size_t
 
__n
)

152 
__THROW
 
	`__nnu
 ((2));

153 
__END_NAMESPACE_STD


155 #ifde
__USE_XOPEN2K8


159 
	~<xlo.h
>

162 
	$rcl_l
 (cڡ *
__s1
, cڡ *
__s2
, 
__lo_t
 
__l
)

163 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2, 3));

165 
size_t
 
	$rxm_l
 (*
__de
, cڡ *
__c
, 
size_t
 
__n
,

166 
__lo_t
 
__l

__THROW
 
	`__nnu
 ((2, 4));

169 #i
defed
 
__USE_SVID
 || defed 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 \

170 || 
defed
 
__USE_XOPEN2K8


172 *
	$rdup
 (cڡ *
__s
)

173 
__THROW
 
__ibu_mloc__
 
	`__nnu
 ((1));

179 #i
defed
 
__USE_XOPEN2K8


180 *
	$dup
 (cڡ *
__rg
, 
size_t
 
__n
)

181 
__THROW
 
__ibu_mloc__
 
	`__nnu
 ((1));

184 #i
defed
 
__USE_GNU
 && defed 
__GNUC__


186 
	#rdu
(
s
) \

187 (
__exnsi__
 \

189 cڡ *
__d
 = (
s
); \

190 
size_t
 
__n
 = 
	`
 (
__d
) + 1; \

191 *
__w
 = (*
	`__but_lo
 (
__n
); \

192 (*
	`memy
 (
__w
, 
__d
, 
__n
); \

193 
	}
}))

	)

196 
	#du
(
s
, 
n
) \

197 (
__exnsi__
 \

199 cڡ *
__d
 = (
s
); \

200 
size_t
 
__n
 = 
	`n
 (
__d
, (
n
)); \

201 *
__w
 = (*
	`__but_lo
 (
__n
 + 1); \

202 
__w
[
__n
] = '\0'; \

203 (*
	`memy
 (
__w
, 
__d
, 
__n
); \

204 }))

	)

207 
	g__BEGIN_NAMESPACE_STD


209 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


212 *
rchr
 (*
__s
, 
__c
)

213 
__THROW
 
__asm
 ("rchr"
__ibu_pu__
 
__nnu
 ((1));

214 cڡ *
rchr
 (cڡ *
__s
, 
__c
)

215 
__THROW
 
__asm
 ("rchr"
__ibu_pu__
 
__nnu
 ((1));

217 #ifde
__OPTIMIZE__


218 
__ex_ways_le
 *

219 
rchr
 (*
__s
, 
__c

	g__THROW


221  
__but_rchr
 (
__s
, 
__c
);

224 
__ex_ways_le
 const *

225 
rchr
 (cڡ *
__s
, 
__c

	g__THROW


227  
__but_rchr
 (
__s
, 
__c
);

232 *
	$rchr
 (cڡ *
__s
, 
__c
)

233 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

236 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


239 *
	`chr
 (*
__s
, 
__c
)

240 
__THROW
 
	`__asm
 ("chr"
__ibu_pu__
 
	`__nnu
 ((1));

241 cڡ *
	`chr
 (cڡ *
__s
, 
__c
)

242 
__THROW
 
	`__asm
 ("chr"
__ibu_pu__
 
	`__nnu
 ((1));

244 #ifde
__OPTIMIZE__


245 
__ex_ways_le
 *

246 
	`chr
 (*
__s
, 
__c

__THROW


248  
	`__but_chr
 (
__s
, 
__c
);

251 
__ex_ways_le
 const *

252 
	`chr
 (cڡ *
__s
, 
__c

__THROW


254  
	`__but_chr
 (
__s
, 
__c
);

257 
	}
}

259 *
	$chr
 (cڡ *
__s
, 
__c
)

260 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

262 
__END_NAMESPACE_STD


264 #ifde
__USE_GNU


267 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


268 "C++" *
	$rchul
 (*
__s
, 
__c
)

269 
__THROW
 
	`__asm
 ("rchul"
__ibu_pu__
 
	`__nnu
 ((1));

270 "C++" cڡ *
	$rchul
 (cڡ *
__s
, 
__c
)

271 
__THROW
 
	`__asm
 ("rchul"
__ibu_pu__
 
	`__nnu
 ((1));

273 *
	$rchul
 (cڡ *
__s
, 
__c
)

274 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

278 
__BEGIN_NAMESPACE_STD


281 
size_t
 
	$rcn
 (cڡ *
__s
, cڡ *
__je
)

282 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

285 
size_t
 
	$rn
 (cڡ *
__s
, cڡ *
__ac
)

286 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

288 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


291 *
	`brk
 (*
__s
, cڡ *
__ac
)

292 
__THROW
 
	`__asm
 ("brk"
__ibu_pu__
 
	`__nnu
 ((1, 2));

293 cڡ *
	`brk
 (cڡ *
__s
, cڡ *
__ac
)

294 
__THROW
 
	`__asm
 ("brk"
__ibu_pu__
 
	`__nnu
 ((1, 2));

296 #ifde
__OPTIMIZE__


297 
__ex_ways_le
 *

298 
	`brk
 (*
__s
, cڡ *
__ac

__THROW


300  
	`__but_brk
 (
__s
, 
__ac
);

303 
__ex_ways_le
 const *

304 
	`brk
 (cڡ *
__s
, cڡ *
__ac

__THROW


306  
	`__but_brk
 (
__s
, 
__ac
);

309 
	}
}

311 *
	$brk
 (cڡ *
__s
, cڡ *
__ac
)

312 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

315 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


318 *
	`rr
 (*
__hayack
, cڡ *
__ed
)

319 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

320 cڡ *
	`rr
 (cڡ *
__hayack
, cڡ *
__ed
)

321 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

323 #ifde
__OPTIMIZE__


324 
__ex_ways_le
 *

325 
	`rr
 (*
__hayack
, cڡ *
__ed

__THROW


327  
	`__but_rr
 (
__hayack
, 
__ed
);

330 
__ex_ways_le
 const *

331 
	`rr
 (cڡ *
__hayack
, cڡ *
__ed

__THROW


333  
	`__but_rr
 (
__hayack
, 
__ed
);

336 
	}
}

338 *
	$rr
 (cڡ *
__hayack
, cڡ *
__ed
)

339 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

344 *
	$ok
 (*
__ri
 
__s
, cڡ *__ri 
__dim
)

345 
__THROW
 
	`__nnu
 ((2));

346 
__END_NAMESPACE_STD


350 *
	$__ok_r
 (*
__ri
 
__s
,

351 cڡ *
__ri
 
__dim
,

352 **
__ri
 
__ve_r
)

353 
__THROW
 
	`__nnu
 ((2, 3));

354 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


355 *
	$ok_r
 (*
__ri
 
__s
, cڡ *__ri 
__dim
,

356 **
__ri
 
__ve_r
)

357 
__THROW
 
	`__nnu
 ((2, 3));

360 #ifde
__USE_GNU


362 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


363 "C++" *
	$rr
 (*
__hayack
, cڡ *
__ed
)

364 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

365 "C++" cڡ *
	$rr
 (cڡ *
__hayack
,

366 cڡ *
__ed
)

367 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

369 *
	$rr
 (cڡ *
__hayack
, cڡ *
__ed
)

370 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

374 #ifde
__USE_GNU


378 *
	$memmem
 (cڡ *
__hayack
, 
size_t
 
__hayackn
,

379 cڡ *
__ed
, 
size_t
 
__edn
)

380 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 3));

384 *
	$__mempy
 (*
__ri
 
__de
,

385 cڡ *
__ri
 
__c
, 
size_t
 
__n
)

386 
__THROW
 
	`__nnu
 ((1, 2));

387 *
	$mempy
 (*
__ri
 
__de
,

388 cڡ *
__ri
 
__c
, 
size_t
 
__n
)

389 
__THROW
 
	`__nnu
 ((1, 2));

393 
__BEGIN_NAMESPACE_STD


395 
size_t
 
	$
 (cڡ *
__s
)

396 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

397 
__END_NAMESPACE_STD


399 #ifdef 
__USE_XOPEN2K8


402 
size_t
 
	$n
 (cڡ *
__rg
, 
size_t
 
__maxn
)

403 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

407 
__BEGIN_NAMESPACE_STD


409 *
	$
 (
__um

__THROW
;

410 
__END_NAMESPACE_STD


411 #i
defed
 
__USE_XOPEN2K
 || defed 
__USE_MISC


419 #i
defed
 
__USE_XOPEN2K
 && !defed 
__USE_GNU


422 #ifde
__REDIRECT_NTH


423 
	`__REDIRECT_NTH
 (
_r
,

424 (
__um
, *
__buf
, 
size_t
 
__bu
),

425 
__xpg__r

	`__nnu
 ((2));

427 
	$__xpg__r
 (
__um
, *
__buf
, 
size_t
 
__bu
)

428 
__THROW
 
	`__nnu
 ((2));

429 
	#_r
 
__xpg__r


	)

434 *
	$_r
 (
__um
, *
__buf
, 
size_t
 
__bu
)

435 
__THROW
 
	`__nnu
 ((2)
__wur
;

439 #ifde
__USE_XOPEN2K8


441 *
	$_l
 (
__um
, 
__lo_t
 
__l

__THROW
;

447 
	$__bzo
 (*
__s
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

449 #ifde
__USE_BSD


451 
	$bcy
 (cڡ *
__c
, *
__de
, 
size_t
 
__n
)

452 
__THROW
 
	`__nnu
 ((1, 2));

455 
	$bzo
 (*
__s
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

458 
	$bcmp
 (cڡ *
__s1
, cڡ *
__s2
, 
size_t
 
__n
)

459 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

462 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


465 *
	`dex
 (*
__s
, 
__c
)

466 
__THROW
 
	`__asm
 ("dex"
__ibu_pu__
 
	`__nnu
 ((1));

467 cڡ *
	`dex
 (cڡ *
__s
, 
__c
)

468 
__THROW
 
	`__asm
 ("dex"
__ibu_pu__
 
	`__nnu
 ((1));

470 #i
defed
 
__OPTIMIZE__
 && !defed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


471 
__ex_ways_le
 *

472 
	`dex
 (*
__s
, 
__c

__THROW


474  
	`__but_dex
 (
__s
, 
__c
);

477 
__ex_ways_le
 const *

478 
	`dex
 (cڡ *
__s
, 
__c

__THROW


480  
	`__but_dex
 (
__s
, 
__c
);

483 
	}
}

485 *
	$dex
 (cڡ *
__s
, 
__c
)

486 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

490 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


493 *
	`rdex
 (*
__s
, 
__c
)

494 
__THROW
 
	`__asm
 ("rdex"
__ibu_pu__
 
	`__nnu
 ((1));

495 cڡ *
	`rdex
 (cڡ *
__s
, 
__c
)

496 
__THROW
 
	`__asm
 ("rdex"
__ibu_pu__
 
	`__nnu
 ((1));

498 #i
defed
 
__OPTIMIZE__
 && !defed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


499 
__ex_ways_le
 *

500 
	`rdex
 (*
__s
, 
__c

__THROW


502  
	`__but_rdex
 (
__s
, 
__c
);

505 
__ex_ways_le
 const *

506 
	`rdex
 (cڡ *
__s
, 
__c

__THROW


508  
	`__but_rdex
 (
__s
, 
__c
);

511 
	}
}

513 *
	$rdex
 (cڡ *
__s
, 
__c
)

514 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

519 
	$ffs
 (
__i

__THROW
 
	`__ibu__
 ((
__cڡ__
));

523 #ifdef 
__USE_GNU


524 
	$ff
 (
__l

__THROW
 
	`__ibu__
 ((
__cڡ__
));

525 #ifde
__GNUC__


526 
__exnsi__
 
	$ffl
 (
__
)

527 
__THROW
 
	`__ibu__
 ((
__cڡ__
));

532 
	$rcmp
 (cڡ *
__s1
, cڡ *
__s2
)

533 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

536 
	$cmp
 (cڡ *
__s1
, cڡ *
__s2
, 
size_t
 
__n
)

537 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

540 #ifdef 
__USE_GNU


543 
	$rcmp_l
 (cڡ *
__s1
, cڡ *
__s2
,

544 
__lo_t
 
__loc
)

545 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2, 3));

547 
	$cmp_l
 (cڡ *
__s1
, cڡ *
__s2
,

548 
size_t
 
__n
, 
__lo_t
 
__loc
)

549 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2, 4));

552 #ifdef 
__USE_BSD


555 *
	$rp
 (**
__ri
 
__rgp
,

556 cڡ *
__ri
 
__dim
)

557 
__THROW
 
	`__nnu
 ((1, 2));

560 #ifdef 
__USE_XOPEN2K8


562 *
	$rsigl
 (
__sig

__THROW
;

565 *
	$__py
 (*
__ri
 
__de
, cڡ *__ri 
__c
)

566 
__THROW
 
	`__nnu
 ((1, 2));

567 *
	$py
 (*
__ri
 
__de
, cڡ *__ri 
__c
)

568 
__THROW
 
	`__nnu
 ((1, 2));

572 *
	$__y
 (*
__ri
 
__de
,

573 cڡ *
__ri
 
__c
, 
size_t
 
__n
)

574 
__THROW
 
	`__nnu
 ((1, 2));

575 *
	$y
 (*
__ri
 
__de
,

576 cڡ *
__ri
 
__c
, 
size_t
 
__n
)

577 
__THROW
 
	`__nnu
 ((1, 2));

580 #ifdef 
__USE_GNU


582 
	$rvscmp
 (cڡ *
__s1
, cڡ *
__s2
)

583 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

586 *
	$ry
 (*
__rg

__THROW
 
	`__nnu
 ((1));

589 *
	$memob
 (*
__s
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

591 #ide
bame


596 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


597 "C++" *
	$bame
 (*
__fame
)

598 
__THROW
 
	`__asm
 ("bame"
	`__nnu
 ((1));

599 "C++" cڡ *
	$bame
 (cڡ *
__fame
)

600 
__THROW
 
	`__asm
 ("bame"
	`__nnu
 ((1));

602 *
	$bame
 (cڡ *
__fame

__THROW
 
	`__nnu
 ((1));

608 #i
defed
 
__GNUC__
 && __GNUC__ >= 2

609 #i
defed
 
__OPTIMIZE__
 && !defed 
__OPTIMIZE_SIZE__
 \

610 && !
defed
 
__NO_INLINE__
 && !defed 
__lulus


630 
	~<bs/rg.h
>

633 
	~<bs/rg2.h
>

636 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ftify_funi


638 
	~<bs/rg3.h
>

642 
__END_DECLS


	@/usr/include/termios.h

23 #idef 
_TERMIOS_H


24 
	#_TERMIOS_H
 1

	)

26 
	~<us.h
>

27 #i
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K8


29 
	~<bs/tys.h
>

30 #ide
__pid_t_defed


31 
__pid_t
 
	tpid_t
;

32 
	#__pid_t_defed


	)

36 
	g__BEGIN_DECLS


40 
	~<bs/rmios.h
>

42 #ifde
__USE_BSD


45 
	#CCEQ
(
v
, 
c
((c=(v&& (v!
_POSIX_VDISABLE
)

	)

49 
d_t
 
	$cfgod
 (cڡ 
rmios
 *
__rmios_p

__THROW
;

52 
d_t
 
	$cfgid
 (cڡ 
rmios
 *
__rmios_p

__THROW
;

55 
	$cftod
 (
rmios
 *
__rmios_p
, 
d_t
 
__d

__THROW
;

58 
	$cftid
 (
rmios
 *
__rmios_p
, 
d_t
 
__d

__THROW
;

60 #ifdef 
__USE_BSD


62 
	$cftd
 (
rmios
 *
__rmios_p
, 
d_t
 
__d

__THROW
;

67 
	$tcg
 (
__fd
, 
rmios
 *
__rmios_p

__THROW
;

71 
	$tcr
 (
__fd
, 
__tiڮ_ais
,

72 cڡ 
rmios
 *
__rmios_p

__THROW
;

75 #ifdef 
__USE_BSD


77 
	$cfmakaw
 (
rmios
 *
__rmios_p

__THROW
;

81 
	$tcndbak
 (
__fd
, 
__duti

__THROW
;

87 
	`tcd
 (
__fd
);

91 
	$tcush
 (
__fd
, 
__queue_

__THROW
;

95 
	$tcow
 (
__fd
, 
__ai

__THROW
;

98 #i
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K8


100 
__pid_t
 
	$tcgsid
 (
__fd

__THROW
;

104 #ifde
__USE_BSD


105 
	~<sys/ydeus.h
>

108 
__END_DECLS


	@/usr/include/time.h

22 #idef 
_TIME_H


24 #i(! 
defed
 
__ed_time_t
 && !defed 
__ed_ock_t
 && \

25 ! 
defed
 
	g__ed_timeec
)

26 
	#_TIME_H
 1

	)

27 
	~<us.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__ed_size_t


	)

36 
	#__ed_NULL


	)

37 
	~<ddef.h
>

41 
	~<bs/time.h
>

44 #i!
defed
 
__STRICT_ANSI__
 && !defed 
__USE_XOPEN2K


45 #ide
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #i!
defed
 
__ock_t_defed
 && (defed 
_TIME_H
 || defed 
__ed_ock_t
)

53 
	#__ock_t_defed
 1

	)

55 
	~<bs/tys.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__ock_t
 
	tock_t
;

60 
	g__END_NAMESPACE_STD


61 #i
defed
 
__USE_XOPEN
 || defed 
__USE_POSIX
 || defed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
ock_t
)

66 #unde
__ed_ock_t


68 #i!
defed
 
__time_t_defed
 && (defed 
_TIME_H
 || defed 
__ed_time_t
)

69 
	#__time_t_defed
 1

	)

71 
	~<bs/tys.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC
 || defed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #unde
__ed_time_t


84 #i!
defed
 
__ockid_t_defed
 && \

85 ((
defed
 
_TIME_H
 && defed 
__USE_POSIX199309
|| defed 
__ed_ockid_t
)

86 
	#__ockid_t_defed
 1

	)

88 
	~<bs/tys.h
>

91 
__ockid_t
 
	tockid_t
;

94 #unde
__ockid_time_t


96 #i!
defed
 
__tim_t_defed
 && \

97 ((
defed
 
_TIME_H
 && defed 
__USE_POSIX199309
|| defed 
__ed_tim_t
)

98 
	#__tim_t_defed
 1

	)

100 
	~<bs/tys.h
>

103 
__tim_t
 
	ttim_t
;

106 #unde
__ed_tim_t


109 #i(!
defed
 
__timeec_defed
 \

110 && ((
defed
 
_TIME_H
 \

111 && (
defed
 
__USE_POSIX199309
 || defed 
__USE_MISC
 \

112 || 
defed
 
__USE_ISOC11
)) \

113 || 
defed
 
__ed_timeec
))

114 
	#__timeec_defed
 1

	)

116 
	~<bs/tys.h
>

120 
	stimeec


122 
__time_t
 
tv_c
;

123 
__sys_g_t
 
tv_nc
;

127 #unde
__ed_timeec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_c
;

136 
tm_m
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m
;

140 
tm_yr
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cڡ *
tm_ze
;

149 
__tm_gmtoff
;

150 cڡ *
__tm_ze
;

153 
__END_NAMESPACE_STD


154 #i
defed
 
__USE_XOPEN
 || defed 
__USE_POSIX
 || defed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde
__USE_POSIX199309


161 
	simec


163 
timeec
 
_rv
;

164 
timeec
 
_vue
;

168 
sigevt
;

172 #ifde
__USE_XOPEN2K


173 #ide
__pid_t_defed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defed


	)

180 #ifde
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
ock_t
 
	$ock
 (
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim

__THROW
;

195 
	$difime
 (
time_t
 
__time1
,ime_
__time0
)

196 
__THROW
 
	`__ibu__
 ((
__cڡ__
));

199 
time_t
 
	$mktime
 (
tm
 *
__

__THROW
;

205 
size_t
 
	$rime
 (*
__ri
 
__s
, 
size_t
 
__maxsize
,

206 cڡ *
__ri
 
__fm
,

207 cڡ 
tm
 *
__ri
 
__

__THROW
;

208 
__END_NAMESPACE_STD


210 #ifde
__USE_XOPEN


213 *
	$time
 (cڡ *
__ri
 
__s
,

214 cڡ *
__ri
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifde
__USE_XOPEN2K8


221 
	~<xlo.h
>

223 
size_t
 
	$rime_l
 (*
__ri
 
__s
, 
size_t
 
__maxsize
,

224 cڡ *
__ri
 
__fm
,

225 cڡ 
tm
 *
__ri
 
__
,

226 
__lo_t
 
__loc

__THROW
;

229 #ifde
__USE_GNU


230 *
	$time_l
 (cڡ *
__ri
 
__s
,

231 cڡ *
__ri
 
__fmt
, 
tm
 *
__
,

232 
__lo_t
 
__loc

__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cڡ 
time_t
 *
__tim

__THROW
;

243 
tm
 *
	$loime
 (cڡ 
time_t
 *
__tim

__THROW
;

244 
__END_NAMESPACE_STD


246 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cڡ 
time_t
 *
__ri
 
__tim
,

250 
tm
 *
__ri
 
__

__THROW
;

254 
tm
 *
	$loime_r
 (cڡ 
time_t
 *
__ri
 
__tim
,

255 
tm
 *
__ri
 
__

__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asime
 (cڡ 
tm
 *
__

__THROW
;

264 *
	$ime
 (cڡ 
time_t
 *
__tim

__THROW
;

265 
__END_NAMESPACE_STD


267 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


272 *
	$asime_r
 (cڡ 
tm
 *
__ri
 
__
,

273 *
__ri
 
__buf

__THROW
;

276 *
	$ime_r
 (cڡ 
time_t
 *
__ri
 
__tim
,

277 *
__ri
 
__buf

__THROW
;

282 *
__tzme
[2];

283 
__daylight
;

284 
__timeze
;

287 #ifdef 
__USE_POSIX


289 *
tzme
[2];

293 
	$tzt
 (
__THROW
;

296 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


297 
daylight
;

298 
timeze
;

301 #ifde
__USE_SVID


304 
	$ime
 (cڡ 
time_t
 *
__wh

__THROW
;

310 
	#__ip
(
yr
) \

311 ((
yr
% 4 =0 && ((yr% 100 !0 || (yr% 400 =0))

	)

314 #ifde
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__

__THROW
;

322 
time_t
 
	$timol
 (
tm
 *
__

__THROW
;

325 
	$dysize
 (
__yr

__THROW
 
	`__ibu__
 ((
__cڡ__
));

329 #ifde
__USE_POSIX199309


334 
	`nop
 (cڡ 
timeec
 *
__queed_time
,

335 
timeec
 *
__mag
);

339 
	$ock_gs
 (
ockid_t
 
__ock_id
, 
timeec
 *
__s

__THROW
;

342 
	$ock_gtime
 (
ockid_t
 
__ock_id
, 
timeec
 *
__

__THROW
;

345 
	$ock_ime
 (
ockid_t
 
__ock_id
, cڡ 
timeec
 *
__
)

346 
__THROW
;

348 #ifde
__USE_XOPEN2K


353 
	`ock_nop
 (
ockid_t
 
__ock_id
, 
__ags
,

354 cڡ 
timeec
 *
__q
,

355 
timeec
 *
__m
);

358 
	$ock_guockid
 (
pid_t
 
__pid
, 
ockid_t
 *
__ock_id

__THROW
;

363 
	$tim_
 (
ockid_t
 
__ock_id
,

364 
sigevt
 *
__ri
 
__evp
,

365 
tim_t
 *
__ri
 
__timid

__THROW
;

368 
	$tim_de
 (
tim_t
 
__timid

__THROW
;

371 
	$tim_ime
 (
tim_t
 
__timid
, 
__ags
,

372 cڡ 
imec
 *
__ri
 
__vue
,

373 
imec
 *
__ri
 
__ovue

__THROW
;

376 
	$tim_gtime
 (
tim_t
 
__timid
, 
imec
 *
__vue
)

377 
__THROW
;

380 
	$tim_govrun
 (
tim_t
 
__timid

__THROW
;

384 #ifde
__USE_ISOC11


386 
	$timeec_g
 (
timeec
 *
__ts
, 
__ba
)

387 
__THROW
 
	`__nnu
 ((1));

391 #ifde
__USE_XOPEN_EXTENDED


403 
gde_r
;

412 
tm
 *
	`gde
 (cڡ *
__rg
);

415 #ifde
__USE_GNU


426 
	`gde_r
 (cڡ *
__ri
 
__rg
,

427 
tm
 *
__ri
 
__sbu
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #idef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<us.h
>

27 
	g__BEGIN_DECLS


32 #ifde
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #i
defed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #i
defed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #i
defed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #i
defed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #i
defed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

71 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

75 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

79 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

83 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

86 #ifde
__USE_XOPEN2K8


87 
	#_XOPEN_VERSION
 700

	)

88 #i
defed
 
__USE_XOPEN2K


89 
	#_XOPEN_VERSION
 600

	)

90 #i
defed
 
__USE_UNIX98


91 
	#_XOPEN_VERSION
 500

	)

93 
	#_XOPEN_VERSION
 4

	)

97 
	#_XOPEN_XCU_VERSION
 4

	)

100 
	#_XOPEN_XPG2
 1

	)

101 
	#_XOPEN_XPG3
 1

	)

102 
	#_XOPEN_XPG4
 1

	)

105 
	#_XOPEN_UNIX
 1

	)

108 
	#_XOPEN_CRYPT
 1

	)

112 
	#_XOPEN_ENH_I18N
 1

	)

115 
	#_XOPEN_LEGACY
 1

	)

202 
	~<bs/posix_t.h
>

205 #i
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K


206 
	~<bs/vmts.h
>

210 
	#STDIN_FILENO
 0

	)

211 
	#STDOUT_FILENO
 1

	)

212 
	#STDERR_FILENO
 2

	)

217 
	~<bs/tys.h
>

219 #idef 
__ssize_t_defed


220 
__ssize_t
 
	tssize_t
;

221 
	#__ssize_t_defed


	)

224 
	#__ed_size_t


	)

225 
	#__ed_NULL


	)

226 
	~<ddef.h
>

228 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K


231 #ide
__gid_t_defed


232 
__gid_t
 
	tgid_t
;

233 
	#__gid_t_defed


	)

236 #ide
__uid_t_defed


237 
__uid_t
 
	tuid_t
;

238 
	#__uid_t_defed


	)

241 #ide
__off_t_defed


242 #ide
__USE_FILE_OFFSET64


243 
__off_t
 
	toff_t
;

245 
__off64_t
 
	toff_t
;

247 
	#__off_t_defed


	)

249 #i
defed
 
__USE_LARGEFILE64
 && !defed 
__off64_t_defed


250 
__off64_t
 
	toff64_t
;

251 
	#__off64_t_defed


	)

254 #ide
__ucds_t_defed


255 
__ucds_t
 
	tucds_t
;

256 
	#__ucds_t_defed


	)

259 #ide
__pid_t_defed


260 
__pid_t
 
	tpid_t
;

261 
	#__pid_t_defed


	)

265 #i
defed
 
__USE_MISC
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K


266 #ide
___t_defed


267 
___t
 
	t_t
;

268 
	#___t_defed


	)

272 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN


273 #ide
__sockn_t_defed


274 
__sockn_t
 
	tsockn_t
;

275 
	#__sockn_t_defed


	)

281 
	#R_OK
 4

	)

282 
	#W_OK
 2

	)

283 
	#X_OK
 1

	)

284 
	#F_OK
 0

	)

287 
	$acss
 (cڡ *
__me
, 
__ty

__THROW
 
	`__nnu
 ((1));

289 #ifde
__USE_GNU


292 
	$euidacss
 (cڡ *
__me
, 
__ty
)

293 
__THROW
 
	`__nnu
 ((1));

296 
	$css
 (cڡ *
__me
, 
__ty
)

297 
__THROW
 
	`__nnu
 ((1));

300 #ifde
__USE_ATFILE


304 
	$cst
 (
__fd
, cڡ *
__fe
, 
__ty
, 
__ag
)

305 
__THROW
 
	`__nnu
 ((2)
__wur
;

310 #idef 
_STDIO_H


311 
	#SEEK_SET
 0

	)

312 
	#SEEK_CUR
 1

	)

313 
	#SEEK_END
 2

	)

314 #ifde
__USE_GNU


315 
	#SEEK_DATA
 3

	)

316 
	#SEEK_HOLE
 4

	)

320 #i
defed
 
__USE_BSD
 && !defed 
L_SET


322 
	#L_SET
 
SEEK_SET


	)

323 
	#L_INCR
 
SEEK_CUR


	)

324 
	#L_XTND
 
SEEK_END


	)

333 #ide
__USE_FILE_OFFSET64


334 
__off_t
 
	$lek
 (
__fd
, 
__off_t
 
__offt
, 
__wh

__THROW
;

336 #ifde
__REDIRECT_NTH


337 
__off64_t
 
	`__REDIRECT_NTH
 (
lek
,

338 (
__fd
, 
__off64_t
 
__offt
, 
__wh
),

339 
lek64
);

341 
	#lek
 
lek64


	)

344 #ifde
__USE_LARGEFILE64


345 
__off64_t
 
	$lek64
 (
__fd
, 
__off64_t
 
__offt
, 
__wh
)

346 
__THROW
;

353 
	`o
 (
__fd
);

360 
ssize_t
 
	$ad
 (
__fd
, *
__buf
, 
size_t
 
__nbys

__wur
;

366 
ssize_t
 
	$wre
 (
__fd
, cڡ *
__buf
, 
size_t
 
__n

__wur
;

368 #i
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K8


369 #ide
__USE_FILE_OFFSET64


376 
ssize_t
 
	$d
 (
__fd
, *
__buf
, 
size_t
 
__nbys
,

377 
__off_t
 
__offt

__wur
;

384 
ssize_t
 
	$pwre
 (
__fd
, cڡ *
__buf
, 
size_t
 
__n
,

385 
__off_t
 
__offt

__wur
;

387 #ifde
__REDIRECT


388 
ssize_t
 
	`__REDIRECT
 (
d
, (
__fd
, *
__buf
, 
size_t
 
__nbys
,

389 
__off64_t
 
__offt
),

390 
d64

__wur
;

391 
ssize_t
 
	`__REDIRECT
 (
pwre
, (
__fd
, cڡ *
__buf
,

392 
size_t
 
__nbys
, 
__off64_t
 
__offt
),

393 
pwre64

__wur
;

395 
	#d
 
d64


	)

396 
	#pwre
 
pwre64


	)

400 #ifde
__USE_LARGEFILE64


404 
ssize_t
 
	$d64
 (
__fd
, *
__buf
, 
size_t
 
__nbys
,

405 
__off64_t
 
__offt

__wur
;

408 
ssize_t
 
	$pwre64
 (
__fd
, cڡ *
__buf
, 
size_t
 
__n
,

409 
__off64_t
 
__offt

__wur
;

417 
	$pe
 (
__pedes
[2]
__THROW
 
__wur
;

419 #ifde
__USE_GNU


422 
	$pe2
 (
__pedes
[2], 
__ags

__THROW
 
__wur
;

432 
	$m
 (
__cds

__THROW
;

444 
	`p
 (
__cds
);

446 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K8
) \

447 || 
defed
 
__USE_BSD


452 
__ucds_t
 
	$um
 (
__ucds_t
 
__vue
, __ucds_
__rv
)

453 
__THROW
;

460 
	`up
 (
__ucds_t
 
__ucds
);

469 
	`u
 ();

473 
	$chown
 (cڡ *
__fe
, 
__uid_t
 
__owr
, 
__gid_t
 
__group
)

474 
__THROW
 
	`__nnu
 ((1)
__wur
;

476 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


478 
	$fchown
 (
__fd
, 
__uid_t
 
__owr
, 
__gid_t
 
__group

__THROW
 
__wur
;

483 
	$lchown
 (cڡ *
__fe
, 
__uid_t
 
__owr
, 
__gid_t
 
__group
)

484 
__THROW
 
	`__nnu
 ((1)
__wur
;

488 #ifde
__USE_ATFILE


491 
	$fchowt
 (
__fd
, cڡ *
__fe
, 
__uid_t
 
__owr
,

492 
__gid_t
 
__group
, 
__ag
)

493 
__THROW
 
	`__nnu
 ((2)
__wur
;

497 
	$chd
 (cڡ *
__th

__THROW
 
	`__nnu
 ((1)
__wur
;

499 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


501 
	$fchd
 (
__fd

__THROW
 
__wur
;

511 *
	$gcwd
 (*
__buf
, 
size_t
 
__size

__THROW
 
__wur
;

513 #ifdef 
__USE_GNU


517 *
	$g_cut_d_me
 (
__THROW
;

520 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K8
) \

521 || 
defed
 
__USE_BSD


525 *
	$gwd
 (*
__buf
)

526 
__THROW
 
	`__nnu
 ((1)
__ibu_dd__
 
__wur
;

531 
	$dup
 (
__fd

__THROW
 
__wur
;

534 
	$dup2
 (
__fd
, 
__fd2

__THROW
;

536 #ifde
__USE_GNU


539 
	$dup3
 (
__fd
, 
__fd2
, 
__ags

__THROW
;

543 **
__v
;

544 #ifde
__USE_GNU


545 **
v
;

551 
	$execve
 (cڡ *
__th
, *cڡ 
__gv
[],

552 *cڡ 
__vp
[]
__THROW
 
	`__nnu
 ((1, 2));

554 #ifde
__USE_XOPEN2K8


557 
	$xecve
 (
__fd
, *cڡ 
__gv
[], *cڡ 
__vp
[])

558 
__THROW
 
	`__nnu
 ((2));

563 
	$execv
 (cڡ *
__th
, *cڡ 
__gv
[])

564 
__THROW
 
	`__nnu
 ((1, 2));

568 
	$exee
 (cڡ *
__th
, cڡ *
__g
, ...)

569 
__THROW
 
	`__nnu
 ((1, 2));

573 
	$exe
 (cڡ *
__th
, cڡ *
__g
, ...)

574 
__THROW
 
	`__nnu
 ((1, 2));

578 
	$execvp
 (cڡ *
__fe
, *cڡ 
__gv
[])

579 
__THROW
 
	`__nnu
 ((1, 2));

584 
	$exep
 (cڡ *
__fe
, cڡ *
__g
, ...)

585 
__THROW
 
	`__nnu
 ((1, 2));

587 #ifde
__USE_GNU


590 
	$execv
 (cڡ *
__fe
, *cڡ 
__gv
[],

591 *cڡ 
__vp
[])

592 
__THROW
 
	`__nnu
 ((1, 2));

596 #i
defed
 
__USE_MISC
 || defed 
__USE_XOPEN


598 
	$ni
 (
__c

__THROW
 
__wur
;

603 
	$_ex
 (
__us

	`__ibu__
 ((
__nܑu__
));

609 
	~<bs/came.h
>

612 
	$thcf
 (cڡ *
__th
, 
__me
)

613 
__THROW
 
	`__nnu
 ((1));

616 
	$hcf
 (
__fd
, 
__me

__THROW
;

619 
	$syscf
 (
__me

__THROW
;

621 #ifdef 
__USE_POSIX2


623 
size_t
 
	$cfr
 (
__me
, *
__buf
, 
size_t
 
__n

__THROW
;

628 
__pid_t
 
	$gpid
 (
__THROW
;

631 
__pid_t
 
	$gid
 (
__THROW
;

635 #ide
__FAVOR_BSD


636 
__pid_t
 
	$gpg
 (
__THROW
;

638 #ifde
__REDIRECT_NTH


639 
__pid_t
 
	`__REDIRECT_NTH
 (
gpg
, (__pid_
__pid
), 
__gpgid
);

641 
	#gpg
 
__gpgid


	)

646 
__pid_t
 
	$__gpgid
 (
__pid_t
 
__pid

__THROW
;

647 #i
defed
 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


648 
__pid_t
 
	$gpgid
 (
__pid_t
 
__pid

__THROW
;

655 
	$gid
 (
__pid_t
 
__pid
, __pid_
__pgid

__THROW
;

657 #i
defed
 
__USE_SVID
 || defed 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


668 #ide
__FAVOR_BSD


672 
	$g
 (
__THROW
;

677 #ifde
__REDIRECT_NTH


678 
	`__REDIRECT_NTH
 (
g
, (
__pid_t
 
__pid
, __pid_
__pg
), 
gid
);

680 
	#g
 
gid


	)

689 
__pid_t
 
	$tsid
 (
__THROW
;

691 #i
defed
 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


693 
__pid_t
 
	$gsid
 (
__pid_t
 
__pid

__THROW
;

697 
__uid_t
 
	$guid
 (
__THROW
;

700 
__uid_t
 
	$geuid
 (
__THROW
;

703 
__gid_t
 
	$ggid
 (
__THROW
;

706 
__gid_t
 
	$gegid
 (
__THROW
;

711 
	$ggroups
 (
__size
, 
__gid_t
 
__li
[]
__THROW
 
__wur
;

713 #ifdef 
__USE_GNU


715 
	$group_memb
 (
__gid_t
 
__gid

__THROW
;

722 
	$tuid
 (
__uid_t
 
__uid

__THROW
 
__wur
;

724 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


727 
	$euid
 (
__uid_t
 
__ruid
, __uid_
__euid

__THROW
 
__wur
;

730 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN2K


732 
	$uid
 (
__uid_t
 
__uid

__THROW
 
__wur
;

739 
	$tgid
 (
__gid_t
 
__gid

__THROW
 
__wur
;

741 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


744 
	$egid
 (
__gid_t
 
__rgid
, __gid_
__egid

__THROW
 
__wur
;

747 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN2K


749 
	$gid
 (
__gid_t
 
__gid

__THROW
 
__wur
;

752 #ifde
__USE_GNU


755 
	$gsuid
 (
__uid_t
 *
__ruid
, __uid_*
__euid
, __uid_*
__suid
)

756 
__THROW
;

760 
	$gsgid
 (
__gid_t
 *
__rgid
, __gid_*
__egid
, __gid_*
__sgid
)

761 
__THROW
;

765 
	$esuid
 (
__uid_t
 
__ruid
, __uid_
__euid
, __uid_
__suid
)

766 
__THROW
 
__wur
;

770 
	$esgid
 (
__gid_t
 
__rgid
, __gid_
__egid
, __gid_
__sgid
)

771 
__THROW
 
__wur
;

778 
__pid_t
 
	$fk
 (
__THROWNL
;

780 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K8
) \

781 || 
defed
 
__USE_BSD


786 
__pid_t
 
	$vfk
 (
__THROW
;

792 *
	$yme
 (
__fd

__THROW
;

796 
	$yme_r
 (
__fd
, *
__buf
, 
size_t
 
__bu
)

797 
__THROW
 
	`__nnu
 ((2)
__wur
;

801 
	$iy
 (
__fd

__THROW
;

803 #i
defed
 
__USE_BSD
 \

804 || (
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_UNIX98
)

807 
	$y
 (
__THROW
;

812 
	$lk
 (cڡ *
__om
, cڡ *
__to
)

813 
__THROW
 
	`__nnu
 ((1, 2)
__wur
;

815 #ifde
__USE_ATFILE


818 
	$lk
 (
__omfd
, cڡ *
__om
, 
__tofd
,

819 cڡ *
__to
, 
__ags
)

820 
__THROW
 
	`__nnu
 ((2, 4)
__wur
;

823 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K


825 
	$symlk
 (cڡ *
__om
, cڡ *
__to
)

826 
__THROW
 
	`__nnu
 ((1, 2)
__wur
;

831 
ssize_t
 
	$adlk
 (cڡ *
__ri
 
__th
,

832 *
__ri
 
__buf
, 
size_t
 
__n
)

833 
__THROW
 
	`__nnu
 ((1, 2)
__wur
;

836 #ifde
__USE_ATFILE


838 
	$symlk
 (cڡ *
__om
, 
__tofd
,

839 cڡ *
__to

__THROW
 
	`__nnu
 ((1, 3)
__wur
;

842 
ssize_t
 
	$adlk
 (
__fd
, cڡ *
__ri
 
__th
,

843 *
__ri
 
__buf
, 
size_t
 
__n
)

844 
__THROW
 
	`__nnu
 ((2, 3)
__wur
;

848 
	$uƚk
 (cڡ *
__me

__THROW
 
	`__nnu
 ((1));

850 #ifde
__USE_ATFILE


852 
	$uƚk
 (
__fd
, cڡ *
__me
, 
__ag
)

853 
__THROW
 
	`__nnu
 ((2));

857 
	$rmd
 (cڡ *
__th

__THROW
 
	`__nnu
 ((1));

861 
__pid_t
 
	$tcgpg
 (
__fd

__THROW
;

864 
	$tcg
 (
__fd
, 
__pid_t
 
__pg_id

__THROW
;

871 *
	`glog
 ();

872 #i
defed
 
__USE_REENTRANT
 || defed 
__USE_POSIX199506


879 
	$glog_r
 (*
__me
, 
size_t
 
__me_n

	`__nnu
 ((1));

882 #ifdef 
__USE_BSD


884 
	$og
 (cڡ *
__me

__THROW
 
	`__nnu
 ((1));

888 #ifdef 
__USE_POSIX2


892 
	#__ed_gt


	)

893 
	~<gt.h
>

897 #i
defed
 
__USE_BSD
 || defed 
__USE_UNIX98
 || defed 
__USE_XOPEN2K


901 
	$ghome
 (*
__me
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

905 #i
defed
 
__USE_BSD
 || (defed 
__USE_XOPEN
 && !defed 
__USE_UNIX98
)

908 
	$thome
 (cڡ *
__me
, 
size_t
 
__n
)

909 
__THROW
 
	`__nnu
 ((1)
__wur
;

913 
	$thoid
 (
__id

__THROW
 
__wur
;

919 
	$gdomame
 (*
__me
, 
size_t
 
__n
)

920 
__THROW
 
	`__nnu
 ((1)
__wur
;

921 
	$tdomame
 (cڡ *
__me
, 
size_t
 
__n
)

922 
__THROW
 
	`__nnu
 ((1)
__wur
;

928 
	$vhgup
 (
__THROW
;

931 
	$voke
 (cڡ *
__fe

__THROW
 
	`__nnu
 ((1)
__wur
;

939 
	$of
 (*
__me_bufr
, 
size_t
 
__size
,

940 
size_t
 
__offt
, 
__s
)

941 
__THROW
 
	`__nnu
 ((1));

947 
	$ac
 (cڡ *
__me

__THROW
;

951 *
	$gurshl
 (
__THROW
;

952 
	$durshl
 (
__THROW
;

953 
	$turshl
 (
__THROW
;

959 
	$dm
 (
__nochd
, 
__noo

__THROW
 
__wur
;

963 #i
defed
 
__USE_BSD
 || (defed 
__USE_XOPEN
 && !defed 
__USE_XOPEN2K
)

966 
	$chro
 (cڡ *
__th

__THROW
 
	`__nnu
 ((1)
__wur
;

970 *
	$gss
 (cڡ *
__om

	`__nnu
 ((1));

978 
	`fsync
 (
__fd
);

981 #ifde
__USE_GNU


984 
	$syncfs
 (
__fd

__THROW
;

988 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


991 
	`ghoid
 ();

994 
	$sync
 (
__THROW
;

997 #i
defed
 
__USE_BSD
 || !defed 
__USE_XOPEN2K


1000 
	$ggesize
 (
__THROW
 
	`__ibu__
 ((
__cڡ__
));

1005 
	$gdbsize
 (
__THROW
;

1011 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


1014 #ide
__USE_FILE_OFFSET64


1015 
	$un
 (cڡ *
__fe
, 
__off_t
 
__ngth
)

1016 
__THROW
 
	`__nnu
 ((1)
__wur
;

1018 #ifde
__REDIRECT_NTH


1019 
	`__REDIRECT_NTH
 (
un
,

1020 (cڡ *
__fe
, 
__off64_t
 
__ngth
),

1021 
un64

	`__nnu
 ((1)
__wur
;

1023 
	#un
 
un64


	)

1026 #ifde
__USE_LARGEFILE64


1027 
	$un64
 (cڡ *
__fe
, 
__off64_t
 
__ngth
)

1028 
__THROW
 
	`__nnu
 ((1)
__wur
;

1033 #i
defed
 
__USE_BSD
 || defed 
__USE_POSIX199309
 \

1034 || 
defed
 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K


1037 #ide
__USE_FILE_OFFSET64


1038 
	$run
 (
__fd
, 
__off_t
 
__ngth

__THROW
 
__wur
;

1040 #ifde
__REDIRECT_NTH


1041 
	`__REDIRECT_NTH
 (
run
, (
__fd
, 
__off64_t
 
__ngth
),

1042 
run64

__wur
;

1044 
	#run
 
run64


	)

1047 #ifde
__USE_LARGEFILE64


1048 
	$run64
 (
__fd
, 
__off64_t
 
__ngth

__THROW
 
__wur
;

1054 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K
) \

1055 || 
defed
 
__USE_MISC


1059 
	$brk
 (*
__addr

__THROW
 
__wur
;

1065 *
	$sbrk
 (
_t
 
__d

__THROW
;

1069 #ifde
__USE_MISC


1080 
	$sys
 (
__syo
, ...
__THROW
;

1085 #i(
defed
 
__USE_MISC
 || defed 
__USE_XOPEN_EXTENDED
&& !defed 
F_LOCK


1097 
	#F_ULOCK
 0

	)

1098 
	#F_LOCK
 1

	)

1099 
	#F_TLOCK
 2

	)

1100 
	#F_TEST
 3

	)

1102 #ide
__USE_FILE_OFFSET64


1103 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__n

__wur
;

1105 #ifde
__REDIRECT


1106 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__n
),

1107 
lockf64

__wur
;

1109 
	#lockf
 
lockf64


	)

1112 #ifde
__USE_LARGEFILE64


1113 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__n

__wur
;

1118 #ifde
__USE_GNU


1123 
	#TEMP_FAILURE_RETRY
(
exessi
) \

1124 (
__exnsi__
 \

1125 ({ 
__su
; \

1126 d
__su
 = ((
exessi
); \

1127 
__su
 =-1L && 
o
 =
EINTR
); \

1128 
__su
; 
	}
}))

	)

1131 #i
defed
 
__USE_POSIX199309
 || defed 
__USE_UNIX98


1134 
fdasync
 (
__fdes
);

1140 #ifdef 
__USE_XOPEN


1142 *
	$y
 (cڡ *
__key
, cڡ *
__
)

1143 
__THROW
 
	`__nnu
 ((1, 2));

1147 
	$y
 (*
__block
, 
__edag

__THROW
 
	`__nnu
 ((1));

1154 
	$swab
 (cڡ *
__ri
 
__om
, *__ri 
__to
,

1155 
ssize_t
 
__n

__THROW
 
	`__nnu
 ((1, 2));

1161 #i
defed
 
__USE_XOPEN
 && !defed 
__USE_XOPEN2K


1163 *
	$mid
 (*
__s

__THROW
;

1168 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ftify_funi


1169 
	~<bs/unid.h
>

1172 
__END_DECLS


	@/usr/include/utime.h

22 #idef 
_UTIME_H


23 
	#_UTIME_H
 1

	)

25 
	~<us.h
>

27 
	g__BEGIN_DECLS


29 
	~<bs/tys.h
>

31 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K


32 
	#__ed_time_t


	)

33 
	~<time.h
>

37 
	sutimbuf


39 
__time_t
 
	maime
;

40 
__time_t
 
	mmodtime
;

45 
	$utime
 (cڡ *
__fe
,

46 cڡ 
utimbuf
 *
__fe_times
)

47 
__THROW
 
	`__nnu
 ((1));

49 
__END_DECLS


	@/usr/include/alloca.h

18 #idef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<us.h
>

23 
	#__ed_size_t


	)

24 
	~<ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde
lo


32 *
	$lo
 (
size_t
 
__size

__THROW
;

34 #ifdef 
__GNUC__


35 
	#lo
(
size

	`__but_lo
 (size)

	)

38 
__END_DECLS


	@/usr/include/endian.h

18 #idef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<us.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bs/dn.h
>

40 #ide
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
LO, 
	)
HI

53 #i
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
HI, 
	)
LO

58 #i
defed
 
__USE_BSD
 && !defed 
__ASSEMBLER__


60 
	~<bs/bysw.h
>

62 #i
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x

	`__bsw_16
 (x)

	)

64 
	#hte16
(
x
(x)

	)

65 
	#be16toh
(
x

	`__bsw_16
 (x)

	)

66 
	#16toh
(
x
(x)

	)

68 
	#htobe32
(
x

	`__bsw_32
 (x)

	)

69 
	#hte32
(
x
(x)

	)

70 
	#be32toh
(
x

	`__bsw_32
 (x)

	)

71 
	#32toh
(
x
(x)

	)

73 #i
__GLIBC_HAVE_LONG_LONG


74 
	#htobe64
(
x

	`__bsw_64
 (x)

	)

75 
	#hte64
(
x
(x)

	)

76 
	#be64toh
(
x

	`__bsw_64
 (x)

	)

77 
	#64toh
(
x
(x)

	)

81 
	#htobe16
(
x
(x)

	)

82 
	#hte16
(
x

	`__bsw_16
 (x)

	)

83 
	#be16toh
(
x
(x)

	)

84 
	#16toh
(
x

	`__bsw_16
 (x)

	)

86 
	#htobe32
(
x
(x)

	)

87 
	#hte32
(
x

	`__bsw_32
 (x)

	)

88 
	#be32toh
(
x
(x)

	)

89 
	#32toh
(
x

	`__bsw_32
 (x)

	)

91 #i
__GLIBC_HAVE_LONG_LONG


92 
	#htobe64
(
x
(x)

	)

93 
	#hte64
(
x

	`__bsw_64
 (x)

	)

94 
	#be64toh
(
x
(x)

	)

95 
	#64toh
(
x

	`__bsw_64
 (x)

	)

	@/usr/include/features.h

18 #idef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

98 #unde
__USE_ISOC11


99 #unde
__USE_ISOC99


100 #unde
__USE_ISOC95


101 #unde
__USE_ISOCXX11


102 #unde
__USE_POSIX


103 #unde
__USE_POSIX2


104 #unde
__USE_POSIX199309


105 #unde
__USE_POSIX199506


106 #unde
__USE_XOPEN


107 #unde
__USE_XOPEN_EXTENDED


108 #unde
__USE_UNIX98


109 #unde
__USE_XOPEN2K


110 #unde
__USE_XOPEN2KXSI


111 #unde
__USE_XOPEN2K8


112 #unde
__USE_XOPEN2K8XSI


113 #unde
__USE_LARGEFILE


114 #unde
__USE_LARGEFILE64


115 #unde
__USE_FILE_OFFSET64


116 #unde
__USE_BSD


117 #unde
__USE_SVID


118 #unde
__USE_MISC


119 #unde
__USE_ATFILE


120 #unde
__USE_GNU


121 #unde
__USE_REENTRANT


122 #unde
__USE_FORTIFY_LEVEL


123 #unde
__FAVOR_BSD


124 #unde
__KERNEL_STRICT_NAMES


128 #ide
_LOOSE_KERNEL_NAMES


129 
	#__KERNEL_STRICT_NAMES


	)

133 
	#__USE_ANSI
 1

	)

142 #i
defed
 
__GNUC__
 && defed 
__GNUC_MINOR__


143 
	#__GNUC_PREREQ
(
maj
, 
m
) \

144 ((
__GNUC__
 << 16+ 
__GNUC_MINOR__
 >((
maj
<< 16+ (
m
))

	)

146 
	#__GNUC_PREREQ
(
maj
, 
m
0

	)

151 #i
defed
 
_BSD_SOURCE
 && \

152 !(
defed
 
	g_POSIX_SOURCE
 || defed 
	g_POSIX_C_SOURCE
 || \

153 
defed
 
	g_XOPEN_SOURCE
 || defed 
	g_GNU_SOURCE
 || defed 
	g_SVID_SOURCE
)

154 
	#__FAVOR_BSD
 1

	)

158 #ifde
_GNU_SOURCE


159 #unde
_ISOC95_SOURCE


160 
	#_ISOC95_SOURCE
 1

	)

161 #unde
_ISOC99_SOURCE


162 
	#_ISOC99_SOURCE
 1

	)

163 #unde
_ISOC11_SOURCE


164 
	#_ISOC11_SOURCE
 1

	)

165 #unde
_POSIX_SOURCE


166 
	#_POSIX_SOURCE
 1

	)

167 #unde
_POSIX_C_SOURCE


168 
	#_POSIX_C_SOURCE
 200809L

	)

169 #unde
_XOPEN_SOURCE


170 
	#_XOPEN_SOURCE
 700

	)

171 #unde
_XOPEN_SOURCE_EXTENDED


172 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

173 #unde
_LARGEFILE64_SOURCE


174 
	#_LARGEFILE64_SOURCE
 1

	)

175 #unde
_BSD_SOURCE


176 
	#_BSD_SOURCE
 1

	)

177 #unde
_SVID_SOURCE


178 
	#_SVID_SOURCE
 1

	)

179 #unde
_ATFILE_SOURCE


180 
	#_ATFILE_SOURCE
 1

	)

185 #i(!
defed
 
__STRICT_ANSI__
 && !defed 
_ISOC99_SOURCE
 && \

186 !
defed
 
	g_POSIX_SOURCE
 && !defed 
	g_POSIX_C_SOURCE
 && \

187 !
defed
 
	g_XOPEN_SOURCE
 && !defed 
	g_BSD_SOURCE
 && !defed 
	g_SVID_SOURCE
)

188 
	#_BSD_SOURCE
 1

	)

189 
	#_SVID_SOURCE
 1

	)

193 #i(
defed
 
_ISOC11_SOURCE
 \

194 || (
defed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

195 
	#__USE_ISOC11
 1

	)

199 #i(
defed
 
_ISOC99_SOURCE
 || defed 
_ISOC11_SOURCE
 \

200 || (
defed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

201 
	#__USE_ISOC99
 1

	)

205 #i(
defed
 
_ISOC99_SOURCE
 || defed 
_ISOC11_SOURCE
 \

206 || (
defed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

207 
	#__USE_ISOC95
 1

	)

214 #i((
defed
 
__lulus
 && __cplusplus >= 201103L) \

215 || 
defed
 
__GXX_EXPERIMENTAL_CXX0X__
)

216 
	#__USE_ISOCXX11
 1

	)

221 #i((!
defed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

222 !
defed
 
_POSIX_SOURCE
 && !defed 
_POSIX_C_SOURCE
)

223 
	#_POSIX_SOURCE
 1

	)

224 #i
defed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

225 
	#_POSIX_C_SOURCE
 2

	)

226 #i
defed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

227 
	#_POSIX_C_SOURCE
 199506L

	)

228 #i
defed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

229 
	#_POSIX_C_SOURCE
 200112L

	)

231 
	#_POSIX_C_SOURCE
 200809L

	)

233 
	#__USE_POSIX_IMPLICITLY
 1

	)

236 #i
defed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || defed 
_XOPEN_SOURCE


237 
	#__USE_POSIX
 1

	)

240 #i
defed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || defed 
_XOPEN_SOURCE


241 
	#__USE_POSIX2
 1

	)

244 #i(
_POSIX_C_SOURCE
 - 0) >= 199309L

245 
	#__USE_POSIX199309
 1

	)

248 #i(
_POSIX_C_SOURCE
 - 0) >= 199506L

249 
	#__USE_POSIX199506
 1

	)

252 #i(
_POSIX_C_SOURCE
 - 0) >= 200112L

253 
	#__USE_XOPEN2K
 1

	)

254 #unde
__USE_ISOC95


255 
	#__USE_ISOC95
 1

	)

256 #unde
__USE_ISOC99


257 
	#__USE_ISOC99
 1

	)

260 #i(
_POSIX_C_SOURCE
 - 0) >= 200809L

261 
	#__USE_XOPEN2K8
 1

	)

262 #unde
_ATFILE_SOURCE


263 
	#_ATFILE_SOURCE
 1

	)

266 #ifdef 
_XOPEN_SOURCE


267 
	#__USE_XOPEN
 1

	)

268 #i(
_XOPEN_SOURCE
 - 0) >= 500

269 
	#__USE_XOPEN_EXTENDED
 1

	)

270 
	#__USE_UNIX98
 1

	)

271 #unde
_LARGEFILE_SOURCE


272 
	#_LARGEFILE_SOURCE
 1

	)

273 #i(
_XOPEN_SOURCE
 - 0) >= 600

274 #i(
_XOPEN_SOURCE
 - 0) >= 700

275 
	#__USE_XOPEN2K8
 1

	)

276 
	#__USE_XOPEN2K8XSI
 1

	)

278 
	#__USE_XOPEN2K
 1

	)

279 
	#__USE_XOPEN2KXSI
 1

	)

280 #unde
__USE_ISOC95


281 
	#__USE_ISOC95
 1

	)

282 #unde
__USE_ISOC99


283 
	#__USE_ISOC99
 1

	)

286 #ifde
_XOPEN_SOURCE_EXTENDED


287 
	#__USE_XOPEN_EXTENDED
 1

	)

292 #ifde
_LARGEFILE_SOURCE


293 
	#__USE_LARGEFILE
 1

	)

296 #ifde
_LARGEFILE64_SOURCE


297 
	#__USE_LARGEFILE64
 1

	)

300 #i
defed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

301 
	#__USE_FILE_OFFSET64
 1

	)

304 #i
defed
 
_BSD_SOURCE
 || defed 
_SVID_SOURCE


305 
	#__USE_MISC
 1

	)

308 #ifdef 
_BSD_SOURCE


309 
	#__USE_BSD
 1

	)

312 #ifdef 
_SVID_SOURCE


313 
	#__USE_SVID
 1

	)

316 #ifdef 
_ATFILE_SOURCE


317 
	#__USE_ATFILE
 1

	)

320 #ifdef 
_GNU_SOURCE


321 
	#__USE_GNU
 1

	)

324 #i
defed
 
_REENTRANT
 || defed 
_THREAD_SAFE


325 
	#__USE_REENTRANT
 1

	)

328 #i
defed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0

329 #i!
defed
 
__OPTIMIZE__
 || __OPTIMIZE__ <= 0

330 #wng 
_FORTIFY_SOURCE
 
ques
 
compg
 
wh
 
timizi
 (-
O
)

331 #i!
__GNUC_PREREQ
 (4, 1)

332 #wng 
_FORTIFY_SOURCE
 
ques
 
GCC
 4.1 

 
ϋr


333 #i
_FORTIFY_SOURCE
 > 1

334 
	#__USE_FORTIFY_LEVEL
 2

	)

336 
	#__USE_FORTIFY_LEVEL
 1

	)

339 #ide
__USE_FORTIFY_LEVEL


340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<dc-edef.h
>

353 #unde
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 17

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
m
) \

362 ((
__GLIBC__
 << 16+ 
__GLIBC_MINOR__
 >((
maj
<< 16+ (
m
))

	)

365 #i
defed
 
__GNUC__
 \

366 || (
defed
 
	g__PGI
 && defed 
	g__i386__
 ) \

367 || (
defed
 
	g__INTEL_COMPILER
 && (defed 
	g__i386__
 || defed 
	g__64__
)) \

368 || (
defed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

369 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

373 #ide
__ASSEMBLER__


374 #ide
_SYS_CDEFS_H


375 
	~<sys/cdefs.h
>

380 #i
defed
 
__USE_FILE_OFFSET64
 && !defed 
__REDIRECT


381 
	#__USE_LARGEFILE
 1

	)

382 
	#__USE_LARGEFILE64
 1

	)

388 #i
__GNUC_PREREQ
 (2, 7&& 
defed
 
__OPTIMIZE__
 \

389 && !
defed
 
	g__OPTIMIZE_SIZE__
 && !defed 
	g__NO_INLINE__
 \

390 && 
defed
 
	g__ex_le


391 
	#__USE_EXTERN_INLINES
 1

	)

399 
	~<gnu/ubs.h
>

	@/usr/include/getopt.h

20 #ide
_GETOPT_H


22 #ide
__ed_gt


23 
	#_GETOPT_H
 1

	)

33 #i!
defed
 
__GNU_LIBRARY__


34 
	~<y.h
>

37 #ide
__THROW


38 #ide
__GNUC_PREREQ


39 
	#__GNUC_PREREQ
(
maj
, 
m
(0)

	)

41 #i
defed
 
__lulus
 && 
__GNUC_PREREQ
 (2,8)

42 
	#__THROW
 
	`throw
 ()

	)

44 
	#__THROW


	)

48 #ifdef 
__lulus


58 *
ݏrg
;

72 
td
;

77 
݋
;

81 
tt
;

83 #ide
__ed_gt


105 
	sti


107 cڡ *
	gme
;

110 
	ghas_g
;

111 *
	gag
;

112 
	gv
;

117 
	#no_gumt
 0

	)

118 
	#qued_gumt
 1

	)

119 
	#tiڮ_gumt
 2

	)

147 #ifde
__GNU_LIBRARY__


151 
gt
 (
___gc
, *cڡ *
___gv
, cڡ *
__shtts
)

152 
__THROW
;

154 #i
defed
 
__ed_gt
 && defed 
__USE_POSIX2
 \

155 && !
defed
 
	g__USE_POSIX_IMPLICITLY
 && !defed 
	g__USE_GNU


159 #ifde
__REDIRECT


160 
__REDIRECT_NTH
 (
gt
, (
___gc
, *cڡ *
___gv
,

161 cڡ *
__shtts
),

162 
__posix_gt
);

164 
__posix_gt
 (
___gc
, *cڡ *
___gv
,

165 cڡ *
__shtts

__THROW
;

166 
	#gt
 
__posix_gt


	)

170 
gt
 ();

173 #ide
__ed_gt


174 
gt_lg
 (
___gc
, *cڡ *
___gv
,

175 cڡ *
__shtts
,

176 cڡ 
ti
 *
__lgts
, *
__lgd
)

177 
__THROW
;

178 
gt_lg_ly
 (
___gc
, *cڡ *
___gv
,

179 cڡ *
__shtts
,

180 cڡ 
ti
 *
__lgts
, *
__lgd
)

181 
__THROW
;

185 #ifdef 
__lulus


190 #unde
__ed_gt


	@/usr/include/libio.h

29 #ide
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cfig.h
>

34 
	#_IO_os_t
 
_G_os_t


	)

35 
	#_IO_os64_t
 
_G_os64_t


	)

36 
	#_IO_size_t
 
size_t


	)

37 
	#_IO_ssize_t
 
__ssize_t


	)

38 
	#_IO_off_t
 
__off_t


	)

39 
	#_IO_off64_t
 
__off64_t


	)

40 
	#_IO_pid_t
 
__pid_t


	)

41 
	#_IO_uid_t
 
__uid_t


	)

42 
	#_IO_icv_t
 
_G_icv_t


	)

43 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

44 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

45 
	#_IO_va_li
 
_G_va_li


	)

46 
	#_IO_wt_t
 
wt_t


	)

49 
	#__ed___va_li


	)

50 
	~<dg.h
>

51 #ifde
__GNUC_VA_LIST


52 #unde
_IO_va_li


53 
	#_IO_va_li
 
__gnuc_va_li


	)

56 #ide
__P


57 
	~<sys/cdefs.h
>

60 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

62 #ide
EOF


63 
	#EOF
 (-1)

	)

65 #ide
NULL


66 #i
defed
 
__GNUG__
 && \

67 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

68 
	#NULL
 (
__nu
)

	)

70 #i!
defed
(
__lulus
)

71 
	#NULL
 ((*)0)

	)

73 
	#NULL
 (0)

	)

78 
	#_IOS_INPUT
 1

	)

79 
	#_IOS_OUTPUT
 2

	)

80 
	#_IOS_ATEND
 4

	)

81 
	#_IOS_APPEND
 8

	)

82 
	#_IOS_TRUNC
 16

	)

83 
	#_IOS_NOCREATE
 32

	)

84 
	#_IOS_NOREPLACE
 64

	)

85 
	#_IOS_BIN
 128

	)

93 
	#_IO_MAGIC
 0xFBAD0000

	)

94 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

95 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

96 
	#_IO_USER_BUF
 1

	)

97 
	#_IO_UNBUFFERED
 2

	)

98 
	#_IO_NO_READS
 4

	)

99 
	#_IO_NO_WRITES
 8

	)

100 
	#_IO_EOF_SEEN
 0x10

	)

101 
	#_IO_ERR_SEEN
 0x20

	)

102 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

103 
	#_IO_LINKED
 0x80

	)

104 
	#_IO_IN_BACKUP
 0x100

	)

105 
	#_IO_LINE_BUF
 0x200

	)

106 
	#_IO_TIED_PUT_GET
 0x400

	)

107 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

108 
	#_IO_IS_APPENDING
 0x1000

	)

109 
	#_IO_IS_FILEBUF
 0x2000

	)

110 
	#_IO_BAD_SEEN
 0x4000

	)

111 
	#_IO_USER_LOCK
 0x8000

	)

113 
	#_IO_FLAGS2_MMAP
 1

	)

114 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

115 #ifde
_LIBC


116 
	#_IO_FLAGS2_FORTIFY
 4

	)

118 
	#_IO_FLAGS2_USER_WBUF
 8

	)

119 #ifde
_LIBC


120 
	#_IO_FLAGS2_SCANF_STD
 16

	)

121 
	#_IO_FLAGS2_NOCLOSE
 32

	)

122 
	#_IO_FLAGS2_CLOEXEC
 64

	)

126 
	#_IO_SKIPWS
 01

	)

127 
	#_IO_LEFT
 02

	)

128 
	#_IO_RIGHT
 04

	)

129 
	#_IO_INTERNAL
 010

	)

130 
	#_IO_DEC
 020

	)

131 
	#_IO_OCT
 040

	)

132 
	#_IO_HEX
 0100

	)

133 
	#_IO_SHOWBASE
 0200

	)

134 
	#_IO_SHOWPOINT
 0400

	)

135 
	#_IO_UPPERCASE
 01000

	)

136 
	#_IO_SHOWPOS
 02000

	)

137 
	#_IO_SCIENTIFIC
 04000

	)

138 
	#_IO_FIXED
 010000

	)

139 
	#_IO_UNITBUF
 020000

	)

140 
	#_IO_STDIO
 040000

	)

141 
	#_IO_DONT_CLOSE
 0100000

	)

142 
	#_IO_BOOLALPHA
 0200000

	)

145 
_IO_jump_t
; 
	g_IO_FILE
;

148 #ifde
_IO_MTSAFE_IO


149 #i
defed
 
__GLIBC__
 && __GLIBC__ >= 2

150 
	~<bs/dio-lock.h
>

155 
	t_IO_lock_t
;

161 
	s_IO_mk
 {

162 
_IO_mk
 *
	m_xt
;

163 
_IO_FILE
 *
	m_sbuf
;

167 
	m_pos
;

169 
t_ampos
(
ampos
 

{ 
	m_os
 = sp; }

170 
t_offt
(
offt
{ 
	m_pos
 = offt; 
	m_os
 = (
ampos
)(-2); }

171 
	mpublic
:

172 
ammk
(
ambuf
 *
sb
);

173 ~
ammk
();

174 
vg
({  
	m_os
 == -2; }

175 
d
(
ammk
&);

176 
d
();

181 
	e__codecvt_su


183 
	m__codecvt_ok
,

184 
	m__codecvt_l
,

185 
	m__codecvt_r
,

186 
	m__codecvt_nocv


189 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


192 
	s_IO_codecvt


194 (*
	m__codecvt_der
(
	m_IO_codecvt
 *);

195 
__codecvt_su
 (*
__codecvt_do_out
(
	m_IO_codecvt
 *,

196 
	m__mbe_t
 *,

197 cڡ 
	mwch_t
 *,

198 cڡ 
	mwch_t
 *,

199 cڡ 
	mwch_t
 **, *,

201 
__codecvt_su
 (*
__codecvt_do_unshi
(
	m_IO_codecvt
 *,

202 
	m__mbe_t
 *, *,

204 
__codecvt_su
 (*
__codecvt_do_
(
	m_IO_codecvt
 *,

205 
	m__mbe_t
 *,

207 cڡ **, 
	mwch_t
 *,

208 
	mwch_t
 *, wchar_t **);

209 (*
	m__codecvt_do_codg
(
	m_IO_codecvt
 *);

210 (*
	m__codecvt_do_ways_nocv
(
	m_IO_codecvt
 *);

211 (*
	m__codecvt_do_ngth
(
	m_IO_codecvt
 *, 
	m__mbe_t
 *,

212 cڡ *, cڡ *, 
	m_IO_size_t
);

213 (*
	m__codecvt_do_max_ngth
(
	m_IO_codecvt
 *);

215 
_IO_icv_t
 
	m__cd_
;

216 
_IO_icv_t
 
	m__cd_out
;

220 
	s_IO_wide_da


222 
wch_t
 *
	m_IO_ad_r
;

223 
wch_t
 *
	m_IO_ad_d
;

224 
wch_t
 *
	m_IO_ad_ba
;

225 
wch_t
 *
	m_IO_wre_ba
;

226 
wch_t
 *
	m_IO_wre_r
;

227 
wch_t
 *
	m_IO_wre_d
;

228 
wch_t
 *
	m_IO_buf_ba
;

229 
wch_t
 *
	m_IO_buf_d
;

231 
wch_t
 *
	m_IO_ve_ba
;

232 
wch_t
 *
	m_IO_backup_ba
;

234 
wch_t
 *
	m_IO_ve_d
;

236 
__mbe_t
 
	m_IO_e
;

237 
__mbe_t
 
	m_IO_ϡ_e
;

238 
_IO_codecvt
 
	m_codecvt
;

240 
wch_t
 
	m_shtbuf
[1];

242 cڡ 
_IO_jump_t
 *
	m_wide_vb
;

246 
	s_IO_FILE
 {

247 
	m_ags
;

248 
	#_IO_fe_ags
 
_ags


	)

252 * 
	m_IO_ad_r
;

253 * 
	m_IO_ad_d
;

254 * 
	m_IO_ad_ba
;

255 * 
	m_IO_wre_ba
;

256 * 
	m_IO_wre_r
;

257 * 
	m_IO_wre_d
;

258 * 
	m_IO_buf_ba
;

259 * 
	m_IO_buf_d
;

261 *
	m_IO_ve_ba
;

262 *
	m_IO_backup_ba
;

263 *
	m_IO_ve_d
;

265 
_IO_mk
 *
	m_mks
;

267 
_IO_FILE
 *
	m_cha
;

269 
	m_fo
;

271 
	m_blksize
;

273 
	m_ags2
;

275 
_IO_off_t
 
	m_d_offt
;

277 
	#__HAVE_COLUMN


	)

279 
	m_cur_cumn
;

280 sigd 
	m_vb_offt
;

281 
	m_shtbuf
[1];

285 
_IO_lock_t
 *
	m_lock
;

286 #ifde
_IO_USE_OLD_IO_FILE


289 
	s_IO_FILE_come


291 
_IO_FILE
 
	m_fe
;

293 #i
defed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

294 
_IO_off64_t
 
	m_offt
;

295 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


297 
_IO_codecvt
 *
	m_codecvt
;

298 
_IO_wide_da
 *
	m_wide_da
;

299 
_IO_FILE
 *
	m_䓻s_li
;

300 *
	m_䓻s_buf
;

301 
size_t
 
	m_䓻s_size
;

303 *
	m__d1
;

304 *
	m__d2
;

305 *
	m__d3
;

306 *
	m__d4
;

307 
size_t
 
	m__d5
;

309 
	m_mode
;

311 
	m_unud2
[15 *  (- 4 *  (*-  (
size_t
)];

315 #ide
__lulus


316 
_IO_FILE
 
	t_IO_FILE
;

319 
	g_IO_FILE_us
;

321 
_IO_FILE_us
 
_IO_2_1_d_
;

322 
_IO_FILE_us
 
_IO_2_1_dout_
;

323 
_IO_FILE_us
 
_IO_2_1_dr_
;

324 #ide
_LIBC


325 
	#_IO_d
 ((
_IO_FILE
*)(&
_IO_2_1_d_
))

	)

326 
	#_IO_dout
 ((
_IO_FILE
*)(&
_IO_2_1_dout_
))

	)

327 
	#_IO_dr
 ((
_IO_FILE
*)(&
_IO_2_1_dr_
))

	)

329 
_IO_FILE
 *
_IO_d
 
ibu_hidd
;

330 
_IO_FILE
 *
_IO_dout
 
ibu_hidd
;

331 
_IO_FILE
 *
_IO_dr
 
ibu_hidd
;

339 
__ssize_t
 
	t__io_ad_
 (*
	t__cook
, *
	t__buf
, 
	tsize_t
 
	t__nbys
);

347 
__ssize_t
 
	t__io_wre_
 (*
	t__cook
, cڡ *
	t__buf
,

348 
	tsize_t
 
	t__n
);

356 
	t__io_ek_
 (*
	t__cook
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

359 
	t__io_o_
 (*
	t__cook
);

362 #ifde
_GNU_SOURCE


364 
__io_ad_
 
	tcook_ad_funi_t
;

365 
__io_wre_
 
	tcook_wre_funi_t
;

366 
__io_ek_
 
	tcook_ek_funi_t
;

367 
__io_o_
 
	tcook_o_funi_t
;

372 
__io_ad_
 *
	mad
;

373 
__io_wre_
 *
	mwre
;

374 
__io_ek_
 *
	mek
;

375 
__io_o_
 *
	mo
;

376 } 
	t_IO_cook_io_funis_t
;

377 
_IO_cook_io_funis_t
 
	tcook_io_funis_t
;

379 
	g_IO_cook_fe
;

382 
_IO_cook_
 (
_IO_cook_fe
 *
__cfe
, 
__ad_wre
,

383 *
__cook
, 
_IO_cook_io_funis_t
 
__s
);

387 #ifde
__lulus


391 
__undow
 (
_IO_FILE
 *);

392 
__uow
 (
_IO_FILE
 *);

393 
__ovow
 (
_IO_FILE
 *, );

394 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


395 
_IO_wt_t
 
__wundow
 (
_IO_FILE
 *);

396 
_IO_wt_t
 
__wuow
 (
_IO_FILE
 *);

397 
_IO_wt_t
 
__wovow
 (
_IO_FILE
 *, _IO_wint_t);

400 #i 
__GNUC__
 >= 3

401 
	#_IO_BE
(
ex
, 
s

	`__but_ex
 (x),es)

	)

403 
	#_IO_BE
(
ex
, 
s
x)

	)

406 
	#_IO_gc_uocked
(
_
) \

407 (
	`_IO_BE
 ((
_
)->
_IO_ad_r
 >(_)->
_IO_ad_d
, 0) \

408 ? 
	`__uow
 (
_
: *(*(_)->
_IO_ad_r
++)

	)

409 
	#_IO_ekc_uocked
(
_
) \

410 (
	`_IO_BE
 ((
_
)->
_IO_ad_r
 >(_)->
_IO_ad_d
, 0) \

411 && 
	`__undow
 (
_
=
EOF
 ? EOF \

412 : *(*(
_
)->
_IO_ad_r
)

	)

413 
	#_IO_putc_uocked
(
_ch
, 
_
) \

414 (
	`_IO_BE
 ((
_
)->
_IO_wre_r
 >(_)->
_IO_wre_d
, 0) \

415 ? 
	`__ovow
 (
_
, ((
_ch
)) \

416 : ((*(
_
)->
_IO_wre_r
++ = (
_ch
)))

	)

418 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


419 
	#_IO_gwc_uocked
(
_
) \

420 (
	`_IO_BE
 ((
_
)->
_wide_da
 =
NULL
 \

421 || ((
_
)->
_wide_da
->
_IO_ad_r
 \

422 >(
_
)->
_wide_da
->
_IO_ad_d
), 0) \

423 ? 
	`__wuow
 (
_
: (
_IO_wt_t
*(_)->
_wide_da
->
_IO_ad_r
++)

	)

424 
	#_IO_putwc_uocked
(
_wch
, 
_
) \

425 (
	`_IO_BE
 ((
_
)->
_wide_da
 =
NULL
 \

426 || ((
_
)->
_wide_da
->
_IO_wre_r
 \

427 >(
_
)->
_wide_da
->
_IO_wre_d
), 0) \

428 ? 
	`__wovow
 (
_
, 
_wch
) \

429 : (
_IO_wt_t
(*(
_
)->
_wide_da
->
_IO_wre_r
++ = (
_wch
)))

	)

432 
	#_IO_of_uocked
(
__
(((__)->
_ags
 & 
_IO_EOF_SEEN
!0)

	)

433 
	#_IO__uocked
(
__
(((__)->
_ags
 & 
_IO_ERR_SEEN
!0)

	)

435 
_IO_gc
 (
_IO_FILE
 *
__
);

436 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__
);

437 
_IO_of
 (
_IO_FILE
 *
__

__THROW
;

438 
_IO_
 (
_IO_FILE
 *
__

__THROW
;

440 
_IO_ekc_locked
 (
_IO_FILE
 *
__
);

443 
	#_IO_PENDING_OUTPUT_COUNT
(
_
) \

444 ((
_
)->
_IO_wre_r
 - (_)->
_IO_wre_ba
)

	)

446 
_IO_ockfe
 (
_IO_FILE
 *
__THROW
;

447 
_IO_fuockfe
 (
_IO_FILE
 *
__THROW
;

448 
_IO_rylockfe
 (
_IO_FILE
 *
__THROW
;

450 #ifde
_IO_MTSAFE_IO


451 
	#_IO_ekc
(
_

	`_IO_ekc_locked
 (_)

	)

452 
	#_IO_ockfe
(
_
) \

453 i(((
_
)->
_ags
 & 
_IO_USER_LOCK
=0
	`_IO_ockfe
 (_)

	)

454 
	#_IO_fuockfe
(
_
) \

455 i(((
_
)->
_ags
 & 
_IO_USER_LOCK
=0
	`_IO_fuockfe
 (_)

	)

457 
	#_IO_ekc
(
_

	`_IO_ekc_uocked
 (_)

	)

458 
	#_IO_ockfe
(
_


	)

459 
	#_IO_fuockfe
(
_


	)

460 
	#_IO_rylockfe
(
_


	)

461 
	#_IO_nup_gi_t
(
_f
, 
_


	)

462 
	#_IO_nup_gi_d
(
_Do


	)

465 
_IO_vfsnf
 (
_IO_FILE
 * 
__ri
, const * __restrict,

466 
_IO_va_li
, *
__ri
);

467 
_IO_vrtf
 (
_IO_FILE
 *
__ri
, const *__restrict,

468 
_IO_va_li
);

469 
_IO_ssize_t
 
_IO_dn
 (
_IO_FILE
 *, , _IO_ssize_t);

470 
_IO_size_t
 
_IO_sgn
 (
_IO_FILE
 *, *, _IO_size_t);

472 
_IO_off64_t
 
_IO_ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

473 
_IO_off64_t
 
_IO_ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

475 
_IO__backup_
 (
_IO_FILE
 *
__THROW
;

477 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


478 
_IO_wt_t
 
_IO_gwc
 (
_IO_FILE
 *
__
);

479 
_IO_wt_t
 
_IO_putwc
 (
wch_t
 
__wc
, 
_IO_FILE
 *
__
);

480 
_IO_fwide
 (
_IO_FILE
 *
__
, 
__mode

__THROW
;

481 #i
__GNUC__
 >= 2

484 #i
defed
 
_LIBC
 && defed 
SHARED


485 
	~<shlib-comt.h
>

486 #i
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

487 
	#_IO_fwide_maybe_comtib
 \

488 (
	`__but_ex
 (&
_IO_d_ud
 =
NULL
, 0))

	)

489 cڡ 
_IO_d_ud
;

490 
wk_ex
 (
_IO_d_ud
);

493 #ide
_IO_fwide_maybe_comtib


494 
	#_IO_fwide_maybe_comtib
 (0)

	)

498 
	#_IO_fwide
(
__
, 
__mode
) \

499 ({ 
__su
 = (
__mode
); \

500 i(
__su
 < 0 && ! 
_IO_fwide_maybe_comtib
) \

502 i((
__
)->
_mode
 == 0) \

504 (
__
)->
_mode
 = -1; \

505 
__su
 = (
__
)->
_mode
; \

507 i(
	`__but_cڡt_p
 (
__mode
) && (__mode) == 0) \

508 
__su
 = 
_IO_fwide_maybe_comtib
 ? -1 : (
__
)->
_mode
; \

510 
__su
 = 
	`_IO_fwide
 (
__
, __result); \

511 
__su
; })

	)

514 
_IO_vfwsnf
 (
_IO_FILE
 * 
__ri
, cڡ 
wch_t
 * __restrict,

515 
_IO_va_li
, *
__ri
);

516 
_IO_vfwtf
 (
_IO_FILE
 *
__ri
, cڡ 
wch_t
 *__restrict,

517 
_IO_va_li
);

518 
_IO_ssize_t
 
_IO_wdn
 (
_IO_FILE
 *, 
wt_t
, _IO_ssize_t);

519 
_IO__wbackup_
 (
_IO_FILE
 *
__THROW
;

522 #ifde
__LDBL_COMPAT


523 
	~<bs/libio-ldbl.h
>

526 #ifde
__lulus


	@/usr/include/linux/ioctl.h

1 #ide
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/iol.h
>

	@/usr/include/linux/limits.h

1 #ide
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/sysinfo.h

1 #ide
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<lux/tys.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysfo
 {

8 
__kl_lg_t
 
	muime
;

9 
__kl_ulg_t
 
	mlds
[3];

10 
__kl_ulg_t
 
	mtٮm
;

11 
__kl_ulg_t
 
	m䓿m
;

12 
__kl_ulg_t
 
	mshedm
;

13 
__kl_ulg_t
 
	mbufam
;

14 
__kl_ulg_t
 
	mtٮsw
;

15 
__kl_ulg_t
 
	msw
;

16 
__u16
 
	mocs
;

17 
__u16
 
	md
;

18 
__kl_ulg_t
 
	mtٮhigh
;

19 
__kl_ulg_t
 
	mhigh
;

20 
__u32
 
	mmem_un
;

21 
	m_f
[20-2*(
__kl_ulg_t
)-(
__u32
)];

	@/usr/include/linux/types.h

1 #ide
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/tys.h
>

6 #ide
__ASSEMBLY__


8 
	~<lux/posix_tys.h
>

16 #ifde
__CHECKER__


17 
	#__bwi__
 
	`__ibu__
((
bwi
))

	)

19 
	#__bwi__


	)

21 #ifde
__CHECK_ENDIAN__


22 
	#__bwi
 
__bwi__


	)

24 
	#__bwi


	)

27 
__u16
 
	t__bwi
 
	t__16
;

28 
__u16
 
	t__bwi
 
	t__be16
;

29 
__u32
 
	t__bwi
 
	t__32
;

30 
__u32
 
	t__bwi
 
	t__be32
;

31 
__u64
 
	t__bwi
 
	t__64
;

32 
__u64
 
	t__bwi
 
	t__be64
;

34 
__u16
 
	t__bwi
 
	t__sum16
;

35 
__u32
 
	t__bwi
 
	t__wsum
;

46 
	#__igd_u64
 
__u64
 
	`__ibu__
((
	`igd
(8)))

	)

47 
	#__igd_be64
 
__be64
 
	`__ibu__
((
	`igd
(8)))

	)

48 
	#__igd_64
 
__64
 
	`__ibu__
((
	`igd
(8)))

	)

	@/usr/include/xlocale.h

20 #ide
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__lo_ru


30 
__lo_da
 *
	m__los
[13];

33 cڡ *
	m__y_b
;

34 cڡ *
	m__y_tow
;

35 cڡ *
	m__y_tou
;

38 cڡ *
	m__mes
[13];

39 } *
	t__lo_t
;

42 
__lo_t
 
	tlo_t
;

	@/usr/include/_G_config.h

4 #ide
_G_cfig_h


5 
	#_G_cfig_h
 1

	)

9 
	~<bs/tys.h
>

10 
	#__ed_size_t


	)

11 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


12 
	#__ed_wch_t


	)

14 
	#__ed_NULL


	)

15 
	~<ddef.h
>

16 
	#__ed_mbe_t


	)

17 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


18 
	#__ed_wt_t


	)

20 
	~<wch.h
>

23 
__off_t
 
	m__pos
;

24 
__mbe_t
 
	m__e
;

25 } 
	t_G_os_t
;

28 
__off64_t
 
	m__pos
;

29 
__mbe_t
 
	m__e
;

30 } 
	t_G_os64_t
;

31 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcv.h
>

35 
__gcv_fo
 
	m__cd
;

38 
__gcv_fo
 
	m__cd
;

39 
__gcv__da
 
	m__da
;

40 } 
	m__combed
;

41 } 
	t_G_icv_t
;

46 
	#_G_va_li
 
__gnuc_va_li


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/linux/posix_types.h

1 #ide
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lux/ddef.h
>

21 #unde
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kl_fd_t
;

29 (*
	t__kl_sighdr_t
)();

32 
	t__kl_key_t
;

33 
	t__kl_mqd_t
;

35 
	~<asm/posix_tys.h
>

	@/usr/include/stdc-predef.h

18 #idef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

30 
	#__STDC_IEC_559__
 1

	)

31 
	#__STDC_IEC_559_COMPLEX__
 1

	)

35 
	#__STDC_ISO_10646__
 201103L

	)

38 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/gconv.h

22 #ide
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<us.h
>

26 
	#__ed_mbe_t


	)

27 
	#__ed_wt_t


	)

28 
	~<wch.h
>

29 
	#__ed_size_t


	)

30 
	#__ed_wch_t


	)

31 
	~<ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch_t
0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gcv_
;

66 
	g__gcv__da
;

67 
	g__gcv_lded_obje
;

71 (*
	t__gcv_f
(
	t__gcv_
 *, 
	t__gcv__da
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wt_t
 (*
	t__gcv_btowc_f
(
	t__gcv_
 *, );

79 (*
	t__gcv__f
(
	t__gcv_
 *);

80 (*
	t__gcv_d_f
(
	t__gcv_
 *);

84 
	s__gcv_


86 
__gcv_lded_obje
 *
__shlib_hd
;

87 cڡ *
__modme
;

89 
__cou
;

91 *
__om_me
;

92 *
__to_me
;

94 
__gcv_f
 
__f
;

95 
__gcv_btowc_f
 
__btowc_f
;

96 
__gcv__f
 
___f
;

97 
__gcv_d_f
 
__d_f
;

101 
__m_eded_om
;

102 
__max_eded_om
;

103 
__m_eded_to
;

104 
__max_eded_to
;

107 
__eful
;

109 *
__da
;

114 
	s__gcv__da


116 *
__outbuf
;

117 *
__outbund
;

121 
__ags
;

125 
__voti_cou
;

129 
___u
;

131 
__mbe_t
 *
__
;

132 
__mbe_t
 
__e
;

138 
	s__gcv_fo


140 
size_t
 
__ns
;

141 
__gcv_
 *
__s
;

142 
__exnsi__
 
__gcv__da
 
__da
 
__exr
;

143 } *
	t__gcv_t
;

146 
	`__gcv_e
 (
__gcv_
 *

,

147 
__gcv__da
 *
_da
,

148 cڡ *
buft
,

149 cڡ **
bu
,

150 cڡ *
bund
,

151 **
outbuft
,

152 
size_t
 *
vsib
);

	@/usr/include/linux/stddef.h

	@/usr/include/wchar.h

23 #ide
_WCHAR_H


25 #i!
defed
 
__ed_mbe_t
 && !defed 
__ed_wt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<us.h
>

30 #ifde
_WCHAR_H


32 
	#__ed___FILE


	)

33 #i
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K


34 
	#__ed_FILE


	)

36 
	~<dio.h
>

38 
	#__ed___va_li


	)

39 
	~<dg.h
>

41 
	~<bs/wch.h
>

44 
	#__ed_size_t


	)

45 
	#__ed_wch_t


	)

46 
	#__ed_NULL


	)

48 #i
defed
 
_WCHAR_H
 || defed 
__ed_wt_t
 || !defed 
__WINT_TYPE__


49 #unde
__ed_wt_t


50 
	#__ed_wt_t


	)

51 
	~<ddef.h
>

55 #ide
_WINT_T


60 
	#_WINT_T


	)

61 
	twt_t
;

65 #i
defed
 
__lulus
 && defed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twt_t
;

69 
	g__END_NAMESPACE_STD


74 #i
defed
 
__lulus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #i(
defed
 
_WCHAR_H
 || defed 
__ed_mbe_t
&& !defed 
____mbe_t_defed


80 
	#____mbe_t_defed
 1

	)

84 
	m__cou
;

87 #ifde
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__vue
;

94 } 
	t__mbe_t
;

96 #unde
__ed_mbe_t


101 #ifde
_WCHAR_H


103 #ide
__mbe_t_defed


104 
__BEGIN_NAMESPACE_C99


106 
__mbe_t
 
	tmbe_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mbe_t_defed
 1

	)

111 #ifde
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mbe_t
)

115 #ide
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #ide
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #i
defed
 
__USE_XOPEN
 && !defed 
__USE_UNIX98


128 
	~<wy.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch_t
 *
	$wcsy
 (
wch_t
 *
__ri
 
__de
,

148 cڡ 
wch_t
 *
__ri
 
__c

__THROW
;

150 
wch_t
 *
	$wcy
 (
wch_t
 *
__ri
 
__de
,

151 cڡ 
wch_t
 *
__ri
 
__c
, 
size_t
 
__n
)

152 
__THROW
;

155 
wch_t
 *
	$wcst
 (
wch_t
 *
__ri
 
__de
,

156 cڡ 
wch_t
 *
__ri
 
__c

__THROW
;

158 
wch_t
 *
	$wct
 (
wch_t
 *
__ri
 
__de
,

159 cڡ 
wch_t
 *
__ri
 
__c
, 
size_t
 
__n
)

160 
__THROW
;

163 
	$wcscmp
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
)

164 
__THROW
 
__ibu_pu__
;

166 
	$wccmp
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
, 
size_t
 
__n
)

167 
__THROW
 
__ibu_pu__
;

168 
__END_NAMESPACE_STD


170 #ifde
__USE_XOPEN2K8


172 
	$wcscmp
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2

__THROW
;

175 
	$wccmp
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
,

176 
size_t
 
__n

__THROW
;

180 
	~<xlo.h
>

182 
	$wcscmp_l
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
,

183 
__lo_t
 
__loc

__THROW
;

185 
	$wccmp_l
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
,

186 
size_t
 
__n
, 
__lo_t
 
__loc

__THROW
;

189 
__BEGIN_NAMESPACE_STD


192 
	$wcscl
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2

__THROW
;

196 
size_t
 
	$wcsxm
 (
wch_t
 *
__ri
 
__s1
,

197 cڡ 
wch_t
 *
__ri
 
__s2
, 
size_t
 
__n

__THROW
;

198 
__END_NAMESPACE_STD


200 #ifde
__USE_XOPEN2K8


206 
	$wcscl_l
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
,

207 
__lo_t
 
__loc

__THROW
;

212 
size_t
 
	$wcsxm_l
 (
wch_t
 *
__s1
, cڡ wch_*
__s2
,

213 
size_t
 
__n
, 
__lo_t
 
__loc

__THROW
;

216 
wch_t
 *
	$wcsdup
 (cڡ 
wch_t
 *
__s

__THROW
 
__ibu_mloc__
;

219 
__BEGIN_NAMESPACE_STD


221 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


222 "C++" 
wch_t
 *
	$wcschr
 (
wch_t
 *
__wcs
, wch_
__wc
)

223 
__THROW
 
	`__asm
 ("wcschr"
__ibu_pu__
;

224 "C++" cڡ 
wch_t
 *
	$wcschr
 (cڡ 
wch_t
 *
__wcs
, wch_
__wc
)

225 
__THROW
 
	`__asm
 ("wcschr"
__ibu_pu__
;

227 
wch_t
 *
	$wcschr
 (cڡ 
wch_t
 *
__wcs
, wch_
__wc
)

228 
__THROW
 
__ibu_pu__
;

231 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


232 "C++" 
wch_t
 *
	$wcchr
 (
wch_t
 *
__wcs
, wch_
__wc
)

233 
__THROW
 
	`__asm
 ("wcchr"
__ibu_pu__
;

234 "C++" cڡ 
wch_t
 *
	$wcchr
 (cڡ 
wch_t
 *
__wcs
, wch_
__wc
)

235 
__THROW
 
	`__asm
 ("wcchr"
__ibu_pu__
;

237 
wch_t
 *
	$wcchr
 (cڡ 
wch_t
 *
__wcs
, wch_
__wc
)

238 
__THROW
 
__ibu_pu__
;

240 
__END_NAMESPACE_STD


242 #ifde
__USE_GNU


245 
wch_t
 *
	$wcschul
 (cڡ 
wch_t
 *
__s
, wch_
__wc
)

246 
__THROW
 
__ibu_pu__
;

249 
__BEGIN_NAMESPACE_STD


252 
size_t
 
	$wcscn
 (cڡ 
wch_t
 *
__wcs
, cڡ wch_*
__je
)

253 
__THROW
 
__ibu_pu__
;

256 
size_t
 
	$wcsn
 (cڡ 
wch_t
 *
__wcs
, cڡ wch_*
__ac
)

257 
__THROW
 
__ibu_pu__
;

259 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


260 "C++" 
wch_t
 *
	$wcbrk
 (
wch_t
 *
__wcs
, cڡ wch_*
__ac
)

261 
__THROW
 
	`__asm
 ("wcbrk"
__ibu_pu__
;

262 "C++" cڡ 
wch_t
 *
	$wcbrk
 (cڡ 
wch_t
 *
__wcs
,

263 cڡ 
wch_t
 *
__ac
)

264 
__THROW
 
	`__asm
 ("wcbrk"
__ibu_pu__
;

266 
wch_t
 *
	$wcbrk
 (cڡ 
wch_t
 *
__wcs
, cڡ wch_*
__ac
)

267 
__THROW
 
__ibu_pu__
;

270 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


271 "C++" 
wch_t
 *
	$wcsr
 (
wch_t
 *
__hayack
, cڡ wch_*
__ed
)

272 
__THROW
 
	`__asm
 ("wcsr"
__ibu_pu__
;

273 "C++" cڡ 
wch_t
 *
	$wcsr
 (cڡ 
wch_t
 *
__hayack
,

274 cڡ 
wch_t
 *
__ed
)

275 
__THROW
 
	`__asm
 ("wcsr"
__ibu_pu__
;

277 
wch_t
 *
	$wcsr
 (cڡ 
wch_t
 *
__hayack
, cڡ wch_*
__ed
)

278 
__THROW
 
__ibu_pu__
;

282 
wch_t
 *
	$wcok
 (
wch_t
 *
__ri
 
__s
,

283 cڡ 
wch_t
 *
__ri
 
__dim
,

284 
wch_t
 **
__ri
 
__r

__THROW
;

287 
size_t
 
	$wc
 (cڡ 
wch_t
 *
__s

__THROW
 
__ibu_pu__
;

288 
__END_NAMESPACE_STD


290 #ifde
__USE_XOPEN


292 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


293 "C++" 
wch_t
 *
	$wcswcs
 (
wch_t
 *
__hayack
, cڡ wch_*
__ed
)

294 
__THROW
 
	`__asm
 ("wcswcs"
__ibu_pu__
;

295 "C++" cڡ 
wch_t
 *
	$wcswcs
 (cڡ 
wch_t
 *
__hayack
,

296 cڡ 
wch_t
 *
__ed
)

297 
__THROW
 
	`__asm
 ("wcswcs"
__ibu_pu__
;

299 
wch_t
 *
	$wcswcs
 (cڡ 
wch_t
 *
__hayack
, cڡ wch_*
__ed
)

300 
__THROW
 
__ibu_pu__
;

304 #ifde
__USE_XOPEN2K8


306 
size_t
 
	$wcn
 (cڡ 
wch_t
 *
__s
, 
size_t
 
__maxn
)

307 
__THROW
 
__ibu_pu__
;

311 
__BEGIN_NAMESPACE_STD


313 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


314 "C++" 
wch_t
 *
	$wmemchr
 (
wch_t
 *
__s
, wch_
__c
, 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
;

316 "C++" cڡ 
wch_t
 *
	$wmemchr
 (cڡ 
wch_t
 *
__s
, wch_
__c
,

317 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
;

320 
wch_t
 *
	$wmemchr
 (cڡ 
wch_t
 *
__s
, wch_
__c
, 
size_t
 
__n
)

321 
__THROW
 
__ibu_pu__
;

325 
	$wmemcmp
 (cڡ 
wch_t
 *
__s1
, cڡ wch_*
__s2
, 
size_t
 
__n
)

326 
__THROW
 
__ibu_pu__
;

329 
wch_t
 *
	$wmemy
 (
wch_t
 *
__ri
 
__s1
,

330 cڡ 
wch_t
 *
__ri
 
__s2
, 
size_t
 
__n

__THROW
;

334 
wch_t
 *
	$wmemmove
 (
wch_t
 *
__s1
, cڡ wch_*
__s2
, 
size_t
 
__n
)

335 
__THROW
;

338 
wch_t
 *
	$wmemt
 (
wch_t
 *
__s
, wch_
__c
, 
size_t
 
__n

__THROW
;

339 
__END_NAMESPACE_STD


341 #ifde
__USE_GNU


344 
wch_t
 *
	$wmempy
 (
wch_t
 *
__ri
 
__s1
,

345 cڡ 
wch_t
 *
__ri
 
__s2
, 
size_t
 
__n
)

346 
__THROW
;

350 
__BEGIN_NAMESPACE_STD


353 
wt_t
 
	$btowc
 (
__c

__THROW
;

357 
	$wob
 (
wt_t
 
__c

__THROW
;

361 
	$mbs
 (cڡ 
mbe_t
 *
__ps

__THROW
 
__ibu_pu__
;

365 
size_t
 
	$mbowc
 (
wch_t
 *
__ri
 
__pwc
,

366 cڡ *
__ri
 
__s
, 
size_t
 
__n
,

367 
mbe_t
 *
__ri
 
__p

__THROW
;

370 
size_t
 
	$wtomb
 (*
__ri
 
__s
, 
wch_t
 
__wc
,

371 
mbe_t
 *
__ri
 
__ps

__THROW
;

374 
size_t
 
	$__mb
 (cڡ *
__ri
 
__s
, 
size_t
 
__n
,

375 
mbe_t
 *
__ri
 
__ps

__THROW
;

376 
size_t
 
	$mb
 (cڡ *
__ri
 
__s
, 
size_t
 
__n
,

377 
mbe_t
 *
__ri
 
__ps

__THROW
;

378 
__END_NAMESPACE_STD


380 #ifde
__USE_EXTERN_INLINES


386 
wt_t
 
	$__btowc_s
 (
__c

	`__asm
 ("btowc");

387 
__ex_le
 
wt_t


388 
	`__NTH
 (
	$btowc
 (
__c
))

389 {  (
	`__but_cڡt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

390 ? (
wt_t

__c
 : 
	`__btowc_s
 (__c)); 
	}
}

392 
	$__wob_s
 (
wt_t
 
__c

	`__asm
 ("wctob");

393 
__ex_le
 

394 
	`__NTH
 (
	$wob
 (
wt_t
 
__wc
))

395 {  (
	`__but_cڡt_p
 (
__wc
&& __w>
L
'\0' && __wc <= L'\x7f'

396 ? (
__wc
 : 
	`__wob_s
 (__wc)); 
	}
}

398 
__ex_le
 
size_t


399 
__NTH
 (
	$mb
 (cڡ *
__ri
 
__s
, 
size_t
 
__n
,

400 
mbe_t
 *
__ri
 
__ps
))

401 {  (
__ps
 !
NULL


402 ? 
	`mbowc
 (
NULL
, 
__s
, 
__n
, 
__ps
: 
	`__mb
 (__s, __n, NULL)); 
	}
}

405 
__BEGIN_NAMESPACE_STD


408 
size_t
 
	$mbtowcs
 (
wch_t
 *
__ri
 
__d
,

409 cڡ **
__ri
 
__c
, 
size_t
 
__n
,

410 
mbe_t
 *
__ri
 
__ps

__THROW
;

414 
size_t
 
	$wctombs
 (*
__ri
 
__d
,

415 cڡ 
wch_t
 **
__ri
 
__c
, 
size_t
 
__n
,

416 
mbe_t
 *
__ri
 
__ps

__THROW
;

417 
__END_NAMESPACE_STD


420 #ifdef 
__USE_XOPEN2K8


423 
size_t
 
	$mbowcs
 (
wch_t
 *
__ri
 
__d
,

424 cڡ **
__ri
 
__c
, 
size_t
 
__nmc
,

425 
size_t
 
__n
, 
mbe_t
 *
__ri
 
__ps

__THROW
;

429 
size_t
 
	$wcombs
 (*
__ri
 
__d
,

430 cڡ 
wch_t
 **
__ri
 
__c
,

431 
size_t
 
__nwc
, size_
__n
,

432 
mbe_t
 *
__ri
 
__ps

__THROW
;

437 #ifde
__USE_XOPEN


439 
	$wcwidth
 (
wch_t
 
__c

__THROW
;

443 
	$wcswidth
 (cڡ 
wch_t
 *
__s
, 
size_t
 
__n

__THROW
;

447 
__BEGIN_NAMESPACE_STD


450 
	$wcod
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

451 
wch_t
 **
__ri
 
__dr

__THROW
;

452 
__END_NAMESPACE_STD


454 #ifde
__USE_ISOC99


455 
__BEGIN_NAMESPACE_C99


457 
	$wcof
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

458 
wch_t
 **
__ri
 
__dr

__THROW
;

459 
	$wcd
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

460 
wch_t
 **
__ri
 
__dr

__THROW
;

461 
__END_NAMESPACE_C99


465 
__BEGIN_NAMESPACE_STD


468 
	$wc
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

469 
wch_t
 **
__ri
 
__dr
, 
__ba

__THROW
;

473 
	$wcoul
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

474 
wch_t
 **
__ri
 
__dr
, 
__ba
)

475 
__THROW
;

476 
__END_NAMESPACE_STD


478 #i
defed
 
__USE_ISOC99
 || (defed 
__GNUC__
 && defed 
__USE_GNU
)

479 
__BEGIN_NAMESPACE_C99


482 
__exnsi__


483 
	$wcl
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

484 
wch_t
 **
__ri
 
__dr
, 
__ba
)

485 
__THROW
;

489 
__exnsi__


490 
	$wcou
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

491 
wch_t
 **
__ri
 
__dr
,

492 
__ba

__THROW
;

493 
__END_NAMESPACE_C99


496 #i
defed
 
__GNUC__
 && defed 
__USE_GNU


499 
__exnsi__


500 
	$wcoq
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

501 
wch_t
 **
__ri
 
__dr
, 
__ba
)

502 
__THROW
;

506 
__exnsi__


507 
	$wcouq
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

508 
wch_t
 **
__ri
 
__dr
,

509 
__ba

__THROW
;

512 #ifde
__USE_GNU


526 
	~<xlo.h
>

530 
	$wc_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

531 
wch_t
 **
__ri
 
__dr
, 
__ba
,

532 
__lo_t
 
__loc

__THROW
;

534 
	$wcoul_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

535 
wch_t
 **
__ri
 
__dr
,

536 
__ba
, 
__lo_t
 
__loc

__THROW
;

538 
__exnsi__


539 
	$wcl_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

540 
wch_t
 **
__ri
 
__dr
,

541 
__ba
, 
__lo_t
 
__loc

__THROW
;

543 
__exnsi__


544 
	$wcou_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

545 
wch_t
 **
__ri
 
__dr
,

546 
__ba
, 
__lo_t
 
__loc
)

547 
__THROW
;

549 
	$wcod_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

550 
wch_t
 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

551 
__THROW
;

553 
	$wcof_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

554 
wch_t
 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

555 
__THROW
;

557 
	$wcd_l
 (cڡ 
wch_t
 *
__ri
 
__Ō
,

558 
wch_t
 **
__ri
 
__dr
,

559 
__lo_t
 
__loc

__THROW
;

563 #ifde
__USE_XOPEN2K8


566 
wch_t
 *
	$wy
 (
wch_t
 *
__ri
 
__de
,

567 cڡ 
wch_t
 *
__ri
 
__c

__THROW
;

571 
wch_t
 *
	$wny
 (
wch_t
 *
__ri
 
__de
,

572 cڡ 
wch_t
 *
__ri
 
__c
, 
size_t
 
__n
)

573 
__THROW
;

580 
__FILE
 *
	$ݒ_wmemam
 (
wch_t
 **
__buoc
, 
size_t
 *
__sizoc

__THROW
;

583 #i
defed
 
__USE_ISOC95
 || defed 
__USE_UNIX98


584 
__BEGIN_NAMESPACE_STD


587 
	$fwide
 (
__FILE
 *
__
, 
__mode

__THROW
;

594 
	`fwtf
 (
__FILE
 *
__ri
 
__am
,

595 cڡ 
wch_t
 *
__ri
 
__fm
, ...)

601 
	`wtf
 (cڡ 
wch_t
 *
__ri
 
__fm
, ...)

604 
	$swtf
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__n
,

605 cڡ 
wch_t
 *
__ri
 
__fm
, ...)

606 
__THROW
 ;

612 
	`vfwtf
 (
__FILE
 *
__ri
 
__s
,

613 cڡ 
wch_t
 *
__ri
 
__fm
,

614 
__gnuc_va_li
 
__g
)

620 
	`vwtf
 (cڡ 
wch_t
 *
__ri
 
__fm
,

621 
__gnuc_va_li
 
__g
)

625 
	$vswtf
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__n
,

626 cڡ 
wch_t
 *
__ri
 
__fm
,

627 
__gnuc_va_li
 
__g
)

628 
__THROW
 ;

635 
	`fwsnf
 (
__FILE
 *
__ri
 
__am
,

636 cڡ 
wch_t
 *
__ri
 
__fm
, ...)

642 
	`wsnf
 (cڡ 
wch_t
 *
__ri
 
__fm
, ...)

645 
	$swsnf
 (cڡ 
wch_t
 *
__ri
 
__s
,

646 cڡ 
wch_t
 *
__ri
 
__fm
, ...)

647 
__THROW
 ;

649 #i
defed
 
__USE_ISOC99
 && !defed 
__USE_GNU
 \

650 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

651 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

652 #ifde
__REDIRECT


656 
	`__REDIRECT
 (
fwsnf
, (
__FILE
 *
__ri
 
__am
,

657 cڡ 
wch_t
 *
__ri
 
__fm
, ...),

658 
__isoc99_fwsnf
)

660 
	`__REDIRECT
 (
wsnf
, (cڡ 
wch_t
 *
__ri
 
__fm
, ...),

661 
__isoc99_wsnf
)

663 
	`__REDIRECT_NTH
 (
swsnf
, (cڡ 
wch_t
 *
__ri
 
__s
,

664 cڡ 
wch_t
 *
__ri
 
__fm
,

665 ...), 
__isoc99_swsnf
)

668 
	`__isoc99_fwsnf
 (
__FILE
 *
__ri
 
__am
,

669 cڡ 
wch_t
 *
__ri
 
__fm
, ...);

670 
	`__isoc99_wsnf
 (cڡ 
wch_t
 *
__ri
 
__fm
, ...);

671 
	$__isoc99_swsnf
 (cڡ 
wch_t
 *
__ri
 
__s
,

672 cڡ 
wch_t
 *
__ri
 
__fm
, ...)

673 
__THROW
;

674 
	#fwsnf
 
__isoc99_fwsnf


	)

675 
	#wsnf
 
__isoc99_wsnf


	)

676 
	#swsnf
 
__isoc99_swsnf


	)

680 
__END_NAMESPACE_STD


683 #ifde
__USE_ISOC99


684 
__BEGIN_NAMESPACE_C99


689 
	`vfwsnf
 (
__FILE
 *
__ri
 
__s
,

690 cڡ 
wch_t
 *
__ri
 
__fm
,

691 
__gnuc_va_li
 
__g
)

697 
	`vwsnf
 (cڡ 
wch_t
 *
__ri
 
__fm
,

698 
__gnuc_va_li
 
__g
)

701 
	$vswsnf
 (cڡ 
wch_t
 *
__ri
 
__s
,

702 cڡ 
wch_t
 *
__ri
 
__fm
,

703 
__gnuc_va_li
 
__g
)

704 
__THROW
 ;

706 #i!
defed
 
__USE_GNU
 \

707 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

708 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

709 #ifde
__REDIRECT


710 
	`__REDIRECT
 (
vfwsnf
, (
__FILE
 *
__ri
 
__s
,

711 cڡ 
wch_t
 *
__ri
 
__fm
,

712 
__gnuc_va_li
 
__g
), 
__isoc99_vfwsnf
)

714 
	`__REDIRECT
 (
vwsnf
, (cڡ 
wch_t
 *
__ri
 
__fm
,

715 
__gnuc_va_li
 
__g
), 
__isoc99_vwsnf
)

717 
	`__REDIRECT_NTH
 (
vswsnf
, (cڡ 
wch_t
 *
__ri
 
__s
,

718 cڡ 
wch_t
 *
__ri
 
__fm
,

719 
__gnuc_va_li
 
__g
), 
__isoc99_vswsnf
)

722 
	`__isoc99_vfwsnf
 (
__FILE
 *
__ri
 
__s
,

723 cڡ 
wch_t
 *
__ri
 
__fm
,

724 
__gnuc_va_li
 
__g
);

725 
	`__isoc99_vwsnf
 (cڡ 
wch_t
 *
__ri
 
__fm
,

726 
__gnuc_va_li
 
__g
);

727 
	$__isoc99_vswsnf
 (cڡ 
wch_t
 *
__ri
 
__s
,

728 cڡ 
wch_t
 *
__ri
 
__fm
,

729 
__gnuc_va_li
 
__g

__THROW
;

730 
	#vfwsnf
 
__isoc99_vfwsnf


	)

731 
	#vwsnf
 
__isoc99_vwsnf


	)

732 
	#vswsnf
 
__isoc99_vswsnf


	)

736 
__END_NAMESPACE_C99


740 
__BEGIN_NAMESPACE_STD


745 
wt_t
 
	`fgwc
 (
__FILE
 *
__am
);

746 
wt_t
 
	`gwc
 (
__FILE
 *
__am
);

752 
wt_t
 
	`gwch
 ();

759 
wt_t
 
	`utwc
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

760 
wt_t
 
	`putwc
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

766 
wt_t
 
	`putwch
 (
wch_t
 
__wc
);

774 
wch_t
 *
	`fgws
 (wch_*
__ri
 
__ws
, 
__n
,

775 
__FILE
 *
__ri
 
__am
);

781 
	`utws
 (cڡ 
wch_t
 *
__ri
 
__ws
,

782 
__FILE
 *
__ri
 
__am
);

789 
wt_t
 
	`ungwc
 (wt_
__wc
, 
__FILE
 *
__am
);

790 
__END_NAMESPACE_STD


793 #ifde
__USE_GNU


801 
wt_t
 
	`gwc_uocked
 (
__FILE
 *
__am
);

802 
wt_t
 
	`gwch_uocked
 ();

810 
wt_t
 
	`fgwc_uocked
 (
__FILE
 *
__am
);

818 
wt_t
 
	`utwc_uocked
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

827 
wt_t
 
	`putwc_uocked
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

828 
wt_t
 
	`putwch_uocked
 (
wch_t
 
__wc
);

837 
wch_t
 *
	`fgws_uocked
 (wch_*
__ri
 
__ws
, 
__n
,

838 
__FILE
 *
__ri
 
__am
);

846 
	`utws_uocked
 (cڡ 
wch_t
 *
__ri
 
__ws
,

847 
__FILE
 *
__ri
 
__am
);

851 
__BEGIN_NAMESPACE_C99


855 
size_t
 
	$wcsime
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__maxsize
,

856 cڡ 
wch_t
 *
__ri
 
__fm
,

857 cڡ 
tm
 *
__ri
 
__

__THROW
;

858 
__END_NAMESPACE_C99


860 #ifde
__USE_GNU


861 
	~<xlo.h
>

865 
size_t
 
	$wcsime_l
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__maxsize
,

866 cڡ 
wch_t
 *
__ri
 
__fm
,

867 cڡ 
tm
 *
__ri
 
__
,

868 
__lo_t
 
__loc

__THROW
;

877 #i
defed
 
__USE_UNIX98
 && !defed 
__USE_GNU


878 
	#__ed_iswxxx


	)

879 
	~<wy.h
>

883 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ftify_funi


884 
	~<bs/wch2.h
>

887 #ifde
__LDBL_COMPAT


888 
	~<bs/wch-ldbl.h
>

891 
__END_DECLS


899 #unde
__ed_mbe_t


900 #unde
__ed_wt_t


	@/usr/include/wctype.h

23 #ide
_WCTYPE_H


25 
	~<us.h
>

26 
	~<bs/tys.h
>

28 #ide
__ed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__ed_wt_t


	)

33 
	~<wch.h
>

37 #ide
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #unde
__ed_iswxxx


46 #ide
__iswxxx_defed


47 
	#__iswxxx_defed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twy_t
;

53 
	g__END_NAMESPACE_C99


55 #ide
_ISwb


60 
	~<dn.h
>

61 #i
__BYTE_ORDER
 =
__BIG_ENDIAN


62 
	#_ISwb
(
b
(1 << (b))

	)

64 
	#_ISwb
(
b
) \

65 ((
b
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (((1UL << (
b
)>> 24))))

	)

73 
	m__ISwu
 = 0,

74 
	m__ISwlow
 = 1,

75 
	m__ISwpha
 = 2,

76 
	m__ISwdig
 = 3,

77 
	m__ISwxdig
 = 4,

78 
	m__ISwa
 = 5,

79 
	m__ISwt
 = 6,

80 
	m__ISwgph
 = 7,

81 
	m__ISwbnk
 = 8,

82 
	m__ISwl
 = 9,

83 
	m__ISwpun
 = 10,

84 
	m__ISwnum
 = 11,

86 
	m_ISwu
 = 
_ISwb
 (
__ISwu
),

87 
	m_ISwlow
 = 
_ISwb
 (
__ISwlow
),

88 
	m_ISwpha
 = 
_ISwb
 (
__ISwpha
),

89 
	m_ISwdig
 = 
_ISwb
 (
__ISwdig
),

90 
	m_ISwxdig
 = 
_ISwb
 (
__ISwxdig
),

91 
	m_ISwa
 = 
_ISwb
 (
__ISwa
),

92 
	m_ISwt
 = 
_ISwb
 (
__ISwt
),

93 
	m_ISwgph
 = 
_ISwb
 (
__ISwgph
),

94 
	m_ISwbnk
 = 
_ISwb
 (
__ISwbnk
),

95 
	m_ISwl
 = 
_ISwb
 (
__ISwl
),

96 
	m_ISwpun
 = 
_ISwb
 (
__ISwpun
),

97 
	m_ISwnum
 = 
_ISwb
 (
__ISwnum
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$iswnum
 (
wt_t
 
__wc

__THROW
;

117 
	$iswpha
 (
wt_t
 
__wc

__THROW
;

120 
	$iswl
 (
wt_t
 
__wc

__THROW
;

124 
	$iswdig
 (
wt_t
 
__wc

__THROW
;

128 
	$iswgph
 (
wt_t
 
__wc

__THROW
;

133 
	$iswlow
 (
wt_t
 
__wc

__THROW
;

136 
	$iswt
 (
wt_t
 
__wc

__THROW
;

141 
	$iswpun
 (
wt_t
 
__wc

__THROW
;

146 
	$iswa
 (
wt_t
 
__wc

__THROW
;

151 
	$iswu
 (
wt_t
 
__wc

__THROW
;

156 
	$iswxdig
 (
wt_t
 
__wc

__THROW
;

161 #ifde
__USE_ISOC99


162 
	$iswbnk
 (
wt_t
 
__wc

__THROW
;

171 
wy_t
 
	$wy
 (cڡ *
__ݔty

__THROW
;

175 
	$iswy
 (
wt_t
 
__wc
, 
wy_t
 
__desc

__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cڡ 
	t__t32_t
 *
	twns_t
;

187 
__END_NAMESPACE_C99


188 #ifde
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wt_t
 
	$towlow
 (
wt_t
 
__wc

__THROW
;

197 
wt_t
 
	$towu
 (
wt_t
 
__wc

__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifde
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wns_t
 
	$wns
 (cڡ *
__ݔty

__THROW
;

221 
wt_t
 
	$towns
 (
wt_t
 
__wc
, 
wns_t
 
__desc

__THROW
;

222 
__END_NAMESPACE_C99


224 #ifde
__USE_XOPEN2K8


226 
	~<xlo.h
>

230 
	$iswnum_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

236 
	$iswpha_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

239 
	$iswl_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

243 
	$iswdig_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

247 
	$iswgph_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

252 
	$iswlow_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

255 
	$iswt_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

260 
	$iswpun_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

265 
	$iswa_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

270 
	$iswu_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

275 
	$iswxdig_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

280 
	$iswbnk_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

284 
wy_t
 
	$wy_l
 (cڡ *
__ݔty
, 
__lo_t
 
__lo
)

285 
__THROW
;

289 
	$iswy_l
 (
wt_t
 
__wc
, 
wy_t
 
__desc
, 
__lo_t
 
__lo
)

290 
__THROW
;

298 
wt_t
 
	$towlow_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

301 
wt_t
 
	$towu_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

305 
wns_t
 
	$wns_l
 (cڡ *
__ݔty
, 
__lo_t
 
__lo
)

306 
__THROW
;

309 
wt_t
 
	$towns_l
 (
wt_t
 
__wc
, 
wns_t
 
__desc
,

310 
__lo_t
 
__lo

__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
126
2342
boot/bootsect.s
boot/head.s
boot/setup.s
fs/bitmap.c
fs/block_dev.c
fs/buffer.c
fs/char_dev.c
fs/exec.c
fs/fcntl.c
fs/file_dev.c
fs/file_table.c
fs/inode.c
fs/ioctl.c
fs/namei.c
fs/open.c
fs/pipe.c
fs/read_write.c
fs/stat.c
fs/super.c
fs/truncate.c
include/a.out.h
include/asm/io.h
include/asm/memory.h
include/asm/segment.h
include/asm/system.h
include/const.h
include/ctype.h
include/errno.h
include/fcntl.h
include/linux/config.h
include/linux/fdreg.h
include/linux/fs.h
include/linux/hdreg.h
include/linux/head.h
include/linux/kernel.h
include/linux/mm.h
include/linux/sched.h
include/linux/sys.h
include/linux/tty.h
include/signal.h
include/stdarg.h
include/stddef.h
include/string.h
include/sys/stat.h
include/sys/times.h
include/sys/types.h
include/sys/utsname.h
include/sys/wait.h
include/termios.h
include/time.h
include/unistd.h
include/utime.h
init/main.c
kernel/asm.s
kernel/blk_drv/blk.h
kernel/blk_drv/floppy.c
kernel/blk_drv/hd.c
kernel/blk_drv/ll_rw_blk.c
kernel/blk_drv/ramdisk.c
kernel/chr_drv/console.c
kernel/chr_drv/keyboard.S
kernel/chr_drv/rs_io.s
kernel/chr_drv/serial.c
kernel/chr_drv/tty_io.c
kernel/chr_drv/tty_ioctl.c
kernel/exit.c
kernel/fork.c
kernel/math/math_emulate.c
kernel/mktime.c
kernel/panic.c
kernel/printk.c
kernel/sched.c
kernel/signal.c
kernel/sys.c
kernel/system_call.s
kernel/traps.c
kernel/vsprintf.c
lib/_exit.c
lib/close.c
lib/ctype.c
lib/dup.c
lib/errno.c
lib/execve.c
lib/malloc.c
lib/open.c
lib/setsid.c
lib/string.c
lib/wait.c
lib/write.c
mm/memory.c
mm/page.s
tools/build.c
/usr/include/ctype.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/linux/fdreg.h
/usr/include/linux/fs.h
/usr/include/linux/hdreg.h
/usr/include/linux/kernel.h
/usr/include/linux/sched.h
/usr/include/linux/tty.h
/usr/include/signal.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/utime.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/linux/ioctl.h
/usr/include/linux/limits.h
/usr/include/linux/sysinfo.h
/usr/include/linux/types.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/linux/posix_types.h
/usr/include/stdc-predef.h
/usr/include/gconv.h
/usr/include/linux/stddef.h
/usr/include/wchar.h
/usr/include/wctype.h
